<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]--><!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if IE 8]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><title>Deploying Tanzu Kubernetes Grid (TKG) on VMware Cloud on AWS (VMC) &#183; davidstamen.com</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content="TKG,Kubernetes,vSphere with Kubernetes,vk8s,VMware Cloud on AWS,TKC,Tanzu Kubernetes Cluster,Tanzu Kubernetes Grid,"><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:article:published_time" content="2020-05-13T08:00:00Z"><meta property="og:article:modified_time" content="2020-05-13T08:00:00Z"><meta property="og:article:tag" content="TKG"><meta property="og:article:tag" content="Kubernetes"><meta property="og:article:tag" content="vSphere with Kubernetes"><meta property="og:article:tag" content="vk8s"><meta property="og:article:tag" content="VMware Cloud on AWS"><meta property="og:article:tag" content="TKC"><meta property="og:article:tag" content="Tanzu Kubernetes Cluster"><meta property="og:article:tag" content="Tanzu Kubernetes Grid"><meta property="og:title" content="Deploying Tanzu Kubernetes Grid (TKG) on VMware Cloud on AWS (VMC)"><meta property="og:description" content="In a previous post I covered how you can deploy TKG on vSphere, for the second part of our internal hackathon we had a requirement to install TKG on VMware Cloud on AWS (VMC). This post will go over how I was able to get TKG deployed on VMC."><meta property="og:type" content="article"><meta property="og:url" content="https://davidstamen.com/deploying-tkg-on-vmc/"><meta property="og:image" content="https://davidstamen.com/images/vmctkg16.png"><meta property="article:published_time" content="2020-05-13T08:00:00+00:00"><meta property="article:modified_time" content="2020-05-13T08:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://davidstamen.com/images/vmctkg16.png"><meta name=twitter:title content="Deploying Tanzu Kubernetes Grid (TKG) on VMware Cloud on AWS (VMC)"><meta name=twitter:description content="In a previous post I covered how you can deploy TKG on vSphere, for the second part of our internal hackathon we had a requirement to install TKG on VMware Cloud on AWS (VMC). This post will go over how I was able to get TKG deployed on VMC."><meta name=twitter:site content="@davidstamen"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-67336507-1','auto');ga('send','pageview');}</script><link rel=canonical href=https://davidstamen.com/deploying-tkg-on-vmc/><link rel=apple-touch-icon-precomposed sizes=144x144 href=/touch-icon-144-precomposed.png><link rel=icon href=/favicon/favicon.ico><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6907288179836979",enable_page_level_ads:true});</script><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/js/clr-3.0/clr-icons.min.js></script><script src=/js/clr-3.0/custom-elements.min.js></script><link href=/css/clr-3.0/clr-ui.css rel=stylesheet><link href=/css/clr-3.0/clr-icons.min.css rel=stylesheet><link href=/css/custom.css rel=stylesheet><link rel=stylesheet href=/css/all.css></head><body data-ng-app=myapp data-ng-controller=MyController data-ng-mouseleave=MouseLeave($event)><div class=main-container><header class=header-2><div class=branding><a class=navbar-brand-img href=/><img alt src>
<span class=title>davidstamen.com</span></a></div><div class=header-nav [clr-nav-level]=1><a class="nav-link nav-text" href=https://davidstamen.com/ title=Home>Home</a>
<a class="nav-link nav-text" href=https://davidstamen.com/categories/pure-storage/ title="Pure Storage">Pure Storage</a>
<a class="nav-link nav-text" href=https://davidstamen.com/categories/vmware/ title=VMware>VMware</a>
<a class="nav-link nav-text" href=https://davidstamen.com/tags/ title=Tags>Tags</a>
<a class="nav-link nav-text" href=https://davidstamen.com/series/ title=Series>Series</a>
<a class="nav-link nav-text" href=https://www.youracclaim.com/users/davidstamen title=Acclaim>Acclaim</a>
<a class="nav-link nav-text" href=https://davidstamen.com/about title=About>About</a></div><div class=header-actions><form class=search id=search method=get action=//google.com/search><label for=search_input><input id=search_input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=davidstamen.com></label></form></div></header><div class=content-container><div class=content-area><h1>Deploying Tanzu Kubernetes Grid (TKG) on VMware Cloud on AWS (VMC)</h1><div class=metas><span class=clr-card-authors><div class=clr-card-authors>Published on
May 13, 2020 under <a href=/categories/vmware>VMware</a>
&#183; Tagged <a href=/tags/tkg>TKG</a>, <a href=/tags/kubernetes>Kubernetes</a>, <a href=/tags/vsphere-with-kubernetes>vSphere with Kubernetes</a>, <a href=/tags/vk8s>vk8s</a>, <a href=/tags/vmware-cloud-on-aws>VMware Cloud on AWS</a>, <a href=/tags/tkc>TKC</a>, <a href=/tags/tanzu-kubernetes-cluster>Tanzu Kubernetes Cluster</a> and <a href=/tags/tanzu-kubernetes-grid>Tanzu Kubernetes Grid</a>
&#183; Read in about 6 min (1095 words)</div></span></div><hr><p>In a previous post I covered how you can deploy TKG on vSphere, for the second part of our internal hackathon we had a requirement to install TKG on VMware Cloud on AWS (VMC). This post will go over how I was able to get TKG deployed on VMC.</p><br><html><div class="alert alert-app-level alert-info" role=alert><div class=alert-items><div class="alert-item static"><div class=alert-icon-wrapper><clr-icon class=alert-icon shape=info-circle></clr-icon></div><span class=alert-text>TKG 1.1 has been released, some of the commands may need to be updated to reflect the new versions of CLI as well as Photon and HA Proxy Images</span></div></div></div></html><h2 id=getting-started>Getting Started</h2><p>In this blog I will cover using the new VMware Fling
<a href=https://flings.vmware.com/demo-appliance-for-tanzu-kubernetes-grid target=_blank>Demo Appliance for Tanzu Kubernetes Grid</a> if you wish to configure the TKG CLI locally you can review my
<a href=/deploying-tkg-on-vsphere>previous blog</a>.</p><p>The Demo Appliance for TKG contains everything you need to deploy TKG On-Premises or in the cloud, with or without internet access. It includes all images pre-downloaded as well as the Tanzu CLI&rsquo;s, Harbor, Octant, kubectl and docker.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc1.png data-caption=caption><img width=100% src=/images/tkgvmc1.png></a></div><p>This appliance actually came in handy, as when I was originally trying to deploy TKG on VMC I was having issues pulling down the images.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>Anyone get <a href="https://twitter.com/hashtag/TKG?src=hash&ref_src=twsrc%5Etfw">#TKG</a> deployed on <a href="https://twitter.com/hashtag/VMC?src=hash&ref_src=twsrc%5Etfw">#VMC</a>? Having issues with the tkg cluster deploying..errors pulling images. /cc <a href="https://twitter.com/lamw?ref_src=twsrc%5Etfw">@lamw</a> <a href="https://twitter.com/chipzoller?ref_src=twsrc%5Etfw">@chipzoller</a> Thoughts?</p>&mdash; David Stamen (@davidstamen) <a href="https://twitter.com/davidstamen/status/1260310068727353344?ref_src=twsrc%5Etfw">May 12, 2020</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>A few responses later and a chat with William I had the TKG Demo Appliance deployed and deploying TKG and Tanzu Kubernetes Clusters on VMC with ease.</p><p>I will not go over the full details on how to deploy the TKG Demo Appliance, but a great set of instructions are located
<a href=https://hackmd.io/f51grvGxRJeTyeRxd_APeA#5-Configure-TKG-Demo-Appliance target=_blank>here.</a></p><h2 id=configuring-vmc-for-tkg>Configuring VMC for TKG</h2><blockquote><p>A much more detailed set of instructions can be found as part of the
<a href=http://vmwa.re/tkg-on-vmc-guide target=_blank>TKG Workshop Guide</a></p></blockquote><p>As we start to setup our environment first we will need to create a new network segment in VMC. We will need to first login to the <strong>Cloud Console</strong> and then navigate to <strong>Networking & Security</strong> and then to <strong>Segments</strong>. Click on <strong>Add Segment</strong> and enter a name, type, gateway/prefix and a DHCP range.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc2.png data-caption=caption><img width=100% src=/images/tkgvmc2.png></a></div><p>Next we we need to configure our firewalls to allow access, by default everything on VMC is set to <strong>Deny</strong>. Navigate to <strong>Networking & Security</strong> and then to <strong>Groups</strong> under <strong>Inventory</strong>.</p><p>Under <strong>Compute Groups</strong> we will create three groups.</p><ol><li>Lab Network (This group will contain the IPs that you wish to connect to the TKG Network. In my cause its home, so i will use my IP from whatismyip.com)</li><li>SDDC Management (This group will contain the IPs for the SDDC Management Network, by default this is 10.2.0.0/16)</li><li>TKG Network (this is the segment we created above, 192.168.2.0/24)</li></ol><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc3.png data-caption=caption><img width=100% src=/images/tkgvmc3.png></a></div><p>Under <strong>Management Groups</strong> we will create two groups.</p><ol><li>Lab Network (This group will contain the IPs that you wish to connect to the TKG Network. In my cause its home, so i will use my IP from whatismyip.com)</li><li>TKG Network (this is the segment we created above, 192.168.2.0/24)</li></ol><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc4.png data-caption=caption><img width=100% src=/images/tkgvmc4.png></a></div><p>Once our groups are created we can configure the VMC Firewall. Navigate to <strong>Networking & Security</strong> and then to <strong>Gateway Firewall</strong> under <strong>Security</strong>.</p><p>Under <strong>Compute Gateway</strong> create the following rules.</p><ol><li>Lab Network to TKG Network</li><li>TKG Network to SDDC Management</li></ol><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc5.png data-caption=caption><img width=100% src=/images/tkgvmc5.png></a></div><p>Under <strong>Management Gateway</strong> create the following rules.</p><ol><li>Lab Network to vCenter Server</li><li>TKG Network to vCenter Server</li></ol><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc6.png data-caption=caption><img width=100% src=/images/tkgvmc6.png></a></div><blockquote><p>Don&rsquo;t forget to <strong>Publish</strong> your changes to active your new firewall rules!</p></blockquote><p>Next we will need to <strong>Request a Public IP</strong> and Create a <strong>NAT Rule</strong> to access our <strong>TKG Appliance</strong>. Navigate to <strong>Networking & Security</strong> and then to <strong>Public IPs</strong> under <strong>System</strong>. Click on <strong>Request New IP</strong> and enter in a description for your IP.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc7.png data-caption=caption><img width=100% src=/images/tkgvmc7.png></a></div><p>Navigate to <strong>Networking & Security</strong> and then to <strong>NAT</strong> under <strong>Network</strong>. Click on <strong>Add NAT Rule</strong> and enter in a name, select your public ip, assign a service and available ports.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc8.png data-caption=caption><img width=100% src=/images/tkgvmc8.png></a></div><p>Once all the networking is configured we can proceed to configure the vCenter Server. We need to import the two templates, this can either by done manually as shown in my
<a href=/deploying-tkg-on-vsphere>previous blog</a>, or you can deploy them from the
<a href=https://hackmd.io/f51grvGxRJeTyeRxd_APeA#Sync-K8s-HA-Proxy-and-TKG-Demo-Appliance-OVAs target=_blank>TKG Demo Content Library</a></p><h2 id=deploying-tkg-on-vmc>Deploying TKG on VMC</h2><p>Begin by starting an SSH session to the external IP of your <strong>TKG Demo Appliance</strong></p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc9.png data-caption=caption><img width=100% src=/images/tkgvmc9.png></a></div><p>Create an <strong>SSH Keypair</strong>. Instructions are located
<a href=https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.0/vmware-tanzu-kubernetes-grid-10/GUID-install-tkg-vsphere.html#ssh-key target=_blank>here</a>. Once created you&rsquo;ll need to copy your <strong>SSH Public Key</strong> from <strong>~/.ssh/id_rsa.pub</strong></p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc10.png data-caption=caption><img width=100% src=/images/tkgvmc10.png></a></div><p>A sample <code>config.yaml</code> file is located at <strong>~/config.yaml</strong>. This will be used to provision our <strong>TKG Management Cluster</strong> this will need to be filled out for your particular environment. Update the fields to be specific for your environment including the server, password, network, resource pool and folder.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>VSPHERE_SERVER</span>: <span style=color:#f1fa8c>&#39;10.2.224.4&#39;</span>
<span style=color:#ff79c6>VSPHERE_USERNAME</span>: <span style=color:#f1fa8c>&#39;cloudadmin@vmc.local&#39;</span>
<span style=color:#ff79c6>VSPHERE_PASSWORD</span>: <span style=color:#f1fa8c>&#39;FILL-ME-IN&#39;</span>
<span style=color:#ff79c6>VSPHERE_DATACENTER</span>: <span style=color:#f1fa8c>&#39;/SDDC-Datacenter&#39;</span>
<span style=color:#ff79c6>VSPHERE_DATASTORE</span>: <span style=color:#f1fa8c>&#39;WorkloadDatastore&#39;</span>
<span style=color:#ff79c6>VSPHERE_NETWORK</span>: <span style=color:#f1fa8c>&#39;david-tkg&#39;</span>
<span style=color:#ff79c6>VSPHERE_RESOURCE_POOL</span>: <span style=color:#f1fa8c>&#39;/SDDC-Datacenter/host/Cluster-1/Resources/Compute-ResourcePool&#39;</span>
<span style=color:#ff79c6>VSPHERE_FOLDER</span>: <span style=color:#f1fa8c>&#39;/SDDC-Datacenter/vm/david&#39;</span>
<span style=color:#ff79c6>VSPHERE_TEMPLATE</span>: <span style=color:#f1fa8c>&#39;photon-3-kube-v1.17.3_vmware.2&#39;</span>
<span style=color:#ff79c6>VSPHERE_HAPROXY_TEMPLATE</span>: <span style=color:#f1fa8c>&#39;photon-3-capv-haproxy-v0.6.3_vmware.1&#39;</span>
<span style=color:#ff79c6>VSPHERE_DISK_GIB</span>: <span style=color:#bd93f9>30</span>
<span style=color:#ff79c6>VSPHERE_NUM_CPUS</span>: <span style=color:#bd93f9>2</span>
<span style=color:#ff79c6>VSPHERE_MEM_MIB</span>: <span style=color:#bd93f9>2048</span>
<span style=color:#ff79c6>VSPHERE_SSH_AUTHORIZED_KEY</span>: <span style=color:#f1fa8c>&#34;ssh_key&#34;</span>
<span style=color:#ff79c6>SERVICE_CIDR</span>: <span style=color:#f1fa8c>&#34;100.64.0.0/13&#34;</span>
<span style=color:#ff79c6>CLUSTER_CIDR</span>: <span style=color:#f1fa8c>&#34;100.96.0.0/11&#34;</span>
<span style=color:#ff79c6>KUBERNETES_VERSION</span>: v1<span style=color:#bd93f9>.17.3</span>+vmware<span style=color:#bd93f9>.2</span>
<span style=color:#ff79c6>overridesFolder</span>: /root/.tkg/overrides
<span style=color:#ff79c6>providers</span>:
  - <span style=color:#ff79c6>name</span>: cluster-api
    <span style=color:#ff79c6>url</span>: /root/.tkg/providers/cluster-api/v0<span style=color:#bd93f9>.3.3</span>/core-components.yaml
    <span style=color:#ff79c6>type</span>: CoreProvider
  - <span style=color:#ff79c6>name</span>: aws
    <span style=color:#ff79c6>url</span>: /root/.tkg/providers/infrastructure-aws/v0<span style=color:#bd93f9>.5.2</span>/infrastructure-components.yaml
    <span style=color:#ff79c6>type</span>: InfrastructureProvider
  - <span style=color:#ff79c6>name</span>: vsphere
    <span style=color:#ff79c6>url</span>: /root/.tkg/providers/infrastructure-vsphere/v0<span style=color:#bd93f9>.6.3</span>/infrastructure-components.yaml
    <span style=color:#ff79c6>type</span>: InfrastructureProvider
  - <span style=color:#ff79c6>name</span>: tkg-service-vsphere
    <span style=color:#ff79c6>url</span>: /root/.tkg/providers/infrastructure-tkg-service-vsphere/v1<span style=color:#bd93f9>.0.0</span>/unused.yaml
    <span style=color:#ff79c6>type</span>: InfrastructureProvider
  - <span style=color:#ff79c6>name</span>: kubeadm
    <span style=color:#ff79c6>url</span>: /root/.tkg/providers/bootstrap-kubeadm/v0<span style=color:#bd93f9>.3.3</span>/bootstrap-components.yaml
    <span style=color:#ff79c6>type</span>: BootstrapProvider
  - <span style=color:#ff79c6>name</span>: kubeadm
    <span style=color:#ff79c6>url</span>: /root/.tkg/providers/control-plane-kubeadm/v0<span style=color:#bd93f9>.3.3</span>/control-plane-components.yaml
    <span style=color:#ff79c6>type</span>: ControlPlaneProvider
<span style=color:#ff79c6>images</span>:
    <span style=color:#ff79c6>cert-manager</span>:
        <span style=color:#ff79c6>repository</span>: registry.rainpole.io/library/cert-manager
        <span style=color:#ff79c6>tag</span>: v0<span style=color:#bd93f9>.11</span>.0_vmware<span style=color:#bd93f9>.1</span>
</code></pre></div><p>Save your config file to <strong>~/.tkg/config.yaml</strong></p><p>Kick off your <strong>Management Cluster</strong> deployment by executing <strong>tkg init &ndash;infrastructure=vsphere</strong>. In about ~5-10 minutes your management cluster should now be provisioned.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc11.png data-caption=caption><img width=100% src=/images/tkgvmc11.png></a></div><p>Now that the TKG Management Cluster is Created. We can use TKG to provision a Tanzu Kubernetes Cluster (TKC). Execute <strong>tkg create cluster tkc01 &ndash;plan=dev</strong>. After another ~5-10 minutes your TKC cluster should now be provisioned.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc12.png data-caption=caption><img width=100% src=/images/tkgvmc12.png></a></div><p>If we want to access our application externally I recommend using
<a href=https://metallb.universe.tf/installation/#installation-by-manifest target=_blank>MetalLB</a> as its one of the easier pieces I have found to setup.</p><p>To install run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>kubectl apply <span style=color:#ff79c6>-</span>f https:<span style=color:#6272a4>//raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/namespace.yaml
</span><span style=color:#6272a4></span>kubectl apply <span style=color:#ff79c6>-</span>f https:<span style=color:#6272a4>//raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml
</span><span style=color:#6272a4></span># On first install only
kubectl create secret generic <span style=color:#ff79c6>-</span>n metallb<span style=color:#ff79c6>-</span>system memberlist <span style=color:#ff79c6>--</span>from<span style=color:#ff79c6>-</span>literal=secretkey=<span style=color:#f1fa8c>&#34;$(openssl rand -base64 128)&#34;</span>
</code></pre></div><p>You will then need to execute a YAML to specify an IP Pool to use.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>apiVersion</span>: v1
<span style=color:#ff79c6>kind</span>: ConfigMap
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>namespace</span>: metallb-system
  <span style=color:#ff79c6>name</span>: config
<span style=color:#ff79c6>data</span>:
  <span style=color:#ff79c6>config</span>: <span style=color:#f1fa8c>|
</span><span style=color:#f1fa8c>    address-pools:</span>
    - <span style=color:#ff79c6>name</span>: default
      <span style=color:#ff79c6>protocol</span>: layer2
      <span style=color:#ff79c6>addresses</span>:
      - <span style=color:#bd93f9>192.168.2.10</span> - <span style=color:#bd93f9>192.168.2.20</span>
</code></pre></div><p>Deploy your application, I like to use hipster shop as a demo.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>kubectl apply <span style=color:#ff79c6>-</span>f https:<span style=color:#6272a4>//raw.githubusercontent.com/dstamen/Kubernetes/master/demo-applications/demo-hipstershop.yaml
</span></code></pre></div><p>Once deployed find out its <strong>External-IP and Port</strong> using <strong>kubectl get svc</strong>.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc13.png data-caption=caption><img width=100% src=/images/tkgvmc13.png></a></div><p>Next, request a new <strong>Public IP from VMC</strong> and Create a <strong>NAT Rule</strong> to access our service.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc14.png data-caption=caption><img width=100% src=/images/tkgvmc14.png></a></div><p>If we access our public ip we can see our application running!</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkgvmc15.png data-caption=caption><img width=100% src=/images/tkgvmc15.png></a></div><h2 id=conclusion>Conclusion</h2><p>TKG is a very flexible component to get k8s deployed on either your cloud or on-premises VMware environments. Using the TKG Demo Appliance you can be up and running with a TKC Cluster very quickly! This is a great use case for any sort of test/dev/poc.</p><p>Questions or Comments? Leave them below!</p><h6>Share this post</h6><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vmc%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=Deploying%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20VMware%20Cloud%20on%20AWS%20%28VMC%29&url=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vmc%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5.0-4.55 2.04-4.55 4.54.0.36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3.0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35.0 12.92-6.92 12.92-12.93.0-.2.0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vmc%2f&title=Deploying%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20VMware%20Cloud%20on%20AWS%20%28VMC%29&summary=Deploying%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20VMware%20Cloud%20on%20AWS%20%28VMC%29&source=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vmc%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6.0 2.5 1 2.6 2.5.0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vmc%2f&resubmit=true&title=Deploying%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20VMware%20Cloud%20on%20AWS%20%28VMC%29" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96.0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65.0 3-1.35 3-3s-1.35-3-3-3c-1.38.0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65.0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66.0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64.0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4.0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6.0.23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1.0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1.0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Deploying%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20VMware%20Cloud%20on%20AWS%20%28VMC%29&body=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vmc%2f" target=_self rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9.0 6v12c0 1.1.9 2 2 2h20c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17.0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1.0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08.0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div></div></a><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='davidstamen';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><h3>See Also</h3><ul><li><a href=/deploying-tkg-on-vsphere/>Deploying Tanzu Kubernetes Grid (TKG) on vSphere</a></li><li><a href=/2020/04/13/part-6-deploying-vsphere-with-kubernetes-provisioning-and-managing-a-tanzu-kubernetes-cluster/>Part 6: Deploying vSphere with Kubernetes - Provisioning and Managing a Tanzu Kubernetes Cluster</a></li><li><a href=/2020/04/10/part-5-deploying-vsphere-with-kubernetes-using-vsphere-with-kubernetes/>Part 5: Deploying vSphere with Kubernetes - Using vSphere with Kubernetes</a></li><li><a href=/2020/04/10/part-4-deploying-vsphere-with-kubernetes-enabling-vsphere-with-kubernetes/>Part 4: Deploying vSphere with Kubernetes - Enabling vSphere with Kubernetes</a></li><li><a href=/2020/04/10/part-3-deploying-vsphere-with-kubernetes-deploy-and-configure-nsx-t/>Part 3: Deploying vSphere with Kubernetes - Deploy and Configure NSX-T</a></li></ul><div class="clarity-prev-next col-xs-12 col-sm-12 col-md-12 col-lg-12"><nav class=clarity-page-prev-next><div class=clr-nav-previous><a href=https://davidstamen.com/deploying-tkg-on-vsphere/ title="Deploying Tanzu Kubernetes Grid (TKG) on vSphere" class="btn btn-sm btn-outline">Previous</a></div><div class=clr-nav-next><a href=https://davidstamen.com/running-vvol-on-vmc-on-cbs/ title="Running vVols in VMware Cloud on AWS (VMC) on Pure Storage Cloud Block Store (CBS) on AWS" class="btn btn-sm btn-outline">Next</a></div></nav></div></div><nav class="sidenav clr-col-2 clr-col-sm-12 clr-col-md-12 clr-col-lg-6 clr-col-xl-6"><section class=sidenav-content><div class=card><div class=card-block><div class=card-text id=site-intro><img src=/images/me2-300.png><p>a blog about virtualization, storage and stuff<ul class=nav-list-inline><a href=//github.com/dstamen target=_blank rel=noopener title=GitHub class="fab fa-github"></a><a href=//linkedin.com/in/davidstamen target=_blank rel=noopener title=LinkedIn class="fab fa-linkedin"></a><a href=//twitter.com/davidstamen target=_blank rel=noopener title=Twitter class="fab fa-twitter"></a><a href=mailto:dstamen@gmail.com target=_blank title=Email class="fas fa-envelope"></a></ul></div></div></div><div class=card><div class=card-header><b>Latest Posts</b></div><div class=card-block><div class=card-text><ul class=list style=list-style-type:square;list-style-position:inherit><li><a class=nav-list href=https://davidstamen.com/2020/06/26/using-terraform-to-deploy-the-site-recovery-manager-8.3-appliance/>Using Terraform to Deploy the Site Recovery Manager 8.3 Appliance</a></li><li><a class=nav-list href=https://davidstamen.com/using-veba-to-expand-pure-datastore/>Using the VMware Event Broker Appliance to Automatically Expand a Pure Storage FlashArray Datastore</a></li><li><a class=nav-list href=https://davidstamen.com/2020/06/22/updating-the-vcenter-server-appliance-vcsa-with-powercli-revisited/>Updating the vCenter Server Appliance (VCSA) with PowerCLI - Revisited</a></li><li><a class=nav-list href=https://davidstamen.com/2020/06/05/configuring-vrealize-orchestrator-to-use-pure1-integration/>Configuring vRealize Orchestrator to use Pure1 Integration</a></li><li><a class=nav-list href=https://davidstamen.com/2020/06/02/unable-to-provision-a-vvol-hard-disk-on-a-vm-located-on-vmfs-datastore/>Unable to Provision a vVol Hard Disk on a VM Located on VMFS Datastore</a></li><li><a class=nav-list href=https://davidstamen.com/updating-vk8s-supervisor-cluster/>Updating a vSphere with Kubernetes Supervisor Cluster</a></li><li><a class=nav-list href=https://davidstamen.com/2020/05/26/whats-new-in-the-4.3.1-pure-storage-vsphere-client-plugin/>What's New in the 4.3.1 Pure Storage vSphere Client Plugin</a></li><li><a class=nav-list href=https://davidstamen.com/deploying-tkc-on-vk8s-using-tkgcli/>Deploying Tanzu Kubernetes Clusters (TKC) on vSphere with Kubernetes using the TKG CLI</a></li><li><a class=nav-list href=https://davidstamen.com/running-vvol-on-vmc-on-cbs/>Running vVols in VMware Cloud on AWS (VMC) on Pure Storage Cloud Block Store (CBS) on AWS</a></li><li><a class=nav-list href=https://davidstamen.com/deploying-tkg-on-vmc/>Deploying Tanzu Kubernetes Grid (TKG) on VMware Cloud on AWS (VMC)</a></li></ul></div></div></div><div class=card><div class=card-header><b>Advertisements</b></div><div class=card-block><div class=card-text align=center><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:inline-block;width:180px;height:150px data-ad-client=ca-pub-6907288179836979 data-ad-slot=6070718289></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div></div></section></nav></div></div></body></html>