<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Unable to Boot EFI VM on ESXi FC Storage  &middot; davidstamen.com</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


  <meta name="description" content="" />

  <meta name="keywords" content="PowerCLI, Storage, ">




<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2016-01-13T00:00:00Z" />
<meta property="og:article:modified_time" content="2016-01-13T00:00:00Z" />

  
    
<meta property="og:article:tag" content="PowerCLI">
    
<meta property="og:article:tag" content="Storage">
    
  

  <meta property="og:title" content="Unable to Boot EFI VM on ESXi FC Storage" />
<meta property="og:description" content="For the past week, I have been troubleshooting the strangest issue. I have been attempting to move some Windows 8.1 VM&rsquo;s from our legacy datacenter(iSCSI) to our new datacenter(FC).
Whenever I would move the VM to our new DC, it would fail to boot properly. It would boot straight to Windows Recovery. If I moved the same VM to any other type of storage(NFS, iSCSI, Local) the VM would boot perfectly fine." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2016/01/13/unable-to-boot-efi-vm-on-esxi-fc-storage/" />
<meta property="article:published_time" content="2016-01-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2016-01-13T00:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Unable to Boot EFI VM on ESXi FC Storage"/>
<meta name="twitter:description" content="For the past week, I have been troubleshooting the strangest issue. I have been attempting to move some Windows 8.1 VM&rsquo;s from our legacy datacenter(iSCSI) to our new datacenter(FC).
Whenever I would move the VM to our new DC, it would fail to boot properly. It would boot straight to Windows Recovery. If I moved the same VM to any other type of storage(NFS, iSCSI, Local) the VM would boot perfectly fine."/>
<meta name="twitter:site" content="@davidstamen"/>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-67336507-1', 'auto');
	
	ga('send', 'pageview');
}
</script>






  <link rel="canonical" href="/2016/01/13/unable-to-boot-efi-vm-on-esxi-fc-storage/" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="icon" href="/favicon/favicon.ico">

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6907288179836979",
    enable_page_level_ads: true
  });
</script>

  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    
    <script src="/js/clr-2.0/clr-icons.min.js"></script>
    <script src="/js/clr-2.0/custom-elements.min.js"></script>

    
    <link href="/css/clr-2.0/clr-ui.css" rel="stylesheet">
    
    <link href="/css/clr-2.0/clr-icons.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/all.css">
</head>
<body data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
  <div class="main-container">
    
<header class="header-7">
  <div class="branding">
    

    
    <a class="navbar-brand-img" href="/">
      <img alt="" src="">
      <span class="title">davidstamen.com</span>
      
    </a>
  </div>
  <div class="header-nav" [clr-nav-level]="1">
    
    
        <a class="nav-link  nav-text" href="/" >
          
          Home
        </a>
    
        <a class="nav-link  nav-text" href="/tags/" >
          
          Tags
        </a>
    
        <a class="nav-link  nav-text" href="/categories/" >
          
          Categories
        </a>
    
        <a class="nav-link  nav-text" href="/series/" >
          
          Series
        </a>
    
        <a class="nav-link  nav-text" href="/acclaim" >
          
          Acclaim
        </a>
    
        <a class="nav-link  nav-text" href="/about" >
          
          About
        </a>
    
  </div>
  <div class="header-actions">
  <form class="search" id="search" method="get" action="//google.com/search">
    <label for="search_input">
        <input id="search_input" type="text" name="q" placeholder="Search">
        <input type="hidden" name="as_sitesearch" value="davidstamen.com">
    </label>
</form>
</div>
</header>
<nav class="subnav" [clr-nav-level]="2">
  <ul class="nav">
    
    
    <li class="nav-item">
        <a class="nav-link " href="/vcsa-json-creator" >
          
          VCSA JSON Creator 9000
        </a>
    </li>
    
  </ul>
</nav>


<div class="content-container">
  <div class="content-area">
      <h1>Unable to Boot EFI VM on ESXi FC Storage
</h1>

      <div class="metas">
  
  <span class="clr-card-authors">
      <div class="clr-card-authors">
        Published on 
January 13, 2016 under <a class="" href="/categories/vmware">VMware</a>
        &middot; Tagged <a class="" href="/tags/powercli">PowerCLI</a> and <a class="" href="/tags/storage">Storage</a>
        &middot; Read in about 2 min (353 words)
      </div>
  </span>
  
    
    
</div>
<hr>

      
      

<p>For the past week, I have been troubleshooting the strangest issue. I have been attempting to move some Windows 8.1 VM&rsquo;s from our legacy datacenter(iSCSI) to our new datacenter(FC).</p>

<p>Whenever I would move the VM to our new DC, it would fail to boot properly. It would boot straight to Windows Recovery. If I moved the same VM to any other type of storage(NFS, iSCSI, Local) the VM would boot perfectly fine. I opened a case with VMware and our Storage vendor and no one had any idea what was causing it.</p>

<p>Strangely enough my coworker found the following article today that explains and provides a workaround. <a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2137402">KB2137402</a></p>

<p>Also, our storage vendor Pure Storage also had an article explaining the issue. [Windows-2012-R2-and-Windows-8-boot-fails-after-Storage-VMotion]<a href="http://community.purestorage.com/t5/Pure-Customer-Knowledge-Base/Windows-2012-R2-and-Windows-8-boot-fails-after-Storage-VMotion/ta-p/4109]">http://community.purestorage.com/t5/Pure-Customer-Knowledge-Base/Windows-2012-R2-and-Windows-8-boot-fails-after-Storage-VMotion/ta-p/4109]</a></p>

<p>So today I went and modified a host to have the DiskMaxIOSize to be 4096 instead of the default 32767, and the VM booted up fine! All my stress and troubleshooting could finally be resolved. Strange enough this issue has been around since 5.5 and there is still no actual resolution. I am not even sure if this is an array or VMware issue as this seems to affect 3Par and XtremIO as well.</p>

<p>However, since I had to replicate this change to a bunch of hosts I created a script to make this change.</p>

<h4 id="link-to-script"><strong><em>Link to Script</em></strong></h4>

<ul>
<li><a href="https://github.com/dstamen/PowerCLI/blob/master/Set-MaxDiskIO.ps1">Set-MaxDiskIO.ps1</a></li>
</ul>

<h4 id="preparing-to-execute-the-script"><strong><em>Preparing to Execute the Script</em></strong></h4>

<p>The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.</p>

<pre><code># PowerCLI Script for setting Disk Max IO Size
# @davidstamen
# http://davidstamen.com

#Define Variables
$cred = Get-Credential
$VC = &quot;vc.lab.local&quot;
$Cluster = &quot;Production&quot;

#Connect to vCenter
Connect-VIServer $VC -Credential $cred

#Get all Hosts
$esxHosts = Get-Cluster $Cluster | Get-VMHost | Where { $_.PowerState -eq &quot;PoweredOn&quot; -and $_.ConnectionState -eq &quot;Connected&quot; } | Sort Name

#For each host set DiskMaxIOsize to 4MB
foreach ($esx in $esxHosts) {
  Get-AdvancedSetting -Entity $esx -Name Disk.DiskMaxIOSize | Set-AdvancedSetting -Value 4096 -Confirm:$false
}
</code></pre>

<h4 id="execute-the-script"><strong><em>Execute the Script</em></strong></h4>

<ul>
<li>Run .\Set-MaxDiskIO.ps1</li>
</ul>

<p>Hopefully this helps anyone else who comes across this issue, not alot of people have seen it.</p>

      <h6>Share this post</h6>
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=%2f2016%2f01%2f13%2funable-to-boot-efi-vm-on-esxi-fc-storage%2f" target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg>
      </div>
    </div>
  </a>
    <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Unable%20to%20Boot%20EFI%20VM%20on%20ESXi%20FC%20Storage&amp;url=%2f2016%2f01%2f13%2funable-to-boot-efi-vm-on-esxi-fc-storage%2f" target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg>
      </div>
    </div>
  </a>
  <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2f2016%2f01%2f13%2funable-to-boot-efi-vm-on-esxi-fc-storage%2f&amp;title=Unable%20to%20Boot%20EFI%20VM%20on%20ESXi%20FC%20Storage&amp;summary=Unable%20to%20Boot%20EFI%20VM%20on%20ESXi%20FC%20Storage&amp;source=%2f2016%2f01%2f13%2funable-to-boot-efi-vm-on-esxi-fc-storage%2f" target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg>
      </div>
    </div>
  </a>
    <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=%2f2016%2f01%2f13%2funable-to-boot-efi-vm-on-esxi-fc-storage%2f&amp;resubmit=true&amp;title=Unable%20to%20Boot%20EFI%20VM%20on%20ESXi%20FC%20Storage" target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg>
      </div>
    </div>
  </a>
    <a class="resp-sharing-button__link" href="mailto:?subject=Unable%20to%20Boot%20EFI%20VM%20on%20ESXi%20FC%20Storage&amp;body=%2f2016%2f01%2f13%2funable-to-boot-efi-vm-on-esxi-fc-storage%2f" target="_self" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg>
        </div>
    </div>
    </a>

      
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'davidstamen';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      

<h3>See Also</h3>
<ul>
	
	<li><a href="/2015/09/15/using-powercli-to-extend-vmdk-and-windows-os-disk/">Using PowerCLI to Extend VMDK and Windows OS Disk</a></li>
	
	<li><a href="/2015/09/14/using-powercli-to-detach-luns/">Using PowerCLI to Detach Luns</a></li>
	
	<li><a href="/2015/04/02/powercli-extend-vmdk-and-guest-os/">PowerCLI - Extend VMDK and Guest OS</a></li>
	
	<li><a href="/2014/05/22/create-vmfs-datastore-using-powercli/">Create VMFS Datastore Using PowerCLI</a></li>
	
	<li><a href="/2014/05/06/get-naa-id-for-virtual-machine-rdms-in-vmware/">Get NAA.ID for Virtual Machine RDM&#39;s in VMware</a></li>
	
</ul>

      <div class="clarity-prev-next col-xs-12 col-sm-12 col-md-12 col-lg-12">


      
      <nav class="clarity-page-prev-next">
            
            <div class="clr-nav-previous">
                  <a href="/2016/01/12/upgrading-vcsa-from-60-u1a-to-60u1b/" title="Upgrading VCSA from 6.0 U1a to 6.0U1b using CLI" class="btn btn-sm btn-outline">
                  Previous
                  </a>
            </div>
            
            
            <div class="clr-nav-next">
                  <a href="/2016/01/14/using-ucs-powertool-to-generate-tech-supports/" title="Using UCS PowerTool To Generate Tech Supports" class="btn btn-sm btn-outline">
                  Next
                  </a>
            </div>
            
      </nav>
      

</div>

  </div>
  
  <nav class="sidenav clr-col-2 clr-col-sm-12 clr-col-md-12 clr-col-lg-6 clr-col-xl-6">
  <section class="sidenav-content">
    
    
    
    <div class="card">
    <div class="card-block">
    <div class="card-text" id="site-intro">
      <img src="/images/me2-300.png">
        <p>a blog about virtualization and stuff
        
        <ul class="nav-list-inline">
          <a href="//github.com/dstamen" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a>











<a href="//linkedin.com/in/davidstamen" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a>















<a href="//twitter.com/davidstamen" target="_blank" rel="noopener" title="Twitter" class="fab fa-twitter"></a>








<a href="mailto:dstamen@gmail.com" target="_blank" title="Email" class="fas fa-envelope"></a>

          

        </ul>
        
    </div>
    </div>
    </div>
    <div class="card">
    <div class="card-header">
      <b>Latest Posts</b>
    </div>
  <div class="card-block">
    <div class="card-text">
      <ul class="list" style="list-style-type:square;list-style-position:inherit">
        
        <li><a class="nav-list" href="/2019/08/12/windows-server-2008-is-going-eol-what-about-my-vcenter-server/">Windows Server 2008 is Going EOL - What about my vCenter Server?</a></li>
        
        <li><a class="nav-list" href="/2019/06/18/vmworld-2019-sessions-and-events/">VMworld 2019 - Sessions and Events</a></li>
        
        <li><a class="nav-list" href="/2019/06/07/vcenter-server-converge-tool-what-about-my-certificates/">vCenter Server Converge Tool - What About My Certificates</a></li>
        
        <li><a class="nav-list" href="/2019/04/24/vcenter-server-appliance-cli-json-creator/">vCenter Server Appliance CLI - JSON Creator</a></li>
        
        <li><a class="nav-list" href="/2019/04/11/vcenter-server-converge-tool-how-do-i-converge-an-environment-using-the-ui/">vCenter Server Converge Tool - How do I Converge an Environment Using the UI</a></li>
        
      </ul>
    </div>
  </div>
</div>
<div class="card">
  <div class="card-header">
    <b>Advertisements</b>
  </div>
<div class="card-block">
  <div class="card-text" align="center">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:inline-block;width:180px;height:150px"
     data-ad-client="ca-pub-6907288179836979"
     data-ad-slot="6070718289"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
</div>
</div>

</section>
</nav>
  
</div>
      
    </div>
  </body>
</html>

