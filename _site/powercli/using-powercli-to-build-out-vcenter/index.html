<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Using PowerCLI to Build Out vCenter &#8211; davidstamen.com</title>
<meta name="description" content="I wanted to share this handy script i created when you have a need to build out a new vCenter.

">
<meta name="keywords" content="">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Using PowerCLI to Build Out vCenter">
<meta name="twitter:description" content="I wanted to share this handy script i created when you have a need to build out a new vCenter.

">
<meta name="twitter:site" content="@davidstamen">
<meta name="twitter:creator" content="@davidstamen">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://davidstamen.com/images/default-thumb.png">


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Using PowerCLI to Build Out vCenter">
<meta property="og:description" content="I wanted to share this handy script i created when you have a need to build out a new vCenter.

">
<meta property="og:url" content="http://davidstamen.com/powercli/using-powercli-to-build-out-vcenter/">
<meta property="og:site_name" content="davidstamen.com">

<meta property="og:image" content="http://davidstamen.com/images/default-thumb.png">







<link rel="canonical" href="http://davidstamen.com/powercli/using-powercli-to-build-out-vcenter/">
<link href="http://davidstamen.com/feed.xml" type="application/atom+xml" rel="alternate" title="davidstamen.com Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://davidstamen.com/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://davidstamen.com/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://davidstamen.com/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://davidstamen.com/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons-->
<link rel="shortcut icon" href="http://davidstamen.com/favicon.ico">
<link rel="shortcut icon" href="http://davidstamen.com/favicon.png">
<link rel="icon" href="http://davidstamen.com/favicon.ico">
<link rel="icon" href="http://davidstamen.com/favicon.png">
<link rel="apple-touch-icon-precomposed" href="http://davidstamen.com/images/apple-touch-icon-precomposed.png">
<link rel="apple-touch-icon" sizes="57x57" href="http://davidstamen.com/images//apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="http://davidstamen.com/images//apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="http://davidstamen.com/images//apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="http://davidstamen.com/images//apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="http://davidstamen.com/images//apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="http://davidstamen.com/images//apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="http://davidstamen.com/images//apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="http://davidstamen.com/images//apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://davidstamen.com/images//apple-touch-icon-180x180.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://davidstamen.com/">davidstamen.com</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				    <li><a href="http://davidstamen.com/categories/" >Categories</a></li>
				
				    
				    <li><a href="http://davidstamen.com/posts/" >Posts</a></li>
				
				    
				    <li><a href="http://davidstamen.com/resources/" >Resources</a></li>
				
				    
				    <li><a href="http://davidstamen.com/search/" >Search</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    

<div itemscope itemtype="http://schema.org/Person">


	<img src="http://davidstamen.com/images/me.jpeg" class="bio-photo" alt="David Stamen bio photo">

  <h4 itemprop="name">David Stamen</h4>
  <p>Senior Virtualization Engineer
  <br><br>VCAP-DCA | MCSA | VMware vExpert | Cisco Champion | PernixPro
</p>
  <a href="mailto:dstamen@gmail.com" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/davidstamen" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  
  <a href="http://linkedin.com/in/davidstamen" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/dstamen" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="http://davidstamen.com/powercli/using-powercli-to-build-out-vcenter/" rel="bookmark" title="Using PowerCLI to Build Out vCenter">Using PowerCLI to Build Out vCenter</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>I wanted to share this handy script i created when you have a need to build out a new vCenter.</p>

<p>This script can be extremely handy as it will take care of creating the datacenter, cluster, adding hosts, creating datastores and then applying the appropriate host profile. It is all done via CSV files so it is extremely customizable.</p>

<h3 id="files-to-modify-to-customize-your-configuration">Files to modify to customize your configuration</h3>
<ul>
  <li><strong><em>createdatacenter.csv</em></strong> - Contains the name of the datacenter to create.</li>
  <li><strong><em>createcluster.csv</em></strong> - Contains the name of the cluster to create and the datacenter to put it in.</li>
  <li><strong><em>createhosts.csv</em></strong> - Contains the Name of the host and which cluster to place them in.</li>
  <li><strong><em>createdatastores.csv</em></strong> - Contains the name of the datastore, naaid of the lun and the datastore cluster to put it in.</li>
  <li><strong><em>applyhostprofile.csv</em></strong> - Contains the name of the host and hostprofile to apply.</li>
</ul>

<p>The code and Github Link can be found below.</p>

<p><a href="https://github.com/dstamen/PowerCLI/tree/master/ConfigvCenter">ConfigvCenter.ps1</a></p>

<figure class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="c1"># Variables</span>
<span class="nv">$vcenter</span> <span class="o">=</span> <span class="s2">"vc.lab.local"</span>
<span class="nv">$esxusername</span> <span class="o">=</span> <span class="s2">"root"</span>
<span class="nv">$esxpassword</span> <span class="o">=</span> <span class="s2">"password"</span>
<span class="nv">$DSC</span> <span class="o">=</span> <span class="s2">"DSC01"</span>
<span class="nv">$Datacenter</span> <span class="o">=</span> <span class="s2">"Lab"</span>

<span class="c1">#Connect to vCenter</span>
<span class="c1">#Connect-VIServer -Server $vCenter</span>

<span class="c1"># Create Datacenters</span>
<span class="nb">Write-Host</span> <span class="s2">"Creating Datacenter"</span> -ForegroundColor <span class="s2">"Green"</span>
<span class="nv">$csv</span> <span class="o">=</span> <span class="nb">Import-CSV</span> .<span class="se">\c</span>reatedatacenter.csv
<span class="k">foreach</span> <span class="o">(</span><span class="nv">$datacenter</span> <span class="k">in</span> <span class="nv">$csv</span><span class="o">)</span> <span class="o">{</span>
  New-Datacenter -Location <span class="o">(</span>Get-Folder -NoRecursion<span class="o">)</span> -Name <span class="nv">$datacenter</span>.Name
<span class="o">}</span>

<span class="c1"># Create Clusters</span>
<span class="nb">Write-Host</span> <span class="s2">"Creating Clusters"</span> -ForegroundColor <span class="s2">"Green"</span>
<span class="nv">$csv</span> <span class="o">=</span> <span class="nb">Import-CSV</span> .<span class="se">\c</span>reatecluster.csv
<span class="k">foreach</span> <span class="o">(</span><span class="nv">$cluster</span> <span class="k">in</span> <span class="nv">$csv</span><span class="o">)</span> <span class="o">{</span>
  New-Cluster -Name <span class="nv">$cluster</span>.Name -Location <span class="nv">$cluster</span>.Datacenter -DRSEnabled -DrsAutomationLevel FullyAutomated -HAEnabled
<span class="o">}</span>

<span class="c1"># Create Clusters</span>
<span class="nb">Write-Host</span> <span class="s2">"Adding Hosts"</span> -ForegroundColor <span class="s2">"Green"</span>
<span class="nv">$csv</span> <span class="o">=</span> <span class="nb">Import-CSV</span> .<span class="se">\c</span>reatehosts.csv
<span class="k">foreach</span> <span class="o">(</span><span class="nv">$vmhost</span> <span class="k">in</span> <span class="nv">$csv</span><span class="o">)</span> <span class="o">{</span>
  Add-VMHost -Name <span class="nv">$vmhost</span>.Name -Location <span class="nv">$vmhost</span>.Cluster -User <span class="nv">$esxusername</span> -Password <span class="nv">$esxpassword</span>
  <span class="nb">Set</span>-VMHost -VMHost <span class="nv">$vmhost</span>.Name -State Maintenance
<span class="o">}</span>

<span class="c1"># Create Datastores</span>
<span class="nb">Write-Host</span> <span class="s2">"Creating Datastores"</span> -ForegroundColor <span class="s2">"Green"</span>
<span class="nv">$csv</span> <span class="o">=</span> <span class="nb">Import-CSV</span> .<span class="se">\c</span>reatedatastores.csv
<span class="k">foreach</span> <span class="o">(</span><span class="nv">$datastore</span> <span class="k">in</span> <span class="nv">$csv</span><span class="o">)</span> <span class="o">{</span>
  New-Datastore -VMHost <span class="nv">$datastore</span>.host -Name <span class="nv">$datastore</span>.Name -Path <span class="nv">$datastore</span>.NAAID -VMFS
<span class="o">}</span>

<span class="c1"># Create Datastore Cluster and Move Datastores In</span>
<span class="nb">Write-Host</span> <span class="s2">"Creating Datastore Cluster and Adding Datastores"</span> -ForegroundColor <span class="s2">"Green"</span>
<span class="nv">$csv</span> <span class="o">=</span> <span class="nb">Import-CSV</span> .<span class="se">\c</span>reatedatastores.csv
New-DatastoreCluster -Name <span class="nv">$DSC</span> -Location <span class="nv">$Datacenter</span>
<span class="k">foreach</span> <span class="o">(</span><span class="nv">$datastore</span> <span class="k">in</span> <span class="nv">$csv</span><span class="o">)</span> <span class="o">{</span>
  <span class="nb">Move</span>-Datastore <span class="nv">$datastore</span>.Name -Destination <span class="nv">$datastore</span>.DatastoreCluster
<span class="o">}</span>

<span class="c1"># Apply HostProfile</span>
<span class="nb">Write-Host</span> <span class="s2">"Applying HostProfiles"</span> -ForegroundColor <span class="s2">"Green"</span>
<span class="nv">$csv</span> <span class="o">=</span> <span class="nb">Import-CSV</span> .<span class="se">\a</span>pplyhostprofile.csv
<span class="k">foreach</span> <span class="o">(</span><span class="nv">$hostprofile</span> <span class="k">in</span> <span class="nv">$csv</span><span class="o">)</span> <span class="o">{</span>
  Apply-VMHostProfile -Entity <span class="nv">$hostprofile</span>.Entity -Profile <span class="nv">$hostprofile</span>.Profile -Confirm:<span class="nv">$false</span>
<span class="o">}</span>

<span class="nb">Write-Host</span> <span class="s2">"Complete!"</span> -ForegroundColor <span class="s2">"Green"</span></code></pre></figure>


      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?url=http://davidstamen.com/powercli/using-powercli-to-build-out-vcenter/&text=Using PowerCLI to Build Out vCenter&via=davidstamen" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://davidstamen.com/powercli/using-powercli-to-build-out-vcenter/" class="tumbler" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://davidstamen.com/powercli/using-powercli-to-build-out-vcenter/" class="tumbler" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a>
    </li>
    <li>
      <a href="http://www.linkedin.com/shareArticle?mini=true&url=http://davidstamen.com/powercli/using-powercli-to-build-out-vcenter/" class="tumbler" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin-square fa-2x"></i></a>
    </li>
    <li>
      <a href="http://www.reddit.com/submit?url=http://davidstamen.com/powercli/using-powercli-to-build-out-vcenter/&title=Using PowerCLI to Build Out vCenter" class="tumbler" title="Share on Reddit"><i class="fa fa-fw fa-reddit-square fa-2x"></i></a>
    </li>
  </ul>
</div><!-- /.social-share -->

        <p class="byline"><strong>Using PowerCLI to Build Out vCenter</strong> was published on <time datetime="2015-10-08T00:00:00-04:00">October 08, 2015</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://davidstamen.com/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="http://davidstamen.com/vmware/vsphere-65-new-license-import-from-myvmware/" title="vSphere 6.5 - New License Import from My VMware">vSphere 6.5 - New License Import from My VMware</a></li>
    
      <li><a href="http://davidstamen.com/windows/using-powershell-to-create-windows-smb-shares/" title="Using Powershell to Create Windows SMB Shares">Using Powershell to Create Windows SMB Shares</a></li>
    
      <li><a href="http://davidstamen.com/certification/vmware-certified-advanced-professional-6-data-center-virtualization-design-guide-3v0-622/" title="VMware Certified Advanced Professional 6 – Data Center Virtualization Design Guide (3V0 622)">VMware Certified Advanced Professional 6 – Data Center Virtualization Design Guide (3V0 622)</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2016 David Stamen. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a></span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://davidstamen.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://davidstamen.com/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-67336507-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'davidstamen'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




</body>
</html>
