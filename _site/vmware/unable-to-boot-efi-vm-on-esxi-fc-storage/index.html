<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Unable to Boot EFI VM on ESXi FC Storage &#8211; davidstamen.com</title>
<meta name="description" content="For the past week, I have been troubleshooting the strangest issue. I have been attempting to move some Windows 8.1 VM’s from our legacy datacenter(iSCSI) to our new datacenter(FC).

">
<meta name="keywords" content="">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Unable to Boot EFI VM on ESXi FC Storage">
<meta name="twitter:description" content="For the past week, I have been troubleshooting the strangest issue. I have been attempting to move some Windows 8.1 VM’s from our legacy datacenter(iSCSI) to our new datacenter(FC).

">
<meta name="twitter:site" content="@davidstamen">
<meta name="twitter:creator" content="@davidstamen">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Unable to Boot EFI VM on ESXi FC Storage">
<meta property="og:description" content="For the past week, I have been troubleshooting the strangest issue. I have been attempting to move some Windows 8.1 VM’s from our legacy datacenter(iSCSI) to our new datacenter(FC).

">
<meta property="og:url" content="/vmware/unable-to-boot-efi-vm-on-esxi-fc-storage/">
<meta property="og:site_name" content="davidstamen.com">

<meta property="og:image" content="/images/default-thumb.png">







<link rel="canonical" href="/vmware/unable-to-boot-efi-vm-on-esxi-fc-storage/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="davidstamen.com Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons-->
<link rel="shortcut icon" href="/favicon.ico">
<link rel="shortcut icon" href="/favicon.png">
<link rel="icon" href="/favicon.ico">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<link rel="apple-touch-icon" sizes="57x57" href="/images//apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/images//apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images//apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/images//apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images//apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/images//apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images//apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/images//apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images//apple-touch-icon-180x180.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">davidstamen.com</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/categories/" >Categories</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Posts</a></li>
				
				    
				        
				    
				    <li><a href="/resources/" >Resources</a></li>
				
				    
				        
				    
				    <li><a href="/search/" >Search</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    


<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/me.jpeg" class="bio-photo" alt="David Stamen bio photo">

  <h4 itemprop="name">David Stamen</h4>
  <p>Senior Virtualization Engineer
  <br><br>VCAP-DCA | MCSA | VMware vExpert | Cisco Champion | PernixPro
</p>
  <a href="mailto:dstamen@gmail.com" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/davidstamen" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  
  <a href="http://linkedin.com/in/davidstamen" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/dstamen" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/vmware/unable-to-boot-efi-vm-on-esxi-fc-storage/" rel="bookmark" title="Unable to Boot EFI VM on ESXi FC Storage">Unable to Boot EFI VM on ESXi FC Storage</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>For the past week, I have been troubleshooting the strangest issue. I have been attempting to move some Windows 8.1 VM’s from our legacy datacenter(iSCSI) to our new datacenter(FC).</p>

<p>Whenever I would move the VM to our new DC, it would fail to boot properly. It would boot straight to Windows Recovery. If I moved the same VM to any other type of storage(NFS, iSCSI, Local) the VM would boot perfectly fine. I opened a case with VMware and our Storage vendor and no one had any idea what was causing it.</p>

<p>Strangely enough my coworker found the following article today that explains and provides a workaround. <a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2137402">KB2137402</a></p>

<p>Also, our storage vendor Pure Storage also had an article explaining the issue. [Windows-2012-R2-and-Windows-8-boot-fails-after-Storage-VMotion]http://community.purestorage.com/t5/Pure-Customer-Knowledge-Base/Windows-2012-R2-and-Windows-8-boot-fails-after-Storage-VMotion/ta-p/4109]</p>

<p>So today I went and modified a host to have the DiskMaxIOSize to be 4096 instead of the default 32767, and the VM booted up fine! All my stress and troubleshooting could finally be resolved. Strange enough this issue has been around since 5.5 and there is still no actual resolution. I am not even sure if this is an array or VMware issue as this seems to affect 3Par and XtremIO as well.</p>

<p>However, since I had to replicate this change to a bunch of hosts I created a script to make this change.</p>

<h4 id="link-to-script"><strong><em>Link to Script</em></strong></h4>
<ul>
  <li><a href="https://github.com/dstamen/PowerCLI/blob/master/Set-MaxDiskIO.ps1">Set-MaxDiskIO.ps1</a></li>
</ul>

<h4 id="preparing-to-execute-the-script"><strong><em>Preparing to Execute the Script</em></strong></h4>
<p>The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.</p>

<div class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="c"># PowerCLI Script for setting Disk Max IO Size</span>
<span class="c"># @davidstamen</span>
<span class="c"># http://davidstamen.com</span>

<span class="c">#Define Variables</span>
<span class="nv">$cred</span> <span class="p">=</span> <span class="nb">Get-Credential</span>
<span class="nv">$VC</span> <span class="p">=</span> <span class="s2">&quot;vc.lab.local&quot;</span>
<span class="nv">$Cluster</span> <span class="p">=</span> <span class="s2">&quot;Production&quot;</span>

<span class="c">#Connect to vCenter</span>
<span class="nb">Connect-VIServer</span> <span class="nv">$VC</span> <span class="n">-Credential</span> <span class="nv">$cred</span>

<span class="c">#Get all Hosts</span>
<span class="nv">$esxHosts</span> <span class="p">=</span> <span class="nb">Get-Cluster</span> <span class="nv">$Cluster</span> <span class="p">|</span> <span class="nb">Get-VMHost</span> <span class="p">|</span> <span class="n">Where</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">PowerState</span> <span class="o">-eq</span> <span class="s2">&quot;PoweredOn&quot;</span> <span class="o">-and</span> <span class="nv">$_</span><span class="p">.</span><span class="n">ConnectionState</span> <span class="o">-eq</span> <span class="s2">&quot;Connected&quot;</span> <span class="p">}</span> <span class="p">|</span> <span class="n">Sort</span> <span class="n">Name</span>

<span class="c">#For each host set DiskMaxIOsize to 4MB</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$esx</span> <span class="k">in</span> <span class="nv">$esxHosts</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">Get-AdvancedSetting</span> <span class="n">-Entity</span> <span class="nv">$esx</span> <span class="n">-Name</span> <span class="n">Disk</span><span class="p">.</span><span class="n">DiskMaxIOSize</span> <span class="p">|</span> <span class="nb">Set-AdvancedSetting</span> <span class="n">-Value</span> <span class="n">4096</span> <span class="n">-Confirm</span><span class="err">:</span><span class="nv">$false</span>
<span class="p">}</span></code></pre></div>

<h4 id="execute-the-script"><strong><em>Execute the Script</em></strong></h4>
<ul>
  <li>Run .\Set-MaxDiskIO.ps1</li>
</ul>

<p>Hopefully this helps anyone else who comes across this issue, not alot of people have seen it.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?url=/vmware/unable-to-boot-efi-vm-on-esxi-fc-storage/&text=Unable to Boot EFI VM on ESXi FC Storage&via=davidstamen" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/vmware/unable-to-boot-efi-vm-on-esxi-fc-storage/" class="tumbler" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/vmware/unable-to-boot-efi-vm-on-esxi-fc-storage/" class="tumbler" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a>
    </li>
    <li>
      <a href="http://www.linkedin.com/shareArticle?mini=true&url=/vmware/unable-to-boot-efi-vm-on-esxi-fc-storage/" class="tumbler" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin-square fa-2x"></i></a>
    </li>
    <li>
      <a href="http://www.reddit.com/submit?url=/vmware/unable-to-boot-efi-vm-on-esxi-fc-storage/&title=Unable to Boot EFI VM on ESXi FC Storage" class="tumbler" title="Share on Reddit"><i class="fa fa-fw fa-reddit-square fa-2x"></i></a>
    </li>
  </ul>
</div><!-- /.social-share -->

        <p class="byline"><strong>Unable to Boot EFI VM on ESXi FC Storage</strong> was published on <time datetime="2016-01-13T00:00:00-05:00">January 13, 2016</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/vmware/cisco/troubleshooting-cisco-enic-and-fnic-drivers-with-vmware-update-manager-6x/" title="Troubleshooting Cisco ENIC and FNIC Drivers with VMware Update Manager 6.x">Troubleshooting Cisco ENIC and FNIC Drivers with VMware Update Manager 6.x</a></li>
    
      <li><a href="/cisco/using-ucs-powertool-to-configure-syslog-servers/" title="Using UCS PowerTool to Configure Syslog Servers">Using UCS PowerTool to Configure Syslog Servers</a></li>
    
      <li><a href="/purestorage/using-purestorage-powershell-to-configure-syslog-servers/" title="Using PureStorage Powershell to Configure SysLog Servers">Using PureStorage Powershell to Configure SysLog Servers</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2016 David Stamen. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a></span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-67336507-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'davidstamen'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




</body>
</html>
