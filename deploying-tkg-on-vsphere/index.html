<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]--><!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if IE 8]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><title>Deploying Tanzu Kubernetes Grid (TKG) on vSphere &#183; davidstamen.com</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content="TKG,Kubernetes,vSphere with Kubernetes,vk8s,vSphere,TKC,Tanzu Kubernetes Cluster,Tanzu Kubernetes Grid,"><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:article:published_time" content="2020-05-11T08:00:00Z"><meta property="og:article:modified_time" content="2020-05-11T08:00:00Z"><meta property="og:article:tag" content="TKG"><meta property="og:article:tag" content="Kubernetes"><meta property="og:article:tag" content="vSphere with Kubernetes"><meta property="og:article:tag" content="vk8s"><meta property="og:article:tag" content="vSphere"><meta property="og:article:tag" content="TKC"><meta property="og:article:tag" content="Tanzu Kubernetes Cluster"><meta property="og:article:tag" content="Tanzu Kubernetes Grid"><meta property="og:title" content="Deploying Tanzu Kubernetes Grid (TKG) on vSphere"><meta property="og:description" content="Tanzu Kubernetes Grid (TKG) is part of VMware&rsquo;s new Tanzu Portfolio of products. I have done quite a bit with vSphere with Kubernetes and Tanzu Kubernetes Clusters on vSphere with Kubernetes, but something came up and I began to explore native TKG. This blog will cover how to deploy TKG on vSphere and get your management and tkc clusters provisioned."><meta property="og:type" content="article"><meta property="og:url" content="https://davidstamen.com/deploying-tkg-on-vsphere/"><meta property="og:image" content="https://davidstamen.com/images/tkg14.png"><meta property="article:published_time" content="2020-05-11T08:00:00+00:00"><meta property="article:modified_time" content="2020-05-11T08:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://davidstamen.com/images/tkg14.png"><meta name=twitter:title content="Deploying Tanzu Kubernetes Grid (TKG) on vSphere"><meta name=twitter:description content="Tanzu Kubernetes Grid (TKG) is part of VMware&rsquo;s new Tanzu Portfolio of products. I have done quite a bit with vSphere with Kubernetes and Tanzu Kubernetes Clusters on vSphere with Kubernetes, but something came up and I began to explore native TKG. This blog will cover how to deploy TKG on vSphere and get your management and tkc clusters provisioned."><meta name=twitter:site content="@davidstamen"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-67336507-1','auto');ga('send','pageview');}</script><link rel=canonical href=https://davidstamen.com/deploying-tkg-on-vsphere/><link rel=apple-touch-icon-precomposed sizes=144x144 href=/touch-icon-144-precomposed.png><link rel=icon href=/favicon/favicon.ico><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6907288179836979",enable_page_level_ads:true});</script><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/js/clr-3.0/clr-icons.min.js></script><script src=/js/clr-3.0/custom-elements.min.js></script><link href=/css/clr-3.0/clr-ui.css rel=stylesheet><link href=/css/clr-3.0/clr-icons.min.css rel=stylesheet><link href=/css/custom.css rel=stylesheet><link rel=stylesheet href=/css/all.css></head><body data-ng-app=myapp data-ng-controller=MyController data-ng-mouseleave=MouseLeave($event)><div class=main-container><header class=header-2><div class=branding><a class=navbar-brand-img href=/><img alt src>
<span class=title>davidstamen.com</span></a></div><div class=header-nav [clr-nav-level]=1><a class="nav-link nav-text" href=https://davidstamen.com/ title=Home>Home</a>
<a class="nav-link nav-text" href=https://davidstamen.com/categories/pure-storage/ title="Pure Storage">Pure Storage</a>
<a class="nav-link nav-text" href=https://davidstamen.com/categories/vmware/ title=VMware>VMware</a>
<a class="nav-link nav-text" href=https://davidstamen.com/tags/ title=Tags>Tags</a>
<a class="nav-link nav-text" href=https://davidstamen.com/series/ title=Series>Series</a>
<a class="nav-link nav-text" href=https://www.youracclaim.com/users/davidstamen title=Acclaim>Acclaim</a>
<a class="nav-link nav-text" href=https://davidstamen.com/about title=About>About</a></div><div class=header-actions><form class=search id=search method=get action=//google.com/search><label for=search_input><input id=search_input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=davidstamen.com></label></form></div></header><div class=content-container><div class=content-area><h1>Deploying Tanzu Kubernetes Grid (TKG) on vSphere</h1><div class=metas><span class=clr-card-authors><div class=clr-card-authors>Published on
May 11, 2020 under <a href=/categories/vmware>VMware</a>
&#183; Tagged <a href=/tags/tkg>TKG</a>, <a href=/tags/kubernetes>Kubernetes</a>, <a href=/tags/vsphere-with-kubernetes>vSphere with Kubernetes</a>, <a href=/tags/vk8s>vk8s</a>, <a href=/tags/vsphere>vSphere</a>, <a href=/tags/tkc>TKC</a>, <a href=/tags/tanzu-kubernetes-cluster>Tanzu Kubernetes Cluster</a> and <a href=/tags/tanzu-kubernetes-grid>Tanzu Kubernetes Grid</a>
&#183; Read in about 5 min (943 words)</div></span></div><hr><p>Tanzu Kubernetes Grid (TKG) is part of VMware&rsquo;s new Tanzu Portfolio of products. I have done quite a bit with vSphere with Kubernetes and Tanzu Kubernetes Clusters on vSphere with Kubernetes, but something came up and I began to explore native TKG. This blog will cover how to deploy TKG on vSphere and get your management and tkc clusters provisioned.</p><br><html><div class="alert alert-app-level alert-info" role=alert><div class=alert-items><div class="alert-item static"><div class=alert-icon-wrapper><clr-icon class=alert-icon shape=info-circle></clr-icon></div><span class=alert-text>TKG 1.1 has been released, some of the commands may need to be updated to reflect the new versions of CLI as well as Photon and HA Proxy Images</span></div></div></div></html><p>At first I figured I would have some of the same requirements as vSphere with Kubernetes, but as I started going down the path of deploying TKG i kept thinking to myself&mldr; <strong>Can it really be this easy?</strong> Not only is it easy, it is <strong>Free</strong>.</p><p>To begin I first reviewed the
<a href=https://tanzu.vmware.com/kubernetes-grid target=_blank>TKG Website</a> and
<a href=https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/index.html target=_blank>TKG Documentation</a></p><p>Before we can provison a TKG cluster we must first install <strong>Docker</strong> and <strong>TKG CLI</strong>. Instructions to install docker can be found
<a href=https://docs.docker.com/get-docker/ target=_blank>here.</a></p><h2 id=installing-the-tkg-cli>Installing the TKG CLI</h2><ol><li>Go to
<a href=https://www.vmware.com/go/get-tkg target=_blank>https://www.vmware.com/go/get-tkg</a> and log in with your My VMware credentials.</li><li>Head to the Download Section</li><li>TKG CLI is not currently available for Windows. Download either the Mac OS or Linux CLI</li><li>Use either the gunzip command or the extraction tool of your choice to unpack the binarie. Run either one of the following commands:</li></ol><p>Linux</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gunzip tkg-linux-amd64-v1.0.0_vmware.1.gz
</code></pre></div><p>Mac OS</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gunzip tkg-darwin-amd64-v1.0.0_vmware.1.gz
</code></pre></div><ol start=5><li>Navigate to the executable for the Tanzu Kubernetes Grid CLI that you downloaded in the previous section.</li><li>Rename the CLI binary for your platform to tkg, make sure that it is executable, and add it to your PATH.</li></ol><p>Linux</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>mv ./tkg-linux-amd64-v1.0.0_vmware.1 /usr/local/bin/tkg
</code></pre></div><p>Mac OS</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>mv ./tkg-darwin-amd64-v1.0.0_vmware.1 /usr/local/bin/tkg
</code></pre></div><ol start=7><li>Make the file executable.</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>chmod +x /usr/local/bin/tkg
</code></pre></div><ol start=8><li>Run tkg version to check that the correct version of the binary is properly installed.</li></ol><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg19.png data-caption=caption><img width=100% src=/images/tkg19.png></a></div><h2 id=deploying-the-tkg-management-cluster>Deploying the TKG Management Cluster</h2><p>TKG can be deployed either through the UI or CLI. This walk-through will cover the UI deployment of TKG.</p><p>Before we can deploy TKG we must first download and import the
<a href=https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.0/vmware-tanzu-kubernetes-grid-10/GUID-install-tkg-vsphere.html#import-baseos target=_blank>Base OS Image</a> and the
<a href=https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.0/vmware-tanzu-kubernetes-grid-10/GUID-install-tkg-vsphere.html#import-haproxy target=_blank>API Server Load Balancer</a> OVA&rsquo;s into vSphere.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg16.png data-caption=caption><img width=100% src=/images/tkg16.png></a></div><p>Once our templates are imported we can proceed to launch the TKG UI. Run the following command:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>tkg init --ui
</code></pre></div><blockquote><p>If Docker is not installed or running you will receive the following error. Make sure it is running and run the command again.</p></blockquote><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg1.png data-caption=caption><img width=100% src=/images/tkg1.png></a></div><p>When the above command is run it will launch the UI, if not you can navigate to <strong>http://127.0.0.1:8080</strong></p><p>Click on <strong>Deploy on vSphere</strong></p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg2.png data-caption=caption><img width=100% src=/images/tkg2.png></a></div><p>Enter the <strong>vCenter Server</strong>, <strong>Username</strong> and <strong>Password</strong> and Click Connect.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg20.png data-caption=caption><img width=100% src=/images/tkg20.png></a></div><br><html><div class="alert alert-app-level alert-warning" role=alert><div class=alert-items><div class="alert-item static"><div class=alert-icon-wrapper><clr-icon class=alert-icon shape=info-circle></clr-icon></div><span class=alert-text>If the vSphere with Kubernetes feature is not enabled, deploying a Tanzu Kubernetes Grid management cluster to vSphere 7.0 is possible, but it is not supported.</span></div></div></div></html><p>If deploying to vSphere 7.0 you will be notified that it has not been <strong>optimized for Kubernetes</strong> but this just means you aren&rsquo;t using vSphere with Kubernetes so click <strong>Proceed</strong></p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg3.png data-caption=caption><img width=100% src=/images/tkg3.png></a></div><p>Select your <strong>Datacenter</strong> and enter in your <strong>SSH Public Key</strong></p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg5.png data-caption=caption><img width=100% src=/images/tkg5.png></a></div><blockquote><p>If you do not know your public key you can get it by running <strong>cat ~/.ssh/id_rsa.pub</strong> If you need to generate an SSH keypair, the instructions are
<a href=https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.0/vmware-tanzu-kubernetes-grid-10/GUID-install-tkg-vsphere.html#ssh-key target=_blank>here</a></p></blockquote><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg4.png data-caption=caption><img width=100% src=/images/tkg4.png></a></div><p>Select whether you wish to deploy for <strong>Development</strong> or <strong>Production</strong> and select a <strong>Size</strong>. Development is one Control Plane and one Worker and Production is three Control Planes and three Workers.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg7.png data-caption=caption><img width=100% src=/images/tkg7.png></a></div><p>Name your <strong>Management Cluster</strong> and Select the <strong>Load Balancer Template</strong></p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg8.png data-caption=caption><img width=100% src=/images/tkg8.png></a></div><p>Specify the <strong>Resource Pool</strong>, <strong>VM Folder</strong> and <strong>Datastore</strong> for your VMs.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg9.png data-caption=caption><img width=100% src=/images/tkg9.png></a></div><p>Select a <strong>Network</strong> for your VMs. You can leave the Service and Pod CIDR&rsquo;s as default if you wish.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg10.png data-caption=caption><img width=100% src=/images/tkg10.png></a></div><p>Select the <strong>Image Template</strong> you wish to use for your Kubernetes Cluster</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg11.png data-caption=caption><img width=100% src=/images/tkg11.png></a></div><p>Click on <strong>Review Configuration</strong> to Proceed.</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg12.png data-caption=caption><img width=100% src=/images/tkg12.png></a></div><p>Make sure everything entered looks correct and click on <strong>Deploy Management Cluster</strong></p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg13.png data-caption=caption><img width=100% src=/images/tkg13.png></a></div><p>Your cluster will now be deployed, when it is complete you will be presented with this screen!</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg14.png data-caption=caption><img width=100% src=/images/tkg14.png></a></div><p>Back to our CLI we can see the details of our management cluster by running:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>tkg get management-cluster
</code></pre></div><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg15.png data-caption=caption><img width=100% src=/images/tkg15.png></a></div><h2 id=deploying-the-tanzu-kubernetes-cluster>Deploying the Tanzu Kubernetes Cluster</h2><p>Once our management cluster is deployed its quite easy to deploy our Tanzu Kubernetes Clusters!</p><p>There are a few
<a href=https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/1.0/vmware-tanzu-kubernetes-grid-10/GUID-tanzu-k8s-clusters-create.html target=_blank>advanced options</a> but i will focus on two of the simple commands</p><p>To deploy a development cluster (1 control plane and 1 worker)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>tkg create cluster tkc01 --plan=dev
</code></pre></div><p>To deploy a production cluster (3 control plane and 3 worker)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>tkg create cluster tkc --plan=prod
</code></pre></div><p>To monitor the deployment status, you can run the following:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>tkg get cluster
</code></pre></div><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg17.png data-caption=caption><img width=100% src=/images/tkg17.png></a></div><p>When it is complete we can see all the nodes that have been deployed!</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg18.png data-caption=caption><img width=100% src=/images/tkg18.png></a></div><h2 id=deploying-a-workload-to-the-tanzu-kubernetes-cluster>Deploying a Workload to the Tanzu Kubernetes Cluster</h2><p>Find the Kubernetes Context you wish to deploy to:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl config get-contexts
</code></pre></div><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg21.png data-caption=caption><img width=100% src=/images/tkg21.png></a></div><p>Switch to the context of your TKC.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl config use-context tkc01-admin@tkc01
</code></pre></div><p>If we want to access our application through an external-ip. I recommend using
<a href=https://metallb.universe.tf/installation/#installation-by-manifest target=_blank>MetalLB</a> as its one of the easier pieces I have found to setup.</p><p>To install run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>kubectl apply <span style=color:#ff79c6>-</span>f https:<span style=color:#6272a4>//raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/namespace.yaml
</span><span style=color:#6272a4></span>kubectl apply <span style=color:#ff79c6>-</span>f https:<span style=color:#6272a4>//raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml
</span><span style=color:#6272a4></span># On first install only
kubectl create secret generic <span style=color:#ff79c6>-</span>n metallb<span style=color:#ff79c6>-</span>system memberlist <span style=color:#ff79c6>--</span>from<span style=color:#ff79c6>-</span>literal=secretkey=<span style=color:#f1fa8c>&#34;$(openssl rand -base64 128)&#34;</span>
</code></pre></div><p>You will then need to execute a YAML to specify an IP Pool to use.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>apiVersion</span>: v1
<span style=color:#ff79c6>kind</span>: ConfigMap
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>namespace</span>: metallb-system
  <span style=color:#ff79c6>name</span>: config
<span style=color:#ff79c6>data</span>:
  <span style=color:#ff79c6>config</span>: <span style=color:#f1fa8c>|
</span><span style=color:#f1fa8c>    address-pools:</span>
    - <span style=color:#ff79c6>name</span>: default
      <span style=color:#ff79c6>protocol</span>: layer2
      <span style=color:#ff79c6>addresses</span>:
      - <span style=color:#bd93f9>10.21.234.45-10.21.234.55</span>
</code></pre></div><p>Deploy your application and find out its <strong>External-IP</strong> using <strong>kubectl get svc</strong></p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg24.png data-caption=caption><img width=100% src=/images/tkg24.png></a></div><p>Your application should now be running&mldr;</p><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery-3.4.1.min.js></script><script src=/js/jquery.fancybox.min.js></script><div style=max-width:80%;width:fit-content;margin:auto;padding:1.5em><a data-fancybox=gallery href=/images/tkg25.png data-caption=caption><img width=100% src=/images/tkg25.png></a></div><h2 id=conclusion>Conclusion</h2><p>Knowing how difficult it is to install vanilla k8s and how much planning and difficulty goes into deploying vSphere with Kubernetes I was not expecting the deployment of TKG to be this easy! I hope this walk-through helped get your TKG environment up and running!</p><p>Questions or Comments? Leave them below!</p><h6>Share this post</h6><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vsphere%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=Deploying%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere&url=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vsphere%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5.0-4.55 2.04-4.55 4.54.0.36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3.0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35.0 12.92-6.92 12.92-12.93.0-.2.0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vsphere%2f&title=Deploying%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere&summary=Deploying%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere&source=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vsphere%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6.0 2.5 1 2.6 2.5.0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vsphere%2f&resubmit=true&title=Deploying%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96.0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65.0 3-1.35 3-3s-1.35-3-3-3c-1.38.0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65.0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66.0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64.0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4.0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6.0.23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1.0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1.0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Deploying%20Tanzu%20Kubernetes%20Grid%20%28TKG%29%20on%20vSphere&body=https%3a%2f%2fdavidstamen.com%2fdeploying-tkg-on-vsphere%2f" target=_self rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9.0 6v12c0 1.1.9 2 2 2h20c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17.0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1.0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08.0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div></div></a><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='davidstamen';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><h3>See Also</h3><ul><li><a href=/2020/04/13/part-6-deploying-vsphere-with-kubernetes-provisioning-and-managing-a-tanzu-kubernetes-cluster/>Part 6: Deploying vSphere with Kubernetes - Provisioning and Managing a Tanzu Kubernetes Cluster</a></li><li><a href=/2020/04/10/part-5-deploying-vsphere-with-kubernetes-using-vsphere-with-kubernetes/>Part 5: Deploying vSphere with Kubernetes - Using vSphere with Kubernetes</a></li><li><a href=/2020/04/10/part-4-deploying-vsphere-with-kubernetes-enabling-vsphere-with-kubernetes/>Part 4: Deploying vSphere with Kubernetes - Enabling vSphere with Kubernetes</a></li><li><a href=/2020/04/10/part-3-deploying-vsphere-with-kubernetes-deploy-and-configure-nsx-t/>Part 3: Deploying vSphere with Kubernetes - Deploy and Configure NSX-T</a></li><li><a href=/2020/04/10/part-2-deploying-vsphere-with-kubernetes-configuring-vcenter-server/>Part 2: Deploying vSphere with Kubernetes - Configuring vCenter Server</a></li></ul><div class="clarity-prev-next col-xs-12 col-sm-12 col-md-12 col-lg-12"><nav class=clarity-page-prev-next><div class=clr-nav-previous><a href=https://davidstamen.com/2020/04/24/whats-new-in-the-pure-storage-vrealize-operations-management-pack-3.0/ title="What's New in the Pure Storage vRealize Operations Management Pack 3.0" class="btn btn-sm btn-outline">Previous</a></div><div class=clr-nav-next><a href=https://davidstamen.com/deploying-tkg-on-vmc/ title="Deploying Tanzu Kubernetes Grid (TKG) on VMware Cloud on AWS (VMC)" class="btn btn-sm btn-outline">Next</a></div></nav></div></div><nav class="sidenav clr-col-2 clr-col-sm-12 clr-col-md-12 clr-col-lg-6 clr-col-xl-6"><section class=sidenav-content><div class=card><div class=card-block><div class=card-text id=site-intro><img src=/images/me2-300.png><p>a blog about virtualization, storage and stuff<ul class=nav-list-inline><a href=//github.com/dstamen target=_blank rel=noopener title=GitHub class="fab fa-github"></a><a href=//linkedin.com/in/davidstamen target=_blank rel=noopener title=LinkedIn class="fab fa-linkedin"></a><a href=//twitter.com/davidstamen target=_blank rel=noopener title=Twitter class="fab fa-twitter"></a><a href=mailto:dstamen@gmail.com target=_blank title=Email class="fas fa-envelope"></a></ul></div></div></div><div class=card><div class=card-header><b>Latest Posts</b></div><div class=card-block><div class=card-text><ul class=list style=list-style-type:square;list-style-position:inherit><li><a class=nav-list href=https://davidstamen.com/2020/05/26/whats-new-in-the-4.3.1-pure-storage-vsphere-client-plugin/>What's New in the 4.3.1 Pure Storage vSphere Client Plugin</a></li><li><a class=nav-list href=https://davidstamen.com/deploying-tkc-on-vk8s-using-tkgcli/>Deploying Tanzu Kubernetes Clusters (TKC) on vSphere with Kubernetes using the TKG CLI</a></li><li><a class=nav-list href=https://davidstamen.com/running-vvol-on-vmc-on-cbs/>Running vVols in VMware Cloud on AWS (VMC) on Pure Storage Cloud Block Store (CBS) on AWS</a></li><li><a class=nav-list href=https://davidstamen.com/deploying-tkg-on-vmc/>Deploying Tanzu Kubernetes Grid (TKG) on VMware Cloud on AWS (VMC)</a></li><li><a class=nav-list href=https://davidstamen.com/deploying-tkg-on-vsphere/>Deploying Tanzu Kubernetes Grid (TKG) on vSphere</a></li><li><a class=nav-list href=https://davidstamen.com/2020/04/24/whats-new-in-the-pure-storage-vrealize-operations-management-pack-3.0/>What's New in the Pure Storage vRealize Operations Management Pack 3.0</a></li><li><a class=nav-list href=https://davidstamen.com/2020/04/21/whats-new-in-the-4.3.0-pure-storage-vsphere-client-plugin/>What's New in the 4.3.0 Pure Storage vSphere Client Plugin</a></li><li><a class=nav-list href=https://davidstamen.com/2020/04/16/using-powercli-to-deploy-the-site-recovery-manager-8.3-appliance/>Using PowerCLI to Deploy the Site Recovery Manager 8.3 Appliance</a></li><li><a class=nav-list href=https://davidstamen.com/2020/04/13/part-6-deploying-vsphere-with-kubernetes-provisioning-and-managing-a-tanzu-kubernetes-cluster/>Part 6: Deploying vSphere with Kubernetes - Provisioning and Managing a Tanzu Kubernetes Cluster</a></li><li><a class=nav-list href=https://davidstamen.com/2020/04/10/part-5-deploying-vsphere-with-kubernetes-using-vsphere-with-kubernetes/>Part 5: Deploying vSphere with Kubernetes - Using vSphere with Kubernetes</a></li></ul></div></div></div><div class=card><div class=card-header><b>Advertisements</b></div><div class=card-block><div class=card-text align=center><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:inline-block;width:180px;height:150px data-ad-client=ca-pub-6907288179836979 data-ad-slot=6070718289></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div></div></section></nav></div></div></body></html>