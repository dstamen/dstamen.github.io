<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "/"
        },
        "articleSection" : "blog",
        "name" : "Upgrading Platform Services Controller and vCenter Server via the CLI Installer",
        "headline" : "Upgrading Platform Services Controller and vCenter Server via the CLI Installer",
        "description" : "<p>The first topic we will cover in our Automating your vSphere Upgrade series is updating our core infrastructure. Upgrading Platform Services Controller(PSC)  and vCenter Server via the CLI installer. In our workshops one of the common things I hear is that most folks aren&rsquo;t using the CLI based tools that have been included in the installer. I am a huge fan of these as they make migrations and upgrades seamless&ndash;especially when having to perform the task if you have multiple PSC&rsquo;s and vCenter Servers. Using the CLI tools don’t have to be intimidating, as we go through this blog we will cover some how-to&rsquo;s and benefits of using the CLI based approach.</p>

<p></p>",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2018",
        "datePublished": "2018-10-05 09:08:15 -0400 EDT",
        "dateModified" : "2018-10-05 09:08:15 -0400 EDT",
        "url" : "/2018/10/05/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer/",
        "wordCount" : "1544",
        "keywords" : [ "vSphere Upgrade","vSphere 6.5","vSphere 6.7","PSC","vCenter Server","Blog" ]
    }
    </script>
        
            
                <title>Upgrading Platform Services Controller and vCenter Server via the CLI Installer</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.46" />
        
  
    
  

  

  <link rel="apple-touch-icon-precomposed" href='/favicon/apple-touch-icon-precomposed.png'>
  <link rel="icon" href='/favicon/favicon.png'>
  
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content='/favicon/mstile.png'>
  <meta name="application-name" content="davidstamen.com">
  <meta name="msapplication-tooltip" content="a blog about virtualization and stuff">
  <meta name="msapplication-config" content='/favicon/ieconfig.xml'>



        
        
            
                <meta name="description" content="a blog about virtualization and stuff">
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Upgrading Platform Services Controller and vCenter Server via the CLI Installer"/>
<meta name="twitter:description" content="The first topic we will cover in our Automating your vSphere Upgrade series is updating our core infrastructure. Upgrading Platform Services Controller(PSC)  and vCenter Server via the CLI installer. In our workshops one of the common things I hear is that most folks aren&rsquo;t using the CLI based tools that have been included in the installer. I am a huge fan of these as they make migrations and upgrades seamless&ndash;especially when having to perform the task if you have multiple PSC&rsquo;s and vCenter Servers. Using the CLI tools don’t have to be intimidating, as we go through this blog we will cover some how-to&rsquo;s and benefits of using the CLI based approach.

"/>
<meta name="twitter:site" content="@davidstamen"/>

        <meta property="og:title" content="Upgrading Platform Services Controller and vCenter Server via the CLI Installer" />
<meta property="og:description" content="The first topic we will cover in our Automating your vSphere Upgrade series is updating our core infrastructure. Upgrading Platform Services Controller(PSC)  and vCenter Server via the CLI installer. In our workshops one of the common things I hear is that most folks aren&rsquo;t using the CLI based tools that have been included in the installer. I am a huge fan of these as they make migrations and upgrades seamless&ndash;especially when having to perform the task if you have multiple PSC&rsquo;s and vCenter Servers. Using the CLI tools don’t have to be intimidating, as we go through this blog we will cover some how-to&rsquo;s and benefits of using the CLI based approach.

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2018/10/05/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer/" />



<meta property="article:published_time" content="2018-10-05T09:08:15-04:00"/>

<meta property="article:modified_time" content="2018-10-05T09:08:15-04:00"/>











        
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        
<meta itemprop="name" content="Upgrading Platform Services Controller and vCenter Server via the CLI Installer">
<meta itemprop="description" content="The first topic we will cover in our Automating your vSphere Upgrade series is updating our core infrastructure. Upgrading Platform Services Controller(PSC)  and vCenter Server via the CLI installer. In our workshops one of the common things I hear is that most folks aren&rsquo;t using the CLI based tools that have been included in the installer. I am a huge fan of these as they make migrations and upgrades seamless&ndash;especially when having to perform the task if you have multiple PSC&rsquo;s and vCenter Servers. Using the CLI tools don’t have to be intimidating, as we go through this blog we will cover some how-to&rsquo;s and benefits of using the CLI based approach.

">


<meta itemprop="datePublished" content="2018-10-05T09:08:15-04:00" />
<meta itemprop="dateModified" content="2018-10-05T09:08:15-04:00" />
<meta itemprop="wordCount" content="1544">



<meta itemprop="keywords" content="vSphere Upgrade,vSphere 6.5,vSphere 6.7,PSC,vCenter Server," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/add-on.css">
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-67336507-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="/">blog</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="/tags/">
                            <i class="fa fa-hashtag">&nbsp;</i>Tags
                    </a>
                </li>
            
                <li>
                    <a href="/categories/">
                            <i class="fa fa-sitemap">&nbsp;</i>Categories
                    </a>
                </li>
            
                <li>
                    <a href="/resources/">
                            <i class="fa fa-link">&nbsp;</i>Resources
                    </a>
                </li>
            
                <li>
                    <a href="/acclaim/">
                            <i class="fa fa-list">&nbsp;</i>Acclaim
                    </a>
                </li>
            
                <li>
                    <a href="/about/">
                            <i class="fa fa-question">&nbsp;</i>About
                    </a>
                </li>
            
                <li>
                    <a href="/contact/">
                            <i class="fa fa-envelope-o">&nbsp;</i>Contact
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="davidstamen.com">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags/">
                            <h3>
                                <i class="fa fa-hashtag">&nbsp;</i>Tags
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories/">
                            <h3>
                                <i class="fa fa-sitemap">&nbsp;</i>Categories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/resources/">
                            <h3>
                                <i class="fa fa-link">&nbsp;</i>Resources
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/acclaim/">
                            <h3>
                                <i class="fa fa-list">&nbsp;</i>Acclaim
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about/">
                            <h3>
                                <i class="fa fa-question">&nbsp;</i>About
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/contact/">
                            <h3>
                                <i class="fa fa-envelope-o">&nbsp;</i>Contact
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/2018/10/25/vsphere-update-manager-6.7-unable-to-scan-cluster/">vSphere Update Manager 6.7 Unable to Scan Cluster</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-10-25'>
                                    October 25, 2018</time>
                            </header>
                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/2018/10/24/vmworld-eu-2018-sessions-events/">VMworld EU - Sessions and Events</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-10-24'>
                                    October 24, 2018</time>
                            </header>
                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/2018/10/18/whats-new-with-auto-deploy-in-vsphere-6.7-u1/">What&#39;s New with Auto Deploy in vSphere 6.7 U1</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-10-18'>
                                    October 18, 2018</time>
                            </header>
                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/2018/10/11/why-and-how-to-upgrade-to-vsphere-6.7-u1/">Why and How To Upgrade to vSphere 6.7 U1</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-10-11'>
                                    October 11, 2018</time>
                            </header>
                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/2018/10/08/automating-the-upgrade-of-the-virtual-distributed-switch/">Automating the Upgrade of the Virtual Distributed Switch</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-10-08'>
                                    October 8, 2018</time>
                            </header>
                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/2018/10/07/automating-migration-of-vmfs-5-to-vmfs-6-datastores/">Automating Migration of VMFS-5 to VMFS-6 Datastores</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-10-07'>
                                    October 7, 2018</time>
                            </header>
                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/2018/10/06/automating-upgrade-of-vmware-tools-and-vm-compatibility/">Automating Upgrade of VMware Tools and VM Compatibility</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-10-06'>
                                    October 6, 2018</time>
                            </header>
                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/2018/10/05/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer/">Upgrading Platform Services Controller and vCenter Server via the CLI Installer</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-10-05'>
                                    October 5, 2018</time>
                            </header>
                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/2018/08/15/l1-terminal-fault-l1tf-patching-considerations/">L1 Terminal Fault (L1TF) Patching Considerations</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-08-15'>
                                    August 15, 2018</time>
                            </header>
                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/2018/07/18/vmworld-2018-sessions-events/">VMworld 2018 - Sessions and Events</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-18'>
                                    July 18, 2018</time>
                            </header>
                        </article>
                

                
                    <a href=
                        
                            /blog/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li>
  <a href="//twitter.com/share?url=%2f2018%2f10%2f05%2fupgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer%2f&amp;text=Upgrading%20Platform%20Services%20Controller%20and%20vCenter%20Server%20via%20the%20CLI%20Installer&amp;via=davidstamen" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>








<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=%2f2018%2f10%2f05%2fupgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=%2f2018%2f10%2f05%2fupgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer%2f&amp;title=Upgrading%20Platform%20Services%20Controller%20and%20vCenter%20Server%20via%20the%20CLI%20Installer" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=%2f2018%2f10%2f05%2fupgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer%2f&amp;title=Upgrading%20Platform%20Services%20Controller%20and%20vCenter%20Server%20via%20the%20CLI%20Installer" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>











        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h2><a href="/2018/10/05/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer/">Upgrading Platform Services Controller and vCenter Server via the CLI Installer</a></h2>
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2018-10-05'>
            October 5, 2018</time>
        <span class="author"></span>
        
        
    </div>
</header>

  <div id="content">
      <p>The first topic we will cover in our Automating your vSphere Upgrade series is updating our core infrastructure. Upgrading Platform Services Controller(PSC)  and vCenter Server via the CLI installer. In our workshops one of the common things I hear is that most folks aren&rsquo;t using the CLI based tools that have been included in the installer. I am a huge fan of these as they make migrations and upgrades seamless&ndash;especially when having to perform the task if you have multiple PSC&rsquo;s and vCenter Servers. Using the CLI tools don’t have to be intimidating, as we go through this blog we will cover some how-to&rsquo;s and benefits of using the CLI based approach.</p>

<p></p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//vsphereupgradeprocess-1.png" data-caption=""><img src="/images//vsphereupgradeprocess-1.png"></a>
      
    </div>
  



<p>When we start our vSphere Upgrade the first thing we want to do is to upgrade our PSC and vCenter Server before updating other components. If we happen to be using an Embedded PSC deployment the upgrade is simple, we can do the upgrade in one step (Step 1 and Step 2 combined). However, if we are using an External PSC deployment we must upgrade all of our PSC&rsquo;s within the same SSO domain first prior to upgrading any vCenter Servers&ndash;so this becomes a multi-step process.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//67applianceupgradeimage.png" data-caption=""><img src="/images//67applianceupgradeimage.png"></a>
      
    </div>
  



<p>For this upgrade scenario we will be performing an upgrade from an External PSC deployment using appliances on vSphere 6.0 to an External PSC deployment using appliances on vSphere 6.7.</p>

<h2 id="prepare-your-json-configuration-file-for-cli-upgrade">Prepare Your JSON Configuration File for CLI Upgrade</h2>

<p>When doing a CLI based upgrade, we use a configuration file template (JSON) that is part of the vCenter Server Appliance (VCSA) ISO. When you mount the ISO you will see a directory labelled <strong>vcsa-cli-installer</strong> and within that folder is a directory called <strong>templates.</strong> Once you are here you have the option to see the CLI templates for install, migrate and upgrade. As a reminder a migration is when we are moving from a vCenter Server on Windows, and an upgrade is when we are moving from VCSA to VCSA.</p>

<p>Since we are doing an <strong>upgrade</strong> we will browse to that folder and we are left seeing a <strong>vcsa6.0</strong> and <strong>vcsa6.5</strong> directory. The information we need when coming from each version is different so there is a unique set of templates for each version. Since we are upgrading from a vSphere 6.0 deployment we will head into the <strong>vcsa6.0</strong> directory.</p>

<p>Once we are in this directory we can see a few different templates. We have a template for an embedded deployment, external PSC and external vCenter Server. Each template has an associated version whether or not we will be connecting to a vCenter Server or an ESXi host directly. The embedded template is for an embedded deployment which does both PSC and vCenter Server at the same time as we mentioned above, and the PSC and VCSA are separate templates as we need to do these one at a time.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//cli1.png" data-caption=""><img src="/images//cli1.png"></a>
      
    </div>
  



<p>Since we have an External PSC deployment and we are using a vCenter Server, we will first open the <strong>PSC_on_VC.json</strong>.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//cli1.png" data-caption=""><img src="/images//cli1.png"></a>
      
    </div>
  



<p>When opening this file at first glance you might say WOAH! That looks complicated, but there is quite a bit of extra text explaining each field. Lets fill in the blanks with the required information and take another look.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//cli3.png" data-caption=""><img src="/images//cli3.png"></a>
      
    </div>
  



<p>This looks a lot better, we can clearly see the details it is asking for. The vCenter Server to deploy the new appliance to, the appliance information, the temporary IP to use, and then last but not least the source information for the appliance we are upgrading. If we have a deployment where there are multiple PSC&rsquo;s we could see how easy it would be to make a copy of this file, and edit lines 17 and 41 putting in the second PSC and then re-saving. How much time saving could this be!? With vSphere 6.5 allowing 10 PSC&rsquo;s per SSO domain and vSphere 6.7 allowing 15 this could be quite a bit of time saved!</p>

<p>Next up, its time to upgrade our vCenter Server. To get our JSON file ready we will head back and grab the <strong>vCSA_on_VC.json</strong> template. Also remember that if you happen to have multiple VCSA&rsquo;s to upgrade you can easily update lines 16 ,17 and 40 to upgrade other appliances in your environment.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//cli4.png" data-caption=""><img src="/images//cli4.png"></a>
      
    </div>
  



<blockquote>
<p><em>Certain sensitive fields such as passwords can be left blank if chosen. When the CLI installer is run it will prompt for the password during runtime.</em></p>
</blockquote>

<p>Now that we have prepared our templates for our upgrade, the next section we will jump into how to actually perform our upgrade using the CLI.  </p>

<p>More information on preparing the JSON template can be found <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vcenter.upgrade.doc/GUID-97DFD5CF-449A-4CB8-A5D1-9091D93E807B.html">here</a>.</p>

<h2 id="upgrade-a-vcenter-server-appliance-or-platform-services-controller-appliance-by-using-the-cli">Upgrade a vCenter Server Appliance or Platform Services Controller Appliance by Using the CLI</h2>

<p>CLI templates in hand, its now for the fun. Using these templates we will automate our upgrade. vSphere 6.0 originally introduced this concept of a CLI based tool, however its been enhanced with vSphere 6.7. With vSphere 6.7 we now have a &ldquo;batch template&rdquo; technology built into the installer. Prior to vSphere 6.7 we had to run the installer against a single JSON file and wait for it to finish, we would then have to manually kick off the second JSON file when the previous one completes. With the batch upgrade we can put multiple JSON files into a single directory and point the installer to the directory and it is smart enough to map out the dependencies and upgrade the PSC&rsquo;s first and then the vCenter Servers.</p>

<p>Before we actually perform our upgrade, I want to explain some of the benefits of the CLI installer. If we happened to be using the GUI based upgrade, everything in that upgrade would have to be manually entered into the GUI and obviously that is susceptible to typos and errors. Also, if we happened to enter some incorrect information and had to retry our upgrade we would again have to re-type all that information. What if we had a way to perform an upgrade test without ever touching our production environment? With the CLI Installer we do! And its called a pre-check. When running the CLI installer with the <strong>--precheck-only</strong> flag we have the ability to go through a full dry run of our upgrade. If we happened to have a typo, insufficient capacity or any other errors it would spit this out, and we could easily correct the settings.</p>

<p>To run our CLI based installer we will mount our vSphere 6.7 media as that is the version we are going to. We will again navigate to the <strong>vcsa-cli-installer</strong> directory. From here depending on the operating system of the machine we are on we will either navigate to the <strong>lin64, win32 or mac</strong> folder to use the supported installer for that operating system.</p>

<p>Here we will see quite a few files, but the one we want to focus on is <strong>vcsa-deploy.exe</strong> in the win32 folder since I will be running this from a windows machine. If we run <strong>.\vcsa-deploy.exe</strong> <strong>upgrade</strong> it will give us the details on how to properly use the CLI tool.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//cli5.png" data-caption=""><img src="/images//cli5.png"></a>
      
    </div>
  



<p>As I mentioned previously one of the benefits of using the CLI tool is that you can execute a pre-check of your template against the environment to make sure things will pass. Usually with upgrades and migrations a big issue we see with them failing is due to a smaller appliance size being chosen for the new appliance or insufficient capacity in the vCenter Server environment. In this environment we will execute our vcsa-deploy utilizing the pre-check option and see our results.</p>

<p>To run the pre-check I ran the following command: <code>.\vcsa-deploy.exe upgrade --no-ssl-certificate-verification --accept-eula --acknowledge-ceip --precheck-only C:\scripts\\6.7\upg60to67\</code></p>

<p>I chose to point this to the folder to take advantage of the batch upgrade vs pointing it to the individual file, as I mentioned earlier it is smart enough to map out the dependencies as we can see from the below image.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//cli6.png" data-caption=""><img src="/images//cli6.png"></a>
      
    </div>
  



<p>Once the pre-check runs through we will either get a success or failure. In the image below my vCenter Server services were not running so the pre-check failed.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//cli7.png" data-caption=""><img src="/images//cli7.png"></a>
      
    </div>
  



<p>Now that we have the service running and re-run our pre-check we can see everything is successful and we can now proceed to remove the &ndash;precheck-only flag from our command.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//cli7.png" data-caption=""><img src="/images//cli7.png"></a>
      
    </div>
  



<p><code>.\vcsa-deploy.exe** **upgrade --no-ssl-certificate-verification --accept-eula --acknowledge-ceip C:\scripts\\6.7\upg60to67\</code></p>

<p>The upgrade process is now happening without any additional user input. If you need to step away for lunch or if a co-worker needs you there is no additional action that is needed until the end. If you were using the GUI based approach once Stage 1 where the appliance is deployed is complete you have to manually start Stage 2 to configure the upgraded appliance. With the CLI based installer this is not needed. When our upgrade is complete we will be presented with the vCenter Server and login information as we can see below.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    

    <div class="fancybox">
      <a data-fancybox="" href="/images//cli9.png" data-caption=""><img src="/images//cli9.png"></a>
      
    </div>
  



<p>More information on Upgrading your PSC and vCenter Server via the CLI can be found <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vcenter.upgrade.doc/GUID-80ADA633-13EA-49B0-9AC9-2C4E6B513AAB.html">here</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Automating your vSphere Upgrade does not have to be scary or hard, as we went through the steps its actually quite easy. Now that we have our PSC and vCenter Server updated we can now proceed to our next step which is automating the upgrade of our ESXi hosts.</p>

<hr />

<p><strong>Cross-Posted from vSphere Blog</strong></p>

<p><a href="https://blogs.vmware.com/vsphere/2018/09/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer.html">https://blogs.vmware.com/vsphere/2018/09/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer.html</a></p>
    </div>
<hr>

<section id="social-share">
  <ul class="icons">
      <header>
          <h3>Share this post</h3>
      </header>
    


<li>
  <a href="//twitter.com/share?url=%2f2018%2f10%2f05%2fupgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer%2f&amp;text=Upgrading%20Platform%20Services%20Controller%20and%20vCenter%20Server%20via%20the%20CLI%20Installer&amp;via=davidstamen" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>








<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=%2f2018%2f10%2f05%2fupgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=%2f2018%2f10%2f05%2fupgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer%2f&amp;title=Upgrading%20Platform%20Services%20Controller%20and%20vCenter%20Server%20via%20the%20CLI%20Installer" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=%2f2018%2f10%2f05%2fupgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer%2f&amp;title=Upgrading%20Platform%20Services%20Controller%20and%20vCenter%20Server%20via%20the%20CLI%20Installer" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>











  </ul>
</section>

<hr>
    <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
            
            
                <i class="fa fa-folder"></i>
                
                
                <li><a class="article-category-link" href="/categories/vmware">VMware</a></li>
                
            
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
            
            
                <i class="fa fa-tags"></i>
                
                
                <li><a class="article-category-link" href="/tags/vsphere-upgrade">vSphere Upgrade</a></li>
                
                
                <li><a class="article-category-link" href="/tags/vsphere-6.5">vSphere 6.5</a></li>
                
                
                <li><a class="article-category-link" href="/tags/vsphere-6.7">vSphere 6.7</a></li>
                
                
                <li><a class="article-category-link" href="/tags/psc">PSC</a></li>
                
                
                <li><a class="article-category-link" href="/tags/vcenter-server">vCenter Server</a></li>
                
            
        
    </ul>
  </li>
</ul>

  </footer>
</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "davidstamen" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="/2018/08/15/l1-terminal-fault-l1tf-patching-considerations/"
                class="button big previous">L1 Terminal Fault (L1TF) Patching Considerations</a></li>
    

    
        <li><a href="/2018/10/06/automating-upgrade-of-vmware-tools-and-vm-compatibility/"
                class="button big next">Automating Upgrade of VMware Tools and VM Compatibility</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/'><img src="/images/me2.jpg" width="300" alt="me" /></a>
      
    
    
      <header>
        <h2>David Stamen</h2>
        <p>technical marketing engineer at vmware</p>
      </header>
    
    
      <ul class="icons">
        
          
    <li><a href="/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/dstamen" target="_blank" title="GitHub" class="fa fa-github"></a></li>

























  <li><a href="//linkedin.com/in/davidstamen" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>



































  <li><a href="//twitter.com/davidstamen" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




















      </ul>
    
  </section>

  
  
  
  

  
 <section>
  <h3>Recent Posts</h3>
   <section class="recent-posts">
    <div class="mini-posts">

      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3><a href="/2018/10/25/vsphere-update-manager-6.7-unable-to-scan-cluster/">vSphere Update Manager 6.7 Unable to Scan Cluster</a></h3>
              
              <time class="published" datetime=
                  '2018-10-25'>
                  October 25, 2018</time>
          </header>
            
          </article>
        
          <article class="mini-post">
            <header>
              <h3><a href="/2018/10/24/vmworld-eu-2018-sessions-events/">VMworld EU - Sessions and Events</a></h3>
              
              <time class="published" datetime=
                  '2018-10-24'>
                  October 24, 2018</time>
          </header>
            
          </article>
        
          <article class="mini-post">
            <header>
              <h3><a href="/2018/10/18/whats-new-with-auto-deploy-in-vsphere-6.7-u1/">What&#39;s New with Auto Deploy in vSphere 6.7 U1</a></h3>
              
              <time class="published" datetime=
                  '2018-10-18'>
                  October 18, 2018</time>
          </header>
            
          </article>
        
          <article class="mini-post">
            <header>
              <h3><a href="/2018/10/11/why-and-how-to-upgrade-to-vsphere-6.7-u1/">Why and How To Upgrade to vSphere 6.7 U1</a></h3>
              
              <time class="published" datetime=
                  '2018-10-11'>
                  October 11, 2018</time>
          </header>
            
          </article>
        
          <article class="mini-post">
            <header>
              <h3><a href="/2018/10/08/automating-the-upgrade-of-the-virtual-distributed-switch/">Automating the Upgrade of the Virtual Distributed Switch</a></h3>
              
              <time class="published" datetime=
                  '2018-10-08'>
                  October 8, 2018</time>
          </header>
            
          </article>
        
          <article class="mini-post">
            <header>
              <h3><a href="/2018/10/07/automating-migration-of-vmfs-5-to-vmfs-6-datastores/">Automating Migration of VMFS-5 to VMFS-6 Datastores</a></h3>
              
              <time class="published" datetime=
                  '2018-10-07'>
                  October 7, 2018</time>
          </header>
            
          </article>
        
          <article class="mini-post">
            <header>
              <h3><a href="/2018/10/06/automating-upgrade-of-vmware-tools-and-vm-compatibility/">Automating Upgrade of VMware Tools and VM Compatibility</a></h3>
              
              <time class="published" datetime=
                  '2018-10-06'>
                  October 6, 2018</time>
          </header>
            
          </article>
        
          <article class="mini-post">
            <header>
              <h3><a href="/2018/10/05/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer/">Upgrading Platform Services Controller and vCenter Server via the CLI Installer</a></h3>
              
              <time class="published" datetime=
                  '2018-10-05'>
                  October 5, 2018</time>
          </header>
            
          </article>
        
          <article class="mini-post">
            <header>
              <h3><a href="/2018/08/15/l1-terminal-fault-l1tf-patching-considerations/">L1 Terminal Fault (L1TF) Patching Considerations</a></h3>
              
              <time class="published" datetime=
                  '2018-08-15'>
                  August 15, 2018</time>
          </header>
            
          </article>
        
          <article class="mini-post">
            <header>
              <h3><a href="/2018/07/18/vmworld-2018-sessions-events/">VMworld 2018 - Sessions and Events</a></h3>
              
              <time class="published" datetime=
                  '2018-07-18'>
                  July 18, 2018</time>
          </header>
            
          </article>
        
      </div>
    </div>
  </section>
 </section>
 <section>
 <h3>Tag Cloud</h3>
  


<div class="widget-wrap">
    <h3 class="widget-title">
        
    </h3>
    <div class="widget tagcloud">
        
        
        <a href="/tags/ansible" style="font-size: 12px;">Ansible</a>
        
        
        <a href="/tags/autodeploy" style="font-size: 12px;">AutoDeploy</a>
        
        
        <a href="/tags/availability" style="font-size: 12px;">Availability</a>
        
        
        <a href="/tags/career" style="font-size: 12px;">Career</a>
        
        
        <a href="/tags/chrome" style="font-size: 12px;">Chrome</a>
        
        
        <a href="/tags/cisco-aci" style="font-size: 12px;">Cisco ACI</a>
        
        
        <a href="/tags/cisco-champion" style="font-size: 12px;">Cisco Champion</a>
        
        
        <a href="/tags/cisco-ucs" style="font-size: 12px;">Cisco UCS</a>
        
        
        <a href="/tags/content-library" style="font-size: 12px;">Content Library</a>
        
        
        <a href="/tags/dump-collector" style="font-size: 12px;">Dump Collector</a>
        
        
        <a href="/tags/esxcli" style="font-size: 12px;">ESXCLI</a>
        
        
        <a href="/tags/esxi" style="font-size: 12px;">ESXi</a>
        
        
        <a href="/tags/exchange" style="font-size: 12px;">Exchange</a>
        
        
        <a href="/tags/forestry.io" style="font-size: 12px;">Forestry.io</a>
        
        
        <a href="/tags/ha" style="font-size: 12px;">HA</a>
        
        
        <a href="/tags/homelab" style="font-size: 12px;">HomeLab</a>
        
        
        <a href="/tags/horizon-view" style="font-size: 12px;">Horizon View</a>
        
        
        <a href="/tags/hugo" style="font-size: 12px;">Hugo</a>
        
        
        <a href="/tags/jekyll" style="font-size: 12px;">Jekyll</a>
        
        
        <a href="/tags/kvm" style="font-size: 12px;">KVM</a>
        
        
        <a href="/tags/l1tf" style="font-size: 12px;">L1TF</a>
        
        
        <a href="/tags/lifecycle" style="font-size: 12px;">Lifecycle</a>
        
        
        <a href="/tags/myvmware" style="font-size: 12px;">MyVMware</a>
        
        
        <a href="/tags/network" style="font-size: 12px;">Network</a>
        
        
        <a href="/tags/nginx" style="font-size: 12px;">Nginx</a>
        
        
        <a href="/tags/psc" style="font-size: 12px;">PSC</a>
        
        
        <a href="/tags/pernix-pro" style="font-size: 12px;">Pernix Pro</a>
        
        
        <a href="/tags/powercli" style="font-size: 12px;">PowerCLI</a>
        
        
        <a href="/tags/powerdns" style="font-size: 12px;">PowerDNS</a>
        
        
        <a href="/tags/powershell" style="font-size: 12px;">Powershell</a>
        
        
        <a href="/tags/ravello" style="font-size: 12px;">Ravello</a>
        
        
        <a href="/tags/snmp" style="font-size: 12px;">SNMP</a>
        
        
        <a href="/tags/srm" style="font-size: 12px;">SRM</a>
        
        
        <a href="/tags/ssh" style="font-size: 12px;">SSH</a>
        
        
        <a href="/tags/standdesk" style="font-size: 12px;">StandDesk</a>
        
        
        <a href="/tags/storage" style="font-size: 12px;">Storage</a>
        
        
        <a href="/tags/study-guide" style="font-size: 12px;">Study Guide</a>
        
        
        <a href="/tags/syslog" style="font-size: 12px;">Syslog</a>
        
        
        <a href="/tags/sysprep" style="font-size: 12px;">Sysprep</a>
        
        
        <a href="/tags/trend-micro" style="font-size: 12px;">Trend Micro</a>
        
        
        <a href="/tags/usg" style="font-size: 12px;">USG</a>
        
        
        <a href="/tags/ubuntu" style="font-size: 12px;">Ubuntu</a>
        
        
        <a href="/tags/unifi" style="font-size: 12px;">Unifi</a>
        
        
        <a href="/tags/update-manager" style="font-size: 12px;">Update Manager</a>
        
        
        <a href="/tags/vcap6-dcv-deploy" style="font-size: 12px;">VCAP6-DCV Deploy</a>
        
        
        <a href="/tags/vcap6-dcv-design" style="font-size: 12px;">VCAP6-DCV Design</a>
        
        
        <a href="/tags/vcap6.5-dcv-design" style="font-size: 12px;">VCAP6.5-DCV Design</a>
        
        
        <a href="/tags/vcp6-dcv" style="font-size: 12px;">VCP6-DCV</a>
        
        
        <a href="/tags/vdp" style="font-size: 12px;">VDP</a>
        
        
        <a href="/tags/vm-compatibility" style="font-size: 12px;">VM Compatibility</a>
        
        
        <a href="/tags/vm-tools" style="font-size: 12px;">VM Tools</a>
        
        
        <a href="/tags/vmware-fling" style="font-size: 12px;">VMware Fling</a>
        
        
        <a href="/tags/vmworld" style="font-size: 12px;">VMworld</a>
        
        
        <a href="/tags/vpn" style="font-size: 12px;">VPN</a>
        
        
        <a href="/tags/vagrant" style="font-size: 12px;">Vagrant</a>
        
        
        <a href="/tags/veeam" style="font-size: 12px;">Veeam</a>
        
        
        <a href="/tags/vulnerability" style="font-size: 12px;">Vulnerability</a>
        
        
        <a href="/tags/webclient" style="font-size: 12px;">Webclient</a>
        
        
        <a href="/tags/windows" style="font-size: 12px;">Windows</a>
        
        
        <a href="/tags/vcenter-ha" style="font-size: 12px;">vCenter HA</a>
        
        
        <a href="/tags/vcenter-server" style="font-size: 12px;">vCenter Server</a>
        
        
        <a href="/tags/vcloud-air" style="font-size: 12px;">vCloud Air</a>
        
        
        <a href="/tags/vexpert" style="font-size: 12px;">vExpert</a>
        
        
        <a href="/tags/vma" style="font-size: 12px;">vMA</a>
        
        
        <a href="/tags/vmotion" style="font-size: 12px;">vMotion</a>
        
        
        <a href="/tags/vra" style="font-size: 12px;">vRA</a>
        
        
        <a href="/tags/vrops" style="font-size: 12px;">vROPS</a>
        
        
        <a href="/tags/vsphere-5.1" style="font-size: 12px;">vSphere 5.1</a>
        
        
        <a href="/tags/vsphere-5.5" style="font-size: 12px;">vSphere 5.5</a>
        
        
        <a href="/tags/vsphere-6.0" style="font-size: 12px;">vSphere 6.0</a>
        
        
        <a href="/tags/vsphere-6.5" style="font-size: 12px;">vSphere 6.5</a>
        
        
        <a href="/tags/vsphere-6.7" style="font-size: 12px;">vSphere 6.7</a>
        
        
        <a href="/tags/vsphere-upgrade" style="font-size: 12px;">vSphere Upgrade</a>
        
    </div>
</div>




</section>

  
  <section id="footer">
    
      <ul class="icons">
        
          
    <li><a href="/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/dstamen" target="_blank" title="GitHub" class="fa fa-github"></a></li>

























  <li><a href="//linkedin.com/in/davidstamen" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>



































  <li><a href="//twitter.com/davidstamen" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




















      </ul>
    
    <p class="copyright">
      
        &copy; 2018
        
          davidstamen.com
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/css.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
      <script src="/js/backToTop.js"></script>
    

    
      
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

