<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Automating Upgrade of VMware Tools and VM Compatibility  &middot; davidstamen.com</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


  <meta name="description" content="" />

  <meta name="keywords" content="vSphere Upgrade, VM Tools, VM Compatibility, ">




<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2018-10-06T08:25:31-04:00" />
<meta property="og:article:modified_time" content="2018-10-06T08:25:31-04:00" />

  
    
<meta property="og:article:tag" content="vSphere Upgrade">
    
<meta property="og:article:tag" content="VM Tools">
    
<meta property="og:article:tag" content="VM Compatibility">
    
  

  <meta property="og:title" content="Automating Upgrade of VMware Tools and VM Compatibility" />
<meta property="og:description" content="Next up in our Automating your vSphere Upgrade blog series is your VMware Tools and VM Compatibility. Upgrading these both have different requirements so we will cover when and how you should upgrade your VMware Tools and VM compatibility in the below post." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2018/10/06/automating-upgrade-of-vmware-tools-and-vm-compatibility/" />
<meta property="article:published_time" content="2018-10-06T08:25:31-04:00"/>
<meta property="article:modified_time" content="2018-10-06T08:25:31-04:00"/>


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Automating Upgrade of VMware Tools and VM Compatibility"/>
<meta name="twitter:description" content="Next up in our Automating your vSphere Upgrade blog series is your VMware Tools and VM Compatibility. Upgrading these both have different requirements so we will cover when and how you should upgrade your VMware Tools and VM compatibility in the below post."/>
<meta name="twitter:site" content="@davidstamen"/>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-67336507-1', 'auto');
	
	ga('send', 'pageview');
}
</script>






  <link rel="canonical" href="/2018/10/06/automating-upgrade-of-vmware-tools-and-vm-compatibility/" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="icon" href="/favicon/favicon.ico">

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6907288179836979",
    enable_page_level_ads: true
  });
</script>

  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    
    <script src="/js/clr-2.0/clr-icons.min.js"></script>
    <script src="/js/clr-2.0/custom-elements.min.js"></script>

    
    <link href="/css/clr-2.0/clr-ui.css" rel="stylesheet">
    
    <link href="/css/clr-2.0/clr-icons.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/all.css">
</head>
<body data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
  <div class="main-container">
    
<header class="header-7">
  <div class="branding">
    

    
    <a class="navbar-brand-img" href="/">
      <img alt="" src="">
      <span class="title">davidstamen.com</span>
      
    </a>
  </div>
  <div class="header-nav" [clr-nav-level]="1">
    
    
        <a class="nav-link  nav-text" href="/" >
          
          Home
        </a>
    
        <a class="nav-link  nav-text" href="/tags/" >
          
          Tags
        </a>
    
        <a class="nav-link  nav-text" href="/categories/" >
          
          Categories
        </a>
    
        <a class="nav-link  nav-text" href="/series/" >
          
          Series
        </a>
    
        <a class="nav-link  nav-text" href="/acclaim" >
          
          Acclaim
        </a>
    
        <a class="nav-link  nav-text" href="/about" >
          
          About
        </a>
    
  </div>
  <div class="header-actions">
  <form class="search" id="search" method="get" action="//google.com/search">
    <label for="search_input">
        <input id="search_input" type="text" name="q" placeholder="Search">
        <input type="hidden" name="as_sitesearch" value="davidstamen.com">
    </label>
</form>
</div>
</header>
<nav class="subnav" [clr-nav-level]="2">
  <ul class="nav">
    
    
    <li class="nav-item">
        <a class="nav-link " href="/vcsa-json-creator" >
          
          VCSA JSON Creator 9000
        </a>
    </li>
    
  </ul>
</nav>


<div class="content-container">
  <div class="content-area">
      <h1>Automating Upgrade of VMware Tools and VM Compatibility
</h1>

      <div class="metas">
  
  <span class="clr-card-authors">
      <div class="clr-card-authors">
        Published on 
October 6, 2018 under <a class="" href="/categories/vmware">VMware</a>
        &middot; Tagged <a class="" href="/tags/vsphere-upgrade">vSphere Upgrade</a>, <a class="" href="/tags/vm-tools">VM Tools</a> and <a class="" href="/tags/vm-compatibility">VM Compatibility</a>
        &middot; Read in about 6 min (1270 words)
      </div>
  </span>
  
    
    
</div>
<hr>

      
  
  <div class="alert alert-info" role="alert">
      <div class="alert-items">
          <div class="alert-item static">
              <div class="alert-icon-wrapper">
                  <clr-icon class="alert-icon" shape="info-circle"></clr-icon>
              </div>
              <span class="alert-text">This post is part of the <a href="series/automating-your-vsphere-upgrade">Automating your vSphere Upgrade</a> series.</span>
              <div class="alert-actions">
                <ol>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                  <li>
                  
                      <a href="/2018/10/08/automating-the-upgrade-of-the-virtual-distributed-switch/">Automating the Upgrade of the Virtual Distributed Switch</a>
                    
                    </li>
                  
                
                
                
                
                
                
                  <li>
                  
                      <a href="/2018/10/07/automating-migration-of-vmfs-5-to-vmfs-6-datastores/">Automating Migration of VMFS-5 to VMFS-6 Datastores</a>
                    
                    </li>
                  
                
                
                
                
                
                
                
                
                  <li>
                  
                    Automating Upgrade of VMware Tools and VM Compatibility
                    
                    </li>
                  
                
                
                
                
                  <li>
                  
                      <a href="/2018/10/05/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer/">Upgrading Platform Services Controller and vCenter Server via the CLI Installer</a>
                    
                    </li>
                  
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                </ol>
              </div>
          </div>
      </div>
  </div>

      <p>Next up in our Automating your vSphere Upgrade blog series is your VMware Tools and VM Compatibility. Upgrading these both have different requirements so we will cover when and how you should upgrade your VMware Tools and VM compatibility in the below post.</p>

  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/vsphereupgradeprocess-4.png" data-caption=""><img width=100% src="/images/vsphereupgradeprocess-4.png"></a>
      
    </div>
  



<h2 id="upgrading-vmware-tools">Upgrading VMware Tools</h2>

<p>When it comes to keeping your VMware Tools up to date we have a few options but I will focus on two of my favorite methods. Keeping VMware tools up to date is very important as VMware includes drivers and tools to make sure your VM&rsquo;s run optimally with the latest features. <a href="https://twitter.com/eric_gray">Eric Gray</a> of our CPBU Technical Marketing Team covers a few considerations and methods in depth in the following blog post <a href="https://blogs.vmware.com/vsphere/2016/03/six-methods-for-keeping-vm-tools-up-to-date.html">Six Methods for Keeping VM Tools Up to Date</a>.</p>

<h3 id="checking-vmware-tools-compliance">Checking VMware Tools Compliance</h3>

<p>Before we can start to update our VMware Tools it might be a good idea to understand which VMs in our environment are currently out of compliance, the easiest way to check if a VM if out of compliance is to view it via the vSphere Client and it will show you details such as the version and compliance.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli1.png" data-caption=""><img width=100% src="/images/toolscli1.png"></a>
      
    </div>
  



<p>However, since we are talking about automation lets show this another way using PowerCLI.</p>

<pre><code>Get-Folder -name Testing | Get-VM | % { get-view $\_.id } | select name, @{Name=“ToolsVersion”; Expression={$\_.config.tools.toolsversion}}, @{ Name=“ToolStatus”; Expression={$\_.Guest.ToolsVersionStatus}}|Sort-Object Name
</code></pre>

<p>Using this PowerCLI one-liner we are able to see more information at scale, we can see that within our folder we actually have 3 VMs that are out of compliance. To remediate these to the latest version its actually quite simple with PowerCLI as well.  </p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli2.png" data-caption=""><img width=100% src="/images/toolscli2.png"></a>
      
    </div>
  



<p>To make the information clearer on what needs an update we will use the same search only looking for VMs where ToolStatus is guestToolsNeedUpgrade. To do that we will use the following one-liner.</p>

<pre><code>Get-Folder -name Testing | Get-VM | % { get-view $\_.id } |Where-Object {$\_.Guest.ToolsVersionStatus -like &quot;guestToolsNeedUpgrade&quot;} |select name, @{Name=“ToolsVersion”; Expression={$\_.config.tools.toolsversion}}, @{ Name=“ToolStatus”; Expression={$\_.Guest.ToolsVersionStatus}}| Sort-Object Name
</code></pre>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli3.png" data-caption=""><img width=100% src="/images/toolscli3.png"></a>
      
    </div>
  



<h3 id="upgrading-vmware-tools-via-powercli">Upgrading VMware Tools via PowerCLI</h3>

<p>Now that we know which VMs need tools update we can actually go forth and upgrade tools. That is quite simple we can do this using the Update-Tools PowerCLI cmdlet. Using our existing one-liner from above we will just append Update-Tools to update the VMs with tools currently out of compliance.</p>

<pre><code>Get-Folder -name Testing | Get-VM | % { get-view $\_.id } |Where-Object {$\_.Guest.ToolsVersionStatus -like &quot;guestToolsNeedUpgrade&quot;} |select name, @{Name=“ToolsVersion”; Expression={$\_.config.tools.toolsversion}}, @{ Name=“ToolStatus”; Expression={$\_.Guest.ToolsVersionStatus}}| Update-Tools -NoReboot -VM {$\_.Name} -Verbose
</code></pre>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli4.png" data-caption=""><img width=100% src="/images/toolscli4.png"></a>
      
    </div>
  



<p>You may have noticed that all the VMs had their updates kicked off at the same time and this may not be ideal, this is one way that the Update-Tools cmdlet works, however we can get around this by storing the VMs within a variable and then using a loop process them one at a time. This is definitely preferable as it will limit the impact to the environment.</p>

<pre><code>$OutofDateVMs = Get-Folder -name Testing | Get-VM | % { get-view $\_.id } |Where-Object {$\_.Guest.ToolsVersionStatus -like &quot;guestToolsNeedUpgrade&quot;} |select name, @{Name=“ToolsVersion”; Expression={$\_.config.tools.toolsversion}}, @{ Name=“ToolStatus”; Expression={$\_.Guest.ToolsVersionStatus}}

ForEach ($VM in $OutOfDateVMs){Update-Tools -NoReboot -VM $VM.Name -Verbose}
</code></pre>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli5.png" data-caption=""><img width=100% src="/images/toolscli5.png"></a>
      
    </div>
  



<p>Now our tools are up to date! For more information on upgrading your VMware Tools via PowerCLI you can find more information <a href="https://code.vmware.com/docs/7053/cmdlet-reference#/doc/Update-Tools.html">here</a>.  </p>

<h3 id="upgrading-tools-automatically-on-reboot">Upgrading Tools Automatically on Reboot</h3>

<p>Using VM options to keep VMware Tools up to date is also another method to automatically keep VMs up to date. Enabling the &ldquo;Check and upgrade VMware Tools before each power on&rdquo; advanced setting use to not be used because of the additional reboot it would cause for virtual machines. Keep in mind that with Windows Server 2016 <a href="https://blogs.vmware.com/vsphere/2018/08/eliminate-the-windows-reboot-after-updating-vmware-tools.html">VMware Tools no longer need a reboot on upgrade</a>, it can be safe to enable this setting and have VMs stay up to date on every reboot. However this may not be applicable to all situations, so another recommendation would be to enable this for a lab environment or non-critical workloads. The easy way to enable this option is to log into the vSphere Client, edit the VM settings and enable the setting.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli6.png" data-caption=""><img width=100% src="/images/toolscli6.png"></a>
      
    </div>
  



<p>After all this a post on automation, so lets see if we can find a way to use PowerCLI to modify the VM&rsquo;s setting so this gets easier when we have a large environment.</p>

<pre><code>Get-Folder Testing|Get-VM|Get-View | select name,@{N='ToolsUpgradePolicy';E={$\_.Config.Tools.ToolsUpgradePolicy } } |Sort Name
</code></pre>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli7.png" data-caption=""><img width=100% src="/images/toolscli7.png"></a>
      
    </div>
  



<p>Here we can see which VMs have the automatic upgrade set and which ones are configured for manual. Utilizing a filter we can look for objects that are set for manual and then configure them to be set for upgradeAtPowerCycle</p>

<pre><code>$ManualUpdateVMs = Get-Folder Testing|Get-VM|Get-View | Where-Object {$\_.Config.Tools.ToolsUpgradePolicy -like &quot;manual&quot;}|select name,@{N='ToolsUpgradePolicy';E={$\_.Config.Tools.ToolsUpgradePolicy } }

Foreach ($VM in ($ManualUpdateVMs)) {
$VMConfig = Get-View -VIObject $VM.Name
$vmConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec
$vmConfigSpec.Tools = New-Object VMware.Vim.ToolsConfigInfo
$vmConfigSpec.Tools.ToolsUpgradePolicy = &quot;UpgradeAtPowerCycle&quot;
$VMConfig.ReconfigVM($vmConfigSpec)
}
</code></pre>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli8.png" data-caption=""><img width=100% src="/images/toolscli8.png"></a>
      
    </div>
  



<p>If we do a final check we can see that all VMs are now set to <strong>upgradeAtPowerCycle</strong>.</p>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli9.png" data-caption=""><img width=100% src="/images/toolscli9.png"></a>
      
    </div>
  



<h2 id="upgrading-vm-compatibility">Upgrading VM Compatibility</h2>

<p>When it comes to upgrading your VM Compatibility this is something that should be done with caution. Upgrading VM Compatibility aka VM Hardware is like pulling out the motherboard and replacing it with a new one, so this should only be done when features and functionality in a higher level are needed. Our current recommended level is Hardware Version 11 as it handles remediation from current security threats. Prior to upgrading your VM Compatibility you should always make sure VMware Tools are up to date first as new drivers can be required for the new virtual hardware. As I mentioned previously prior to upgrading your VM Compatibility I recommend taking a snapshot or a backup of the virtual machine in case a rollback is needed.  </p>

<h3 id="checking-vm-compatibility-version">Checking VM Compatibility Version</h3>

<p>Its quite easy to see the current version of VM Compatibility via the vSphere Client, however when checking the current levels across our entire vCenter Server we may want to automate this Below you will find a quick and easy one-liner to identify the VMs and their current VM Compatibility version.</p>

<pre><code>Get-folder Testing | Get-VM | Select Name, Version | Sort Name
</code></pre>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli10.png" data-caption=""><img width=100% src="/images/toolscli10.png"></a>
      
    </div>
  



<p>As we can see above a few VMs are currently running v14 which is compatible with vSphere 6.7 only. This was needed for us to take advantage of <a href="https://blogs.vmware.com/vsphere/2018/05/introducing-support-virtualization-based-security-credential-guard-vsphere-6-7.html">VBS</a> and <a href="https://blogs.vmware.com/vsphere/2018/05/vsphere-6-7-virtual-trusted-platform-modules.html">TPM</a> security features. Again, we should only upgrade VM Compatibility when additional functionality is needed.</p>

<h3 id="upgrading-vm-compatibility-version">Upgrading VM Compatibility Version</h3>

<p>We have identified a need to upgrade VM08 also to v14 to take advantage of Per-VM EVC so we can handle the automation of the VM compatibility upgrade. We can do this again quite easily with PowerCLI. If you wish to do this via the vSphere Client my colleague Nigel Hickey covers this in his blog series <a href="https://blogs.vmware.com/vsphere/2018/09/vsphere-upgrade-series-part-4-upgrading-vmware-tools-and-vm-compatibility.html">here</a>. However, we are talking automation here so lets jump into the quick script to accomplish this.</p>

<pre><code>$HardwareUpdateVMs = Get-Folder Testing | Get-VM VM08

Foreach ($VM in ($HardwareUpdateVMs)) {
$VMConfig = Get-View -VIObject $VM.Name
$vmConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec
$vmConfigSpec.ScheduledHardwareUpgradeInfo = New-Object -TypeName VMware.Vim.ScheduledHardwareUpgradeInfo
$vmConfigSpec.ScheduledHardwareUpgradeInfo.UpgradePolicy = “always”
$vmConfigSpec.ScheduledHardwareUpgradeInfo.VersionKey = “vmx-14”
$VMConfig.ReconfigVM($vmConfigSpec)
}
</code></pre>




  
    
    
    
      
    
    
      
    

    
    







  



    
    
    
    
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css" />
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>
    <div style="max-width: 80%;width: fit-content;margin: auto;padding: 1.5em;">
      <a data-fancybox="" href="/images/toolscli11.png" data-caption=""><img width=100% src="/images/toolscli11.png"></a>
      
    </div>
  



<p>This will not automatically upgrade the VM Compatibility, unlike VMware Tools this can not be done with the virtual machine Powered On. The next time the VM is rebooted it will be shutdown, the compatibility will be upgraded and then be powered back on.</p>

<p>More information on upgrading VM Compatibility can be found <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.vm_admin.doc/GUID-96C06236-C271-4CFE-857E-22D1FDEECC95.html">here</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Automating your VMware Tools and VM Compatibility upgrades do not need to be hard, we have quite a few ways to help you with this and help this blog has helped educate you on some additional methods. For more information on Automating your vSphere Upgrade be sure to check out the full series <a href="https://blogs.vmware.com/vsphere/2018/09/introduction-to-automating-your-vsphere-upgrade.html">here</a>.</p>

<hr />

<p><strong>Cross-Posted from vSphere Blog</strong></p>

<p><a href="https://blogs.vmware.com/vsphere/2018/09/automating-upgrade-of-vmware-tools-and-vmware-compatibility.html">https://blogs.vmware.com/vsphere/2018/09/automating-upgrade-of-vmware-tools-and-vmware-compatibility.html</a></p>
      <h6>Share this post</h6>
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=%2f2018%2f10%2f06%2fautomating-upgrade-of-vmware-tools-and-vm-compatibility%2f" target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg>
      </div>
    </div>
  </a>
    <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Automating%20Upgrade%20of%20VMware%20Tools%20and%20VM%20Compatibility&amp;url=%2f2018%2f10%2f06%2fautomating-upgrade-of-vmware-tools-and-vm-compatibility%2f" target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg>
      </div>
    </div>
  </a>
  <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2f2018%2f10%2f06%2fautomating-upgrade-of-vmware-tools-and-vm-compatibility%2f&amp;title=Automating%20Upgrade%20of%20VMware%20Tools%20and%20VM%20Compatibility&amp;summary=Automating%20Upgrade%20of%20VMware%20Tools%20and%20VM%20Compatibility&amp;source=%2f2018%2f10%2f06%2fautomating-upgrade-of-vmware-tools-and-vm-compatibility%2f" target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg>
      </div>
    </div>
  </a>
    <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=%2f2018%2f10%2f06%2fautomating-upgrade-of-vmware-tools-and-vm-compatibility%2f&amp;resubmit=true&amp;title=Automating%20Upgrade%20of%20VMware%20Tools%20and%20VM%20Compatibility" target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg>
      </div>
    </div>
  </a>
    <a class="resp-sharing-button__link" href="mailto:?subject=Automating%20Upgrade%20of%20VMware%20Tools%20and%20VM%20Compatibility&amp;body=%2f2018%2f10%2f06%2fautomating-upgrade-of-vmware-tools-and-vm-compatibility%2f" target="_self" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg>
        </div>
    </div>
    </a>

      
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'davidstamen';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      

<h3>See Also</h3>
<ul>
	
	<li><a href="/2018/10/05/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer/">Upgrading Platform Services Controller and vCenter Server via the CLI Installer</a></li>
	
	<li><a href="/2018/04/17/upgrading-to-vmware-vsphere-6.7/">Upgrading to VMware vSphere 6.7</a></li>
	
</ul>

      <div class="clarity-prev-next col-xs-12 col-sm-12 col-md-12 col-lg-12">


      
      <nav class="clarity-page-prev-next">
            
            <div class="clr-nav-previous">
                  <a href="/2018/10/05/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer/" title="Upgrading Platform Services Controller and vCenter Server via the CLI Installer" class="btn btn-sm btn-outline">
                  Previous
                  </a>
            </div>
            
            
            <div class="clr-nav-next">
                  <a href="/2018/10/07/automating-migration-of-vmfs-5-to-vmfs-6-datastores/" title="Automating Migration of VMFS-5 to VMFS-6 Datastores" class="btn btn-sm btn-outline">
                  Next
                  </a>
            </div>
            
      </nav>
      

</div>

  </div>
  
  <nav class="sidenav clr-col-2 clr-col-sm-12 clr-col-md-12 clr-col-lg-6 clr-col-xl-6">
  <section class="sidenav-content">
    
    
    
    <div class="card">
    <div class="card-block">
    <div class="card-text" id="site-intro">
      <img src="/images/me2-300.png">
        <p>a blog about virtualization and stuff
        
        <ul class="nav-list-inline">
          <a href="//github.com/dstamen" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a>











<a href="//linkedin.com/in/davidstamen" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a>















<a href="//twitter.com/davidstamen" target="_blank" rel="noopener" title="Twitter" class="fab fa-twitter"></a>








<a href="mailto:dstamen@gmail.com" target="_blank" title="Email" class="fas fa-envelope"></a>

          

        </ul>
        
    </div>
    </div>
    </div>
    <div class="card">
    <div class="card-header">
      <b>Latest Posts</b>
    </div>
  <div class="card-block">
    <div class="card-text">
      <ul class="list" style="list-style-type:square;list-style-position:inherit">
        
        <li><a class="nav-list" href="/2019/08/12/windows-server-2008-is-going-eol-what-about-my-vcenter-server/">Windows Server 2008 is Going EOL - What about my vCenter Server?</a></li>
        
        <li><a class="nav-list" href="/2019/06/18/vmworld-2019-sessions-and-events/">VMworld 2019 - Sessions and Events</a></li>
        
        <li><a class="nav-list" href="/2019/06/07/vcenter-server-converge-tool-what-about-my-certificates/">vCenter Server Converge Tool - What About My Certificates</a></li>
        
        <li><a class="nav-list" href="/2019/04/24/vcenter-server-appliance-cli-json-creator/">vCenter Server Appliance CLI - JSON Creator</a></li>
        
        <li><a class="nav-list" href="/2019/04/11/vcenter-server-converge-tool-how-do-i-converge-an-environment-using-the-ui/">vCenter Server Converge Tool - How do I Converge an Environment Using the UI</a></li>
        
      </ul>
    </div>
  </div>
</div>
<div class="card">
  <div class="card-header">
    <b>Advertisements</b>
  </div>
<div class="card-block">
  <div class="card-text" align="center">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:inline-block;width:180px;height:150px"
     data-ad-client="ca-pub-6907288179836979"
     data-ad-slot="6070718289"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
</div>
</div>

</section>
</nav>
  
</div>
      
    </div>
  </body>
</html>

