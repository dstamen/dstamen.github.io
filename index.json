[{"categories":["Automation","VMware","Pure Storage"],"contents":"Pure1 VM Analytics is a great tool to have in your environment. You don\u0026rsquo;t need to even have a Pure Storage array, but it makes it even better! Back in 2019 the collector was converted to an OVA format and has been much simpler to deploy. You can deploy it through the UI or even Powershell. With the latest update to the Terraform vSphere provider we can now deploy OVA\u0026rsquo;s, so lets jump in to see how we can deploy the VM Analytics collector!\nPre-Requsites  Terraform Pure1 VM Analytics OVA (2.0.1)  Link to Code  Github Repository  Preparing to Execute the Runbook In order to depoloy the Pure1 VM Analytics collector, you must first create an authorization key.\nLogin to your Pure1 environment using an Administrator account and select VM Topology. Click on the Gear icon and select Create Collector.\n    Enter in a name for your collector.\n    Copy the Authorization Key to be used for the OVA deployment.\n    Execute the Runbook  The script is pretty straight forward, you will need to download the Appliance OVA to a local directory and fill in the appropriate variables on the configuration file. Terraform also supports a Remote OVF, but due to performance reasons I have find local to work better.  1git clone https://github.com/dstamen/Terraform.git #Clone the Github Repository 2cd Terraform/deploy-purecollector #Change to Runbook Directory 3vi modules/deploy-purecollector/main.tf #Update the configuration file to provide your vCenter Server and Appliance Settings and then Save the file 4terraform init #Initialize and install the provider if needed 5terraform plan #Validate the run book will work 6terraform apply #Deploy your VMs! Conclusion Options are great, want to use the UI? Check! Want to use Powershell? Check! Want to use Terraform? Check!\nWhat would you like to see next? Leave a comment below!\n","permalink":"https://davidstamen.com/2020/06/30/using-terraform-to-deploy-the-pure1-vm-analytics-collector/","tags":["Terraform","VM Analytics","Pure1"],"title":"Using Terraform to Deploy the Pure1 VM Analytics Collector"},{"categories":["Automation","VMware"],"contents":"With the addition of OVF/OVA customized properties in Terraform, I figured I would put together a few runbooks for appliances to deploy. In my first post I covered how to deploy SRM, this post will include the details on how to deploy the VMware Event Broker Appliance (VEBA).\nPre-Requsites  Terraform  Link to Code  Github Repository  Execute the Runbook  The script is pretty straight forward, you will need to download the Appliance OVA to a local directory and fill in the appropriate variables on the configuration file. Terraform also supports a Remote OVF, but due to performance reasons I have find local to work better.  1git clone https://github.com/dstamen/Terraform.git #Clone the Github Repository 2cd Terraform/deploy-veba #Change to Runbook Directory 3vi modules/deploy-veba/main.tf #Update the configuration file to provide your vCenter Server and Appliance Settings and then Save the file 4terraform init #Initialize and install the provider if needed 5terraform plan #Validate the run book will work 6terraform apply #Deploy your VMs! Conclusion Im loving all the new pieces of automation that are coming out to help simplify deployments.\nWhat would you like to see next? Leave a comment below!\n","permalink":"https://davidstamen.com/2020/06/29/using-terraform-to-deploy-the-vmware-event-broker-appliance/","tags":["Terraform","VMware Event Broker Appliance"],"title":"Using Terraform to Deploy the VMware Event Broker Appliance"},{"categories":["Automation","VMware"],"contents":"With the addition of OVF/OVA customized properties in Terraform, I figured I would put together a few runbooks for appliances to deploy. This post will cover the details deploy the Nested ESXi Appliance.\nPre-Requsites  Terraform Nested ESXi Appliance  Link to Code  Github Repository  Execute the Runbook  The script is pretty straight forward, you will need to download the Appliance OVA to a local directory and fill in the appropriate variables on the configuration file. Terraform also supports a Remote OVF, but due to performance reasons I have find local to work better.   Conclusion Im loving all the new pieces of automation that are coming out to help simplify deployments.\nWhat would you like to see next? Leave a comment below!\n","permalink":"https://davidstamen.com/2020/06/29/using-terraform-to-deploy-the-vmware-nested-esxi-appliance/","tags":["Terraform","ESXi","vSphere"],"title":"Using Terraform to Deploy the VMware Nested ESXi Appliance"},{"categories":["Automation","VMware"],"contents":"Previously I covered how to deploy the SRM appliance using PowerCLI, but as I started to tinker with Terraform I figured why not create a new blog post to document the process. Without the latest Terraform vSphere 1.20.0 Provider, this wouldnt be possible! Lets dive in and take a look on how we can do some appliance deployments.\n Using PowerCLI to Deploy the Site Recovery Manager 8.3 Appliance\n .twitter-tweet { font: 14px/1.45 -apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,Oxygen-Sans,Ubuntu,Cantarell,\"Helvetica Neue\",sans-serif; border-left: 4px solid #2b7bb9; padding-left: 1.5em; color: #555; } .twitter-tweet a { color: #2b7bb9; text-decoration: none; } blockquote.twitter-tweet a:hover, blockquote.twitter-tweet a:focus { text-decoration: underline; }  Terraform vSphere Provider 1.20.0 is out! That means time to deploy some #vSphere labs using #Terraform! #vExpert\n\u0026mdash; David Stamen (@davidstamen) June 24, 2020 Pre-Requsites  Terraform  Link to Code  Github Repository      Execute the Runbook  The script is pretty straight forward, you will need to extract the SRM 8.3 ISO to a local directory and fill in the appropriate variables on the configuration file.  1git clone https://github.com/dstamen/Terraform.git #Clone the Github Repository 2cd Terraform/deploy-srm #Change to Runbook Directory 3vi modules/deploy-srm1/main.tf #Update the configuration file to provide your vCenter Server and Appliance Settings and then Save the file 4terraform init #Initialize and install the provider if needed 5terraform plan #Validate the run book will work 6terraform apply #Deploy your VMs! Things I learned about Terraform OVF Properties I spent a little bit too much time figuring out how to map the OVF properties, every time I would run a deployment I would get the following error.\n    Usually when I am scripting an OVF deployment I will use the following PowerCLI code and navigate through each level to find the OVF Properties\n1$ovffile = \u0026#34;path.ova\u0026#34; 2Get-OVFConfiguration $ovffile      But that didnt work\u0026hellip;.\nNext I would review the UI Properties and try those keys.\n    But that didnt work\u0026hellip;.\nSo next I dove into the .OVF file and that is where I finally found the magic keys. When deploying an OVF/OVA through Terraform, you MUST use the ovf:key value defined. At some point I would hope it would be easier to find this information.\n    Conclusion Im loving all the new pieces of automation that are coming out to help simplify deployments. I have alot to learn to enhance the script such as using variables, but this was a good start and gets the job done!\nWhat would you like to see next? Leave a comment below!\n","permalink":"https://davidstamen.com/2020/06/26/using-terraform-to-deploy-the-site-recovery-manager-8.3-appliance/","tags":["Terraform","Site Recovery Manager"],"title":"Using Terraform to Deploy the Site Recovery Manager 8.3 Appliance"},{"categories":["VMware","Pure Storage"],"contents":"Something we get asked quite often it seems here at Pure Storage, is can we automatically expand a datastore when it gets full? The answer is yes! With all of the integrations with automation platformsm, Pure Storage Arrays have many options. This blog will cover how to handle this with the VMware Event Broker Appliance (VEBA)!\nEver since I first heard about VEBA it really interested me. William Lam and Michael Gasch presented on it at VMworld 2019. Many things have gotten in the way, but I finally had time to sit down and look at how to deploy and use VEBA.\nIntroduction Before I cover why we may get asked how to automatically expand a volume, I want to cover one thing I love about Pure Storage FlashArray. The array itself has no per-volume performance limits. This means that if a customer wants to deploy a single large datastore or many small datastores it is really up to them. In some cases, customers have datastores carved up for certain roles\u0026rsquo;s such as Snapshots or Replication. In this case, if a datastore gets full they just want to be able to easily expand it. Currently when customers ask if this can be done, we point them over to Cody Hostermans blog. This configuration still works, but its back from 2016 and its SNMP (yuck) sorry Cody.\nDeployment of VEBA Since VEBA is a pre-built OVA appliance, deployment is extremely simple. It is still a VMware Fling but has quite the community behind it. When you deploy the OVA to your vCenter Server you have the choice on whether you wish to use OpenFaaS or AWS Event Bridge as the event broker. For my example I am using OpenFaas.\n You can learn more about the deployment with OpenFaas or AWS EventBridge within their documentation pages.\n     Implementing the VEBA Function Luckily there is a great community for VEBA, and it was useful for me getting up and running. There are prebuilt functions and a great #vmware-event-broker-appliance channel on vmwarecode.slack.com. For this particular use case an example already existed for datastore usage that I was able to build upon.\nA few things I learned along the way\u0026hellip;\nCreate your own image in DockerHub or in Harbor First  Docker must be installed previous to implementing functions.\n To begin, head over to hub.docker.com and create a repository for your function. Once you have it created you should have a place to store your image such as username/repository, in my case it is dstamen/vebapowercli-increaseds-pure\nSince this particular image requires PowerCLI and Powershell it will use the vmware/powerclicore:latest base image.\nUsing docker pull it down to your local machine.\n1docker pull vmware/powerclicore:latest Once it has been pulled down use docker images to see the image information.\n1docker images|grep vmware/powerclicore We will now need to tag and push the image to our own repository to use as a base image. For the tag identifier use the Image ID from docker images.\n1docker tag a0fceeaed43e dstamen/test 2docker push dstamen/test Now that our image is ready, we can proceed to configuring the function for VEBA.\nConfigure the VEBA Function Next, we will need to update the function files for your environment. Grab a copy of the VEBA function from GitHub.\n    There are 3 main files we will need to look at.\n stack.yml vc-ds-config.json /handler/script.ps1  stack.yml In my experience, the stack.yml is similar to a kubernetes manifest where it specifies the details for the function to run. You will need to update this file to include the following parameters:\n Gateway: This will be the FQDN or IP of your VEBA server. Function Name: This will be the name of the function defined in OpenFaas. Image: This will be the username/repository you pushed your image to in the previous step.   vc-ds-config.json This file is the secrets file that stores your configuration such as passwords and data secrely. As I am also including a Slack notification there is a few extra fields.\n SLACK_URL: This is the webhook URL you will setup as part of a slack integration. SLACK_CHANNEL: This will be the channel you wish for the slack messages to be posted to. SUBJECT: This will be the title of the slack notifications. VC: This is the FQDN of the vCenter Server where the function is to be ran against. VC_USERNAME: This is the username of a user that has rights to expand the datastore in the vCenter Server. VC_PASSWORD: This is the password for the above user. VC_ALARM_NAME: This is the alarm name for this function, do not change unless you have created a custom alarm. DATASTORE_NAMES: This is an array of datastore names for the function to trigger against. If the datastore is not in this list, it will not be automatically expanded. PURE_USERNAME: This is a user that has access to expand the volume on the FlashArray. PURE_PASSWORD: This is the password for the above user.   /handler/script.ps1 This is the core script that is executed for the function. As this runs as a container, whatever is done must be run in Powershell Core. The script entails parsing the event when it comes in to make sure the datastore exists in the secrets file, and then based on threshold will expand the disk by that capacity. For my lab if the threshold reached warning I expanded by 10GB. If the threshold reached error I expanded by 20GB, this can be easily customized in the script for what works for your environment.\nThe script will only need to be modified to include the connection endpoints of your FlashArray. What the script will do is connect to those flasharrays and find the FlashArray the datastore volume resides on, expand it and then expand the datastore. Once complete it sends a notification to the slack channel.\n     Currently the Pure Storage PowershellSDK does not support PowershellCore. An update is coming, and when it is available I will update this post, with a much shorter script. For the time being I have added functions to the script that will allow this script to run in Powershell Core with no issues. Please see the GitHub repository for the file with the included functions.\n  Once the files are configured we can now push the function to the OpenFaas Gateway.\nDeploying the function to OpenFaas Gateway  Pre-requisite: You will need to install faas-cli\n Initially, this was one of the components I was having the most issues with, until someone mentioned a great shortcut!\nLogin to the OpenFaaS gateway on VMware Event Broker Appliance\n1VEBA_GATEWAY=https://veba.lab.local 2export OPENFAAS_URL=${VEBA_GATEWAY} 3 4faas-cli login --username admin --password-stdin --tls-no-verify Create function secret (only required once)\n1faas-cli secret create vc-slack-config --from-file=vc-slack-config.json --tls-no-verify The Hard Way 1faas-cli build -f stack.yml 2faas-cli push -f stack.yml 3faas-cli deploy -f stack.yml --tls-no-verify The Easy Way 1faas-cli up --tls-no-verify Validating the Deployment After the deploy is complete, you can see the status. faas-cli up will build the image based on the files provided, pushing the script into a docker image. It will then push the image to your dockerhub repository. It will then push the function to your OpenFaas server where it will pull down your docker image and run the function.\n    Troubleshooting the Deployment If at any time you experience issues with your function, there are two ways to see what is going on.\nOption 1 You can use faas-cli to review the logs, however this will only look at the past 30 seconds and will end when the request finishes.\n1faas-cli logs veba-powercli-increaseds-pure --tls-no-verify Option 2 The preferred option is to tail the logs on the VEBA appliance itself. Since the function runs as a k8s container, there is a couple steps to view the logs.\n1 2ssh root@veba.fqdn #ssh to veba server 3kubectl get pods -n openfaas-fn ##get k8s pods in the openfaas-fn namespace 4kubectl logs veba-powercli-increaseds-pure-59db6cd7f9-g4p4r -n openfaas-fn #review the pod logs. this will be regenerated on each deployment of your function      Conclusion One thing I love about the Pure Storage FlashArray is the suite of integrations we have with different automation providers. This was just one great example how this could be accomplished with Powershell, PowerCLI and VEBA.\nWhat would you like to see next? Leave a comment below!\n","permalink":"https://davidstamen.com/using-veba-to-expand-pure-datastore/","tags":["VEBA","VMware Event Broker Appliance","PowerCLI","vSphere","FlashArray","Powershell"],"title":"Using the VMware Event Broker Appliance to Automatically Expand a Pure Storage FlashArray Datastore"},{"categories":["VMware"],"contents":"In previous blogs, I covered how to update your VCSA using PowerCLI and with Postman. I also had multiple code sessions at VMworld 2019 where I got great feedback on the module. It\u0026rsquo;s been a while since I have looked at the module, and time has passed so I thought it was due for an update. The module will no longer need to be manually imported, it is now located in the Powershell Gallery!\nVMware {code} Power Session Covering the Module!   Introduction Using tools such as Postman can make it utilizing API\u0026rsquo;s a bit easier, but you still need to be familiar with a separate tool or UI. I was able to develop my own version and build my first Powershell Module that you can use to patch the VCSA in a simple method. Some of the function names below may not be 100% exact and this is due to the accepted verbs for Powershell. If you have further recommendations I would be happy to entertain changing the Powershell verbage.\nUse Cases Why would you want to use a Powershell module such as this? Well this tool can support multiple vCenter Servers. So here are a few ideas\u0026hellip;,\n Modify a Custom URL Repository Across all vCenter Servers in your Environment Stage Patches across all vCenter Servers in your Environment. Patch Multiple Servers Simultaneously  Exploring the Powershell Module Functions As of current, the Powershell module currently has 12 Functions.\n Copy-VCSAUpdate Get-VCSAUpdate Get-VCSAUpdateDetail Get-VCSAUpdatePolicy Set-VCSAUpdatePolicy Get-VCSAUpdateStaged Get-VCSAUpdateStatus Remove-VCSAUpdate Start-VCSAUpdateInstall Start-VCSAUpdatePrecheck Start-VCSAUpdateStageandInstall Start-VCSAUpdateValidate Stop-VCSAUpdate  Copy-VCSAUpdate Copy-VCSAUpdate is the command you will use when you want to manually stage the update.\nExample:\n     Get-VCSAUpdate Get-VCSAUpdate is the command you will use when you want to wish to check for new updates. There is an optional Parameter for Source, \u0026ldquo;Local\u0026rdquo; or \u0026ldquo;Online\u0026rdquo;, if no parameter is chosen it will default to Online.\nExamples:\n     Get-VCSAUpdateDetail Get-VCSAUpdateDetail is the command you will use when you want to wish to get more details about a specific update. There is a mandatory parameter for Version.\nExample:\n     Get-VCSAUpdatePolicy Get-VCSAUpdatePolicy is the command you will use when you want to wish to get information about the current appliance update settings.\nExample:\n     Set-VCSAUpdatePolicy Set-VCSAUpdatePolicy is the command you will use when you want to wish to set information for the current appliance update settings.\nExample:\n     Get-VCSAUpdateStaged Get-VCSAUpdateStaged is the command you will use when you want to wish to get information about the current staged update.\nExample:\n     Get-VCSAUpdateStatus Get-VCSAUpdateStaged is th e command you will use when you want to wish to get information about the current update status. This command can be used to get status of staged update, install update or any other update status.\nExample:\n     Remove-VCSAUpdate Remove-VCSAUpdate is the command you will use when you wish to remove a staged update.\nExample:\n     Start-VCSAUpdateInstall Start-VCSAUpdateInstall is the command you will use when you wish to install a currently staged update. If no update is staged you must use Start-VCSAUpdateStageandInstall\nExample:\n     Start-VCSAUpdatePrecheck Start-VCSAUpdatePrecheck is the command you will use when you wish to run the built-in update Precheck.\nExample:\n     Start-VCSAUpdateStageandInstall Start-VCSAUpdateInstall is the command you will use when you wish to install and stage an update.\nExample:\n     Start-VCSAUpdateValidate Start-VCSAUpdateValidate is the command you will use when you wish validate the current update.\nExample:\n     Stop-VCSAUpdate Stop-VCSAUpdate is the command you will use when you want to cancel an update task such as staging an update or other task that has a status of cancelable.\nExample:\n     Putting the Powershell Module to Use This Examples assumes your VCSA has Internet Access and we will update via the Online Repo. You can access the Powershell Module here on the Powershell Gallery.\n Important Note: The code samples included in this module are not supported by VMware. The code included is only provided as sample code for the purpose of demonstrating different tasks using the PowerCLI and the REST API.\n  Conclusion I hope this module can be useful for you to get started with updating your VCSA in a more Automated fashion.\nIf you have any questions feel free to reach out here or on twitter @davidstamen\n","permalink":"https://davidstamen.com/2020/06/22/updating-the-vcenter-server-appliance-vcsa-with-powercli-revisited/","tags":["PowerCLI","vSphere 6.7","REST API","vCenter Server","vSphere 7.0","Powershell","vSphere"],"title":"Updating the vCenter Server Appliance (VCSA) with PowerCLI - Revisited"},{"categories":["VMware","Pure Storage"],"contents":"The more I play with our integrations the more I am impressed. My latest project within vRealize Orchestrator had me utilizing our Pure1 integration. This post will cover how to generate the needed pieces to configure the Pure1 Integration within vRO.\nRequirements  Pure1 Meta Workflow Package for vRO Powershell OpenSSL Windows 10 / Windows 2016 (Needed due to the Powershell Cmdlet)  After importing the Pure1 Meta Package, if we head to the Configure Pure1 Credentials Workflow we see we need the Private Key and the Pure1 REST Application ID. This is a bit different than Creating the JWT for the vSphere Plugin.\nCody Hosterman covered how to generate some of these pieces for using the Pure1 Rest API via Powershell.\nCreating the Certificate First we will need to generate a self-signed certificate to use for authentication.\n1$policies = [System.Security.Cryptography.CngExportPolicies]::AllowPlaintextExport,[System.Security.Cryptography.CngExportPolicies]::AllowExport 2$CertObj = New-SelfSignedCertificate -certstorelocation cert:\\localmachine\\my -HashAlgorithm \u0026#34;SHA256\u0026#34; -KeyLength 2048 -KeyAlgorithm RSA -KeyUsage DigitalSignature -KeyExportPolicy $policies -Subject \u0026#34;vROPure1Cert\u0026#34; Next, a password will need to be specified and the certificate exported.\n1$mypwd = ConvertTo-SecureString -String \u0026#34;Password1!\u0026#34; -Force -AsPlainText 2$CertObj | Export-PfxCertificate -FilePath ~\\Downloads\\mypfx.pfx -Password $mypwd      The next step requires extracting the public key and private key from the certificate. Since I am using Windows 10 I have the Windows Subsystem for Linux (WSL) Configured and will use that for my OpenSSL tasks.\n1openssl pkcs12 -in mypfx.pfx -nocerts -nodes -out converted.key 2openssl rsa -in converted.key -pubout -out converted_public.key      Creating the Pure1 REST Application ID To create the Pure1 AppID head over to https://pure1.purestorage.com/administration/apiappkeys and click on Register Application\nEnter a Name for your ID. Enter the Public Key which can be retrieved from the converted_public.key file we previously generated and select a Role.\n    Once Upload is clicked we can see our AppID to use for the vRO Configuration.\n    Configure the Pure1 Credentials in vRO Now it is time to login to vRO and run the Configure Pure1 Credentials workflow.\nThe Private Key can be retrieved from the converted.key exported earlier. Be sure to only include the content after \u0026mdash;\u0026ndash;BEGIN PRIVATE KEY\u0026mdash;\u0026ndash; as the file will include some Attributes that can be left behind.\nthe Pure1 REST Application ID can be retrieved from our previous step in the Pure1 UI.\n    When the workflow is Completed we can then begin to utilize the Pure1 Integrations within vRealize Orchestrator.\n    Conclusion Adding in Pure1 Meta integration can open up a world of additional workflows for your VMware environment. Stay tuned for a future blog post on how we can utilize these for Intellgient Provisioning of VMs. Questions or Comments? Leave them below!\n","permalink":"https://davidstamen.com/2020/06/05/configuring-vrealize-orchestrator-to-use-pure1-integration/","tags":["vSphere","vRealize Orchestrator","Pure1"],"title":"Configuring vRealize Orchestrator to use Pure1 Integration"},{"categories":["VMware","Pure Storage"],"contents":"An interesting issue came in from one of our customers that they were unable to provision a new vVol Disk on a VM that was based on a VMFS Datastore. After some troubleshooting it seems there was a regression which no longer makes this available in the UI. Take a look at this blog post on how I will cover a workaround.\nIssue After doing some troubleshooting, if you went to provision a vVol for a Virtual Machine you would be given the following error:\n A general system error occurred: Error creating disk Error creating VVol Object. This may be due to insufficient available space on the datastore or the datastore\u0026rsquo;s inability to support the selected provisioning type\n     The customer has an open case with VMware, but there is no current resolution. This seems to only affect when the Configuration File exists on a iSCSI or FC based datastore. If I migrate the Configuration File to NFS or vVol a vVol is able to be attached through the UI.\n 6/2/2020 - I have not had the chance to test this on a vSAN Based Datastore at this time.\n There seem\u0026rsquo;s to be a UI related issue as we can accomplish this task using PowerCLI.\nResolution The resolution is simple! You can either move the Configuration File to NFS/vVol or use the below PowerCLI Snippet to Create the new disk.\n1$VM = \u0026#34;sql-vmanalytics-load\u0026#34; 2$Datastore = \u0026#34;sn1-x70-f06-27-vvol\u0026#34; 3$CapacityGB = \u0026#34;10\u0026#34; 4Get-VM $VM|New-HardDisk -Datastore $Datastore -CapacityGB $CapacityGB Conclusion Stuck trying to add a vVol to a VMFS Based VM? Use PowerCLI! I\u0026rsquo;m glad that when it comes to doing tasks with VMware we are provided with many different ways to accomplish a task.\n","permalink":"https://davidstamen.com/2020/06/02/unable-to-provision-a-vvol-hard-disk-on-a-vm-located-on-vmfs-datastore/","tags":["vCenter Server","vSphere","ESXi","vVol","VMFS"],"title":"Unable to Provision a vVol Hard Disk on a VM Located on VMFS Datastore"},{"categories":["VMware"],"contents":"With the release of the first vSphere 7.0 update we now are seeing how updates for vSphere with Kubernetes environments can be completed! Let\u0026rsquo;s dive into this post to see how I completed the upgrade of my vSphere with Kubernetes environment.\nPre-Requisties  Before we jump in, its always a great idea to review the release notes and the Updating vSphere with Kubernetes Clusters documentation.\n The order to upgrade components would be:\n Upgrade NSX-T Data Center. Upgrade vCenter Server. Upgrade ESXi hosts. Perform a Supervisor Namespaces update (including Kubernetes upgrade).  The procedure to update a Supervisor Namespace is pretty straight forward:\n Navigate to Menu -\u0026gt; Workload Management Navigate to Namespaces -\u0026gt; Updates Select the Version that you want to update to. Select one or more Supervisor Clusters to apply the update to. Click Apply Updates.  The Update Process  In order to perform an update your Configuration Status must be Running and Kubernetes Status must Ready. If they are not in these states your cluster will not be eligible to update.\n If we head over to our Cluster -\u0026gt; Monitor -\u0026gt; Namespaces Overview we can check the status of our cluster.\n    From the Available Versions you can choose which version of Kubernetes you wish to update to from the available list.\nSelect the Cluster and Click Apply Updates\n    Now we can monitor the Update Process.\n Did you ever wonder why the Supervisor Cluster IP Pool is 5 IPs? Well the extra one is to for an additional Supervisor Control Plane VM as they are updated one at a time.\n     During the Update Process you can monitor the status by viewing the Recent Tasks or by tailing the /var/log/vmware/wcp/wcpsvc.log on the vCenter Server.\n    Once the Update Process is complete, you will see the updated Version in your **Cluster Namespaces Overview.\n    Troubleshooting During my update I had to do some troubleshooting, possibly due to self-inflicted unsupportiveness. This particular environment is nested and may not have all the resources allocated that were needed. During my update process it could not validate the last node was up and running as it could not connect to port 6443. I could communicate with each node individually, but not the Supervisor Load Balancer. Looking at the logs I could see connection refused.\n    If I looked at the UI, i could also see that the VMs were angry as they had extremely high CPU Usage and were somewhat unresponsive.\n    As these VM\u0026rsquo;s are managed by vSphere with Kubernetes there is no way to Manage them through the vSphere Client to reset/poweroff. I tried to just go in and execute a reboot from the VM but that did not work either.\nTo get my cluster to finish the update I had to go to the ESXi Hosts and use ESXCLI to forcibly kill the VM\u0026rsquo;s to PowerOff and then have vSphere with Kubernetes Power them Back on.\nThose instructions are located here.\nConclusion The update process for a vSphere with Kubernetes Cluster is quite simple, hopefully this has helped understand the process. Stay tuned for a future post on how we can update a Tanzu Kubernetes Cluster. Questions or Comments? Leave them below!\n","permalink":"https://davidstamen.com/updating-vk8s-supervisor-cluster/","tags":["TKG","Kubernetes","vSphere with Kubernetes","vk8s","vSphere","TKC","Tanzu Kubernetes Cluster","Tanzu Kubernetes Grid"],"title":"Updating a vSphere with Kubernetes Supervisor Cluster"},{"categories":["Pure Storage","VMware"],"contents":"In May 2020 Pure Storage released the latest version of their plugin version 4.3.1! This post will explore what\u0026rsquo;s new in this release!\nVersion 4.3.1 is more of a bugfix release than a new feature release. Let\u0026rsquo;s look at what was fixed.\nThe Release Notes  4.3.1 Release Notes for the Pure Storage vSphere Client Plugin\n General Version 4.3.1 of the Pure Storage vSphere HTML Client Plugin supports vSphere (vCenter and ESXi) version 6.5 and later and Purity version 4.10 and later. Users can upgrade to this version of the plugin from previous release version 4.x or higher. This version is certified by VMware.\nWhatâ€™s New  For the volume group manager, you can now filter by datastore name, not just volume or volume group name.  Fixed issues  Errors in datastore provisioning wizard around loading FlashArray list, matching host groups, or creating the datastore, such as String index out of range:  This was due to introduced code for NVMe-oF based datastores that caused lookups to fail if the type was unknown. This is fixed. Any customer experiencing generic \u0026ldquo;could not lookup object errors\u0026rdquo; should upgrade to this release. Multiple pathologies relate to this issue.   The LUN ID was shown in the NVMe-oF datastore view, not the NVMe namespace ID. The namespace ID is now correctly shown.  Known issues  No RBAC support  Compatibility  The plugin is certified to run on all versions of vSphere 6.7 and vSphere 7.   You can view more detailed compatibility information on the VMware Compatibility Guide.\n Updating the Pure Storage vSphere Client Plugin If you are ready to upgrade, check out how to update the Pure Storage vSphere Plugin.\nWrap Up Is there something you would like to see in a future release? Leave a comment below!\n","permalink":"https://davidstamen.com/2020/05/26/whats-new-in-the-4.3.1-pure-storage-vsphere-client-plugin/","tags":["vSphere Plugin","vCenter Server"],"title":"What's New in the 4.3.1 Pure Storage vSphere Client Plugin"},{"categories":["VMware"],"contents":"Tanzu Kubernetes Grid (TKG) is a great tool to deploy VMware Kubernetes on different Platforms. In previous blogs I covered how you could deploy a TKG to VMware Cloud on AWS as well as to a regular vSphere Environment. Today we will demonstrate how to use the TKG CLI to provision a Tanzu Kubernetes Cluster (TKC) to a vSphere With Kubernetes Environment.\nIn the previous blogs, we covered TKG on VMC and on vSphere. When you deploy a TKC to a vSphere with Kubernetes Supervisor Cluster there is no need to deploy a TKG Management Cluster as the Supervisor Cluster has the same functionality.\nAdding the Supervisor Cluster as a Management Cluster using the TKG CLI Before we begin, we can validate if the Supervisor Cluster is currently added as a TKG Management Cluster by running:\n1tkg get management-cluster      In our case our output is blank, so we can proceed to add the Supervisor Cluster into the TKG CLI. Using kubectl login to your Supervisor Cluster\n1kubectl vsphere login --vsphere-username Administrator@vsphere.local --server=control_Plane_VIP --insecure-skip-tls-verify=true Switch Context to your Supervisor Cluster\n1kubectl config use-context \u0026lt;Supervisor_Cluster_context\u0026gt; Add your Management Cluster\n1tkg add management-cluster Verify your Management-Cluster has been added.\n1tkg get management-cluster      Deploying a TKC using the TKG CLI Before you can deploy a TKC using the TKG CLI you need to either set environment variables by specifying export = at the command line, or set them by updating the ~/.tkg/config file.\nHere is an example of variables for my environment.\n1export CONTROL_PLANE_STORAGE_CLASS=vsan-default-storage-policy 2export WORKER_STORAGE_CLASS=vsan-default-storage-policy 3export DEFAULT_STORAGE_CLASS=vsan-default-storage-policy 4export STORAGE_CLASSES=vsan-default-storage-policy 5export SERVICE_DOMAIN=fsa.lab 6export CONTROL_PLANE_VM_CLASS=best-effort-xsmall 7export WORKER_VM_CLASS=best-effort-xsmall 8export SERVICE_CIDR=100.64.0.0/13 9export CLUSTER_CIDR=100.96.0.0/11 Once your variables are set you can obtain a list of Kubernetes Versions that are available in the Supervisor Cluster\n1kubectl get virtualmachineimages Identify which Namespace you want to deploy your TKC to:\n1kubectl get namespaces Run tkg create cluster to provision your TKC cluster:\n1tkg create cluster tkg-tkc-01 --plan=dev --namespace tkc01 --kubernetes-version=v1.16.8+vmware.1-tkg.3.60d2ffd      Conclusion Using the TKG CLI to provision Tanzu Kubernetes Clusters is a great way to handle the deployment, if you wish to not use the TKG CLI you can still provision a TKC using kubectl and yaml\nQuestions or Comments? Leave them below!\n","permalink":"https://davidstamen.com/deploying-tkc-on-vk8s-using-tkgcli/","tags":["TKG","Kubernetes","vSphere with Kubernetes","vk8s","vSphere","TKC","Tanzu Kubernetes Cluster","Tanzu Kubernetes Grid"],"title":"Deploying Tanzu Kubernetes Clusters (TKC) on vSphere with Kubernetes using the TKG CLI"},{"categories":["VMware","Pure Storage"],"contents":"Another post of a cool project this week. With the tools we have available during our hackathon it was asked if we could run vVols in VMware Cloud on AWS. Because of the locked down nature of VMC we could not run vVols directly on that cluster, but I did find a way that we could. Dive into this blog post to see how vVols run on CBS.\nIf you are not familiar with Pure Storage Cloud Block Store it is a hosted Pure Storage array in AWS that can function as storage for EC2 instances or even be a replication target for your on-premises FlashArrays.\nDeploying a Nested Lab on VMware Cloud on AWS. William Lam has a great post on Nested ESXi on VMware Cloud on AWS (VMC) which I followed. The steps include the following:  Create a Content Library in VMC subscribed to the Nested ESXi Repo Provision out your Nested ESXi Servers from the templates. Extract your vCenter Server ISO, and deploy the OVA to VMC. Access your VC on port 5480 and finalize the deployment.  Once this was done, I configured my vCenter Server by creating a Cluster, Adding in my Hosts and Enabling the Software iSCSI Adapter.\nDeploying a Pure Storage Cloud Block Store on AWS The Pure Storage Cloud Block Store can be deployed as part of an Application Stack from AWS. The deployment is pretty straight forward and the below video walks you through everything you need to know.   Configuring my Nested Lab to Access the Pure Storage Cloud Block Store on AWS The first thing you will need to do is make sure the your AWS VPC has been added to your VMC environment. In our case we had to make sure to add in a route in AWS to communicate back to our VMC environment.\nNext we will install the Pure Storage vSphere Client Plugin and add our Cloud Block Store Array. Then Click on the Array and Register Storage Provider\n    Now let\u0026rsquo;s login to our Cloud Block Store and head over to Settings -\u0026gt; Network and find out our iSCSI IPs. If you are familiar with the FlashArray or FlashBlade UI the CLoud Block Store UI will be very familiar.\n    Next we will configure iSCSI on our ESXi Hosts. Navigate to the iSCSI Software Adapter -\u0026gt; Dynamic Discovery Targets and add in the iSCSI IPs from the Cloud Block Store. Repeat for each ESXi Host.\n    Make a note of the iSCSI IQN that is set in the iSCSI Software Adapter and Navigate back to the Cloud Block Store UI. Navigate to Storage -\u0026gt; Hosts and Create the Host. Repeat for each additional ESXi Host.\n    Next create a Host Group by navigating to Storage -\u0026gt; Hosts and adding in your ESXi Hosts to the group.\n    Next we will create the Protocol Endpoint so our Lab Environment can communicate with vVols on the Cloud Block Store. Navigate to Storage -\u0026gt; Volumes and select the three dots to Show Protocol Endpoints\n    Click on the 3 dots again to Create Protocol Endpoint and name it pure-protocol-endpoint.\n    Next attach the Pure Protocol Endpoint to your Host Group\n    Now it is time to create our vVol Datastore. Right Click your Cluster select Storage -\u0026gt; New Datastore -\u0026gt; vVol. You should see the vVol Container and see that it is backed by our CBS Array connected to ct0. Click Next and attach it to all hosts in the cluster.\n    Your vVol Datastore is now provisioned. You are now able to provision workloads and storage policies running on CBS inside of a Nested ESXi Cluster running on VMware Cloud on AWS.\nTo sum things up Andrew Miller made a great comment on this.\n.twitter-tweet { font: 14px/1.45 -apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,Oxygen-Sans,Ubuntu,Cantarell,\"Helvetica Neue\",sans-serif; border-left: 4px solid #2b7bb9; padding-left: 1.5em; color: #555; } .twitter-tweet a { color: #2b7bb9; text-decoration: none; } blockquote.twitter-tweet a:hover, blockquote.twitter-tweet a:focus { text-decoration: underline; }  Why?\nBecause I can!\n\u0026mdash; Andrew Miller (@andriven) May 13, 2020 Even though this is unsupported, it shows how flexible infrastructure can be. We have essentially virtualized both compute and storage in this lab environment.\nConclusion I feel this was a pretty cool example of the flexibility you have with both the Pure Storage Cloud Block Store and VMware Cloud on AWS. What else will this hackathon bring? You never know!\nQuestions or Comments? Leave them below!\n","permalink":"https://davidstamen.com/running-vvol-on-vmc-on-cbs/","tags":["vVol","VMware Cloud on AWS","VMC","Cloud Block Store","CBS"],"title":"Running vVols in VMware Cloud on AWS (VMC) on Pure Storage Cloud Block Store (CBS) on AWS"},{"categories":["VMware"],"contents":"In a previous post I covered how you can deploy TKG on vSphere, for the second part of our internal hackathon we had a requirement to install TKG on VMware Cloud on AWS (VMC). This post will go over how I was able to get TKG deployed on VMC.\nGetting Started In this blog I will cover using the new VMware Fling Demo Appliance for Tanzu Kubernetes Grid if you wish to configure the TKG CLI locally you can review my previous blog.\nThe Demo Appliance for TKG contains everything you need to deploy TKG On-Premises or in the cloud, with or without internet access. It includes all images pre-downloaded as well as the Tanzu CLI\u0026rsquo;s, Harbor, Octant, kubectl and docker.\n    This appliance actually came in handy, as when I was originally trying to deploy TKG on VMC I was having issues pulling down the images.\n.twitter-tweet { font: 14px/1.45 -apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,Oxygen-Sans,Ubuntu,Cantarell,\"Helvetica Neue\",sans-serif; border-left: 4px solid #2b7bb9; padding-left: 1.5em; color: #555; } .twitter-tweet a { color: #2b7bb9; text-decoration: none; } blockquote.twitter-tweet a:hover, blockquote.twitter-tweet a:focus { text-decoration: underline; }  Anyone get #TKG deployed on #VMC? Having issues with the tkg cluster deploying..errors pulling images. /cc @lamw @chipzoller Thoughts?\n\u0026mdash; David Stamen (@davidstamen) May 12, 2020 A few responses later and a chat with William I had the TKG Demo Appliance deployed and deploying TKG and Tanzu Kubernetes Clusters on VMC with ease.\nI will not go over the full details on how to deploy the TKG Demo Appliance, but a great set of instructions are located here.\nConfiguring VMC for TKG  A much more detailed set of instructions can be found as part of the TKG Workshop Guide\n As we start to setup our environment first we will need to create a new network segment in VMC. We will need to first login to the Cloud Console and then navigate to Networking \u0026amp; Security and then to Segments. Click on Add Segment and enter a name, type, gateway/prefix and a DHCP range.\n    Next we we need to configure our firewalls to allow access, by default everything on VMC is set to Deny. Navigate to Networking \u0026amp; Security and then to Groups under Inventory.\nUnder Compute Groups we will create three groups.\n Lab Network (This group will contain the IPs that you wish to connect to the TKG Network. In my cause its home, so i will use my IP from whatismyip.com) SDDC Management (This group will contain the IPs for the SDDC Management Network, by default this is 10.2.0.0/16) TKG Network (this is the segment we created above, 192.168.2.0/24)      Under Management Groups we will create two groups.\n Lab Network (This group will contain the IPs that you wish to connect to the TKG Network. In my cause its home, so i will use my IP from whatismyip.com) TKG Network (this is the segment we created above, 192.168.2.0/24)      Once our groups are created we can configure the VMC Firewall. Navigate to Networking \u0026amp; Security and then to Gateway Firewall under Security.\nUnder Compute Gateway create the following rules.\n Lab Network to TKG Network TKG Network to SDDC Management      Under Management Gateway create the following rules.\n Lab Network to vCenter Server TKG Network to vCenter Server       Don\u0026rsquo;t forget to Publish your changes to active your new firewall rules!\n Next we will need to Request a Public IP and Create a NAT Rule to access our TKG Appliance. Navigate to Networking \u0026amp; Security and then to Public IPs under System. Click on Request New IP and enter in a description for your IP.\n    Navigate to Networking \u0026amp; Security and then to NAT under Network. Click on Add NAT Rule and enter in a name, select your public ip, assign a service and available ports.\n    Once all the networking is configured we can proceed to configure the vCenter Server. We need to import the two templates, this can either by done manually as shown in my previous blog, or you can deploy them from the TKG Demo Content Library\nDeploying TKG on VMC Begin by starting an SSH session to the external IP of your TKG Demo Appliance\n    Create an SSH Keypair. Instructions are located here. Once created you\u0026rsquo;ll need to copy your SSH Public Key from ~/.ssh/id_rsa.pub\n    A sample config.yaml file is located at ~/config.yaml. This will be used to provision our TKG Management Cluster this will need to be filled out for your particular environment. Update the fields to be specific for your environment including the server, password, network, resource pool and folder.\n1VSPHERE_SERVER:\u0026#39;10.2.224.4\u0026#39;2VSPHERE_USERNAME:\u0026#39;cloudadmin@vmc.local\u0026#39;3VSPHERE_PASSWORD:\u0026#39;FILL-ME-IN\u0026#39;4VSPHERE_DATACENTER:\u0026#39;/SDDC-Datacenter\u0026#39;5VSPHERE_DATASTORE:\u0026#39;WorkloadDatastore\u0026#39;6VSPHERE_NETWORK:\u0026#39;david-tkg\u0026#39;7VSPHERE_RESOURCE_POOL:\u0026#39;/SDDC-Datacenter/host/Cluster-1/Resources/Compute-ResourcePool\u0026#39;8VSPHERE_FOLDER:\u0026#39;/SDDC-Datacenter/vm/david\u0026#39;9VSPHERE_TEMPLATE:\u0026#39;photon-3-kube-v1.17.3_vmware.2\u0026#39;10VSPHERE_HAPROXY_TEMPLATE:\u0026#39;photon-3-capv-haproxy-v0.6.3_vmware.1\u0026#39;11VSPHERE_DISK_GIB:3012VSPHERE_NUM_CPUS:213VSPHERE_MEM_MIB:204814VSPHERE_SSH_AUTHORIZED_KEY:\u0026#34;ssh_key\u0026#34;15SERVICE_CIDR:\u0026#34;100.64.0.0/13\u0026#34;16CLUSTER_CIDR:\u0026#34;100.96.0.0/11\u0026#34;17KUBERNETES_VERSION:v1.17.3+vmware.218overridesFolder:/root/.tkg/overrides19providers:20- name:cluster-api21url:/root/.tkg/providers/cluster-api/v0.3.3/core-components.yaml22type:CoreProvider23- name:aws24url:/root/.tkg/providers/infrastructure-aws/v0.5.2/infrastructure-components.yaml25type:InfrastructureProvider26- name:vsphere27url:/root/.tkg/providers/infrastructure-vsphere/v0.6.3/infrastructure-components.yaml28type:InfrastructureProvider29- name:tkg-service-vsphere30url:/root/.tkg/providers/infrastructure-tkg-service-vsphere/v1.0.0/unused.yaml31type:InfrastructureProvider32- name:kubeadm33url:/root/.tkg/providers/bootstrap-kubeadm/v0.3.3/bootstrap-components.yaml34type:BootstrapProvider35- name:kubeadm36url:/root/.tkg/providers/control-plane-kubeadm/v0.3.3/control-plane-components.yaml37type:ControlPlaneProvider38images:39cert-manager:40repository:registry.rainpole.io/library/cert-manager41tag:v0.11.0_vmware.1Save your config file to ~/.tkg/config.yaml\nKick off your Management Cluster deployment by executing tkg init \u0026ndash;infrastructure=vsphere. In about ~5-10 minutes your management cluster should now be provisioned.\n    Now that the TKG Management Cluster is Created. We can use TKG to provision a Tanzu Kubernetes Cluster (TKC). Execute tkg create cluster tkc01 \u0026ndash;plan=dev. After another ~5-10 minutes your TKC cluster should now be provisioned.\n    If we want to access our application externally I recommend using MetalLB as its one of the easier pieces I have found to setup.\nTo install run:\n1kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/namespace.yaml 2kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml 3# On first install only 4kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=\u0026#34;$(openssl rand -base64 128)\u0026#34; You will then need to execute a YAML to specify an IP Pool to use.\n1apiVersion:v12kind:ConfigMap3metadata:4namespace:metallb-system5name:config6data:7config:| 8address-pools:9- name:default10protocol:layer211addresses:12- 192.168.2.10- 192.168.2.20Deploy your application, I like to use hipster shop as a demo.\n1kubectl apply -f https://raw.githubusercontent.com/dstamen/Kubernetes/master/demo-applications/demo-hipstershop.yaml Once deployed find out its External-IP and Port using kubectl get svc.\n    Next, request a new Public IP from VMC and Create a NAT Rule to access our service.\n    If we access our public ip we can see our application running!\n    Conclusion TKG is a very flexible component to get k8s deployed on either your cloud or on-premises VMware environments. Using the TKG Demo Appliance you can be up and running with a TKC Cluster very quickly! This is a great use case for any sort of test/dev/poc.\nQuestions or Comments? Leave them below!\n","permalink":"https://davidstamen.com/deploying-tkg-on-vmc/","tags":["TKG","Kubernetes","vSphere with Kubernetes","vk8s","VMware Cloud on AWS","TKC","Tanzu Kubernetes Cluster","Tanzu Kubernetes Grid"],"title":"Deploying Tanzu Kubernetes Grid (TKG) on VMware Cloud on AWS (VMC)"},{"categories":["VMware"],"contents":"Tanzu Kubernetes Grid (TKG) is part of VMware\u0026rsquo;s new Tanzu Portfolio of products. I have done quite a bit with vSphere with Kubernetes and Tanzu Kubernetes Clusters on vSphere with Kubernetes, but something came up and I began to explore native TKG. This blog will cover how to deploy TKG on vSphere and get your management and tkc clusters provisioned.\nAt first I figured I would have some of the same requirements as vSphere with Kubernetes, but as I started going down the path of deploying TKG i kept thinking to myself\u0026hellip; Can it really be this easy? Not only is it easy, it is Free.\nTo begin I first reviewed the TKG Website and TKG Documentation\nBefore we can provison a TKG cluster we must first install Docker and TKG CLI. Instructions to install docker can be found here.\nInstalling the TKG CLI  Go to https://www.vmware.com/go/get-tkg and log in with your My VMware credentials. Head to the Download Section TKG CLI is not currently available for Windows. Download either the Mac OS or Linux CLI Use either the gunzip command or the extraction tool of your choice to unpack the binarie. Run either one of the following commands:  Linux\n1gunzip tkg-linux-amd64-v1.0.0_vmware.1.gz Mac OS\n1gunzip tkg-darwin-amd64-v1.0.0_vmware.1.gz Navigate to the executable for the Tanzu Kubernetes Grid CLI that you downloaded in the previous section. Rename the CLI binary for your platform to tkg, make sure that it is executable, and add it to your PATH.  Linux\n1mv ./tkg-linux-amd64-v1.0.0_vmware.1 /usr/local/bin/tkg Mac OS\n1mv ./tkg-darwin-amd64-v1.0.0_vmware.1 /usr/local/bin/tkg Make the file executable.  1chmod +x /usr/local/bin/tkg Run tkg version to check that the correct version of the binary is properly installed.      Deploying the TKG Management Cluster TKG can be deployed either through the UI or CLI. This walk-through will cover the UI deployment of TKG.\nBefore we can deploy TKG we must first download and import the Base OS Image and the API Server Load Balancer OVA\u0026rsquo;s into vSphere.\n    Once our templates are imported we can proceed to launch the TKG UI. Run the following command:\n1tkg init --ui  If Docker is not installed or running you will receive the following error. Make sure it is running and run the command again.\n     When the above command is run it will launch the UI, if not you can navigate to http://127.0.0.1:8080\nClick on Deploy on vSphere\n    Enter the vCenter Server, Username and Password and Click Connect.\n    If deploying to vSphere 7.0 you will be notified that it has not been optimized for Kubernetes but this just means you aren\u0026rsquo;t using vSphere with Kubernetes so click Proceed\n    Select your Datacenter and enter in your SSH Public Key\n     If you do not know your public key you can get it by running cat ~/.ssh/id_rsa.pub If you need to generate an SSH keypair, the instructions are here\n     Select whether you wish to deploy for Development or Production and select a Size. Development is one Control Plane and one Worker and Production is three Control Planes and three Workers.\n    Name your Management Cluster and Select the Load Balancer Template\n    Specify the Resource Pool, VM Folder and Datastore for your VMs.\n    Select a Network for your VMs. You can leave the Service and Pod CIDR\u0026rsquo;s as default if you wish.\n    Select the Image Template you wish to use for your Kubernetes Cluster\n    Click on Review Configuration to Proceed.\n    Make sure everything entered looks correct and click on Deploy Management Cluster\n    Your cluster will now be deployed, when it is complete you will be presented with this screen!\n    Back to our CLI we can see the details of our management cluster by running:\n1tkg get management-cluster      Deploying the Tanzu Kubernetes Cluster Once our management cluster is deployed its quite easy to deploy our Tanzu Kubernetes Clusters!\nThere are a few advanced options but i will focus on two of the simple commands\nTo deploy a development cluster (1 control plane and 1 worker)\n1tkg create cluster tkc01 --plan=dev To deploy a production cluster (3 control plane and 3 worker)\n1tkg create cluster tkc --plan=prod To monitor the deployment status, you can run the following:\n1tkg get cluster      When it is complete we can see all the nodes that have been deployed!\n    Deploying a Workload to the Tanzu Kubernetes Cluster Find the Kubernetes Context you wish to deploy to:\n1kubectl config get-contexts      Switch to the context of your TKC.\n1kubectl config use-context tkc01-admin@tkc01 If we want to access our application through an external-ip. I recommend using MetalLB as its one of the easier pieces I have found to setup.\nTo install run:\n1kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/namespace.yaml 2kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml 3# On first install only 4kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=\u0026#34;$(openssl rand -base64 128)\u0026#34; You will then need to execute a YAML to specify an IP Pool to use.\n1apiVersion:v12kind:ConfigMap3metadata:4namespace:metallb-system5name:config6data:7config:| 8address-pools:9- name:default10protocol:layer211addresses:12- 10.21.234.45-10.21.234.55Deploy your application and find out its External-IP using kubectl get svc\n    Your application should now be running\u0026hellip;\n    Conclusion Knowing how difficult it is to install vanilla k8s and how much planning and difficulty goes into deploying vSphere with Kubernetes I was not expecting the deployment of TKG to be this easy! I hope this walk-through helped get your TKG environment up and running!\nQuestions or Comments? Leave them below!\n","permalink":"https://davidstamen.com/deploying-tkg-on-vsphere/","tags":["TKG","Kubernetes","vSphere with Kubernetes","vk8s","vSphere","TKC","Tanzu Kubernetes Cluster","Tanzu Kubernetes Grid"],"title":"Deploying Tanzu Kubernetes Grid (TKG) on vSphere"},{"categories":["Pure Storage","VMware"],"contents":"Released on April 15, 2020 the long awaited Pure Storage vRealize Operations Management Pack 3.0 is here!\nThis release is an update to bring support to vRealize Operations 8.x line of code. There are no \u0026ldquo;new\u0026rdquo; features outside of the updated compatibility. A future release of the Management Pack will bring support for some of the new features such as vVols.\n    The Release Notes  3.0.0 Release Notes for the Pure Storage FlashArray Management Pack for VMware vRealize Operations Manager (vROps)\n What\u0026rsquo;s New  Support for vROps 8.0 and 8.1  Fixes  Addresses an issue where average bandwidth for read and write operations on Pure Storage objects are incorrect (CSG-203)  While reviewing performance metrics for Pure Storage FlashArrays and volumes, the read and write bandwidth is reporting the values in TB/s rather than MB/s. A change to the underlying formula has corrected this issue.    Known Limitations / Issues  Alert definitions resolve to invalid URLs NVMe-oF backed datastores appear in vROps but not in all Pure Storage Management Pack dashboards. vVol datastores / Protocol Endpoints (PEs) do not show up in the Pure Storage dashboards or statistics. (Not supported until vROps 8.1)  Compatibility  This release is only supported for vRealize Operations 8.0 and 8.1. If using vRealize Operations 7.x you must use a previous Management Pack for vRops.   VMware Compatibility Guide Listing for Pure Storage Management Pack for VMware vRealize Operations\n Wrap Up Ever since I started at Pure Storage this has been one of the most requested updates, now that it is available I am looking forward to more updates to our vRealize Suite 8.x Integrations! Is there something you would like to see in a future release? Leave a comment below!\n","permalink":"https://davidstamen.com/2020/04/24/whats-new-in-the-pure-storage-vrealize-operations-management-pack-3.0/","tags":["vRealize Operations"],"title":"What's New in the Pure Storage vRealize Operations Management Pack 3.0"},{"categories":["Pure Storage","VMware"],"contents":"On April 2, 2020 Pure Storage released the latest version of their plugin version 4.3.0! This post will explore the latest features in this release!\nThe Release Notes  4.3.0 Release Notes for the Pure Storage vSphere Client Plugin\n Whatâ€™s New  Support vSphere 7.0 Support for NVMe-oF datastore identification Full ActiveCluster/Pod Datastore Provisioning Support for non-uniform ActiveCluster host clusters Volume Group management IOPS/Throughput limit assignment on datastores and/or volume groups  Fixed issues  Changed passwords could appear in debug logs of vSphere. Leading or trailing white space automatically removed when pasting a JWT into the Pure1 authentication Invalid Pure1 key will show true error message from Pure1 Improved vVol datastore mounting workflow Datastore size allowed non-numeric numbers Fixed bad error messages with vVol datastore mounting  Known issues  No RBAC support When creating a datastore through the vSphere Client Plugin you may encounter an error Error loading array list  A fix is currently being tested to be certified as part of 4.3.1    Compatibility  The plugin is certified to run on all versions of vSphere 6.7 and vSphere 7.   You can view more detailed compatibility information on the VMware Compatibility Guide.\n Feature Spotlight With the release of new features its always great to see them in action! Let\u0026rsquo;s dive in to the new features of the 4.3.0 Plugin!\nvSphere 7.0 Support With the release of vSphere 7 on April 2nd, the Pure Storage Plugin was certified and ready to be used on day 1!\n    Support for NVMe-oF datastore identification When a datastore is connected via NVMe-oF the plugin can now provide the following limited details.\nView Volume Details\n    Manage FlashArray Snapshots\n     Support for more NVMe-oF workflows will be available in a future release of the vSphere Client Plugin.\n Full ActiveCluster/Pod Datastore Provisioning When creating a datastore it can be assigned to an existing Pod on the FlashArray.\n    Support for non-uniform ActiveCluster host clusters When creating an ActiveCluster Datastore, if the connections are non-uniform you will now be presented with the following warning warning.\n    Volume Group management When navigating to Menu -\u0026gt; Pure Storage you can Create and Edit a Volume Group.\n             Also, the Volume Group can now be modified on creation.\n    Also, it can be modified on an existing datastore by navigating to Right Click Datastore -\u0026gt; Pure Storage -\u0026gt; Edit Datastore and choose the Volume Group dropdown.\n    IOPS/Throughput limit assignment on datastores and/or volume groups The IOPS and Bandwidth Limit of a volume can be modified on creation.\n    It can also be modified on an existing datastore by navigating to Right Click Datastore -\u0026gt; Pure Storage -\u0026gt; Edit Datastore.\n    Updating the Pure Storage vSphere Client Plugin If you are ready to upgrade, check out how to update the Pure Storage vSphere Plugin.\nWrap Up This post has been an overview of all the latest features, which one is your favorite? Is there something you would like to see in a future release? Leave a comment below!\n","permalink":"https://davidstamen.com/2020/04/21/whats-new-in-the-4.3.0-pure-storage-vsphere-client-plugin/","tags":["vSphere Plugin","vCenter Server"],"title":"What's New in the 4.3.0 Pure Storage vSphere Client Plugin"},{"categories":["Automation","VMware"],"contents":"My latest project was to rebuild one of my labs to run vSphere 7 and Site Recovery Manager 8.3. In my current role I am constantly am deploying new lab environments for certain demos. If i can avoid using a manual process for it I will, in this case I am showing how you can deploy the SRM OVF using PowerCLI.\nPre-Requsites  VMware PowerCLI  Link to Script  deploy-srm83.ps1  Preparing to Execute the Script The script is pretty straight forward, you will need to extract the SRM 8.3 ISO and fill in the appropriate variables on the script.\n Execute the Script Run the following command.\n1.\\deploy-srm83.ps1 Hope this helps you out, leave any feedback or questions below.\n","permalink":"https://davidstamen.com/2020/04/16/using-powercli-to-deploy-the-site-recovery-manager-8.3-appliance/","tags":["PowerCLI","Site Recovery Manager"],"title":"Using PowerCLI to Deploy the Site Recovery Manager 8.3 Appliance"},{"categories":["Kubernetes","VMware"],"contents":"vSphere 7 with Kubernetes is finally here and I couldn\u0026rsquo;t be more excited for it to be available. This blog series will cover the requirements, prequisites and deployment steps in order to deploy a vSphere with Kubernetes (vk8s) environment using vSphere 7 and NSX-T 3.0.\nNow that we have the environment deployed, what can we do with it? This blog will cover deploying and using Tanzu Kubernetes Clusters (TKC). You can follow along in the official documentation\nProvisioning Tanzu Kubernetes Clusters In our previous blog we covered the setup of the TKC Content Library, lets validate our namespace can see the images.\nAuthenticate to your vk8s cluster.\n1kubectl vsphere login --server 10.21.234.65 --vsphere-username administrator@vsphere.local --insecure-skip-tls-verify      Once logged in you will be shown the contexts aka namespaces you have access to. Lets switch to our namespace.\n1kubectl config use-context vk8s-ns-01 Execute the following to see what images are available.\n1kubectl get virtualmachineimages      Execute the following to see what size TKC nodes we can deploy.\n1kubectl get virtualmachineimages      From the above information we gathered we can now construct a YAML file to deploy our Tanzu Kubernetes Cluster. An example is available on GitHub.\nThe only items you should need to modify are the Name and Namespace for your TKC.\n1apiVersion:run.tanzu.vmware.com/v1alpha1#tkg api endpoint2kind:TanzuKubernetesCluster#required parameter3metadata:4name:vk8s-tkc-01#cluster name, user defined5namespace:vk8s-ns-01#supervisor namespace6spec:7distribution:8version:v1.16#resolved kubernetes version9topology:10controlPlane:11count:1#number of master nodes12class:guaranteed-small#vmclass for master nodes13storageClass:vk8s-storage#storageclass for master nodes14workers:15count:3#number of worker nodes16class:guaranteed-small#vmclass for worker nodes17storageClass:vk8s-storage#storageclass for worker nodesYou can also deploy multiple TKC\u0026rsquo;s in a single YAML if you want, an example is available on GitHub.\nNowe we are ready to deploy your TKC!\n1kubectl apply -f create-tkc-cluster.yaml      To monitor the status of your TKC Deployment I recommend following the events.\n1kubectl get events -w      To Authenticate with our TKC execute the following command.\n1kubectl vsphere login --server 10.21.234.65 --vsphere-username administrator@vsphere.local --insecure-skip-tls-verify --tanzu-kubernetes-cluster-name tkc-01 --tanzu-kubernetes-cluster-namespace vk8s-ns-01 To validate its ready you can run\n1kubectl get nodes      Managing Tanzu Kubernetes Clusters To Authenticate with our TKC execute the following command.\n1kubectl vsphere login --server 10.21.234.65 --vsphere-username administrator@vsphere.local --insecure-skip-tls-verify --tanzu-kubernetes-cluster-name tkc-01 --tanzu-kubernetes-cluster-namespace vk8s-ns-01      Change Context to your TKC.\n1kubectl config use-context tkc-01      Deploy your Workload! My favorite non-native pod demo application is the Hipster Shop!\n1kubectl apply -f demo-hipstershop.yaml      Wait for all pods to be in a Running Status and then find out the External-IP and see if you can reach your application.\n    If your pods fail to run, you may need to modify the cluster RBAC and Pod Security Policies using this YAML.\n1kubectl apply -f allow-runasnonroot-clusterrole.yaml If everything was successful we can see our running application!\n    Wrap Up Running TKC\u0026rsquo;s allow you to provision Kubernetes Clusters that can run any workload as they are k8s compliant! I hope you have been enjoying this series so far. What would you like to see next?\n","permalink":"https://davidstamen.com/2020/04/13/part-6-deploying-vsphere-with-kubernetes-provisioning-and-managing-a-tanzu-kubernetes-cluster/","tags":["vk8s","NSX","Project Pacific","vSphere with Kubernetes"],"title":"Part 6: Deploying vSphere with Kubernetes - Provisioning and Managing a Tanzu Kubernetes Cluster"},{"categories":["Kubernetes","VMware"],"contents":"vSphere 7 with Kubernetes is finally here and I couldn\u0026rsquo;t be more excited for it to be available. This blog series will cover the requirements, prequisites and deployment steps in order to deploy a vSphere with Kubernetes (vk8s) environment using vSphere 7 and NSX-T 3.0.\nUsing vSphere with Kubernetes Now that we have the environment deployed, what can we do with it? This blog will cover Setting up the Kubernetes CLI, Configuring the TKC Content Library, Creating a Namespace and Deploying Native Pods.\nSetting up the Kubernetes CLI Tools Kubernetes is CLI driven, in order to use vSphere with Kubernetes you must install kubectl and also the vsphere plugin. This can be downloaded from your Supervisor Control Plane VM. The IP address of your Supervisor VM can be found on the Namespaces Overview or the Clusters tab of Workload Management. Navigate to https://{ipofyourvm}\n    From here you can download the CLI plugin for windows, macos or linux. Once it is downloaded extract the file and copy to your OS\u0026rsquo;s executable search path.\nType kubectl vsphere login -h and make sure the kubectl plugin works.\n    Configuring a Content Library for Tanzu Kubernetes Clusters When using TKC\u0026rsquo;s you can use different versions of Kubernetes. VMware does a great job of hosting these in a Content Library you can easily integrate with your environment!\nTo configure the Content Library navigate to Menu -\u0026gt; Content Libaries in the vSphere Client and Click on Create. Specify a name and choose with vCenter Server it will be created on.\n    Create a Subscribed Content Library using https://wp-content.vmware.com/v2/latest/lib.json as the subscription URL.\n    Select a Datastore for the content library images to be stored.\n    Review your settings and click Finish. Wait for the Content Library Items to be syncronized.\n    Creating and Configuring a Namespace A namespace is a unit of management in Kubernetes, in vSphere it is mapped to a resource pool and allows you to provision workloads and assign cpu, memory and storage.\nTo create a Namespace navigate to Menu -\u0026gt; Workload Management -\u0026gt; Namespaces and Click **Create Namespace\n    Select your Cluster and Specify a Name\n    Now we can see the Namespace Overview\n    Click Add Permission to assign permissions to the namespace. This can be any VC authenticated user.\n    Click Add Storage and select your VM Storage Policy. This is where pods will be deployed.\n    Click Add Library to associate the TKC Content Library to your Namespace.\n    Your Namespace is now ready to have workloads deployed!\n    Deploying a Workload Now that everything is ready, we can now deploy our first workload. I have created a GitHub Repo with some sample applications that can be deployed as Native Pods as well as some that require a TKC.\nMy first demo I use on every environment I deploy is hello-kubernetes I will walk you through a quick deployment of it.\nTo begin, authenticate to your vk8s cluster.\n1kubectl vsphere login --server 10.21.234.65 --vsphere-username administrator@vsphere.local --insecure-skip-tls-verify      Once logged in you will be shown the contexts aka namespaces you have access to. Lets switch to our namespace.\n1kubectl config use-context vk8s-ns-01      Execute your YAML file with your application\n1kubectl apply -f demo-hellokubernetes.yaml      View the svc information to find out the endpoint of the application deployed.\n1kubectl get svc      Access your application and validate it is running!\n    Wrap Up Wow that was easy! Kubernetes makes deploying workloads very seamless and deploying them on top of vSphere with Kubernetes is even better! Stay tuned for the next post where we cover Provisioning and Managing a Tanzu Kubernetes Cluster.\n","permalink":"https://davidstamen.com/2020/04/10/part-5-deploying-vsphere-with-kubernetes-using-vsphere-with-kubernetes/","tags":["vk8s","NSX","Project Pacific","vSphere with Kubernetes"],"title":"Part 5: Deploying vSphere with Kubernetes - Using vSphere with Kubernetes"},{"categories":["Kubernetes","VMware"],"contents":"vSphere 7 with Kubernetes is finally here and I couldn\u0026rsquo;t be more excited for it to be available. This blog series will cover the requirements, prequisites and deployment steps in order to deploy a vSphere with Kubernetes (vk8s) environment using vSphere 7 and NSX-T 3.0.\nIn Part 4 we now deploy vSphere with Kubernetes! All the preparation you have done is now for this moment, infrastructure is deployed and networking is configured! The next section will cover enabling your environment\u0026rsquo;s first supervisor cluster.\nLets Begin!\nNavigate to Menu -\u0026gt; Workload Management. If we licensed our components and connected NSX correctly we should be ready to click Enable\n    Validate your cluster is Compatible. If it shows up under incompatible, it can be for a variety of reasons. For more details you can view /var/log/vmware/wcp/nsxd.log and /var/log/vmware/wcp/wcpsvc.log and they will provide the details on why.\n    Specify your Control Plane Size\n    Specify your Network Settings, double and triple check your entries as if you need to change anything you currently must disable Workload Management and redeploy.\n    Specify your Storage, this will be the vm storage policy we created earlier.\n    Review your settings and click Finish.\n    Workload Management will now be configured. This can take awhile depending on your environment. Expect at least 30 minutes. During this time the Kubernetes Status may show all sorts of errors. These can be ignored, focus on the state of Configuration Status\n    When the Configuration Status is Running and Everything is green. We can now proceed to use our vk8s environment.\n    Wrap Up Enabling Workload Management is quite easy! VMware has made it extremely simple to enable a Supervisor Cluster. Stay tuned for the next post where we learn how to use and deploy workloads to our newly provisioned environment.\n","permalink":"https://davidstamen.com/2020/04/10/part-4-deploying-vsphere-with-kubernetes-enabling-vsphere-with-kubernetes/","tags":["vk8s","NSX","Project Pacific","vSphere with Kubernetes"],"title":"Part 4: Deploying vSphere with Kubernetes - Enabling vSphere with Kubernetes"},{"categories":["Kubernetes","VMware"],"contents":"vSphere 7 with Kubernetes is finally here and I couldn\u0026rsquo;t be more excited for it to be available. This blog series will cover the requirements, prequisites and deployment steps in order to deploy a vSphere with Kubernetes (vk8s) environment using vSphere 7 and NSX-T 3.0.\nPart 3 covers the deployment and configuration of NSX-T. Now that we have configured our vCenter Server lets proceed. You can follow along in the official documentation\nDeploy NSX Manager NSX Manager is deployed as an appliance and you can utilize the vSphere Client or ovftool to deploy.\n1\u0026amp; \u0026#39;C:\\Program Files\\VMware\\VMware OVF Tool\\ovftool.exe\u0026#39; --name=ds4nsx1.fsa.lab --X:injectOvfEnv --X:logFile=ovftool.log --allowExtraConfig --datastore=\u0026#34;M50-VC01-DS01\u0026#34; --network=\u0026#34;management\u0026#34; --acceptAllEulas --noSSLVerify --diskMode=thin --powerOn --prop:nsx_role=\u0026#34;NSX Manager\u0026#34; --prop:nsx_ip_0=10.21.230.86 --prop:nsx_netmask_0=255.255.255.0 --prop:nsx_gateway_0=10.21.230.1 --prop:nsx_dns1_0=10.21.230.6 --prop:nsx_domain_0=\u0026#34;fsa.lab\u0026#34; --prop:nsx_ntp_0=\u0026#34;us.pool.ntp.org\u0026#34; --prop:nsx_isSSHEnabled=True --prop:nsx_allowSSHRootLogin=True --prop:nsx_passwd_0=VMware1!VMware1! --prop:nsx_cli_passwd_0=VMware1!VMware1! --prop:nsx_hostname=nsxmanager.vmware.demo C:\\share\\VMware\\NSX\\nsx-unified-appliance-3.0.0.0.0.15946739.ova \u0026#39;vi://dstamen:thisisnotmypassword!@vc01.fsa.lab/Datacenter/host/Cluster01/Resources\u0026#39; Configuring NSX Once NSX Manager is deployed we can proceed to configure the environment for vk8s. Assign an NSX-T license by navigating within NSX Manager to System \u0026gt; Licenses \u0026gt; Add\n    Add a Compute Manager by navigating within NSX Manager to System \u0026gt; Fabric \u0026gt; Compute Managers \u0026gt; Add. Do not Proceed until Registration Status is Registered\n    Create two Transport Zones by navigating to System \u0026gt; Transport Zones \u0026gt; Add. The first will be an Overlay Transport Zone\n    The second will be an VLAN Transport Zone\n    Create two Uplink Profiles by navigating to System \u0026gt; Fabric \u0026gt; Profiles \u0026gt; Uplink Profiles \u0026gt; Add.\nHost Uplink\n Specify a Name Under Teamings, set your Active Uplinks Specify your first TEP VLAN (this must be routable to the second TEP VLAN)  Edge Uplink\n Specify a Name Under Teamings, set your Active Uplinks Specify your second TEP VLAN (this must be routable to the first TEP VLAN)      Create two IP Pools by navigating to Networking \u0026gt; IP Address Pools \u0026gt; IP Address Pools \u0026gt; Add IP Address Pools.\nHow to create an IP Pool\n Specify a Name Under Subnets -\u0026gt; Set -\u0026gt; Add Subnet -\u0026gt; IP Ranges Specify an IP Range Specify the CIDR for the range Specify the Gateway for the range Click Add and then Save.      Create a Transport Node Profile by navigating to System \u0026gt; Fabric \u0026gt; Profiles \u0026gt; Transport Node Profiles \u0026gt; Add\nTNP Settings\n Specify a Name Set type to VDS Set mode to Standard Select your VC under Name and Select your VDS Select your Overlay Transport Zone Select your Host Uplink Profile Select your Host IP Pool Select your VDS Uplink      Assign your Transport Node Profile to your Cluster by navigating to System \u0026gt; Fabric \u0026gt; Nodes \u0026gt; Host Transport Nodes \u0026gt; Managed By. Select your vCenter Server, then select your Cluster and Click Configure NSX. Select your Transport Node Profile and click Apply.\nThis process will take some time as it prepares the hosts for NSX\n    Verify the Transport Node Profile was successfully applied.\n    Now should be your first test of network connectivity between the host TEP interfaces. SSH to an an ESXi host and use vmkping to make sure your VLAN and MTU settings are correct.\n1vmkping -I vmk10 192.168.142.11 -S vxlan -s 1572 Deploy your NSX Edge(s) by navigating to System \u0026gt; Fabric \u0026gt; Nodes \u0026gt; Edge Transport Nodes \u0026gt; Add Edge VM. In my deployment I am using one, but for production you should be using at least 2.\nFollow the below screenshots for the NSX Edge settings. You must use at least a Large form factor.\n                     Wait until the Edge shows a Configuration Status of Success.\n    Now should be your second test of network connectivity between the host TEP and edge TEP interfaces. SSH to an an ESXi host and use vmkping to make sure your VLAN and MTU settings are correct.\n1vmkping -I vmk10 192.168.234.10 -S vxlan -s 1572  If you are unable to ping between TEP interfaces do NOT proceed and troubleshoot connectivity now\n Create an Edge Cluster by navigating to System \u0026gt; Fabric \u0026gt; Nodes \u0026gt; Edge Clusters \u0026gt; Add\n    Create a Segment for the Tier0 Gateway by navigating to Networking \u0026gt; Segments \u0026gt; Add Segment\n Specify a Name Select your VLAN Transport Zone Specify your Edge Uplink VLAN (VLAN where the ingress/egress CIDR\u0026rsquo;s will be)      Create the Tier0 Gateway by navigating to Networking \u0026gt; Tier-0 Gateways \u0026gt; Add Gateway\n Specify a Name Set HA Mode to Active Standby Select your Edge Cluster Click Save and then Yes to continue configuring.      Under Interfaces configure an interface for each Edge.\n Specify a Name Set type to External Input IP in CIDR Format Select your Segment Select your Edge Node Click Save and Close      Under Routing configure a static route.\n Click Add Static Route Specify a Name (default) Specify a Network (0.0.0.0/0) Set Next Hop. This should be the gateway of your uplink interface created above.       Now should be your third test of network connectivity to make sure you can reach your edge uplinks. Validate you can ping the IP of the Interface you created above. If you cannot do NOT proceed and troubleshoot.\n If your connectivity is working, we can now proceed!\nWrap Up This post covered the Deployment and Configuration of NSX-T. Stay tuned for the next post in the series where we will cover enabling vSphere with Kubernetes.\n","permalink":"https://davidstamen.com/2020/04/10/part-3-deploying-vsphere-with-kubernetes-deploy-and-configure-nsx-t/","tags":["vk8s","NSX","Project Pacific","vSphere with Kubernetes"],"title":"Part 3: Deploying vSphere with Kubernetes - Deploy and Configure NSX-T"},{"categories":["Kubernetes","VMware"],"contents":"vSphere 7 with Kubernetes is finally here and I couldn\u0026rsquo;t be more excited for it to be available. This blog series will cover the requirements, prequisites and deployment steps in order to deploy a vSphere with Kubernetes (vk8s) environment using vSphere 7 and NSX-T 3.0.\nWelcome back to Part 2. In Part 1 we covered the prequisites, in this blog we will cover configuring the vCenter Server components prior to enabling Workload Management.\nvSphere Networking vk8s requires the use of a VDS, here are the minimum requirements. You can follow along in the official documentation\n Create a Virtual Distributed Switch that is version 7.0.0 and has an MTU of a minimum of 1600. Create a Distributed Port Group for Management (Specify VLAN Settings if Needed) Create a Distributed Port Group for Edge Uplinks (VLAN Type Must be Set to VLAN Trunking) Add hosts to VDS and migrate VMKernel adapters if needed.      vSphere Storage vk8s requires the use of a a vm storage policy, this section covers how to create one. You can follow along in the official documentation\n Navigate to a datastore you wish to use for vk8s and select Assign under Tags      Click on Add Tag then assign the tag a Name and Create New Category if needed. Click Create.      Select the tag and Click Assign.      Navigate to Menu -\u0026gt; Policies and Profiles -\u0026gt; VM Storage Policies. Click on Create VM Storage Policy. Assign it a Name and then under datastore specific rules select enable tag based placement rules. On the following screen select your tag category and tag previously created. On the next screen make sure your storage that has the tag assigned shows up and finalize the wizard.      Wrap Up This post covered the vCenter Server configuration before enabling workload management. Stay tuned for the next post in the series where we will cover deploying and configuring NSX-T for vk8s.\n","permalink":"https://davidstamen.com/2020/04/10/part-2-deploying-vsphere-with-kubernetes-configuring-vcenter-server/","tags":["vk8s","NSX","Project Pacific","vSphere with Kubernetes"],"title":"Part 2: Deploying vSphere with Kubernetes - Configuring vCenter Server"},{"categories":["Kubernetes","VMware"],"contents":"vSphere 7 with Kubernetes is finally here and I couldn\u0026rsquo;t be more excited for it to be available. This blog series will cover the requirements, prequisites and deployment steps in order to deploy a vSphere with Kubernetes (vk8s) environment using vSphere 7 and NSX-T 3.0.\nHow to Get vSphere with Kubernetes The initial question, is how can I get licenses for vk8s? VMware has posted a blog that covers this, but the TLDR is you need VCF 4.0. You can learn more at Licensing for vSphere with Kubernetes \nAn alternative method in which I will use as VCF 4.0 has not been released is you can utilize the evaluation licenses built into vSphere and use those for the Workload Management aspects. All you will need is an NSX-T 3.0 license, and if you don\u0026rsquo;t have one available the good news its coming to VMUG Advantage!\n.twitter-tweet { font: 14px/1.45 -apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,Oxygen-Sans,Ubuntu,Cantarell,\"Helvetica Neue\",sans-serif; border-left: 4px solid #2b7bb9; padding-left: 1.5em; color: #555; } .twitter-tweet a { color: #2b7bb9; text-decoration: none; } blockquote.twitter-tweet a:hover, blockquote.twitter-tweet a:focus { text-decoration: underline; }  VMUG Advantage provides access to @VMware\u0026#39;s EVALExperience â€“ an avenue to explore cutting-edge #VMware solutions.\nYou heard it here: #vSphere7, #vSan7 \u0026amp; #NSX-T (COMING SOON!) are now included in #EVALExperience! Follow @VMUGAdv \u0026amp; upgrade your career now: https://t.co/tfGFyvLUyk pic.twitter.com/tnvJ6egVps\n\u0026mdash; VMware User Group (@MyVMUG) April 9, 2020 If you do not currently have a VMUG Advantage subscription, William Lam has worked on a group buy with VMUG so take a look!\nðŸ˜€ Iâ€™m super excited to be partnering up with @MyVMUG to bring to the @VMware Community Special @VMUGAdv #Homelab Group Buy! This will be great way to get access to latest #vSphere7, vSAN 7, NSX-T 3.0 \u0026amp; upcoming VCF 4.0 which includes vSphere w/Kuberentes! Please RT \u0026amp; share! https://t.co/isqwGdqWCu\n\u0026mdash; William Lam (@lamw) April 10, 2020 Prerequisites When planning to deploy your vk8s environment, it is important that you understand the prerequisites. These are not only from a software and hardware level, but networking is the most important thing to pay attention to.\nVMware covers the minimum requirements and it goes into great detail. Hint: You need lots of CPU and memory!\nCompute In my deployment, I am using nested but the same allocations would apply to a physical deployment. I have my vk8s VC and ESXi hosts deployed to a management VC and my edges will be deployed to my vk8s VC.\n    I have 8 vCPU\u0026rsquo;s and 96GB assigned to my hosts. As i am not using VSAN I can get away with 2 hosts, however if using VSAN you must use a minimum of 4 hosts.\nStorage Throughout the beta and with my testing 1-2 TB is a good baseline depending on what you deploy, in this example ive provisioned a 500GB volume for my vk8s environment.\nNetworking Throughout the beta and even internally back at VMware the biggest reason an environment didnt function properly was not understanding the networking prerequisites. You WILL need a minimum of 3 separate routable VLANs. This will be for the management, ESXi TEP and Edge TEP interfaces. You will also need PLENTY of IPs.\n From your management network you will need an IP for VC, ESXi Hosts, NSX Manager, NSX Edge and 5 consequitive IPs for the Kubernetes Control Plane VMs. You will need a range or CIDR for each of your TEP VLANS. In my example i use a range from .10 - .50 for each. You will need from your overlay network (at least a /24) an IP for an uplink on each edge, and a minimum of 2 /27 block carved up from it. This will be used for the ingress and egress CIDR\u0026rsquo;s. These MUST be in the same network as your edge uplinks  vCenter Server As of now you cannot use vSphere with Kubernetes alongside some new features in vSphere 7 such as vSphere Lifecycle Manager. If you plan to use vk8s make sure you are still using baselines and not the new image management.\nWrap Up This post is an introduction of what you need in order to deploy vSphere with Kubernetes. Stay tuned for the next post in the series where we will talk about Configuring your vCenter Server for vk8s.\n","permalink":"https://davidstamen.com/2020/04/10/part-1-deploying-vsphere-with-kubernetes-prerequisites/","tags":["vk8s","NSX","Project Pacific","vSphere with Kubernetes"],"title":"Part 1: Deploying vSphere with Kubernetes - Prerequisites"},{"categories":["Awards","VMware"],"contents":"VMware and their vExpert Program has announced the vExpert Sub-Program announcements and I am glad to see I have been accepted into the vExpert Cloud Management group!\nThe vExpert program itself rewards individuals who are advocates for VMware solutions either through many different platforms. Within the past few years they have spread this out into subprograms showing a specific focus for vExperts. Since joining Pure Storage, I have been heavily involved with advocating automation with the vRealize Suite. Im looking forward to being part of this program and continuing spreading the Cloud Management love!\nMore information can be found on the vExpert Portal\n   ","permalink":"https://davidstamen.com/2020/04/07/vexpert-cloud-management-2020-award/","tags":["Cloud Management","vRealize Operations","vRealize Automation","vRealize Orchestrator","vRealize Log Insight"],"title":"vExpert Cloud Management 2020 Award"},{"categories":["Pure Storage"],"contents":"Maintaining Certificates in your environments is an important thing to do to make connections between your client and server are encrypted. With this blog we will go over how to replace your Pure Storage FlashArray Certificate for the vStorage APIs for Storage Awareness (VASA) using a Microsoft Certificate Authority.\nPreviously, we covered how to replace the FlashArray Management Certificate now we will show how to replace the VASA one. With the VASA certificate there are a few reasons we may want to replace it with a signed certificate one being encryption, but the other is it will allow you to register a storage provider with multiple vCenter Servers for vVols. Checking Certificate Status The VASA Certificate can only be replaced via the CLI. If we run *purecert list we can see the current status of our array certificates.\n1pureuser@david-fa1\u0026gt; purecert list 2Name Status Key Size Issued To Issued By Valid From Valid To Country State/Province Locality Organization Organizational Unit Email Common Name 3management imported 2048 david-fa1.newstack.local newstack-DC01-CA 2020-03-30 13:38:49 PDT 2022-03-30 13:38:49 PDT US CA MTV Pure Storage, Inc. Pure Storage, Inc. dstamen@purestorage.com david-fa1.newstack.local 4vasa-ct0 imported 2048 10.21.230.44 CA 2020-03-08 08:11:26 PDT 2021-03-09 07:11:26 PST US - - Pure Storage Pure Storage - 10.21.230.44 We can see that our management certificate has already been replaced by our CA, we will proceed to replace our vasa-ct0 certificate.\n In this blog this is a non-production FlashArray with a single controller. In a production environment this will be repeated for vasa-ct0 and vasa-ct1\n Construct Certificate Signing Request Unlike the management certificate, the vasa certificate is only an IP based name, there is no need to add in any FQDN for the array.\nLet\u0026rsquo;s create a CSR for vasa-ct0 using the following command.\n1purecert construct --certificate-signing-request --common-name 10.21.230.44 --country US --state CA --locality \u0026#39;MTV\u0026#39; --organization \u0026#39;Pure Storage, Inc.\u0026#39; --organizational-unit \u0026#39;Pure Storage, Inc.\u0026#39; --email \u0026#39;dstamen@purestorage.com\u0026#39; vasa-ct0      Request a Certificate Using the CSR from Microsoft Certificate Authority With our CSR in hand we can navigate to our Certificate Authority to request a certificate. You can access the certificate request UI usually by navigating to https://FQDN/certsrv\n    We will click on Request a certificate and then advanced certificate request. As mentioned earlier, the SAN will not contain Common Name but with the Certificate Request we can easily add in the Additional Attributes to include it:\n1san:ipaddress=10.21.230.44\u0026amp;dns=10.21.230.44      Click on Submit and download the certificate as Base 64 encoded\n    Replacing the Management Certificate Once you have your certificate you can navigate back to the CLI and run purecert setattr \u0026ndash;certificate vasa-ct0 to replace the certificate.\n \u0026ldquo;^D\u0026rdquo; is equivalent to \u0026ldquo;Ctrl+D\u0026rdquo;\n     Now if we rerun purecert list we can see our vasa-ct0 certificate is now updated.\n1pureuser@david-fa1\u0026gt; purecert list 2Name Status Key Size Issued To Issued By Valid From Valid To Country State/Province Locality Organization Organizational Unit Email Common Name 3management imported 2048 david-fa1.newstack.local newstack-DC01-CA 2020-03-30 13:38:49 PDT 2022-03-30 13:38:49 PDT US CA MTV Pure Storage, Inc. Pure Storage, Inc. dstamen@purestorage.com david-fa1.newstack.local 4vasa-ct0 imported 2048 10.21.230.44 newstack-DC01-CA 2020-03-31 06:16:12 PDT 2022-03-31 06:16:12 PDT US CA MTV Pure Storage, Inc. Pure Storage, Inc. dstamen@purestorage.com 10.21.230.44 Conclusion Replacing certificates is always a great idea! If you have not replaced your management certificate now is a great time.\n","permalink":"https://davidstamen.com/2020/04/01/replacing-the-pure-storage-flasharray-vasa-certificate/","tags":["Certificates","FlashArray"],"title":"Replacing the Pure Storage FlashArray VASA Certificate"},{"categories":["Pure Storage"],"contents":"Maintaining Certificates in your environments is an important thing to do to make connections between your client and server are encrypted. With this blog we will go over how to replace your Pure Storage FlashArray Management Certificate using a Microsoft Certificate Authority.\nNot only is it a good thing to replace your certificates for security reasons, but your administrators who interact with the storage array will thank you for not having them to be presented with this screen every time they try to access the UI.\n    Construct Certificate Signing Request When it comes to creating a Certificate Signing Request (CSR) we can do this either through the UI or the CLI.\n         When you create a CSR you will be prompted for the following items whether the UI or CLI method is used.\n    When you click Create the CSR will be created and you can either Copy or Download the CSR.\n     There is currently a known issue where the Common Name is not added to the Subject Alternate Name (SAN) in the Certificate Request causing browser errors to still appear, we will cover a workaround in the next section\n Request a Certificate Using the CSR from Microsoft Certificate Authority With our CSR in hand we can navigate to our Certificate Authority to request a certificate. You can access the certificate request UI usually by navigating to https://FQDN/certsrv\n    We will click on Request a certificate and then advanced certificate request. As mentioned earlier, the SAN will not contain Common Name but with the Certificate Request we can easily add in the Additional Attributes to include it:\n1san:dns=david-fa1.newstack.local  In order to have the SAN added to the certificate you must run the following commands on your certificate Authority.\n 1certutil -setreg policy\\EditFlags +EDITF_ATTRIBUTESUBJECTALTNAME2 2net stop certsvc 3net start certsvc      Click on Submit and download the certificate as Base 64 encoded\n    Replacing the Management Certificate Once you have your certificate you can navigate back to the UI or CLI and import the certificate.\n     If using the CLI \u0026ldquo;^D\u0026rdquo; is equivalent to \u0026ldquo;Ctrl+D\u0026rdquo;\n     Conclusion Replacing certificates is always a great idea! The FlashArray Management certificate is not the only certificate that needs replacing on the FlashArray. Stay tuned for more information on how to replace the vStorage APIs for Storage Awareness (VASA) certificate!\n","permalink":"https://davidstamen.com/2020/03/31/replacing-the-pure-storage-flasharray-management-certificate/","tags":["Certificates","FlashArray"],"title":"Replacing the Pure Storage FlashArray Management Certificate"},{"categories":["Awards","VMware"],"contents":"VMware has been working on a new program that recognizes the hard work of speakers who maintain a high feedback score over the span of previous two VMworld Conferences. I am proud to announce I have received the VMworld Distinguished Speaker Award for 2019.\nI am looking forward to hopefully presenting once again at VMworld 2020 and hopefully achieving this award once again.\n   ","permalink":"https://davidstamen.com/2020/03/30/vmworld-2019-distinguished-speaker-award/","tags":["VMworld"],"title":"VMworld 2019 Distinguished Speaker Award"},{"categories":["Awards","VMware Code"],"contents":"VMware has been working on building an influencer program for the VMware{code} community for sometime. I am proud to announce I am one of the inaugural coaches for 2020!\nWhen I was first asked if i wanted to be part of this program I was excited to be part of this new group, little did I know that I would be alongside some of the great contributors out there. Take a look at the announcement on the VMware{code} Blog\nIf you are looking to contribute to VMware{code} I recommend checking out their Github page for PowerCLI examples, its a great place to start!\nI am looking forward to increased contributions and mentoring this year as part of being a VMware{code} Coach.\n   ","permalink":"https://davidstamen.com/2020/03/26/glad-to-be-part-of-the-inaugural-vmwarecode-coach-program/","tags":["Code Coach","PowerCLI","API","VMware Code"],"title":"Glad to be part of the Inaugural VMware{code} Coach Program"},{"categories":["Pure Storage","VMware"],"contents":"Beginning with version 4.2.0 the Pure Storage vSphere Client Plugin had a whole slew of new features added, one of those features was the ability to integrate authentication with Pure1 allowing fleet registration of all your Pure Storage Arrays among other things. This does require a slight change on how you would normally register your arrays in the plugin, so lets take a look at how we can accomplish this!\nWhatâ€™s New in 4.2.0 4.2.0 Release Notes\n Pure1 Authentication Busy Meter Display Intelligent VMFS Provisioning Pure1-driven FlashArray Fleet Registration Pure1 Array Tag Display vVol VM Undelete (Does not Require Pure1 Integration) Wizard-based Datastore Creation tool (Does not Require Pure1 Integration)  If we look closely 4 out of the 6 new features will require Pure1 Integration.\n    Creating the JSON Web Token (JWT) Luckily Cody Hosterman has made this super easy with the Pure Storage Pure1 PowerShell Module. Lets take a look at how we can create our JWT.\nIf it is not installed already we need to install the PowerShell Module.\n1Install-Module -Name PureStorage.Pure1 Once it is installed we can use the following cmdlet to create a Pure1 Certificate\n1$pure1cert = New-PureOneCertificate      Once the certificate is generated, we need to get the Public Key from the certificate.\n1Get-PureOnePublicKey -certificate $pure1cert      Now that we have the Public Key we can get the information needed to register for the API.\nNavigate to Pure1 and logon with an account with Administrator permissions to your Organization. From here click on API Registration.\n    Click on Register Application and Name your Application and enter the Public Key generated earlier. You will also need to update the Role from read-only to admin and click Upload.\n    From here you need to copy the Application ID that is listed as pure1:apikey:stringoflettersandnumbers. We will need this for the next step.\n    By default the expiration of a JWT with the Pure1 module is 30 days. Using PowerCLI you can update the expiration to be whatever you choose. In this example i will set it to expire in 2 years.\n1New-PureOneJwt -certificate $pure1cert -pureAppID pure1:apikey:pEbUxqz5ZxDwvTSX -expiration((Get-Date).AddYears(2)) Now that we have our JWT lets configure the vSphere Plugin.\n    Configure the vSphere Plugin Within the vSphere Client select the Pure Storage plugin. Click on Authenticate with Pure1 and paste your JWT.\n    Click on Authenticate and if you completed all the steps your array will now be Connected with Pure1.\n    We can now Import our arrays that are registered with Pure1. Click on Add and Import Arrays from Pure1. Enter the credentials and select the arrays you wish to add.\n         Now our arrays are added and any Pure1 tags will be shown.\n    Video Demonstration   Conclusion There are many things we can take advantage of now that the array is registered with Pure1. Not only can we bring in performance and capacity metrics but there are other enhancements. In a future post we will dive into these features.\nAs always if there is something you would like to see added to our plugins, reach out or leave a comment below!\n","permalink":"https://davidstamen.com/2020/03/25/configuring-and-using-the-pure-storage-vsphere-plugin-with-pure1-authentication/","tags":["Pure1","vSphere Plugin","vCenter Server"],"title":"Configuring and Using the Pure Storage vSphere Plugin with Pure1 Authentication"},{"categories":["Pure Storage","VMware"],"contents":"Moving forward with Automation, we will now expand our horizons past vRealize Orchestrator (vRO) into vRealize Automation (vRA)! Our integration with vRA utilizes the vRO Plugin and allows users to self-provision their infrastructure using all the goodness included with vRA such as blueprints, approval workflows and reservations. Lets Dive in and take a look!\nConfiguring the vRealize Automation build-in vRealize Orchestrator Server Luckily when vRealize Automation is deployed, vRealize Orchestrator is included. How do you access it? Navigate to your default vRA URL and click on vRealize Orchestrator Client.\n    In order to setup the XaaS blueprints in vRealize Automation we must first import the Pure Storage Plugin, we can find out how to do that in my previous blog post located here.\nConfiguring vRealize Automation to deploy XaaS Blueprints Once your plugin has been imported to vRealize Orchestrator we can begin to setup vRealize Automation. To proceed lets navigate to the vRealize Automation Console.\nTo begin, if you have not already we must first create a Service.\n    You must also create a Business Group to create entitlements and allow users to request catalog items.\n    Deploying the vRealize Automation XaaS Blueprints We are now ready to begin deploying the Pure Storage XaaS Blueprints. Lets navigate to the Design tab to proceed.\n    Just as we did in our earlier blog post, before we can add a FlashArray Connection we must first Import the Certificate, so lets create that workflow first. Click on New, Navigate to Library, Pure Storage, Flash Array Connection Management and then Import FlashArray certification from URL\n    On this screen we can edit the Name and Description, but the defaults work so we can Click Next, Next, Next and then Finish.\n    Now we need to Publish the Blueprint so it is available to be pushed to the Catalog\n    If we navigate to our Catalog we won\u0026rsquo;t see it yet, this is because we need to associated it with the Service we created earlier. Navigate to Administration, Catalog Management, Catalog Items and select the Item and click Configure.\n    From here we can assign an Icon and associate it with the Service, luckily we have some Pure Storage icons available here.\n    But wait, we still can\u0026rsquo;t see the blueprint in our catalog! Well the last step is to create an Entitlement. Navigate to Administration, Catalog Management, Entitlements and Click New. Enter in the Name, Update the Status and select Users.\n    Assign the Service we created earlier and add in your Catalog Item.\n    if we browse to the Catalog tab our Blueprint is now there to Request.\n    To show the vRA workflows, repeat all these steps using the Add FlashArray Connection and Create VMFS Datastore on new FlashArray Volume XaaS blueprints.\n    Using the vRealize Automation XaaS Blueprints Catalog Items To begin lets run the Import FlashArray certificate from URL. Entering our FlashArray FQDN/IP and choosing to Accept the Certificate and hit Submit.\n    Monitor the Deployment until it is Successful.\n    Lets go back to the Catalog and request the Add FlashArray Connection\n    Monitor the Deployment until it is Successful.\n    Now lets request the Create VMFS Datastore on new FlashArray Volume item.\n    Monitor the Deployment until it is Successful.\n    Utilizing vRealize Automation your request can go through levels of approval without folks needing rights to the array. Quotas can be also set to allow users to self-service provision themselves resources.\n    There are many more XaaS Blueprints available! Have you tried them all?\nConclusion This is only the beginning of your Automation journey, take a look at all there is to offer with the vRA and vRO integrations. Is there something you would like to see in a future release? Leave a comment below!\n","permalink":"https://davidstamen.com/2020/03/20/using-vrealize-automation-with-the-pure-storage-vrealize-orchestrator-plugin/","tags":["vRealize Automation","vRealize Orchestrator"],"title":"Using vRealize Automation with the Pure Storage vRealize Orchestrator Plugin"},{"categories":["Pure Storage","VMware"],"contents":"Adding to the series of VMware and Pure Storage blogs is Automation! When it comes to automating your VMware Environment with Pure Storage we have a vRO Plugin for you! Dive in and take a look at how you can get your environment automated.\nDownloading the Pure Storage vRealize Orchestrator Plugin The Pure Storage Flash Array management pack is license free and can be downloaded from the VMware Marketplace. To download the plugin all you need to do is login or click on Login to Try and then once logged in you can click on the Try button to download the plugin.\n    Installing the Pure Storage vRealize Orchestrator Plugin At the time of writing the latest version of the Pure Storage Plugin for vRealize Orchestrator is 3.0.0 and is compatible up to vRealize Orchestrator 7.6. Support for vRealize Orchestrator 8.x will be available in a future release. You can find the Using the Pure Storage FlashArray Plugin for vRealize Orchestrator  on the Pure Storage Support site.\nAfter the Plugin is downloaded we need to login to the vRealize Orchestrator Control Center. From here we will click on Manage Plug-Ins.\n    Click Browse and Select the .VMOAPP and then Click Upload.\n    Accept the EULA, then Click Install.\n    Once the Plugin is installed. vRealize Orchestrator will restart 2 minutes after the last change. Restart your browser after that time frame to see the installed Plugin.\n    Using the Pure Storage vRealize Orchestrator Plugin Now that the Plugin is installed, we can logout of the Control Center and login to the Orchestrator Client. If we navigate to the Workflows section under Library we can filter for the Pure Storage workflows using the Pure_Storage tag.\n    Before we can use vRO to Register our FlashArray, if not using signed certificates we must first Import FlashArray certificate from URL. Thanks Jase for helping me when I was stuck on the first step!\n    We will click on Run to start the workflow entering in the IP or FQDN of our FlashArray and clicking the checkbox to accept a certificate with warnings. Once completed we can see the details in the Workflow Run\n    Next up we will run the Add FlashArray Connection workflow to add our FlashArray to vRealize Orchestrator. If the Autopopulate the REST versions is blank, you need to return to the previous step and Import the Certificate. I recommend using the 1.17 API version as later versions may have issues.\n    Once the FlashArray has been added what else can you do? Well the Pure Storage Plugin has 102 Workflows that can be used. The workflows included can be used to manage anything from the FlashArrays, Managing Volumes, Managing Hosts, Managing Replications, Managing Snapshots and more!\nFor a quick example of a workflow, lets provision a new datastore from the FlashArray to our ESXi Cluster. The workflow to do this is called Create VMFS Datastore on new FlashArray Volume.\n    We will click on Run and enter in the Configuration Parameters to Create your VMFS Datastore.         Once we click Run the workflow will go out and do all it needs to do such as create volume on the FlashArray, add it to the Host Group, Rescan the Hosts and then Provision the Datastore. Once it has completed successfully we can log into the vSphere Client and see the new provisioned Datastore.\n         Conclusion As you can see we have quite a few workflows to integrate Pure Storage FlashArray with VMware Orchestrator. Is there something you would like to see in a future release? Leave a comment below!\n   ","permalink":"https://davidstamen.com/2020/03/16/using-the-pure-storage-vrealize-orchestrator-plugin/","tags":["vRealize Orchestrator"],"title":"Using the Pure Storage vRealize Orchestrator Plugin"},{"categories":["VMware"],"contents":"All good things must come to an end, today marks the End of General Support for vSphere 6.0 and its compatible products.\nThis includes the following releases:\n vCenter Server 6.0 vCenter Update Manager 6.0 ESXi 6.0 Site Recovery Manager 6.0 and 6.1 vSAN 6.0, 6.1 and 6.2 vSphere Data Protection 6.0 and 6.1 vSphere Replication 6.0 and 6.1   Learn more about VMwareâ€™s Lifecycle Support dates at vmware.com/go/lifecycle.\n     For more information check out vSphere 6.0 Reaches End Of General Support (EOGS) in March 2020 \n","permalink":"https://davidstamen.com/2020/03/12/vsphere-6.0-reaches-end-of-general-support/","tags":["vCenter Server 6.0","ESXi 6.0","End of Support"],"title":"vSphere 6.0 Reaches End Of General Support"},{"categories":["Pure Storage","VMware"],"contents":"When it comes to monitoring your Pure Storage environment, Pure1 is an amazing tool. However, some customers have an investment in the VMware vRealize Suite and wish to look at some of the Pure Storage Array information within their vRealize Operations environment.\nDownloading the vRealize Operations Pure Storage Flash Array Management Pack The Pure Storage Flash Array Management Pack is license free and can be downloaded from the VMware Marketplace. To download the management pack all you need to do is click on Login to Try and then once logged in you can click on the Try button to download the management pack.\n    Installing the vRealize Operations Pure Storage Flash Array Management Pack At the time of writing the latest version of the Pure Storage Management Pack for vRealize Operations is 2.0.11 and is compatible up to vRealize Operations 7.5. Support for vRealize Operations 8.0 will be available in a future release. You can find the Management Pack Release Notes on the Pure Storage Support site.\nTo install the plugin we will browse to our vRealize Operations UI and click on the Administration tab. Once there we will click on Repository\n    We will now scroll down to Other Management Packs and Click on Add Management Pack. From here we will browse to the .PAK file downloaded previously and click on Upload.\n    At this point the .PAK file will be uploaded and be ready to install. Click on Next to proceed.\n    Read and Accept the EULA and then click on Next.\n    The management pack will now be installed.\n    The Pure Storage Flash Array Management Pack is now installed and is ready to be configured!\n    Configuring the vRealize Operations Pure Storage Flash Array Management Pack To begin the configuration we can either click on Not Configured in the Repository screen or navigate to Configuration and Select the Pure Storage FlashArray\n    At this point we need to add in our Pure Storage FlashArray so we will click on the Gear under Configured Adapter Instances\n    We will enter in a display name for our array, the FQDN or IP and create a credential. We can either Test Connection or Select Save Settings making sure we accept the Certificate Thumbprint when prompted.\n    At this point the Management Pack will start to collect data, it may take up to 15 minutes for data to start to be ingested to be displayed in the new dashboards.\n    Configuring the vRealize Operations Pure Storage Flash Array Management Pack Selecting the Dashboards tab will show us the newly added dashboards. The Pure Storage Management Pack currently includes 5 built-in Dashboards.\n FlashArray Performance  This dashboard will provide information on the Volumes that are mapped to a VMware datastore. Information about the read/write latency and read/write bandwidth will be displayed.        Pure Environment  This dashboard will allow you to select an object and show the relationships. In this case we select a volume, and can see the FlashArray, Hosts, Datastore and Cluster associated with the volume.        Pure Hosted VMs  This dashboard will allow you to select the VM and see which datastore it is on, as well as the VM storage and Datastore storage metrics.        Volume Overview  The Volume Overview dashboard allows you to select a Volume and See the FlashArray relationship as well as Volume Metrics.        FlashArray Capacity  Last but not least the FlashArray Capacity dashboard will give you plenty of information on the Array and Volume Capacity usage.         Conclusion As you can see we pull in plenty of information in regards to the VMware and Pure Storage environments under one window. It\u0026rsquo;s helpful to see how metrics and alerts can be easily viewed. Is there something you would like to see presented in a future release? Leave a comment below!\n","permalink":"https://davidstamen.com/2020/03/10/using-the-pure-storage-vrealize-operations-management-pack/","tags":["vRealize Operations"],"title":"Using the Pure Storage vRealize Operations Management Pack"},{"categories":["Pure Storage","VMware"],"contents":"Welcome back! If you followed my previous post on Installing and Updating the Pure Storage vSphere Plugin, you may be wondering well What\u0026rsquo;s Next? Now its time to use it, which will empower your VMware Administrators to be awesome Pure Storage Administrators without ever needing to login to the Pure Storage UI!\nConfiguring the vSphere Plugin Once the plugin has been installed it now has to be configured. When I say it must be configured, you need to add in your storage arrays. This can be accomplished 2 ways. Either by adding each array independently, or my connecting to Pure1 and importing your arrays.\n    For my first example I will be adding my standalone M50 array, by clicking the Add button and entering in a name, FQDN/IP and credentials.\n    Host and Cluster Based Tasks with the vSphere Plugin Once the plugin is configured, if we right-click a host or cluster we are presented with a few options.\n    Looking at the plugin dropdown, we can do the following:\n Configure iSCSI  This will enable the software iSCSI adapter if no hardware iSCSI Adapters exist, and add in the Pure Storage IiCSI IQN\u0026rsquo;s as dynamic discovery targets.   Add Host Group  This will create a host or host group on the Pure Storage Array so that Volumes can be provisioned. The host group will be named after the Cluster Name and Hosts will be named after the ESXi hostname.        Create Datastore  This will create a volume on the array, add it to the host group and then create a datastore on the ESXi Cluster. If we chose a VMFS datastore we can select VMFS5 or VMFS6. We also have the ability to create a Vvol datastore if the storage providers have been registered.        Create Snapshots  This will create a snapshot on a volume based on which datastore is selected in the wizard.        Update Cluster Protection  This will allow you to add the Cluster or Hosts to a Protection Group for scheduled snapshots or replication.         Datastore Based Tasks with the vSphere Plugin If we right click a VMFS datastore and browse to the Pure Storage section we can see some new options that were not available in the host and clusters view.\n    We can do the following:\n Resize Datastore  This will extend the volume on the Pure Storage Array and rescan VMFS volumes to detect the new storage capacity.        Rename Datastore  Not only will it rename the volume on the Pure Storage Array, it will rename the datastore to match. Nothing like having a volume and datastore not match names!        Run Space Reclamation  If not using VMFS6 with automatic space reclamation, it will kick off a reclamation job.        Schedule Space Reclamation  If you do not feel like running it manually, you can set a schedule to run on the datastore for every X number of weeks on a particular host.        Destroy Datastore  This will delete the datastore, Unmount it from hosts and delete the volume from the Pure Storage Array. The volume will be left in a destroyed state for 24 hours until it\u0026rsquo;s eradicated and gone for good.        Mount on Additional Hosts  This allows you to provision the volume to even more hosts and have it accessible with the click of a button!        Create Snapshot  As we mentioned earlier, this will create a volume snapshot of the datastore.        Update Datastore Protection  This will allow you to update the Pure Storage protection group for the datastore and volume.         There are also a few unique options when using right clicking a Vvol datastore.\n     Create Virtual Disk  This will clone an existing Virtual Disk attached to a Vvol VM.        Undelete Virtual Machine  As long as the VM on the Vvol datastore had a snapshot of the config volume you will be able to restore a deleted virtual machine.         Virtual Machine Based Tasks with the vSphere Plugin If we right click a virtual machine and browse to the Pure Storage section we can see even more options available. These options are only available if the VM is on a Vvol datastore, these options are not for VMFS based volumes.\n    We can do the following:\n Import Disk  This will allow you to attach an existing disk. This workflow will be used for clustered based volumes.        Restore Deleted Disk  If a Vvol disk was accidentally deleted and you are in the 24 hour window of the destroyed volume, it can be imported.         Video Demonstration   Conclusion This plugin has many features to keep you out of the Pure Storage UI and more are being added in every release. Is there something you would like to see added in a future version? Leave a comment below!\n","permalink":"https://davidstamen.com/2020/03/05/using-the-pure-storage-vsphere-plugin/","tags":["vSphere Plugin","vCenter Server"],"title":"Using the Pure Storage vSphere Plugin"},{"categories":["Pure Storage","VMware"],"contents":"Welcome to the first of many Pure Storage blogs. As I get ramped up with the latest information I plan to do a series of getting started with Pure Storage features. These blogs will cover things such as the vSphere Client (HTML5) Plugin, FlashArray, FlashBlade and integrations with other VMware products. First up is learning to install and update the Pure Storage vSphere Client Plugin.\nIn this post we will cover how to install and update the vSphere Plugin using Powershell and PowerCLI. You could install the plugin using the Pure Storage UI, however why not use some automation?.\n    At the time of writing, the latest vSphere Plugin is version 4.2.0. However, because the array is running older code only 4.0.0 is available. If you want to get a newer version of the plugin you can contact Pure Storage Support and they can push the newer version to your array. This means that I am unable to use the latest version of the plugin even though it is compatible if I do not get it updated.\nInstalling the Pure Storage Powershell Module The Pure Storage Powershell Module for VMware is located in the Powershell Gallery and can be installed by running the following command\n1Install-Module -Name PureStorage.FlashArray.VMware It\u0026rsquo;s that easy!\nInstalling the Pure Storage vSphere Plugin Once you have the Pure Storage module isntalled, we can connect to the vCenter Server we wish to install the plugin to and run the Install-PfavSpherePlugin cmdlet to install it. If we wanted to, we could actually install a previous version.\nTo see versions available to install run:\n1Get-PfavSpherePlugin -html -previous      We see here that 4.2.0 is the latest but since we plan to perform an upgrade i will install version 4.1.0. See the below snippet on how to connect to vCenter Server and install the vSphere Plugin.\n 4.2.1 shows up under previous, even though it is a \u0026ldquo;newer\u0026rdquo; version it is not certified which is why it does not qualify to be the latest build.\n 1Connect-VIServer vcsa03.newstack.local -User administrator@vsphere.local -Password VMware1! 2Install-PfavSpherePlugin -version 4.1.0      Updating the Pure Storage vSphere Plugin To update the vSphere Plugin its the exact steps as the installation, you just specify no version (use the latest) or a newer version. Here i have left version empty so it will install the latest version which is 4.2.0.\n1Connect-VIServer vcsa03.newstack.local -User administrator@vsphere.local -Password VMware1! 2Install-PfavSpherePlugin      Verifying the Pure Storage vSphere Plugin Installed When we login to the vSphere Client you will see the Plugin has been installed but must be refreshed to be loaded. When the browser has been refreshed, we can see that the Pure Storage plugin has been installed and is pending configuration.\n    Uninstalling the Pure Storage vSphere Plugin Just in case you want to uninstall the Plugin, you can use the vCenter Server MOB or use the below Powershell cmdlet.\n1Connect-VIServer vcsa03.newstack.local -User administrator@vsphere.local -Password VMware1! 2Uninstall-PfavSpherePlugin Video Demonstration   Conclusion Installing and updating the Pure Storage plugin is quite simple! Why should I use the plugin? Join me in my next blog post where I cover reasons you want to use the vSphere Plugin instead of the Pure Storage UI!\n","permalink":"https://davidstamen.com/2020/03/03/installing-and-updating-the-pure-storage-vsphere-plugin/","tags":["vSphere Plugin","vCenter Server","PowerCLI","Powershell"],"title":"Installing and Updating the Pure Storage vSphere Plugin"},{"categories":["Awards"],"contents":"I am honored to have been selected as a VMware vExpert once again for 2020!\nThis is my eighth year as a vExpert (2013,2014,2015,2016,2017,2018,2019 and now 2020). It has been great to see the community grow and the amount of vExperts increase. Although I\u0026rsquo;m no longer employed at VMware I plan to still support the VMware community in any way I can. I plan to put more blogs on the personal blog this year and am excited to see folks at whichever industry events I am able to attend.\nI look forward to connecting with all the new vExperts this year!\n    ","permalink":"https://davidstamen.com/2020/02/24/vexpert-2020/","tags":["vExpert"],"title":"vExpert 2020"},{"categories":["Personal","Pure Storage"],"contents":"When the unfortunate reduction in force (RIF) struck in January at VMware, I was in disbelief and didn\u0026rsquo;t even know where to start. Over the past two years I had the amazing opportunity to not only present to customers and partners in places I never imagined, but the ability to be an internal subject matter expert and create some amazing content. VMware is an amazing place to work and the relationships I\u0026rsquo;ve made and my impact to the products are beyond things I thought I could ever accomplish. However things must come to an end. The RIF had nothing to do about performance, it was strictly a business decision and many team members across multiple business units were affected. I wish everyone the best of luck, as there are some amazing things coming!\nWith that said, I am excited to announce that I will be joining Pure Storage as a Field Solutions Architect. In this role I will continue to focus on VMware integrations while being a key resource to the field.\nI am looking forward to joining the Pure family and excited to see what the future brings!\n    ","permalink":"https://davidstamen.com/2020/02/12/back-to-work-im-going-to/","tags":["Pure Storage","Career"],"title":"Back to Work, I'm Going to"},{"categories":["Certification"],"contents":"It has now been about two months since I have began learning Kubernetes as I started to cover Project Pacific in my new role. With that said, one of my goals was to achieve the Certified Kubernetes Administrator (CKA) to prove my current knowledge. This post will be a recap of my experience studying for the exam.\nI am one that likes to take Certifications to obtain a certificate stating I am a SME in a particular area. In this case Kubernetes was up on my list, safe to say on my first attempt i passed the exam!\n    What is the CKA? According to CNCF.io the Certified Kubernetes Administrator (CKA) program was created by the Cloud Native Computing Foundation, in collaboration with The Linux Foundation, to help develop the Kubernetes ecosystem. As one of the highest velocity open source projects, Kubernetes use is exploding. The exam is 3 hours long and to pass you must achieve a score of 74%.\nThis is the first level certificate for Kubernetes, the next level is the Certified Kubernetes Application Developer (CKAD), but ill save that one for later.\nWhat was the exam like? Taking the CKA exam was different than what I\u0026rsquo;m use to. Im use to traveling to a testing center which happens to be no where near me and taking the exam in an environment that I have no control over. The CKA and CKAD exams are taken in the comfort of your own home. The requirements are you must have your own computer that can run chrome or chromium browser, have reliable internet and a webcam and microphone. Your working surface must be clean and have nothing around that can help. In my case I had to use my webcam to pan around the room showing there was nothing on the walls, on my desk or behind my monitor. I even had to remove the pen holder from my desk which I find a little strange, but it was ok. Luckily you are also able to keep a drink on your desk, but it must be a clear liquid in a clear glass or unlabelled bottle. All of these things are documented in the CKA FAQ\nHow did I prepare? Well, up until about 2 months ago I had little to no experience with Kubernetes. Based on feedback from others i started with Nigel Poultons Getting Started with Kubernetes course. This course was able to prepare me with everything I needed to know about Kubernetes and set very great groundwork. Once I was ready to start to study for the CKA I was referred to another great course from Mumshad Mannambeth who I ironically met at KubeCon:San Diego and explained Project Pacific! He has a series on KodeKloud and Udemy. Both exams include a video series as well as a lab that can be used to study based on practice questions.\nExam Tips The CKA is an exam that is kind of an open book test. You are allowed to have a single tab open to anything in the *.kubernetes.io or github.com/kubernetes. This means not having to worry about YAML file structure or those commands that you can easily lookup. Kubernetes.io has a great search function but sometimes its easy to create bookmarks especially when the CKA Handbook provides you with the topics that will be on the exam.\nThe one item I think that can save the most time is enabling auto completion of kubectl commands, you can learn a really long complicated command and try to memorize it, or bookmark the kubectl cheatsheet which has that command and more!\nTo pass the exam, you must score a minimum of a 74%. The exam is 24 questions and each one has the weight of the question listed. Using the in-test notepad I recommend writing down the number to each question the weight and whether you think you got it correct or not, this helps you know when you might\u0026rsquo;ve achieved a passing score.\nConclusion All in all I was very satisfied in the exam quality and questions. I didn\u0026rsquo;t feel that the questions were too easy or too hard. The exam lasts for 3 hours and for the first time I actually utilized the full 3 hours and didn\u0026rsquo;t finish everything 100%. If you follow some of the tips in preparation you should be well prepared when you are ready!\nHave any other tips? Leave them in the comments for others.\n","permalink":"https://davidstamen.com/2020/01/13/my-certified-kubernetes-administrator-cka-exam-experience/","tags":["Kubernetes","CKA","Project Pacific"],"title":"My Certified Kubernetes Administrator (CKA) Exam Experience"},{"categories":["VMware"],"contents":"Now that we have covered the considerations to backup each component in your vSphere Environment, it\u0026rsquo;s time to think about the rollback or restore process. In the previous post we discussed how to backup each individual component, in this post we will continue the conversation and discuss considerations to restore or rollback your vSphere Environment components.\nPlatform Services Controller / vCenter Server When things don\u0026rsquo;t go right with an update, upgrade or configuration change of your Platform Services Controller or vCenter Server you need to understand the proper steps it takes to rollback. In these scenarios sometimes there may have been a failure in the process, or after a successful upgrade was completed, an incompatibility was found which would result in a rollback. A reason we see the need to rollback a vCenter Server is when a supporting solution such as a backup vendor or monitoring vendor is not compatible. In this case you will need to revert to the previous version.\nScenario 1: Embedded vCenter Server Appliance (No Enhanced Linked Mode) When you need to rollback a Standalone vCenter Server with an Embedded Platform Services due to a failed upgrade or migrationâ€”shutdown the new vCenter Server Appliance, power on the original and rejoin to the domain if it previously was.\nIn the event the rollback occurs due to a patch or configuration change, the rollback process will include restoring from the file-based or image-based backup taken.\nScenario 2: Embedded vCenter Server Appliance in Enhanced Linked Mode In case you happen to have multiple Embedded vCenter Servers in Enhanced Linked Mode, the rollback and recovery of this is a bit different than Scenario 1.\nAs the Embedded vCenter Server contains PSC related data we cannot just revert a snapshot of a vCenter Server running in linked mode. There are pre-built checks in the vCenter Server that will look for inconsistencies and if any major issues occur the PSC service could go into read-only mode.\nIn order to properly restore an Embedded vCenter Server that is in Enhanced Linked Mode we must perform a restore that was taken with an Image or File-Based Backup. The File-Based Restore wizard contains logic to detect if the node was in linked mode and instead of restoring the stale data, it will perform a reconciliation and synchronize the PSC data from another vCenter Server in the SSO domain instead of restoring it. If you restore an Embedded vCenter Server from an image-based backup you must log into the VAMI and manually run reconciliation.\n    Scenario 3: External Platform Services Controller As we discussed in Scenario 2 if a vCenter Server had PSC data we did not want to restore old data. The same applies to a standalone External PSC, if we need to rollback a single PSC we will shut down the node and unregister it from the SSO domain. We will then redeploy the PSC using the same FQDN and IP and allow it to synchronize the data. The only time a PSC should be restored from backup is if all PSC\u0026rsquo;s within an SSO domain are unavailable.\n    Scenario 4: External vCenter Server Last but not least as we wrap up we will talk about restoring an External vCenter Server. When you need to rollback an External vCenter Server due to a failed upgrade or migrationâ€”shutdown the new vCenter Server Appliance, power on the original and rejoin to the domain if it previously was. In the event you need to roll back from a patch or configuration change an External vCenter Server contains no PSC data, it is fine to perform a restore from an image based or file-based backup.\nESXI Server Certain scenarios may require you to rollback an ESXi Server. Whether there was an issue with an update, upgrade or software installation we will cover two scenarios to rollback an ESXi Server.\nScenario 1: Reverting using the Built-in Recovery The most common method used to rollback an ESXi Host is the built-in recovery. [Using the Direct Console User Interface (DCUI)][https://kb.vmware.com/s/article/1033604] you have the ability to revert to a previous installation using the altbootbank. This is the simpler of the two scenarios, but a previous version is not always available. In the event a previous version is unavailable you will need to proceed with restoring using a configuration backup.\n        Scenario 2: Reverting using Configuration Backup The next method to recover an ESXi Host is to restore a previous configuration. If an altbootbank is not available to use the built-in recovery you must first install ESXi Server from media. Using the configuration backup, you can perform a restore to bring the host back to its configured state. In some environments host profiles are not used, which is why having a configuration backup can make a restore simpler.\nVMware Tools / VM Compatibility Downgrading of VMware Tools is not supported. In the event of a need to revert to a previous version of VMware Tools, you must first uninstall the newer version of VMware Tools and then install the older version of VMware Tools.\nUnlike VMware Tools there is no process to perform an in-place downgrade of VM Compatibility / Virtual Hardware. To downgrade your virtual machine hardware version you have 3 options:\n Revert to a previous backup or snapshot of the Virtual Machine prior to upgrading virtual hardware. Create a new virtual machine mirroring the original specifications using a previous hardware version and attach the existing disk from the virtual machine. Use VMware Converter to perform a VM to VM conversion choosing a previous hardware version for the destination.  Storage (VMFS/VSAN) When performing a rollback of a VMFS-6 volume it follows the same steps as an upgrade to VMFS-6. When Migrating VMFS-5 to VMFS-6 there was no in-place upgrade. The same applies to a downgrade. In order to downgrade a VMFS-6 volume to VMFS-5 you must first create a new VMFS-5 Volume and then perform a storage migration of Virtual Machines.\nGenerally, it is not recommended to downgrade a vSAN Disk Format. However, in some scenarios you may wish to format a [vSAN][7] Disk Group with a legacy format version. This process includes the ability to evacuate a disk group and choose a legacy disk version by modifying an advanced setting and then recreating a disk group. This is only applicable to vSAN 6.x versions.\nNetwork (VDS) Last but not least let\u0026rsquo;s review the scenario of having to rollback a previous vSphere Distributed Switch version. If you have ever performed an upgrade you may notice on the screen, that a distributed switch cannot be downgraded, however there is a process in order to perform a restore which will allow us to go back to a previous distributed switch version.\n    In order to \u0026ldquo;restore\u0026rdquo; a distributed switch configuration you must first create a Distributed Switch at the correct target version and choose the option to import configuration preserving the original distributed switch and port group identifiers. If you would attempt to restore a distributed switch configuration on top of the existing, it would leave the current distributed switch version intact.\nResources  Restore a vCenter Server Appliance from a File-Based Backup Restore a vCenter Server Instance with an Embedded Platform Services Controller Unregister PSC or vCenter Server from SSO Domain using CMSSO-UTIL Reverting to a previous version of ESXi Restoring ESXi host configuration data Downgrade of VMware Tools is not supported Downgrading the virtual machine hardware version in ESX/ESXi Migrating VMFS 5 datastore to VMFS 6 datastore How to format vSAN Disk Groups with a legacy format version Restore a vSphere Distributed Switch Configuration Export, Import, and Restore vSphere Distributed Port Group Configurations  Conclusion Although we don\u0026rsquo;t like to anticipate any issues in our vSphere Environment, it is important to not only take regular backups of our environment, but to also practice restoring outside of any lifecycle activities. When thinking about backing up and restoring vSphere Components it is important to consider the different parts of your environment and the impact restoring that component will have in your environment.\nIf you have any questions, comments or feedback, feel free to leave them below or reach out on twitter at @davidstamen.\nOriginally Posted on blogs.vmware.com/vsphere\n","permalink":"https://davidstamen.com/2019/10/23/considerations-for-vsphere-component-backup-and-restore-part-2/","tags":["vSphere","Backup","Restore","vCenter Server","ESXi"],"title":"Considerations for vSphere Component Backup and Restore: Part 2"},{"categories":["VMware"],"contents":"You spend time planning and implementing updates, upgrades and configuration changes to vSphere Environments. Rollback or recovery is usually the last thing on the mind. Did you know there are multiple ways to successfully backup each component in a vSphere Environment? There are also many ways to recover those same components.\nIn this series we will talk about considerations to backup and restore or rollback your vSphere environment if we have a need to.\nWhen we discuss our vSphere Components, I am talking about the core product.\n Platform Services Controller / vCenter Server ESXi Hosts VM Compatibility / VM Tools Storage (VMFS/VSAN) Network (VDS)  The backup and recovery for each component is different. vCenter Server has a native file-based backup, whereas everything else does not have a native backup tool. Below I will provide guidance and considerations when backing up your vSphere Environment.\nIntroduction Prior to starting any changes in your vSphere Environment backups should be taken. Backing up your environment does not necessarily have an order of backups, but if you think about dependencies, I like to backup my environments in the same order as an upgrade is completed.\n    Each component has different considerations. Is my vCenter Server running 6.0, 6.5 or 6.7? Is it appliance based, or windows based? Am I using features such as vCenter HA or Content Library\u0026rsquo;s? Those are all very important questions! vCenter Server 6.5 and 6.7 have a native file-based backup, this will include the configuration, inventory and historical data such as tasks, events and performance data. If using vCenter Server for Windows, backup can be accomplished using an image-based backup tool as well as a backup of the database. Features such as vCenter HA are not needed to be backed up, as the server is restored as a standalone node. Features such as Content Library will have all the configuration and metadata restored, but the files contained in a Content Library are stored within the datastore itself, so those are some considerations to think about.\nThere are also many ways to backup each component, and not just differences like image-based vs file-based. Components can be backed up through the vSphere Client, API, vSphere CLI, ESXCLI, DCLI and PowerCLI.\nPlatform Services Controller / vCenter Server When considering backups for the Platform Services Controller or vCenter Server there are a few methods that can be used. If using a Windows based Platform Services Controller or vCenter Server the supported backup process is to take an image based backup of the Machine and a database backup. If utilizing the vCenter Server Appliance on vSphere 6.5 or vSphere 6.7 the recommended backup method is to use the File-Based backup. The file-based backup is not only available in the vCenter Appliance Management Interface (VAMI) but also has an API and DCLI commands.\nPerforming an online snapshot of your environment is not recommended or supported. If the need arises to snapshot the environment, all nodes in the SSO domain should be powered off. This can be problematic as all nodes within the SSO domain must be shutdown causing a downtime. In the event of a recovery you would not be allowed to recover one node from snapshot, the entire environment would need to be reverted.\nESXi Hosts ESXi Hosts do not have a native full backup tool like vCenter Server. There are some considerations to think about; Are my hosts stateless or stateful? Am I using Host Profiles?\nIf your environment is stateless, a backup and recovery is simple. Update the image profile and perform a reboot of the host, during the boot process a new image will be used and the host profile configuration will be applied.\nIf your environment is stateful there are a couple options for backup. Using vSphere CLI or PowerCLI you can export the configuration of your ESXi Host, whereas if using host profiles, the configuration will be stored along with an answer file on the vCenter Server.\n PowerCLI 1Get-VMHostFirmware -VMHost ESXi_host_IP_address -BackupConfiguration -DestinationPath output_directory  vSphere CLI: 1vicfg-cfgbackup --server=ESXi_host_IP_address --username=root -s output_file_name   Virtual Machines: VMware Tools / VM Compatibility In order recover a VM in the event you encounter issues with a VM Tools or VM Compatibility updateâ€”it\u0026rsquo;s important to make sure you have a snapshot or full backup of your virtual machine. Recovery may not always require this backup, but it\u0026rsquo;s good to have a point in time to recover.\nStorage: VMFS / VSAN Storage arrays whether they are VSAN, ISCSI, NFS or FC cannot be backed up directly. In this case, we need to protect the workloads on them instead of the storage itself. For rollback the same holds true, in the event we have a need to rollback a version of VMFS or VSAN the exact steps in the next post in the series.\nNetwork: vSphere Distributed Switch Last but not least, it is important to take a backup of your vSphere Distributed Switch. A vCenter Server backup does include a copy of the VDS, however if you have a need to recover it separately, a backup and export of the switch should be taken.\n        Resources  Image-Based Backup and Restore of a vCenter Server Environment File-Based Backup and Restore of vCenter Server Appliance KB2149237: Overview of Backup and Restore options in vCenter Server 6.x Video: Talking Code â€“ VCSA File-Based Backup with PowerCLI Blog: Automating File-Based Backups of vCenter Server Appliance Walkthrough: vCenter Server Appliance 6.7 File-Based Backup Walkthrough: vCenter Server Appliance 6.5 File-Based Backup DCLI: File-Based Backup API: File-Based Backup KB2042141: How to back up ESXi host configuration Backing Up and Restoring a vSphere Distributed Switch Configuration PowerCLI: Export-VDSwitch  Conclusion As we think about backing up our vSphere Environment it\u0026rsquo;s good to know that we have options when it comes to backing up each component. It\u0026rsquo;s also good to understand the dependencies and order when backing up each piece. In the next part in the series we will discuss the rollback or recovery of each component and the considerations for each.\nIf you have any questions, comments or feedback, feel free to leave them below or reach out on twitter at @davidstamen.\nOriginally Posted on blogs.vmware.com/vsphere\n","permalink":"https://davidstamen.com/2019/10/21/considerations-for-vsphere-component-backup-and-restore-part-1/","tags":["vSphere","Backup","Restore","vCenter Server","ESXi"],"title":"Considerations for vSphere Component Backup and Restore: Part 1"},{"categories":["VMware"],"contents":"VMworld US has wrapped up and now its time to focus on VMworld EU! Let\u0026rsquo;s jump in and find out what\u0026rsquo;s going on in the world of vSphere Lifecycle. Check out this post to see how I will be engaging with our customers at this years events!\n    Adam Eckerle has a great post on our VMware vSphere Blogs on how to Get Prepared for VMworld 2019 US.\nBelow are my sessions that have been accepted, this page will be updated as schedule builder goes live and if any other sessions are accepted.\nAutomating vCenter Server Appliance Update Lifecycle with APIs and PowerCLI\nPlanning for a Successful vSphere Upgrade\n4 Hour Workshop: What\u0026rsquo;s New in vSphere, and How to Upgrade to the Latest Version\nAlso don\u0026rsquo;t forget, there will be plenty of other vSphere Lifecycle related sessions! Check out this link for some!\n","permalink":"https://davidstamen.com/2019/09/24/vmworld-eu-2019-vsphere-lifecycle-sessions/","tags":["VMworld"],"title":"VMworld EU 2019 - vSphere Lifecycle Sessions"},{"categories":["VMware"],"contents":"Windows Server 2008 and 2008 R2 will be end-of-life on January 14th, 2020. This impacts quite a few folks who may have deployed their vCenter Server for Windows on these Operating Systems. I have been asked quite often recently, \u0026ldquo;What are my options?\u0026rdquo; Let\u0026rsquo;s dive in and find out what it takes to move to a supported OS!\nMigrate to the vCenter Server Appliance (VCSA) Mentioned in August 2017,Farewell, vCenter Server for Windows. The VCSA is now the default deployment recommended for vCenter Server. If you are currently running vCenter Server on Windows, during your next upgrade you should be migrating to the VCSA. Features such as many performance and security enhancements and new features such as vCenter HA and the File-Based Backup are exclusive to the VCSA.\nVMware has provided a migration tool directly in the VCSA Installer for 6.5 and 6.7. This migration tool will deploy a brand new VCSA running the latest version, and then import the data from the source Windows vCenter Server shutting it down in the process. This migration option allows you to maintain the same PNID, UID, Certificates, Tags, Roles, etc\u0026hellip;.including the VDS!\n    If you want to learn more on Migration to the VCSA, check out vSphere Central\nMigrate to vCenter Server on Windows Server 2012/2016/2019 If you are unfortunately unable to migrate to the VCSA, there is an alternative option. It is NOT SUPPORTED to do an in-place upgrade from 2008 to a newer operating system with vCenter Server installed. KB2018695 can be referenced for more information but explicitly states:\n VMware does not support the installation of major update releases on an operating system as an upgrade in a virtual machine, such as Windows 7 to Windows 8 or RHEL 5.x to RHEL 6.0. VMware recommends the installation of a new major releases in a new virtual machine.\n The only supported method would be to take a backup of the existing environment including the database. You will then shutdown the old Windows Server 2008 vCenter Server, and deploy a new VM running your newer operating system with the exact same FQDN and IP. Once this machine is online, you would re-install vCenter Server for Windows using your existing vCenter Server Database.\nThe backup and restore options for vCenter Server 6.x are outlined in the following KB2149237. However please note there could be some considerations such as change of UUID, loss of certificates, tags, roles and other policies, so when migrating or moving the vCenter Server database check out KB2144536 for more information!\nWrap Up Its a good idea to keep an eye on EOL/EOGS dates for products you have running in your environment. To understand the EOGS support for VMware Products you can find more information on the VMware Lifecycle Matrix.\n","permalink":"https://davidstamen.com/2019/08/12/windows-server-2008-is-going-eol-what-about-my-vcenter-server/","tags":["vCenter Server","vSphere 6.7","vCenter Server 6.5"],"title":"Windows Server 2008 is Going EOL - What about my vCenter Server?"},{"categories":["VMware"],"contents":"vSphere 6.5 first introduced vCenter HA and since its inception has been deployed in many environments. When it comes to upgrading or updating your vCenter HA environment there are some specific considerations. If you have wondered what it takes to handle the lifecycle of a vCenter HA enabled vCenter Server, keep reading!\nvCenter HA Overview vCenter HA has seen wide adoption as customers wish to provide provide high availability for their vCenter Server. VMware Solutions such as Site Recovery Manager, NSX and Horizon View rely heavily on the availability of the vCenter Server being online, so having a low RPO and RTO assists in availability of these business critical applications. vCenter Server 6.7 Update 1 introduced workflow improvements by bringing vCenter HA into the vSphere Client. There are no longer two separate Basic and Advanced workflows. If the vCenter Server is self-managed the passive and witness nodes will be automatically deployed. However, if the vCenter Server is not self-managed the workflow will prompt you for the managing vCenter Servers credential.\nvCenter HA functions by cloning the vCenter Server to an active and passive node. This process creates a vCenter Server High Availability group which allows the management IP to failover between the active and passive nodes. For more information please see vCenter High Availability Deep Dive â€“ Part 1 or vCenter High Availability Deep Dive â€“ Part 2\n    Snapshots are not supported when vCenter HA is enabled. Prior to any updates or upgrades a vCenter Server File-Based Backup should be taken.\nUpdating a vCenter Server 6.5 Environment With vSphere 6.5 there are two options when it comes to updating your vCenter Server.\nThe first option consists of leaving the configuration intact during updating. As only the active vCenter Server Appliance has access to the management network, this method requires downloading the vCenter Server patch ISO\u0026rsquo;s from the VMware Patch Portal and performing the updates through the command-line interface. This method provides the least amount of downtime for your environment and is documented in our VMware vSphere Product Documentation.\nThe process begins by placing vCenter HA into maintenance mode, which still allows data replication but will disable automatic failover. The patch ISO is mounted to the active, passive and witness vCenter Server nodes. Using the active vCenter Server node as a jumpbox, SSH into the witness performing an update through the software-packages utility. Once the update is complete you will reboot the witness vCenter Server. When the witness is back online you will repeat the process on the passive vCenter Server. Once both the witness and passive nodes are up to date, perform a manual failover. This failover will promote the passive node to the active node having it running the new vCenter Server version. When the failover is complete, using new active vCenter Server as a jumpbox SSH into the passive node performing one last final update. The vCenter Server environment is now updated to the latest version.\nThe second option consists of removing the vCenter HA configuration to be left with a standalone vCenter Server. This method provides a more simplistic approach to updating your environment.\nIf your vCenter Server has internet access you can easily download and install updates from the online repository. However, if your vCenter Server does not have internet access you have the option to either download the ISO and mount it to the vCenter Server Appliance or use an offline repository option. Once updated, vCenter HA can be re-deployed to protect the vCenter Server instance.\nUpdating a vCenter Server 6.7 Environment With vSphere 6.7 there is only one option to update a vCenter Server. Due to changes in the DB schema, the only supported option is to remove vCenter HA configuration and update the vCenter Server as described in the second option above.\nMore information on these changes is documented in KB55938\nvCenter Server Upgrades Upgrading a vCenter Server Appliance from 6.5 to 6.7 configured with vCenter HA requires the configuration to be removed. Beginning with vSphere 6.7 Update 1 the vCenter Server Upgrade installer can detect when vCenter HA is enabled and automatically handle the upgrade process by removing the configuration prior to the upgrade, and then re-deploying vCenter HA once the upgrade is complete.\n    When vCenter Server Upgrade installer detects vCenter HA is enabled on the source appliance, existing witness and passive nodes will be shutdown and deleted. A new vCenter Server Appliance will be deployed as part of the upgrade process and vCenter HA will automatically be re-deployed when the upgrade completes. If preferred to not have the process done automatically, the vCenter HA configurationcan be removed and a standalone upgrade performed of the vCenter Server.\n    Wrap Up Handling the lifecycle of a vCenter Server with vCenter HA doesn\u0026rsquo;t have to be difficult; when armed with the right knowledge it can be quite simple.\nFor more information on using vCenter HA or vCenter Server File-Based Backup and Restore, I recommend checking out Day 2 Operations Section on vSphere Central.\nOriginally Posted on blogs.vmware.com/vsphere\n","permalink":"https://davidstamen.com/2019/07/30/handling-the-lifecycle-of-a-vcenter-ha-environment/","tags":["vCenter HA","vCenter Server","Lifecycle"],"title":"Handling the Lifecycle of a vCenter HA Environment"},{"categories":["VMware"],"contents":"VMworld US 2019 is just around the corner and the session acceptance emails have just been sent out. Check out this post to see how I will be engaging with our customers at this years events!\n    Adam Eckerle has a great post on our VMware vSphere Blogs on how to Get Prepared for VMworld 2019 US.\nBelow are my sessions that have been accepted, this page will be updated as schedule builder goes live and if any other sessions are accepted.\nAutomating vCenter Server Appliance Update Lifecycle with APIs and PowerCLI\nPlanning for a Successful vSphere Upgrade\nUpgrading your vSphere Environment: HM Health Solutions\u0026rsquo; Experience\n4 Hour Workshop: What\u0026rsquo;s New in vSphere, and How to Upgrade to the Latest Version\nAlso dont forget, there will be plenty of other vSphere Lifecycle related sessions! Here some of my additional recommendations\nWhat\u0026rsquo;s New with vSphere?\nUS: HBI2893BU\nThis session is a VMworld staple. Come find out whatâ€™s new with the most robust and widely adopted virtualization platform in the industry. This session will provide a high-level overview of new and existing features, direction updates and changes, tech previews, and other critical data points (such as end-of-support reminders) that will help you stay on top of VMware vSphere in 2019. Donâ€™t miss your chance to get the latest and greatest details on vSphere.\nVMware Tools: The Lowdown\nUS: HBI1540BU\nIn this session, we will be running the gamut of everything involved in VMware Tools. Find out why you should install, which versions you should install, when to upgrade, how to minimize reboots, how to manage at scale, and much more.\nThe Next Generation of Lifecycle Management for vCenter Server\nUS: HBI1973BU\nUpgrading to a new VMware vSphere version can seem daunting, but it doesn\u0026rsquo;t have to be. In this session, we will provide a technical preview of the next generation of vSphere lifecycle tools that will help successfully guide you through your vSphere upgrade.\nA Practitioner\u0026rsquo;s Guide to vCenter Server Architecture\nUS: HBI2227BU\nThe foundation of a VMware vCenter Server environment is a well-architected VMware vSphere single sign-on domain. With the recent announcement of the deprecation of external Platform Services Controllers, itâ€™s important to understand how to transition to VMwareâ€™s simplified, recommended topology. In this session, learn about the tools available to help you transition from an external deployment model to an embedded deployment model. Find out strategies and best practices related to designing and implementing linked mode, multisite, and multidomain that align to your business requirements. This knowledge will serve as a guide to reduce the unneeded complexity for existing and greenfield environments.\nDeep Diving in What\u0026rsquo;s New with vCenter Server\nUS: HBI2217BU\nIn this session, you will learn about the all-new features and capabilities in the latest VMware vCenter Server release. We will deep dive and showcase improvements to the vCenter Server topology, including the tooling available, certificate management, performance and scale, and much more. You will receive guidance and best practices along with a peek at more potential enhancements beyond this release.\nHCI Upgrade: Let\u0026rsquo;s Simplify and Automate the Mundane\nUS: HCI2256BU\nVMware vSphere Update Manager performs zero-downtime patching and upgrading of VMware ESXi clusters, and is a very popular update tool for many VMware environments. VMware engineers decided to integrate vSphere Update Manager into VMware vSAN with one goal in mind: Simplicity. In this session, we will discuss this integration and how software, driver, and firmware update catalogues are managed by vSphere Update Manager. Learn how integration with vSAN Health provides a safe upgrade path. We will also cover best practices for two-node, stretched cluster, and fault domain configurations. Join Paudie and Gourav as they discuss these concepts in depth from both an engineering perspective and a practical real-world perspective.\n","permalink":"https://davidstamen.com/2019/06/18/vmworld-2019-sessions-and-events/","tags":["VMworld"],"title":"VMworld 2019 - Sessions and Events"},{"categories":["VMware"],"contents":"As more customers get ready to run the vCenter Server Converge Tool in their environments, a common question that has been asked is \u0026ldquo;What Happens to my Certificates?\u0026rdquo; Well that is a good question so lets find out!\n    When using certificates in your vSphere Environment there have traditionally been a few ways to deploy them.\n Default VMCA Subordinate CA Hybrid Mode Custom Certificates  Bob Plankers has a very good post on our vSphere Blogs which cover 10 Things To Know about vSphere Certificate Management\nDefault VMCA Included in vCenter Server 6.0 is a VMware Certificate Authority also known as the VMCA. This is usually used as the default unless customers have requirements to use 3rd party signed certificates. This is also the most common as you can easily download the VMCA Root Certificates from your vCenter Server and add them to your trusted root authority either manually or via group policy. This easily meets the requirements for customers who wish to \u0026ldquo;get rid of the red X\u0026rdquo; in the address bar.\nIn the case of vCenter Server Convergence, vCenter Server automatically regenerates any certificates and there are no additional tasks needed.\nSubordinate CA This Subordinate CA method is one that when implemented, the VMCA actually becomes a subordinate CA of your Microsoft Certificate Authority. In this case it is not recommended as it does pose some risks as you cannot actually validate from your Root CA what certificates are being issued. This also poses problems with vCenter Server convergence as VMware does not have the ability to move the Subordinate CA.\nIn the case of vCenter Server Convergence, VMware recommends moving to the Hybrid Certificate or Default VMCA Model. If you must continue to use Subordinate CA, you will need to Converge your vCenter Server, then change the Embedded vCenter Server to be a Subordinate CA, reissue certificates and then decommission the external PSC and Old Subordinate CA.\nHybrid Mode Other then using the Default VMCA, the Hybrid Model is the next recommended approach. When doing a Hybrid Mode certificate setup you replace the machine certificates with 3rd Party certificates allowing all web services to be trusted, while your ESXi hosts still utilize the VMCA for certificates.\nIn the case of vCenter Server Convergence, as nothing is using the External PSC directly, during the vCenter Server convergence no changes are needed.\nCustom Certificates Custom certificates are one of the most difficult certificate solutions to use. This is where no Certificate Authorities are used and EVERY certificate is replaced manually. This is traditionally used only in extremely secure locations such as government.\nIn the case of vCenter Server Convergence, as nothing is using the External PSC directly, during the vCenter Server convergence no changes are needed.\nWrap Up Hopefully this has helped clarify some questions around using certificates with the vCenter Server converge tool, don\u0026rsquo;t forget to review the additional resources below.\nAdditional Resources  Documentation: Certificate Management Overview Blog: 10 Things To Know About vSphere Certificate Management Blog: Hybrid vSphere SSL Certificate Replacement) Blog: vCenter Server Converge Tool - How do I Converge an Environment Using the UI Blog: Understanding the vCenter Server Converge Tool Blog: vCenter Server Converge Tool Enhancements in vSphere 6.7 Update 2 Product Walkthrough: Converging a Load Balanced External vCenter Deployment using the vSphere Client Product Walkthrough: Converging an External vCenter Deployment using the vSphere Client Documentation: vCenter Server Converge Tool ","permalink":"https://davidstamen.com/2019/06/07/vcenter-server-converge-tool-what-about-my-certificates/","tags":["vCenter Server","vSphere 6.7","Converge Tool","Certificates"],"title":"vCenter Server Converge Tool - What About My Certificates"},{"categories":["VMware"],"contents":"I am proud to announce that my first VMware Clarity Project the VCSA JSON Creator is now live! This has been something I have wanted to do for some time, and am glad to finally have the first version available for feedback. Let\u0026rsquo;s dive in and take a look.\nI first want to start off that I would not have been able to do this without the awesome Cody De Arklandexplaining how to get started with Clarity UI.\nWhen I discuss with customers about using the vCenter Server Appliance CLI Tools that have been included since vSphere 6.5, they tend to not have used it before. When I have asked why, I normally hear that the JSON is too complex to figure out.\nWith this being said I am proud to share my first ClarityUI Project the VCSA JSON Creator 9000\nWhy? I have built the VCSA JSON Creator to be used as a resource to understand how the JSON templates should be created. I currently have two wizards created and I hope to create more based on feedback.\nCurrent\n* Installation of an Embedded VCSA 6.7 * Upgrade of an Embedded VCSA 6.5 to 6.7 * Migration of an Embedded Windows vCenter Server 6.5 to 6.7 - Added 4/25/19 * Converge of External PSC - Added 5/2/19 * Decommission of External PSC - Added 5/2/19 * Add Download of JSON Template - Added 5/7/19 * Upgrade of External PSC Appliance and External vCenter Server Appliance - Added 5/8/19  Planned\n* Migration of External PSC and External vCenter Server  How does it work? If you take a look at the tool it should look very similar to the vSphere Client. This is because its using the awesome Clarity Design Interface. When you navigate to the homescreen you will see the wizards that are currently available. At this time we can choose create a JSON for an Installation of an Embedded 6.7 VCSA or an Upgrade of a VCSA from 6.5 to 6.7.\n    For this example we have chosen to do an Install of an Embedded VCSA 6.7. When the wizard is launched you will be prompted for all of the standard information requested as part of the manual creation of the JSON. If you have any questions on how fields should be populated or the format, you can access the link to the documentation or select the (i) signpost to view more information about the fields. Once the first section is filled out we can proceed.\n    Once we have filled out the first section with the Appliance Deployment Information we can input information for configuration. To simplify this screen a few fields have built-in dropdown\u0026rsquo;s for the requested items. Proceed to fill in all available fields and then proceed to click next.\n    Once all our fields have been filled out, your JSON will now be created. You can review how the fields have been entered and then Copy the file to your favorite text editor and save it as a Filename.json.\n A download button should hopefully be added in the next update.\n     Conclusion Using the CLI based tools doesn\u0026rsquo;t have to be overwhelming, hopefully this tool can help you understand the process to create the JSON and maybe even save you some time. Look at the additional resources for some references on how to use the VCSA CLI Installer once you have your JSON created. Have any feedback? Leave a comment below!\nAdditional Resources  Upgrading Platform Services Controller and vCenter Server via the CLI Installer Product Walkthrough: Upgrading vCenter Server 6.5 to vCenter Server 6.7 using VCSA CLI VCSA JSON Creator 9000 ","permalink":"https://davidstamen.com/2019/04/24/vcenter-server-appliance-cli-json-creator/","tags":["vCenter Server","vSphere 6.7","Clarity","Angular","CoolTool"],"title":"vCenter Server Appliance CLI - JSON Creator"},{"categories":["VMware"],"contents":"vSphere 6.7 Update 2 is now available! Inside this update include enhancements to the vCenter Server Converge Tool. Let\u0026rsquo;s dive in and take a look at whats new and see how to converge a deployment using the new UI.\nIncluded in vSphere 6.7 Update 2 is an overhauled system configuration section. Within system configuration you have a table view showing you the Platform Services Controllers and vCenter Servers in your Environment.\nvCenter Server Topology View Alongside the new system configuration table view there is a new topology view. This view allows you to have a graphical representation of the nodes in your SSO domain. This is useful when someone might\u0026rsquo;ve configured additional replication agreements between External Platform Services Controllers. Previously the only method to view replication agreements was using vdcrepadmin against each PSC in your environment to manually build out the topology diagram.\n    When I am in the field we tend to inform users about how to properly setup additional replication agreements in an SSO domain when using 3 or more External PSCs or Embedded vCenter Servers. My recommendation is to create one additional replication agreement to be used as a ring topology. At some point I have heard of customers using a mesh topology, without mapping out all the replication agreements they may have never known they were in a non-recommended topology. Using the new topology view you can easily see if someone incorrectly setup additional replication agreements and then go back in and clean them up using vdcrepadmin.\n    vCenter Server Converge Tool UI When reviewing the new table view you might have noticed two new buttons. You now have the ability ability to Converge and Decommission nodes through the vSphere Client. No longer are you required to utilize the CLI and JSON templates to run the converge tool! This is great for customers or partners who wish for a simplistic and foolproof method to migrate their vSphere Environment to an Embedded vCenter Server Deployment.\n    I will run through a convergence example of a vSphere Environment that has two External PSCs and two External vCenter Servers. I will be migrating these nodes to vCenter Servers with an Embedded PSC.\n    Once I have selected our vCenter Server Appliance that we wish to converge to embedded I will first be notified that the vCenter Services will be restarted and then the next step will proceed to the information gathering screen. If you have previously used the CLI based Converge Tool you might of remember being prompted for the managing vCenter Server credentials. This is no longer needed as the vCenter Server Converge Tool is already aware of this information.\n    On this screen I\u0026rsquo;ll will be prompted certain pieces of information:\n External PSC SSO Username and Password  Needed to be able to install the required components to the vCenter Server and allow replication between the new embedded vCenter Server and the existing External PSC.   New Replication Partner  As seen below you can see that no embedded node is available. This is because this is the first node I have ran the converge utility against and it will reuse the existing replication agreement. When I proceed to converge any additional vCenter Servers I will see the already existing vCenter Servers with an Embedded PSC and will have the ability to choose a replication partner.   Skip AD Join or Join AD  If you wish to join your vCenter Server Appliance to Active Directory then select this option and you will prompted to enter in additional information.         Acknowledge that you have made a backup of your vCenter Server Appliance before initiating convergence.  This is extremely important as you are making major changes to your vSphere Environment. Before proceeding with convergence not only should you back up the node you are currently converging, but you should be backing up ALL External PSC and vCenter Servers within your SSO domain. To perform a backup you should be using the built in file-based backup in the VAMI and NOT relying on snapshots.    Once I have successfully converged both our vCenter Servers I can now proceed to decommission the two External PSC\u0026rsquo;s. As we are already aware of the managing vCenter Server all we need to do is enter in the vCenter Server SSO credentials so that the external PSC can be shutdown and unregistered from the SSO domain.\n    Now that the converge and decommission process is completed, I will go back and review the toplogy view to see that we now have migrated to our simplified deployment topology using Embedded PSCs.\n    Additional Resources  Blog: Understanding the vCenter Server Converge Tool Blog: vCenter Server Converge Tool Enhancements in vSphere 6.7 Update 2 Product Walkthrough: Converging a Load Balanced External vCenter Deployment using the vSphere Client Product Walkthrough: Converging an External vCenter Deployment using the vSphere Client Documentation: vCenter Server Converge Tool ","permalink":"https://davidstamen.com/2019/04/11/vcenter-server-converge-tool-how-do-i-converge-an-environment-using-the-ui/","tags":["vCenter Server","vSphere 6.7","Converge Tool"],"title":"vCenter Server Converge Tool - How do I Converge an Environment Using the UI"},{"categories":null,"contents":"David Stamen is a Field Solutions Architect focused on VMware and Cloud solutions at Pure Storage.\nI can be found blogging at:\n http://davidstamen.com https://blogs.vmware.com/code/author/dstamen1 https://blogs.vmware.com/vsphere/author/dstamen  I am also glad to be part of the following programs:\n VMware vExpert VMware Code Coach  And I can also be found on Twitter and on LinkedIn\n","permalink":"https://davidstamen.com/about/","tags":null,"title":"About Me"},{"categories":["VMware"],"contents":"Previously I covered how to use the VCSA Installer to do a scripted upgrade and then I covered Patching the vCenter Server Appliance (VCSA) using the REST API - Part 1 (Postman Collection) However, after learning recently how to call API\u0026rsquo;s from Powershell I thought to myself, why not write a Powershell Module for this?\nIntroduction Using tools such as Postman can make it utilizing API\u0026rsquo;s a bit easier, but you still need to be familiar with a separate tool or UI. I was able to develop my own version and build my first Powershell Module that you can use to patch the VCSA in a simple method. Some of the function names below may not be 100% exact and this is due to the accepted verbs for Powershell. If you have further recommendations I would be happy to entertain changing the Powershell verbage.\nUse Cases Why would you want to use a Powershell module such as this? Well this tool can support multiple vCenter Servers. So here are a few ideas.\n Modify a Custom URL Repository Across all vCenter Servers in your Environment Stage Patches across all vCenter Servers in your Environment. Patch Multiple Servers Simultaneously  Exploring the Powershell Module Functions As of current, the Powershell module currently has 12 Functions.\n Copy-VCSAUpdate Get-VCSAUpdate Get-VCSAUpdateDetail Get-VCSAUpdatePolicy Set-VCSAUpdatePolicy Get-VCSAUpdateStaged Get-VCSAUpdateStatus Remove-VCSAUpdate Start-VCSAUpdateInstall Start-VCSAUpdatePrecheck Start-VCSAUpdateStageandInstall Start-VCSAUpdateValidate Stop-VCSAUpdate  Copy-VCSAUpdate Copy-VCSAUpdate is the command you will use when you want to manually stage the update.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Copy-VCSAUpdate -Version \u0026#34;6.7.0.20100\u0026#34;      Get-VCSAUpdate Get-VCSAUpdate is the command you will use when you want to wish to check for new updates. There is an optional Parameter for Source, \u0026ldquo;Local\u0026rdquo; or \u0026ldquo;Online\u0026rdquo;, if no parameter is chosen it will default to Online.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Get-VCSAUpdate 3 4Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 5Get-VCSAUpdate -Source \u0026#34;Online\u0026#34; 6 7Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 8Get-VCSAUpdate -Source \u0026#34;Local\u0026#34;      Get-VCSAUpdateDetail Get-VCSAUpdateDetail is the command you will use when you want to wish to get more details about a specific update. There is a mandatory parameter for Version.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Get-VCSAUpdateDetail -Version \u0026#34;6.7.0.20100\u0026#34;      Get-VCSAUpdatePolicy Get-VCSAUpdatePolicy is the command you will use when you want to wish to get information about the current appliance update settings.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Get-VCSAUpdatePolicy      Set-VCSAUpdatePolicy Set-VCSAUpdatePolicy is the command you will use when you want to wish to set information for the current appliance update settings.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Set-VCSAUpdatePolicy -AutoStage $True 3 4Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 5Set-VCSAUpdatePolicy -CustomURL https://myinternalURL.com 6Set-VCSAUpdatePolicy -CustomURL Clear 7 8Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 9Set-VCSAUpdatePolicy -UsernameURL admin 10Set-VCSAUpdatePolicy -PasswordURL Password 11 12Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 13Set-VCSAUpdatePolicy -CheckSchedule Daily 14Set-VCSAUpdatePolicy -CheckSchedule WeeklySunday 15Set-VCSAUpdatePolicy -CheckSchedule WeeklyMonday 16Set-VCSAUpdatePolicy -CheckSchedule WeeklyTuesday 17Set-VCSAUpdatePolicy -CheckSchedule WeeklyWednesday 18Set-VCSAUpdatePolicy -CheckSchedule WeeklyThursday 19Set-VCSAUpdatePolicy -CheckSchedule WeeklyFriday 20Set-VCSAUpdatePolicy -CheckSchedule WeeklySaturday      Get-VCSAUpdateStaged Get-VCSAUpdateStaged is the command you will use when you want to wish to get information about the current staged update.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Get-VCSAUpdateStaged      Get-VCSAUpdateStatus Get-VCSAUpdateStaged is the command you will use when you want to wish to get information about the current update status. This command can be used to get status of staged update, install update or any other update status.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Get-VCSAUpdateStatus      Remove-VCSAUpdate Remove-VCSAUpdate is the command you will use when you wish to remove a staged update.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Remove-VCSAUpdate      Start-VCSAUpdateInstall Start-VCSAUpdateInstall is the command you will use when you wish to install a currently staged update. If no update is staged you must use Start-VCSAUpdateStageandInstall\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Start-VCSAUpdateInstall -Version \u0026#34;6.7.0.20100\u0026#34; -SSODomainPass \u0026#34;VMware1!\u0026#34;      Start-VCSAUpdatePrecheck Start-VCSAUpdatePrecheck is the command you will use when you wish to run the built-in update Precheck.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Start-VCSAUpdatePrecheck -Version \u0026#34;6.7.0.20100\u0026#34;      Start-VCSAUpdateStageandInstall Start-VCSAUpdateInstall is the command you will use when you wish to install and stage an update.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Start-VCSAUpdateStageandInstall -Version \u0026#34;6.7.0.20100\u0026#34; -SSODomainPass \u0026#34;VMware1!\u0026#34;      Start-VCSAUpdateValidate Start-VCSAUpdateValidate is the command you will use when you wish validate the current update.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Start-VCSAUpdateValidate -Version \u0026#34;6.7.0.20100\u0026#34; -SSODomainPass \u0026#34;VMware1!\u0026#34;      Stop-VCSAUpdate Stop-VCSAUpdate is the command you will use when you want to cancel an update task such as staging an update or other task that has a status of cancelable.\nExample:\n1Connect-CisServer -Server 192.168.1.51 -User administrator@vsphere.local -Password VMware1! 2Stop-VCSAUpdate      Putting the Powershell Module to Use This Examples assumes your VCSA has Internet Access and we will update via the Online Repo. You can access the Powershell Module here on GitHub.\n Important Note: The code samples included in this module are not supported by VMware. The code included is only provided as sample code for the purpose of demonstrating different tasks using the PowerCLI and the REST API.\n  Import the module  Import-Module .\\VCSA-VAMI-Patch.psm1   Check for Updates  Get-VCSAUpdate   Stage Update and Check Status  Copy-VCSAUpdate -Version \u0026quot;6.7.0.20100\u0026quot; and Get-VCSAUpdateStatus until status shows UPDATE_PENDING   Run Update Precheck and Validate  Start-VCSAUpdatePrecheck -Version 6.7.0.20100 and Start-VCSAUpdateValidate -Version 6.7.0.20100 -SSODomainPass VMware1! If no errors, proceed with Install   Run Update Install  Start-VCSAUpdateInstall -Version 6.7.0.20100 -SSODomainPass VMware1! and Get-VCSAUpdateStatus until you see status as UPDATE_COMPLETE   Validate Update Version in VCSA UI or in vSphere Client  Conclusion I hope this module can be useful for you to get started with updating your VCSA in a more Automated fashion. Big thanks to Steve Kaplan for taking time to review the module and provide feedback and input!\nIf you have any questions feel free to reach out here or on twitter @davidstamen\n","permalink":"https://davidstamen.com/2019/01/31/patching-the-vcenter-server-appliance-vcsa-using-the-rest-api-part-2-powershell-module/","tags":["PowerCLI","vSphere 6.7\"","REST API","vCenter Server","vSphere 7.0","Powershell","vSphere"],"title":"Patching the vCenter Server Appliance (VCSA) using the REST API - Part 2 (PowerCLI Module)"},{"categories":["VMware"],"contents":"I am a huge fan of Automating the vSphere Lifecycle process. The next step I wanted to cover was patching the vCenter Server Appliance (VCSA) using the REST API.\nI previously wrote about Automating your vCenter Server Upgrade and created a feature-walkthrough which covers vCenter Server Upgrade using the VCSA CLI.\nWith vSphere 6.7 VMware introduced new REST API\u0026rsquo;s. You can learn more about those using the VMware Code online documentation. VMware initially introduced the update REST updates in vSphere 6.5 but they were under tech-preview and limited. With full support in vSphere 6.7 I wanted to cover the REST API\u0026rsquo;s that are available to handle lifecycle of your VCSA.\nIntroduction For those of you who may not be familiar with REST API\u0026rsquo;s it might be intimidating to use them, however using tools such as Postman can make it a bit easier. Postman is a GUI based tool that allows you to create API samples to use and share. When I first was learning about APIs I was completely lost, however when I saw the VMware Code Team had Postman samples already created it helped me learn how to handle some APIs. However when browsing the samples, I had noticed there were no ones currently available for vSphere 6.7 Update REST API. Using the samples and the REST API documentation I was able to update and give back to the community and we will review the REST API based methods to patch your VCSA.\nPostman Collection I have done a pull request to get these added to the VMware Code Repository. However until that is complete, you can find a copy of the Postman samples on my Github here.\nExploring the API When it comes to exploring the available API\u0026rsquo;s we have a few options. The first is to read the documentation. When reviewing the documentation it will give you details such as the HTTP request, parameters and response but if you are not familiar with the API\u0026rsquo;s then this can be quite difficult.\n    This is where API Explorer comes in. API Explorer is available at https://fqdnOFvcsa/apiexplorer and it allows you to explore the API, not only do we give you details such as the HTTP, Parameters and Response but we actually allow you to try it out against the live environment and it will provide you the associated curl command and syntax along with the full response body of your request.\n    Using the API Explorer and documentation we can see the updates are broken down in into 5 main sections.\n* Cancel - Cancellation of an update currently in progress. * Get - Gets the status of the appliance update. * Pending - Allows the manipulation of pending updates. This includes listing, staging, install,precheck and validation. * Policy - Get's or set's the background check for the new updates. * Staged - Get's or delete's a staged update.  Usage of the REST API Using Postman  I will not go into the setup of Postman variables, but before proceeding up validate you have your Environmental Variables setup for vc, sso-password, user and password.\n Login and Logout of the VCSA REST API Just like using a GUI or a Script the first thing we must do is login. We have a Postman section to handle the Login/Logout to your VCSA Appliance. This will provide us the session authorization we need to move forward and proceed with the updates.\n    Checking for Updates When it comes to checking for updates, we can either check locally or locally and online in this example my VCSA has access to the internet so I will navigate to the Check vCenter Server Update - URL \u0026amp; CD-ROM section and Send this request to our VCSA. Once it finishes we will be provided the details of all pending updates. It will let us know the same values available in the UI such as the severity, release date, version and more.\n    The next few requests utilize a variable called version to populate this variable it is quite easy using Postman. If we highlight the version that was returned. We can right-click and for our environment we can set it for the version variable.\n    Checking the Update Details We will next review the vCenter Server Update - Version Details request. This will get details for the specific version update such as the name, version, priority and impact to the vCenter Server such as do services need to be restarted or does the appliance need to be rebooted.\n    Staging the Update Prior to installing any update they must be staged, we do have the ability to stage and install the update in one workflow, but I want to explorer the API\u0026rsquo;s available for staging the patch. The sample requests provide the ability to stage the update, get information on the staged update and delete the staged update.\n    Please note that when the update is staged the request will be complete but the update may not be fully staged yet. You can check the status of the staged update by using the vCenter Server Update - Status request. We can see below the Staging is in Progress\n    Now that the Update is staged we can see that the state is UPDATES_PENDING with the version that is staged.\n    Installing the Update When it comes to installing an update we will follow the workflow of precheck, validate and install. A feature that is included as part of the installation process is the ability to do a precheck. When executed it will review the VCSA details and provide any warnings or errors as well as the estimated time for the update to install.\n    If we previously staged our update we can run the vCenter Server Update - Install request, if we have not previously staged the update we will use the vCenter Server Update - Stage and Install. As soon as we hit send, the update starts but we will not be given any status.\nTo check the status of the update we will go back to the vCenter Server Update - Status request and execute it. Since the update does stop and restart services initially you might get a 503 service unavailable or be prompted to log back in and this is ok. If you wish to keep tabs on the update process keep sending the request to check for updates and login again if needed.\nWe can see that the API is now available again and the Update is in progress.\n    When it is complete we will see the state is UP_TO_DATE and our VCSA update is now complete.\n    Conclusion Using the REST API\u0026rsquo;s does not have to be hard especially when tied in with pre-built sample resources such as Postman requests. Hopefully this has been helpful for you to start the patching of your VCSA using the REST API\u0026rsquo;s.\nIf you have any questions feel free to reach out here or on twitter @davidstamen\n","permalink":"https://davidstamen.com/2018/12/20/patching-the-vcenter-server-appliance-vcsa-using-the-rest-api/","tags":["vSphere 6.7","REST API","vCenter Server"],"title":"Patching the vCenter Server Appliance (VCSA) using the REST API - Part 1 (Postman Collection)"},{"categories":["VMware"],"contents":"When trying to update your vSphere 6.5 environment to vSphere 6.5u2d it may show that there are no available updates.\nWhen you check for updates whether using the URL or CD-ROM Repository you may see Latest updates already installed on vCSA, Nothing to stage/install\n    This issue is due to the method the vCenter Server Appliance (VCSA) 6.5 update feature processes build numbering prior to VCSA 6.5 U1d. Some builds have been fixed such as 6.5f and 6.5u1c when we corrected issues for the root password expiry. However any 6.5 build less than 6.5u1d will be affected by this bug.\nRest assured we have a workaround and its quite easy. For more information lets look at KB59659\n     Log in as root via SSH or console session in vCenter Server Appliance. Run the command to enable the shell. shell Download the 59659_changebuild.sh script attached to this article. Using a supported tool, sftp/scp the 59659_changebuild.sh to the VCSA. Change the file name to changebuild.sh and copy it to /root on the vCenter Server Appliance. cp 59659_changebuild.sh /root/changebuild.sh Run the command to execute permission: chmod +x /root/changebuild.sh Run the command to execute the script: /root/changebuild.sh Proceed with the update.   Note: For information on using WinSCP to relocate files from a workstation to the vCenter Appliance, see Error when uploading files to vCenter Server Appliance using WinSCP\n Hope this helps if you come across this issue.\n","permalink":"https://davidstamen.com/2018/11/19/unable-to-update-to-vcenter-server-6.5-u2d-on-vcsa/","tags":["vSphere 6.5","vSphere Upgrade"],"title":"Unable to Update to vCenter Server 6.5 U2d on VCSA"},{"categories":["VMware"],"contents":"I am proud to announce availability of the new Upgrading to VMware vSphere 6.7 eBook.\nUpgrading to VMware vSphere 6.7, authored by Nigel Hickey and David Stamen is a free resource to assist customers and partners upgrading to vSphere 6.7.\n    The eBook further builds on the foundational guide Upgrading to VMware vSphere 6.5Â by Emad Younis which has been widely adopted when preparing an upgrade to vSphere 6.5. Our new eBook is complete with new information and scenarios for planning and executing your vSphere 6.7 upgrades. !\nUpgrading to VMware vSphere 6.7 eBook follows a 3 phase process to get you acquainted with how to plan and execute an upgrade to vSphere 6.7.\n Phase 1: Pre-Upgrade â€“ Information to use prior to upgrading. Links to resources that will assist in the planning of a successful upgrade. Phase 2: Upgrade â€“ Information on the correct process to upgrade and sample scenarios to guide you through the upgrade process. Phase 3: Post-Upgrade â€“ Information on day 2 operations once your upgrade is complete such as vCenter HA, Converge Tool and File-Based Backup and Restore.  We hope this resource will be able to assist you with successfully planning and executing a successful upgrade to vSphere 6.7. The eBook can be downloaded here.\n","permalink":"https://davidstamen.com/2018/11/19/upgrading-to-vmware-vsphere-6.7-ebook-now-available/","tags":["eBook","vSphere 6.7","vSphere Upgrade"],"title":"Upgrading to VMware vSphere 6.7 eBook - Now Available"},{"categories":["VMware"],"contents":"I recently deployed a couple new vSphere 6.7 labs and was having some issues running Check Compliance within Update Manager.\nAny time I would check compliance of my cluster I was immediately given an \u0026ldquo;There are errors during the scan operation. Check the events and log files for details.\u0026quot; error.\n    After doing some searching, I was able to find the vSphere Update Manager log and see if I could isolate my issue.\ntail -f /var/log/vmware/vmware-updatemgr/vum-server/vmware-vum-server-log4cpp.log\nAfter tailing the log I was able to identify that the hosts were having issues accessing a certain bundle that existed in my Update Manager repository.     From my management machine, I was able to successfully browse to the URL http://ds-vcsa-03.cpbu.lab:9084/vum/repository/hostupdate/vmw/ and download the metadata.zip     However, from my ESXi Servers I was unable to access the Update Manager Repository. Turns out the old adage is true, its normally either the network, DNS or NTP. Turns out when the hosts were deployed they did not have DNS servers defined, so sometimes if you encounter issues we need to go back to the basics and make sure we have our base configuration set correctly.\n","permalink":"https://davidstamen.com/2018/10/25/vsphere-update-manager-6.7-unable-to-scan-cluster/","tags":["Update Manager","vSphere 6.7"],"title":"vSphere Update Manager 6.7 Unable to Scan Cluster"},{"categories":["VMware"],"contents":"VMworld EU is around the corner and just like VMworld US I will be quite busy! If you are interested in where to find me, look below to see some my planned sessions.\nTAM Customer Events I will be doing quite a bit of TAM Events at VMworld EU. On TAM Day Monday I will be hosting 3 vSphere Lifecycle Specialist RoundTables, as well as will have a TAM Customer Session which is currently waiting a schedule.\nvSphere Lifecycle Specialist Roundtable\nCome discuss anything related to vSphere Upgrade or Sphere Lifecycle\nEU: TAM4501E - Monday - 11:15am-12:00pm\nEU: TAM4502E - Monday - 1:15pm-2:00pm\nEU: TAM4503E - Monday - 2:15pm-3:00pm\nUpgrading Your vSphere Environment to the Latest and Greatest\nEU: TAM1249E - Thursday 12:00pm - 1:00pm\nDoes upgrading your vSphere environment seem like an overwhelming task? Armed with the correct knowledge it doesn\u0026rsquo;t have to be! Join us as we review VMware resources that will help you get your environment running the latest and greatest version of vSphere 6.7. During this session you will gain new insight into tips \u0026amp; tricks, resources, and best practices to prepare and implement successful upgrades.\nCustomer Events vSphere Upgrades with Expert David Stamen\nEU: MTE5001E - Tuesday 12:15pm - 1:00pm\nThis roundtable session will be an opportunity to ask detailed questions in regards to the vSphere Upgrade process. Including discussions around vCenter, ESXi and interoperability with other VMware products.\nEU: MTE5001E - Wednesday 1:15pm - 2:00pm\nThis roundtable session will be an opportunity to ask detailed questions in regards to the vSphere Upgrade process. Including discussions around vCenter, ESXi and interoperability with other VMware products.\n Also, don\u0026rsquo;t forget to check out some of my colleagues great sessions too!\nKev Johnson and Nigel Hickey have a great workshop planned for VMworld EU on Monday\u0026hellip;\nUpgrading your vSphere Environment \u0026amp; What\u0026rsquo;s New with vSphere 6.7\nEU: VIN1365WE\nWith vSphere as your foundational hypervisor layer, keeping up to date is essential. Attend this workshop to learn the benefits of upgrading and the steps to ensure a successful upgrade from the vSphere Upgrade experts on the vSphere Technical Marketing team. Don\u0026rsquo;t know which release to upgrade to? Unsure how to get from point A to point B? Not even sure where to start? Or do you just want to confirm you plans are sound? This is the technical workshop for you!\nFocus, Plan, and Execute: A Deep Dive into Your vSphere Upgrade Journey\nEU: VIN1641BE\nUpgrades can be daunting, confusing, and occasionally even time consuming. Learn how to manage your VMware vSphere upgrade from vSphere 6.0 to 6.5 and beyond from VMware\u0026rsquo;s subject matter experts. You will see how to start the process by focusing on the goal of the upgrade, then planning your ideas and business requirements to meet your firmâ€™s needs and wants successfully, and lastly, making sure the execution of your ideas and plans are thought out, tested, and proven to be compatible with any other environment dependencies.\n Stay tuned for more! If you see me running around feel free to stop me I would love you meet you!\n","permalink":"https://davidstamen.com/2018/10/24/vmworld-eu-2018-sessions-events/","tags":["VMworld"],"title":"VMworld EU - Sessions and Events"},{"categories":["VMware"],"contents":"If you havent heard vSphere 6.7 U1 is now out and is loaded with all new features! If you have used 6.7 GA you may have noticed the Auto Deploy functionality did not yet make it into the long awaited vSphere Client. With vCenter Server 6.7 U1 we now have feature parity and this means Auto Deploy has been added to the vSphere Client. Lets jump in and see some of the new functionality that has been included.\nWhat is Auto Deploy? For those who may not be familiar with Auto Deploy I will give a brief overview on it. Auto Deploy allows you to utilize vCenter Server, a TFTP Server and Network Boot to automatically have hosts boot or install ESXi.\nThere are 3 types of Auto Deploy:\n Stateless - This feature allows you to have a host re-provisioned on each the hosts is rebooted with Auto Deploy. Stateless Caching â€“ This feature allows you to cache the host\u0026rsquo;s image locally on the host or on a usb drive and continue to provision the host with Auto Deploy. Stateful Installs â€“ This feature allows you to install hosts over the network without setting up a complete PXE boot infrastructure. After the initial network boot, these hosts boot like other hosts on which ESXi is installed.  More information on installing hosts using Auto Deploy can be found here.\nWhat\u0026rsquo;s New with Auto Deploy There have not been any major changes with Auto Deploy in vSphere 6.7 outside of some bug fixes and performance improvements, but 6.7 U1 included an updated workflow to manage Auto Deploy in the vSphere Client so let\u0026rsquo;s check out the new interface and see how we can configure Auto Deploy using the new interface.\nWe can now enable Auto Deploy and Image Builder in One-Click. No longer do we need to go into the services and edit the startup policy, and start the services.\n    When utilizing an Online Depot we can easily check for updates, view the software packages, image profiles and even export them as needed to be used in an offline software depot.\n    The workflow to create a deploy rule has also been simplified and can easily see patterns to add or use the default setting of all hosts.\n    We can also see the current deploy rules and choose to activate or deactivate and test them before activation\n    Conclusion So far I have loved using the vSphere Client as it has improved on many tasks we do as a VMware Administrator. Bringing all the configuration into a single UI also makes Auto Deploy easier to manage. Hopefully this has helped highlight some of the changes in vSphere 6.7 U1. Please reach out to me with any feedback!\n","permalink":"https://davidstamen.com/2018/10/18/whats-new-with-auto-deploy-in-vsphere-6.7-u1/","tags":["Lifecycle","AutoDeploy","vSphere 6.7"],"title":"What's New with Auto Deploy in vSphere 6.7 U1"},{"categories":["VMware"],"contents":"vSphere 6.7 Update 1 is finally here! Lets jump in and find out how and why to upgrade!\nWhy should I upgrade to vSphere 6.7 Update 1? vSphere 6.7 Update 1 has been a much anticipated release, it has many features folks have been waiting for some time. To highlight a few we now have a converge tool to migrate from an External PSC topology to an Embedded PSC topology, we now have a 100% Parity HTML-5 vSphere Client and more\u0026hellip;. My colleague Emad Younis has a great rundown on the new vSphere 6.7 Update 1 features.\nHow do I upgrade my vSphere Environment to vSphere 6.7 Update 1? Actually upgrading to vSphere 6.7 Update 1 can be quite easy, but we don\u0026rsquo;t just want to jump into the upgrade. We want to make sure we do some planning prior to performing our upgrade.\nPlanning for your vSphere Upgrade to vSphere 6.7 Update 1 Before we even begin to look at how to upgrade we need to make sure we don\u0026rsquo;t have any roadblocks that will stop us from upgrading. First, we want to review the vCenter Server 6.7 Update 1 and ESXi 6.7 Update 1 release notes.\nWhen reviewing the vCenter Server release notes we want to pay close attention to the Installation and Upgrade Notes for This Release section as we would highlight any blocked paths such as upgrading from vSphere 6.5 Update 2 to vSphere 6.7 GA. We also want to review the known issues section of the release notes to make sure that none of the current known issues would impact us once we have upgraded.\nOnce we have validated that we do not have any blockers to upgrade the next thing we want to do is validate compatibility. We need to validate with our 3rd party solutions such as backup, monitoring, security tools are compatible to the release are moving to. We also need to review the VMware Product Interoperability Matrices to make sure our VMware Products are Interoperable and we have a supported upgrade path as well. Last but not least we need to validate our hardware against the VMware Compatibility Guide or the ESXi Compatibility Checker Fling.\nIf we are using multiple VMware products and some are in need of upgrade we want to consult KB53710 which will tell us the update sequence for vSphere 6.7 and its compatible products. A key consideration here is that vCenter Server is actually #8 on the list so quite a few products may need to be upgraded prior to starting your core vSphere Upgrade.\nOne last thing to consider when planning your upgrade to vSphere 6.7 Update 1 is your deployment topology. With vSphere 6.5 Update 2 and vSphere 6.7 we now support Enhanced LInked Mode for Embedded vCenter Server deployments. However, this was only available for greenfield or expanded deployments. With vSphere 6.7 Update 1 we now include a converge tool that will allow you to migrate from an External PSC vCenter Server deployment to an Embedded PSC vCenter Server deployment. This is done as a post upgrade task and requires all PSC and vCenter Servers within the SSO domain to be upgraded to vSphere 6.7 Update 1 first.\nOnce we have reviewed and planned our upgrade we can now begin to actually perform our upgrade.\nPerforming your vSphere Upgrade to vSphere 6.7 Update 1 I covered the actual upgrade process in this blog series on Automating your vSphere Upgrade but we want to cover the specifics of upgrading to vSphere 6.7 Update 1.\nBefore starting our actual upgrade we want to make sure to backup our vCenter Server whether it is with the file-based backup or an image-based backup.\nPSC / vCenter Server There is no in-place upgrade to upgrade from 6.0 or 6.5, whether you are doing a migration (windows to vcsa) or upgrade (vcsa to vcsa) the process is the same, when utilizing the vCenter Server Appliance installer to upgrade we deploy a brand new vSphere 6.7 U1 appliance and then export and import the data. Do NOT try to attach the 6.7 U1 iso to your 6.0/6.5 appliance and upgrade in place as it will not work.\nWhen upgrading from vSphere 6.7 to 6.7 U1 this can be done through the vCenter Appliance Management Interface (VAMI). Please excercise caution when applying updates as folks may not realize that when going this route a major release could be occuring as it shows up as just a patch. This is where the planning stages we mentioned above come into place. The upgrade from vSphere 6.7 to 6.7 U1 is done as in-place upgrade so make sure you understand the upgrade plan depending on which version you are upgrading from.\nYou can find more information on upgrading your PSC/vCenter Server here.\nESXi Hosts As far as your ESXi hosts go, we do have a supported upgrade path to do an in-place upgrade. Doing some workshops with customers I have heard that in the past they have opted to not use vSphere Update Manager (VUM) and choose to either rebuild or attach the ISO manually and upgrade and this is definitely not ideal!\nThe recommended approach to upgrade your ESXi Hosts should be to utilize VUM to import the ESXi 6.7 U1 image, then create an upgrade baseline and remediate your cluster. This allows VUM to orchestrate the upgrades of the vCenter Server clusters and patch 1 host at a time without any impact to your running guests\nYou can find more information on upgrading your ESXi Hosts here.\nVM Tools / VM Compatibility Once your ESXi hosts have been updated to 6.7 U1 you may see that there are newer versions of tools available as well as a newer version of VM Compatibility (v14). VMware Tools should always be updated to the latest version, however when it comes to VM Compatibility we recomend only upgrading it when newer features need to be exposed. At a minimum you should be running v11 to protect against Spectre/Meltdown and only upgrading to v14 if you need features such as VBS, vTPM or Per-VM EVC.\nYou can find more information on upgrading your Virtual Machines here.\nConclusion When upgrading your vSphere environment, it does not help to rush and upgrade as soon as you can. To execute a successful upgrade it takes some planning to make sure you wont have any issues and need to rollback. Hopefully this has helped you and if you have any questions leave them below!\n","permalink":"https://davidstamen.com/2018/10/11/why-and-how-to-upgrade-to-vsphere-6.7-u1/","tags":["vSphere Upgrade","vSphere 6.7"],"title":"Why and How To Upgrade to vSphere 6.7 U1"},{"categories":["VMware"],"contents":"We are on the home stretch of our Automating your vSphere Upgrade blog series. The final step of completing our upgrade will be upgrading our Virtual Distributed Switch (VDS). When upgrading your VDS on vSphere 6.7 the version is actually 6.6 (we will cover the details later). Please make sure prior to upgrading your VDS to 6.6 all ESXi hosts have been upgraded to ESXi 6.7, if you still have hosts on ESXi 6.5 you will only be able to upgrade to version 6.5.\n    Considerations for Upgrading your Virtual Distributed Switch The first consideration we would like to think about is why would I want to upgrade my VDS? Well if you had previously upgraded from vSphere 5.5 your VDS still may be on version 5.5 and this is not compatible with vSphere 6.7. Another reason is that we can review the new features that are listed below, we can see this when we click on the (i**)** within the VDS GUI. We can see that upgrading to version 6.0 gets us NIOC v3 and IGMP/MLD snooping, version 6.5 gives us port mirroring enhancements and version 6.6 gets us mac learning. If you run any nested virtualization in your environment this is a great enhancement as we no longer require you to enable promiscuous mode on your VM port group.\n    Another consideration I like to recommend is that you keep your VDS upgraded to the same version as your ESXi hosts whenever possible. Previously in most vSphere versions it has always been said that upgrading your VDS can be done at anytime and is a non-disruptive upgrade., but we always want to use caution and do this within a maintenance window. The VDS upgrade is also something that has no rollback, once it is complete it is permanent unless you have completed a backup. With vSphere 6.7 and the introduction of VDS version 6.6 there are some known issues and considerations I want to mention prior to getting started upgrading our switch. A question I get asked quite frequently is why is vSphere 6.7\u0026rsquo;s VDS version 6.6? The answer is quite simple, VMware on AWS (VMC) shares quite a bit of the same code as vSphere On-Perm and since there were no major changes to the VDS features or functionality the version stayed the same. Prior to upgrading our VDS version to 6.6 we definitely want to make sure we review KB52621. This KB covers considerations around known issues upgrading to version 6.6. Some of these considerations are making sure to put DRS into partially automated mode since if a vMotion occurs during the upgrade the VDS upgrade will fail. To take these considerations into account, we will make sure to include this in our Upgrading your Virtual Distributed Switch automation. Prior to upgrading we also need to verify that all hosts have been upgraded to vSphere 6.7 so we do not have any errors. If there is a incompatible host attached the upgrade will not be allowed to proceed. To validate our ESXi host version for all hosts attached to our VDS we can do so as follows.\n1Get-VDSwitch \u0026#34;VDS\u0026#34;|Get-VMHost|Select Name, Version|Sort Name      We can see here that one of our hosts is not upgraded to 6.7 so if we were to proceed with upgrading our VDS it would fail. Before we proceed on to our next section we will make sure to upgrade our ESXi host to vSphere 6.7. If we were to attempt to upgrade our VDS prior to upgrading we would have encountered an error such as below.\n    Upgrading your Virtual Distributed Switch Now that we are ready to move forward with upgrading our VDS, we will take some of the above considerations into place. Since we know if a vMotion is occurring during upgrade it will fail. We will make sure that if DRS is enabled we will put it into Partially Automated mode. Also, since we know we cannot rollback from a version upgrade we will make sure to take a backup prior to our upgrade. Unlike our previous blogs where we used simple one-liners, we will utilize a bit more logic in this upgrade that will be required as a script. As an introduction to the below script we will outline what it does. At the top we define variables for the VDS Name, Version we wish to upgrade to and the cluster(s) in which the VDS is attached. We will then check if DRS is enabled on the vSphere Cluster. If DRS is enabled we will store the current DRS Automation level and set it to Partially Automated, Backup the VDS, Upgrade the VDS and then we will restore the DRS Level back to the original state. If DRS is disabled, we perform a Backup of the VDS and then Upgrade the VDS. You can see theÂ code below and grab the script from GitHub.\n1Connect-VIServer \u0026#34;ds-vcsa-03.cpbu.lab\u0026#34; | Out-Null 2$VDSwitch = \u0026#34;VDS\u0026#34; 3$VDVersion = \u0026#34;6.6.0\u0026#34; 4$Cluster = Get-Cluster \u0026#34;Cluster\u0026#34; 5 6If ($Cluster.DrsEnabled -like \u0026#34;True\u0026#34;) { 7 Write-Host \u0026#34;DRS is Enabled, it will be temporarily disabled during upgrade.\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; 8 $ClusterDRSLevel = $Cluster.DrsAutomationLevel 9 Write-Host \u0026#34;DRS Cluster is currently set to $ClusterDRSLevel. Will change back when complete.\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; 10 Get-Cluster $Cluster | Set-Cluster -DrsAutomationLevel \u0026#34;PartiallyAutomated\u0026#34; -Confirm:$false 11 Get-VDSwitch -Name $VDSwitch | Export-VDSwitch -Description \u0026#34;My Backup\u0026#34; -Destination \u0026#34;/PathToBackup/VDSBackup-$VDswitch-$((Get-Date).ToString(â€˜yyyy-MM-dd-hh-mmâ€™)).zip\u0026#34; 12 Get-VDSwitch -Name $VDSwitch | Set-VDSwitch -Version $VDVersion 13 Write-Host \u0026#34;Upgrade is complete. Setting Cluster to $ClusterDRSLevel.\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; 14 Get-Cluster $Cluster | Set-Cluster -DrsAutomationLevel $ClusterDRSLevel -Confirm:$false 15} 16ElseIf ($Cluster.DrsEnabled -like \u0026#34;False\u0026#34;) { 17 Write-Host \u0026#34;DRS is Disabled, No additional action needed.\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; 18 Get-VDSwitch -Name $VDSwitch | Export-VDSwitch -Description \u0026#34;My Backup\u0026#34; -Destination \u0026#34;/PathToBackup/VDSBackup-$VDswitch-$((Get-Date).ToString(â€˜yyyy-MM-dd-hh-mmâ€™)).zip\u0026#34; 19 Get-VDSwitch -Name $VDSwitch | Set-VDSwitch -Version $VDVersion 20}      As we can see the upgrade is now complete. Even though the upgrade is itself a simple one-liner:\n1(Get-VDSwitch -Name $VDSwitch | Set-VDSwitch -Version $VDVersion) We can automate the pre-requisites, backups and considerations to make this a more seamless upgrade.Â If you are interested in understanding how you can upgrade your VDS through the UI please see my colleague Nigel Hickeys blog here.\nYou can find more information on Backing Up and Restoring your VDS here and more information on Upgrading your Virtual Distributed Switch here.\nConclusion As we have now completed Automating our vSphere Upgrade we can see it wasnâ€™t so bad after all. Im hoping this series has helped you better understand what it takes to Automate your vSphere Upgrade and for those of you with large environments it gives you an idea on how you can start to streamline the upgrades across your entire vSphere environment.\n Cross-Posted from vSphere Blog\nhttps://blogs.vmware.com/vsphere/2018/10/automating-upgrade-of-virtual-distributed-switch.html\n","permalink":"https://davidstamen.com/2018/10/08/automating-the-upgrade-of-the-virtual-distributed-switch/","tags":["vSphere Upgrade","Networking","VDS"],"title":"Automating the Upgrade of the Virtual Distributed Switch"},{"categories":["VMware"],"contents":"Next up in our Automating your vSphere Upgrade blog series is your VMFS Datastore. vSphere 6.5 and vSphere 6.7 both support the latest VMFS-6. Once all of your ESXi hosts that are connected to the VMFS-5 datastore have been upgraded to vSphere 6.5 or vSphere 6.7 you can then proceed to migrate your datastore to VMFS-6.\n     Please note that vSphere 6.7 no longer supports VMFS-3. Prior to upgrading your ESXi host you should do an upgrade from VMFS-3 to VMFS-5 or they will be upgraded automatically during the Host upgrade.\n Migrating from VMFS-5 to VMFS-6 When we start our migration of our datastore\u0026rsquo;s to VMFS-6 you may be wonderingâ€¦ Do I need to? What are the benefits? As we can see below graphic there was quite a few enhancements in support for Automatic Space Reclamation, In-Guest Space Reclamation and native support for 4K native storage.\n    You will also see that we have mentioned migrating from VMFS-5 to VMFS-6. Due to the underlying storage changes to support 4K Native storage as well as other features the metadata has changed and the upgrade cannot be done In-Place. The migration requires you to delete the current datastore and re-create. In a later section we will cover how to automate this process.\nYou can find out more information on vSphere 6.7 Storage enhancements here.\nChecking Current VMFS Version In case you are not sure what VMFS version your datastore is currently running, we can find out with a simple PowerCLI one-liner.\n1Get-Datastore | Select Name, FileSystemVersion      Here we can see that DS01 is still at VMFS-5 and DS02 has already been upgraded to VMFS-6. In the next section we will target upgrading our datastore to VMFS-6.\nUpdating VMFS Version When it comes to migrating to VMFS-6 we have a few methods. A good reference to use is KB2147924, this KB covers the supported methods and ways to update your VMFS version. My colleague Nigel Hickey has covered how to do GUI based upgrades of VMFS. However, when you have many datastore\u0026rsquo;s it may help to automate this process.\nAs we reference the above KB it mentions a PowerCLI cmdlet called Update-VMFSDatastore. This is an powerful tool that acts a bit different than your standard PowerCLI cmdlet, it is very verbose and detailed with the checks that it does. However, there are also some considerations to take into account when using it.\nA few considerations when using it are as follows:\n Requires use of datastore cluster and have a temporary VMFS-5 datastore of equal or greater capacity. Issues storage vMotion requests to the temporary datastore. Validates that no unsupported VMs exist on the datastore such as those with SRM, VADP, VRM or Clustering. Will temporarily disable Storage DRS and enable once complete.  If cmdlet fails enabling storage DRS is a manual effort.   Carefully review the usage of the Resume and Rollback parameters in case of any errors.  So now that we know some things to look out for what does the cmdlet actually do?\n Checks for VADP, SMPFT, MSCS/RAC virtual machines on Source Datastore. Makes sure datastore is accessible to all hosts. Validates Temporary datastore has sufficient capacity. Modifies Storage DRS Automation to manual Moves VM and orphaned data from Source to Temp datastore. Unmount Source Datastore Recreate Source Datastore as VMFS-6 Moves VM and orphaned data from Temp to Source datastore. Restores Original Storage DRS setting.  Now that we understand how it works, lets jump into the usage.\n1Connect-VIServer ds-vcsa-03.cpbu.lab 2 3$Source = Get-Datastore \u0026#34;DS02\u0026#34; 4$Temp = Get-Datastore \u0026#34;DS-TEMP\u0026#34; 5$Server = (Get-VIServer -Server \u0026#34;ds-vcsa-03.cpbu.lab\u0026#34;) 6 7Update-VmfsDatastore -Datastore $Source -TemporaryDatastore $Temp -TargetVmfsVersion \u0026#34;6\u0026#34; -Server $Server It requires very minimal input, we will put in the source datastore, the temporary datastore, vCenter Server and the Target VMFS version.Â     The above animated gif will show the process. It is quite simple and if you encounter errors they will be logged and you can rollback using the rollback parameter of if the error can resumed you can use the resume parameter.\nYou can see more information on the usage of Update-VMFSDatastore at the PowerCLI Reference.\nConclusion It is always great to see some native tools to assist us in accomplishing complicated tasks. For those who have an abundance of datastore\u0026rsquo;s in their environment, this cmdlet can save quite a bit of time. If you have used it, leave some feedback on your thoughts. Next up on our series will be Automating Your Virtual Distributed Switch upgrade.\n Cross-Posted from vSphere Blog\nhttps://blogs.vmware.com/vsphere/2018/10/automating-migration-of-vmfs-5-to-vmfs-6-datastores.html\n","permalink":"https://davidstamen.com/2018/10/07/automating-migration-of-vmfs-5-to-vmfs-6-datastores/","tags":["vSphere Upgrade","Storage"],"title":"Automating Migration of VMFS-5 to VMFS-6 Datastores"},{"categories":["VMware"],"contents":"Next up in our Automating your vSphere Upgrade blog series is your VMware Tools and VM Compatibility. Upgrading these both have different requirements so we will cover when and how you should upgrade your VMware Tools and VM compatibility in the below post.\n    Upgrading VMware Tools When it comes to keeping your VMware Tools up to date we have a few options but I will focus on two of my favorite methods. Keeping VMware tools up to date is very important as VMware includes drivers and tools to make sure your VM\u0026rsquo;s run optimally with the latest features. Eric Gray of our CPBU Technical Marketing Team covers a few considerations and methods in depth in the following blog post Six Methods for Keeping VM Tools Up to Date.\nChecking VMware Tools Compliance Before we can start to update our VMware Tools it might be a good idea to understand which VMs in our environment are currently out of compliance, the easiest way to check if a VM if out of compliance is to view it via the vSphere Client and it will show you details such as the version and compliance.\n    However, since we are talking about automation lets show this another way using PowerCLI.\n1Get-Folder -name Testing | Get-VM | % { get-view $\\_.id } | select name, @{Name=â€œToolsVersionâ€; Expression={$\\_.config.tools.toolsversion}}, @{ Name=â€œToolStatusâ€; Expression={$\\_.Guest.ToolsVersionStatus}}|Sort-Object Name Using this PowerCLI one-liner we are able to see more information at scale, we can see that within our folder we actually have 3 VMs that are out of compliance. To remediate these to the latest version its actually quite simple with PowerCLI as well.     To make the information clearer on what needs an update we will use the same search only looking for VMs where ToolStatus is guestToolsNeedUpgrade. To do that we will use the following one-liner.\n1Get-Folder -name Testing | Get-VM | % { get-view $\\_.id } |Where-Object {$\\_.Guest.ToolsVersionStatus -like \u0026#34;guestToolsNeedUpgrade\u0026#34;} |select name, @{Name=â€œToolsVersionâ€; Expression={$\\_.config.tools.toolsversion}}, @{ Name=â€œToolStatusâ€; Expression={$\\_.Guest.ToolsVersionStatus}}| Sort-Object Name      Upgrading VMware Tools via PowerCLI Now that we know which VMs need tools update we can actually go forth and upgrade tools. That is quite simple we can do this using the Update-Tools PowerCLI cmdlet. Using our existing one-liner from above we will just append Update-Tools to update the VMs with tools currently out of compliance.\n1Get-Folder -name Testing | Get-VM | % { get-view $\\_.id } |Where-Object {$\\_.Guest.ToolsVersionStatus -like \u0026#34;guestToolsNeedUpgrade\u0026#34;} |select name, @{Name=â€œToolsVersionâ€; Expression={$\\_.config.tools.toolsversion}}, @{ Name=â€œToolStatusâ€; Expression={$\\_.Guest.ToolsVersionStatus}}| Update-Tools -NoReboot -VM {$\\_.Name} -Verbose      You may have noticed that all the VMs had their updates kicked off at the same time and this may not be ideal, this is one way that the Update-Tools cmdlet works, however we can get around this by storing the VMs within a variable and then using a loop process them one at a time. This is definitely preferable as it will limit the impact to the environment.\n1$OutofDateVMs = Get-Folder -name Testing | Get-VM | % { get-view $\\_.id } |Where-Object {$\\_.Guest.ToolsVersionStatus -like \u0026#34;guestToolsNeedUpgrade\u0026#34;} |select name, @{Name=â€œToolsVersionâ€; Expression={$\\_.config.tools.toolsversion}}, @{ Name=â€œToolStatusâ€; Expression={$\\_.Guest.ToolsVersionStatus}} 2 3ForEach ($VM in $OutOfDateVMs){Update-Tools -NoReboot -VM $VM.Name -Verbose}      Now our tools are up to date! For more information on upgrading your VMware Tools via PowerCLI you can find more information here. Upgrading Tools Automatically on Reboot Using VM options to keep VMware Tools up to date is also another method to automatically keep VMs up to date. Enabling the \u0026ldquo;Check and upgrade VMware Tools before each power on\u0026rdquo; advanced setting use to not be used because of the additional reboot it would cause for virtual machines. Keep in mind that with Windows Server 2016Â VMware Tools no longer need a reboot on upgrade, it can be safe to enable this setting and have VMs stay up to date on every reboot. However this may not be applicable to all situations, so another recommendation would be to enable this for a lab environment or non-critical workloads. The easy way to enable this option is to log into the vSphere Client, edit the VM settings and enable the setting.\n    After all this a post on automation, so lets see if we can find a way to use PowerCLI to modify the VM\u0026rsquo;s setting so this gets easier when we have a large environment.\n1Get-Folder Testing|Get-VM|Get-View | select name,@{N=\u0026#39;ToolsUpgradePolicy\u0026#39;;E={$\\_.Config.Tools.ToolsUpgradePolicy } } |Sort Name      Here we can see which VMs have the automatic upgrade set and which ones are configured for manual. Utilizing a filter we can look for objects that are set for manual and then configure them to be set for upgradeAtPowerCycle\n1$ManualUpdateVMs = Get-Folder Testing|Get-VM|Get-View | Where-Object {$\\_.Config.Tools.ToolsUpgradePolicy -like \u0026#34;manual\u0026#34;}|select name,@{N=\u0026#39;ToolsUpgradePolicy\u0026#39;;E={$\\_.Config.Tools.ToolsUpgradePolicy } } 2 3Foreach ($VM in ($ManualUpdateVMs)) { 4$VMConfig = Get-View -VIObject $VM.Name 5$vmConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec 6$vmConfigSpec.Tools = New-Object VMware.Vim.ToolsConfigInfo 7$vmConfigSpec.Tools.ToolsUpgradePolicy = \u0026#34;UpgradeAtPowerCycle\u0026#34; 8$VMConfig.ReconfigVM($vmConfigSpec) 9}      If we do a final check we can see that all VMs are now set to upgradeAtPowerCycle.\n    Upgrading VM Compatibility When it comes to upgrading your VM Compatibility this is something that should be done with caution. Upgrading VM Compatibility aka VM Hardware is like pulling out the motherboard and replacing it with a new one, so this should only be done when features and functionality in a higher level are needed. Our current recommended level is Hardware Version 11 as it handles remediation from current security threats. Prior to upgrading your VM Compatibility you should always make sure VMware Tools are up to date first as new drivers can be required for the new virtual hardware. As I mentioned previously prior to upgrading your VM Compatibility I recommend taking a snapshot or a backup of the virtual machine in case a rollback is needed. Checking VM Compatibility Version Its quite easy to see the current version of VM Compatibility via the vSphere Client, however when checking the current levels across our entire vCenter Server we may want to automate this Below you will find a quick and easy one-liner to identify the VMs and their current VM Compatibility version.\n1Get-folder Testing | Get-VM | Select Name, Version | Sort Name      As we can see above a few VMs are currently running v14 which is compatible with vSphere 6.7 only. This was needed for us to take advantage of VBS and TPM security features. Again, we should only upgrade VM Compatibility when additional functionality is needed.\nUpgrading VM Compatibility Version We have identified a need to upgrade VM08 also to v14 to take advantage of Per-VM EVC so we can handle the automation of the VM compatibility upgrade. We can do this again quite easily with PowerCLI. If you wish to do this via the vSphere Client my colleague Nigel Hickey covers this in his blog series here. However, we are talking automation here so lets jump into the quick script to accomplish this.\n1$HardwareUpdateVMs = Get-Folder Testing | Get-VM VM08 2 3Foreach ($VM in ($HardwareUpdateVMs)) { 4$VMConfig = Get-View -VIObject $VM.Name 5$vmConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec 6$vmConfigSpec.ScheduledHardwareUpgradeInfo = New-Object -TypeName VMware.Vim.ScheduledHardwareUpgradeInfo 7$vmConfigSpec.ScheduledHardwareUpgradeInfo.UpgradePolicy = â€œalwaysâ€ 8$vmConfigSpec.ScheduledHardwareUpgradeInfo.VersionKey = â€œvmx-14â€ 9$VMConfig.ReconfigVM($vmConfigSpec) 10}      This will not automatically upgrade the VM Compatibility, unlike VMware Tools this can not be done with the virtual machine Powered On. The next time the VM is rebooted it will be shutdown, the compatibility will be upgraded and then be powered back on.\nMore information on upgrading VM Compatibility can be found here.\nConclusion Automating your VMware Tools and VM Compatibility upgrades do not need to be hard, we have quite a few ways to help you with this and help this blog has helped educate you on some additional methods. For more information on Automating your vSphere Upgrade be sure to check out the full series here.\n Cross-Posted from vSphere Blog\nhttps://blogs.vmware.com/vsphere/2018/09/automating-upgrade-of-vmware-tools-and-vmware-compatibility.html\n","permalink":"https://davidstamen.com/2018/10/06/automating-upgrade-of-vmware-tools-and-vm-compatibility/","tags":["vSphere Upgrade","VM Tools","VM Compatibility"],"title":"Automating Upgrade of VMware Tools and VM Compatibility"},{"categories":["VMware"],"contents":"The first topic we will cover in our Automating your vSphere Upgrade series is updating our core infrastructure.Â Upgrading Platform Services Controller(PSC)Â and vCenter Server via the CLI installer. In our workshops one of the common things I hear is that most folks aren\u0026rsquo;t using the CLI based tools that have been included in the installer. I am a huge fan of these as they make migrations and upgrades seamless\u0026ndash;especially when having to perform the task if you have multiple PSC\u0026rsquo;s and vCenter Servers. Using the CLI tools donâ€™t have to be intimidating, as we go through this blog we will cover some how-to\u0026rsquo;s and benefits of using the CLI based approach.\n    When we start our vSphere Upgrade the first thing we want to do is to upgrade our PSC and vCenter Server before updating other components. If we happen to be using an Embedded PSC deployment the upgrade is simple, we can do the upgrade in one step (Step 1 and Step 2 combined). However, if we are using an External PSC deployment we must upgrade all of our PSC\u0026rsquo;s within the same SSO domain first prior to upgrading any vCenter Servers\u0026ndash;so this becomes a multi-step process.\n    For this upgrade scenario we will be performing an upgrade from an External PSC deployment using appliances on vSphere 6.0 to an External PSC deployment using appliances on vSphere 6.7.\nPrepare Your JSON Configuration File for CLI Upgrade When doing a CLI based upgrade, we use a configuration file template (JSON) that is part of the vCenter Server Appliance (VCSA) ISO. When you mount the ISO you will see a directory labelled vcsa-cli-installer and within that folder is a directory called templates. Once you are here you have the option to see the CLI templates for install, migrate and upgrade. As a reminder a migration is when we are moving from a vCenter Server on Windows, and an upgrade is when we are moving from VCSA to VCSA.\nSince we are doing an upgrade we will browse to that folder and we are left seeing a vcsa6.0 and vcsa6.5 directory. The information we need when coming from each version is different so there is a unique set of templates for each version. Since we are upgrading from a vSphere 6.0 deployment we will head into the vcsa6.0 directory.\nOnce we are in this directory we can see a few different templates. We have a template for an embedded deployment, external PSC and external vCenter Server. Each template has an associated version whether or not we will be connecting to a vCenter Server or an ESXi host directly. The embedded template is for an embedded deployment which does both PSC and vCenter Server at the same time as we mentioned above, and the PSC and VCSA are separate templates as we need to do these one at a time.\n    Since we have an External PSC deployment and we are using a vCenter Server, we will first open the PSC_on_VC.json.\n    When opening this file at first glance you might say WOAH! That looks complicated, but there is quite a bit of extra text explaining each field. Lets fill in the blanks with the required information and take another look.\n    This looks a lot better, we can clearly see the details it is asking for. The vCenter Server to deploy the new appliance to, the appliance information, the temporary IP to use, and then last but not least the source information for the appliance we are upgrading. If we have a deployment where there are multiple PSC\u0026rsquo;s we could see how easy it would be to make a copy of this file, and edit lines 17 and 41 putting in the second PSC and then re-saving. How much time saving could this be!? With vSphere 6.5 allowing 10 PSC\u0026rsquo;s per SSO domain and vSphere 6.7 allowing 15 this could be quite a bit of time saved!\nNext up, its time to upgrade our vCenter Server. To get our JSON file ready we will head back and grab the vCSA_on_VC.json template. Also remember that if you happen to have multiple VCSA\u0026rsquo;s to upgrade you can easily update lines 16 ,17 and 40 to upgrade other appliances in your environment.\n     Certain sensitive fields such as passwords can be left blank if chosen. When the CLI installer is run it will prompt for the password during runtime.\n Now that we have prepared our templates for our upgrade, the next section we will jump into how to actually perform our upgrade using the CLI. More information on preparing the JSON template can be found here.\nUpgrade a vCenter Server Appliance or Platform Services Controller Appliance by Using the CLI CLI templates in hand, its now for the fun. Using these templates we will automate our upgrade. vSphere 6.0 originally introduced this concept of a CLI based tool, however its been enhanced with vSphere 6.7. With vSphere 6.7 we now have a \u0026ldquo;batch template\u0026rdquo; technology built into the installer. Prior to vSphere 6.7 we had to run the installer against a single JSON file and wait for it to finish, we would then have to manually kick off the second JSON file when the previous one completes. With the batch upgrade we can put multiple JSON files into a single directory and point the installer to the directory and it is smart enough to map out the dependencies and upgrade the PSC\u0026rsquo;s first and then the vCenter Servers.\nBefore we actually perform our upgrade, I want to explain some of the benefits of the CLI installer. If we happened to be using the GUI based upgrade, everything in that upgrade would have to be manually entered into the GUI and obviously that is susceptible to typos and errors. Also, if we happened to enter some incorrect information and had to retry our upgrade we would again have to re-type all that information. What if we had a way to perform an upgrade test without ever touching our production environment? With the CLI Installer we do! And its called a pre-check. When running the CLI installer with the --precheck-only flag we have the ability to go through a full dry run of our upgrade. If we happened to have a typo, insufficient capacity or any other errors it would spit this out, and we could easily correct the settings.\nTo run our CLI based installer we will mount our vSphere 6.7 media as that is the version we are going to. We will again navigate to the vcsa-cli-installer directory. From here depending on the operating system of the machine we are on we will either navigate to the lin64, win32 or mac folder to use the supported installer for that operating system.\nHere we will see quite a few files, but the one we want to focus on is vcsa-deploy.exeÂ in the win32 folder since I will be running this from a windows machine. If we run .\\vcsa-deploy.exe upgrade it will give us the details on how to properly use the CLI tool.\n    As I mentioned previously one of the benefits of using the CLI tool is that you can execute a pre-check of your template against the environment to make sure things will pass. Usually with upgrades and migrations a big issue we see with them failing is due to a smaller appliance size being chosen for the new appliance or insufficient capacity in the vCenter Server environment. In this environment we will execute our vcsa-deploy utilizing the pre-check option and see our results.\nTo run the pre-check I ran the following command: .\\vcsa-deploy.exe upgrade --no-ssl-certificate-verification --accept-eula --acknowledge-ceip --precheck-only C:\\scripts\\\\6.7\\upg60to67\\\nI chose to point this to the folder to take advantage of the batch upgrade vs pointing it to the individual file, as I mentioned earlier it is smart enough to map out the dependencies as we can see from the below image.\n    Once the pre-check runs through we will either get a success or failure. In the image below my vCenter Server services were not running so the pre-check failed.\n    Now that we have the service running and re-run our pre-check we can see everything is successful and we can now proceed to remove the \u0026ndash;precheck-only flag from our command.\n    .\\vcsa-deploy.exe** **upgrade --no-ssl-certificate-verification --accept-eula --acknowledge-ceip C:\\scripts\\\\6.7\\upg60to67\\\nThe upgrade process is now happening without any additional user input. If you need to step away for lunch or if a co-worker needs you there is no additional action that is needed until the end. If you were using the GUI based approach once Stage 1 where the appliance is deployed is complete you have to manually start Stage 2 to configure the upgraded appliance. With the CLI based installer this is not needed. When our upgrade is complete we will be presented with the vCenter Server and login information as we can see below.\n    More information on Upgrading your PSC and vCenter Server via the CLI can be found here.\nConclusion Automating your vSphere Upgrade does not have to be scary or hard, as we went through the steps its actually quite easy. Now that we have our PSC and vCenter Server updated we can now proceed to our next step which is automating the upgrade of our ESXi hosts.\n Cross-Posted from vSphere Blog\nhttps://blogs.vmware.com/vsphere/2018/09/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer.html\n","permalink":"https://davidstamen.com/2018/10/05/upgrading-platform-services-controller-and-vcenter-server-via-the-cli-installer/","tags":["vSphere Upgrade","vSphere 6.5","vSphere 6.7","PSC","vCenter Server"],"title":"Upgrading Platform Services Controller and vCenter Server via the CLI Installer"},{"categories":["VMware","Security"],"contents":"On Tuesday August 14th, Intel Released their news on the latest vulnerability L1 Terminal Fault (L1TF) or ForeShadow. In response to this VMware released vSphere patches to address the issues. Since then I have seen quite a few threads come up and thought i would address them from a patching perspective.\nI wanted to clarify when remediating your vSphere you should make sure to address the update sequence in the correct order. vCenter Server MUST be patched prior to updating ESXi.\nIn some cases I have seen users patching ESXi before their vCenter Server resulting in generic errors such as xxx esx.problem.hyperthreading.unmitigated.formatOnHost not found xxx or esx.problem.hyperthreading.unmitigated\nKB57374 has been created to inform users on details of this error.\nHowever if done properly, once ESXi is patched after vCenter Server you would see the following warning on your ESXi host.\nOnce you have performed the remediation on the hosts to correct all aspects that warning will now go away.\nPlease stay tuned to KB55806 and VMSA-2018-0020 for any updates to the remediation steps.\n","permalink":"https://davidstamen.com/2018/08/15/l1-terminal-fault-l1tf-patching-considerations/","tags":["L1TF","Vulnerability"],"title":"L1 Terminal Fault (L1TF) Patching Considerations"},{"categories":["VMware"],"contents":"This will be my first VMworld attending as an employee and quite a bit of things will be going on. Just in case anyone was interesting in vSphere Upgrades I wanted to share out some key sessions that I recommend including my own.\nA good reference guide for vSphere Events has been posted here.\nNigel Hickey and myself will be quite busy, we will start off our week at VMworld delivering two vSphere Upgrade workshops on Sunday with a possible repeat on Monday for TAM customers unable to attend.\nUpgrading your vSphere Environment \u0026amp; What\u0026rsquo;s New with vSphere 6.7\nWorkshops will be held on Sunday, August 26 from 8am to 12pm and 1pm to 4pm at the Luxor, Casino Level, Galleria A.\nWhile not doing workshops we have two sessions as well as i will be available during our Meet the Expert (MTE) sessions.\nPreparing to Upgrade Your vSphere Environment\nUS: VIN2664BU\nJoin us as we review VMware sources that will help you prepare to upgrade your vSphere environment. Whether it is a small or large environment, you will have new insight into resources, best practices and tips and tricks to prepare and implement a successful upgrade.\nFocus, Plan, and Execute: A Deep Dive into Your vSphere Upgrade Journey\nUS: VIN1641BU\nLearn how to manage your VMware vSphere upgrade from vSphere 6.0 to 6.5 and beyond from VMwareâ€™s subject matter experts. You will see how to start the process by focusing on the goal of the upgrade, then planning your ideas and business requirements to meet your firmâ€™s needs and wants successfully, and lastly, making sure the execution of your ideas and plans are thought out, tested, and proven to be compatible with any other environment dependencies.\nvSphere Upgrades with expert David Stamen\nUS: MTE5001U\nThis roundtable session will be an opportunity to ask detailed questions in regards to the vSphere Upgrade process. Including discussions around vCenter, ESXi and interoperability with other VMware products.\nHere are also some other recommended vSphere Upgrade sessions.\nNerds with Appliances: vCenter Server Migration\nUS: VIN2410BU\nThis session will cover native tools provided by VMware to help guide you toward a successful migration from a vCenter Server on Windows to a vCenter Server Appliance.\nMake Your vSphere 6.7 Upgrade Bulletproof\nUS: VIN2660BU\nIn this session, a team of vSphere solution architects in VMware Support will walk you through preparing a vSphere environment to run on the latest version. Solution architects are uniquely positioned to distill the top vSphere 6.7 upgrade issues into necessary tips and tricks to avoid stretching out your maintenance window.\nvSphere SSO Domain Architecture Unplugged\nUS: VIN1859BU\nIn this session, you will see best practices for greenfield and brownfield deployments of VMware vCenter Server and Platform Services Controller orchestrated on a digital whiteboard. You will learn the answers to age-old questions such as embedded or external deployment, to load balance or not to load balance, what is Enhanced Linked Mode, how to consolidate your single sign-on (SSO) domain, and more.\n","permalink":"https://davidstamen.com/2018/07/18/vmworld-2018-sessions-events/","tags":["VMworld"],"title":"VMworld 2018 - Sessions and Events"},{"categories":["VMware"],"contents":"On May 22nd we released the first update to our vCenter Server 6.7 version, 6.7a. I will let you know how you can patch your 6.7 GA vCenter Server to 6.7a.\nThe first thing we will do is review the vCenter Server 6.7a Release notes.\nThe update process is quite simple, we can either use the VMware Appliance Management Interface (VAMI) or the CLI.\nIf we choose to use the VAMI, we can either choose to download the update from the online repository, or download the patch and mount it directly to the vCenter Server.\nYou can download the patch from the VMware Patch Portal\n Attach the VMware-vCenter-Server-Appliance-6.7.0.11000-8546234-patch-FP.isoâ€‹ file to vCenter Server Appliance CD or DVD drive. SSH to the appliance as root and run the the commands given below:   To stage the ISO: software-packages stage \u0026ndash;iso To see the staged content: software-packages list \u0026ndash;staged To install the staged rpms: software-packages install \u0026ndash;staged   Attach the VMware-vCenter-Server-Appliance-6.7.0.11000-8546234-patch-FP.isoâ€‹ file to vCenter Server Appliance CD or DVD drive. Login to VAMI https://fqdn-of-vcenter:5480 Click on Update, and then in top right corner select Check Updates -\u0026gt; Check CD Rom Select Update, and select Stage and Install.   Login to VAMI https://fqdn-of-vcenter:5480 Click on Update, and then in top right corner select Check Updates -\u0026gt; Check CD-Rom + URL Select Update, and select Stage and Install.  KB55683 has been created with the workaround information.\n Login to VAMI https://fqdn-of-vcenter:5480 Click on Update, and then in top right corner select Settings. In Custom URL copy and paste the following URL. https://vapp-updates.vmware.com/vai-catalog/valm/vmw/8d167796-34d5-4899-be0a-6daade4005a3/6.7.0.10000.latest/ When you check for updates from URL, it should now properly list the patches.  We are currently investigating the above issue and will update with any official KB or documentation when available.\nNow its time to do one last read of the product documentation and release notes and go upgrade!\n","permalink":"https://davidstamen.com/2018/05/23/patching-your-vcenter-server-appliance-from-6.7-to-6.7a/","tags":["vCenter Server","vSphere 6.7"],"title":"Patching your vCenter Server Appliance from 6.7 to 6.7a"},{"categories":["VMware"],"contents":"It\u0026rsquo;s finally out! vSphere 6.7 is the next major release of VMware\u0026rsquo;s virtualization software. I\u0026rsquo;ve been using 6.7 through the vSphere Beta Program and testing even newer features in my current role. I am here to talk to you about planning your vSphere upgrade and some planning and considerations you should have when going to the latest release.\nThe first, thing I would like to mention is there is no supported migration from vSphere 5.x to 6.7. You must be running vSphere 6.0 or 6.5.\nAs we did with 6.5 and even more with 6.7 we are now calling the vCenter Server Appliance the default deployment. Why you ask? Well vSphere 6.7 is now the last release to support the Windows installer. So if you happened to upgrade to 6.5 and are still on Windows, you now have a supported upgrade path to the appliance on vSphere 6.7.\nSome key considerations with changed topologies as well. We now support Enhanced Link Mode (ELM) with embedded deployments. This means if you have a greenfield deployment, where you have 1 embedded deployment, you can now deploy a second embedded deployment and use ELM. However if you currently have two 6.0/6.5 embedded deployments in separate SSO domains and wish to upgrade to 6.7, there is no way yet to use ELM.\nAnother considerations is we have removed what we called sites within SSO domains, this means there is now a lot more flexibility when planning your Platform Services Controller topology. With 6.7 we have enhanced the cmsso-util utility where you now can repoint to a PSC within the same SSO or across sites. You also now have the ability to repoint across SSO domains, so this will definitely help with consolidating environments (external PSC deployments only).\nAnd of course, if you are already on vSphere 6.5 an wondering why should I go to 6.7? Here are some key features that have improved the overall experience!\n HTML5 Client  VMware Update Manager integrated into the vSphere HTML5 Client More Supported Workflows   VAMI Built in Backup Scheduler w/ Retention in the VAMI Improved Services View (no longer need to go to vSphere Client) Improved Disk View Improved Monitoring (CPU, Memory, Network and Database) Improved Updates (Now you can select updates to install) Syslog now supports up to 3 targets ELM with Embedded deployments Performance Improvements Security Enhancements  VBS vTPM and TPM 20 Encrypted xVC vMotion    and more\u0026hellip;.\nEmad Younis has made a great post on 6.7 with a Whats New Feature Rundown, so I suggest you check it out.\nand for even more information make sure to check out the vSphere 6.7 Launch Blogs\n","permalink":"https://davidstamen.com/2018/04/17/upgrading-to-vmware-vsphere-6.7/","tags":["vSphere 6.7","vCenter Server","vSphere Upgrade"],"title":"Upgrading to VMware vSphere 6.7"},{"categories":["Awards"],"contents":"I am honored to have been selected as a VMware vExpert once again for 2018!\nThis is my sixth year as a vExpert (2013,2014,2015,2016,2017 and 2018). It has been great to see the community grow and the amount of vExperts increase. Now that my new role will have me travelling and presenting more, I look forward to meeting up with many new and existing vExperts this year!\n    ","permalink":"https://davidstamen.com/2018/03/12/vexpert-2018/","tags":["vExpert"],"title":"vExpert 2018"},{"categories":["Personal"],"contents":"Life can always surprise you. For the past few years I have been chasing the dream like most to work for the â€œmothershipâ€ and recently the calling came.\nThis month, I will be joining the CPBU at VMware as a Technical Marketing Engineer focused on vSphere upgrades. I will be working alongside Adam Eckerle, Emad Younis, Kyle Ruddy, Mike Foley, Brian Graf, Nigel Hickey and more!\nNigel has it perfect when he titled his announcement â€œOh the places youâ€™ll goâ€. This job will include quite a bit of travel, both domestic and international, and I couldnâ€™t be more excited.\nI am extremely glad to have a great support system at home from my wife and kids. I am also grateful for the #vCommunity as well for everything that has happened to allow me to pursue this dream.\nThe past few years working at Avast Software have been great. Through different teams, bosses and acquisitions it has helped me grow stronger. I will miss all my colleagues greatly.\nBut now to focus on the future and what comes next\u0026hellip;..\nTo Infinity and Beyond!\n","permalink":"https://davidstamen.com/2018/02/06/to-infinity-and-beyond/","tags":["Career"],"title":"To Infinity and Beyond"},{"categories":["VMware"],"contents":"Another lovely Friday starting off with strange issues, when taking a host out of standard maintenance we noticed that HA would not reconfigure, and kept saying The object \u0026lsquo;vim.Datastore:datastore-1131\u0026rsquo; has already been deleted or has not been completely created. This was strange because no other hosts had this issue.     I proceeded to follow standard troubleshooting steps, reconfigure HA\u0026hellip;same issue\u0026hellip;.disable HA for entire cluster and re-enable\u0026hellip;..same issue\u0026hellip;whoops thats not good!\nFirst step, check what luns are available to the cluster.\n1Get-Cluster $cluster | Get-Datastore | Select Name, ID | Sort ID      Seems that 1131 is missing..\nSometimes the more tools you have available to you, the easier it is to troubleshoot an issue. As part of my daily processes we have an automated script to execute and emails us an RVTools report so I can easily keep track of inventory objects in my vCenter, I went back a few days and was able to identify the lun, datastore and NAAID of this object.\nUsing vRealize Log Insight (Free for up to 25 OSI\u0026rsquo;s, in my case i only have my vCenter for logs) I was able to search for the NAAID and see exactly when and what happened to this lun\u0026hellip;.it was removed.\n    With this newfound information I went and spoke to our storage team, this lun was removed because it was no longer being used by Cluster1. Turns out This lun was zoned to two different clusters, but only used for VMs in Cluster1. Cluster2 in turn was using it for HA heartbeat. In my case to get HA to use a different lun, i chose option 3. Just in case lun\u0026rsquo;s ever get removed again. However after reconfiguring HA it still was trying to use the lun that was removed.\n    Resolution:\nUse Option 2 - Once I selected two specific datastores, I was able to reconfigure HA and no longer had any errors. At this point you can reconfigure HA Datastore Heartbeat to your standard settings and reconfigure the cluster once again.\nHow to Prevent This?\nAlways remove luns the right way, its a lot more work, but can prevent issues like this in the future.\n Unmount Datastore from all hosts Detach lun from all hosts (if LUN is used for HA, it wont let you) Unmap from storage array.  You can also use the following script to detach lun\u0026rsquo;s if you have a bunch of lun\u0026rsquo;s and/or hosts. You will need to unmount the datastores first before running.\nhttp://davidstamen.com/2015/09/14/using-powercli-to-detach-luns/\n","permalink":"https://davidstamen.com/2018/01/19/reconfigure-ha-the-object-vim.datastoredatastore-xxxx-has-already-been-deleted-or-has-not-been-completely-created/","tags":["vCenter Server","Storage","HA"],"title":"Reconfigure HA - The object 'vim.Datastore:datastore-XXXX' has already been deleted or has not been completely created"},{"categories":["Blog"],"contents":"Happy New Year! So towards the end of the year I kind of slacked on writing some blog posts, when I finally did I realized I had no clue how to create a post. I know\u0026hellip;I know this is terrible, however its still much better than wordpress. I stumbled across an awesome tool that would help you manage your hugo/jekyll website Forestry.io\nIt is quite simple, you login with your Github, Bitbucket, etc account and it can detect your existing repositories. From here, click on Add Site.\nFrom here you will select whether it is a huge or jekyll project, and select which version you wish to have the site built with (later is better!)\nFrom here you will choose where to import your project from, in my case i choose github. You will be prompted to login, and then choose a public or private repo.\nYou will now select which repository and branch you wish to choose. Choose a name, and URL (optional)\nThen you will select how you wish Forestry to publish your site, you can choose from none, back to the source repo, github pages, ftp, and many many more. save your changes and your site will be processed and you are almost ready to go!\nWe can see it imported my 3 pages, 112 posts, my site parameters, menus, media and front matter. One thing to note, it uses its own front matter templates for your posts, but will import yours in, but if you make any changes be careful as it only appends and doesn\u0026rsquo;t overwrite.\nDig into the settings and theres lots you can do. Its free for one user and seems logically priced to add more features/users. However i think this will be good to get my started on my blog post.\nIf you are curious on testing it out, clone your repo, use that, commit the source to the local repo and use the built in preview to check it out.\nThis post was entirely written using the CMS service in the WYSIWYG editor.\nI didn\u0026rsquo;t have to update any markdown manually. (I checked to make sure the formatting is correct!)\n","permalink":"https://davidstamen.com/2018/01/02/using-forestry.io-to-manage-your-hugo-blog/","tags":["Hugo","Forestry.io"],"title":"Using Forestry.io to Manage Your Hugo Blog"},{"categories":["Certification"],"contents":"So today I successfully passed the VMware Certified Advanced Professional 6.5 â€“ Data Center Virtualization Design Exam 3V0-624!\nI had set a personal goal at the beginning of the year, that I would pass the VCAP6-DCV Design and unfortunately after months of studying I took it and failed in March. I was ready to give up based on the cost of the exam and the time i spent studying. However, I found out recently that a new version based on 6.5 was released in August and the Visio like design sections were dropped (which were the biggest pain), so I worked to acquire a voucher from work and decided on 3 days ago since I had some downtime at work I would go for it.\nThe first thing i did was pull up the 6.5 exam guide. I was surprised it was not detailed at all in the blueprint breakdown, id did have a lot more information on what to expect question wise. So my first recommendation is if you plan to take the 6.5 exam, use the 6.0 blueprint. I also made a post VMware Certified Advanced Professional 6 â€“ Data Center Virtualization Design Guide (3V0 622) that broke it down as well with links to all the documentation.\nEven with that I still felt a little lost on what to expect, there have not been a lot of blog posts about the experience with the 6.5 exam. All I knew is that it was 60 questions, that were multiple choice, matching, drag and drop and I had 135 minutes to complete it. After some digging I was able to find out Hersey Cartwright was the only person I was able to find who posted briefly about what to expect, and I think it definitely helped me a lot. Here were some of his tips, and a few of mine..\nCouple of tips for the exam:  Read the Exam Prep Guide!!! Everything you need to be successful is there (except experience).  Definately read through this to understand some of the types of questions that will be asked!   When taking the exam MAKE SURE YOU READ THE QUESTION or DESIGN SCENARIO completely, then read it again before selecting your answers or completing the question activity.  Some questions can be answered multiple ways, make sure to read it over and over and completely understand it, dont read the first line and jump to the end   You are able to flag questions for review â€“ but use this wisely. If you are prepared trust your gut donâ€™t second guess yourself.  As always be cautious! Your first instinct may be right   Take your time. Since there are no Visio style questions you are given plenty of time (IMHO) to complete the exam. Relax, read the question, answer, move on.  I completed the first pass in about an hour, the drag and drop and matching questions took a bit of time, but some of the multiple choice answers were very easy to answer and move ahead. It left me plenty of time to review and check things   Technical tip: Have a deep understand of dependencies required for, and limitations of, vSphere features and services and how these dependencies may impact the ability to meet a design requirement or may introduce risks into a design.  This 100%, you need to understand all the components of a vSphere deployment including interoperability, upgrades and features. Please make note on what features would be available in 6.0 and 6.5 and upgrades!   AMPRS  I could not say this any more, make sure to know about your Availability, Management, Performance, Recoverability and Security sections!   RCAR  You NEED to know Risks, Constraints, Assumptions and Requirements. Just like AMPRS, if you don\u0026rsquo;t have a solid understanding of this you will definitely fail this exam.   Functional vs Non-Functional Requirements  Make sure to understand this as well, it is key    Interface Feedback This was one thing I think they did much better, however there were some caveats.\n With some of the drag and drops, it was hard to review you work as when you brought over the statement, you could no like see what it was assigned to without removing it. On an example with diagrams, it would not let me move forward until I enlarged them all, once I did that it still refused. After a few minutes i realized one of the examples had scroll bars up and down and left and right, and even through the complete diagram was in view, I had to use the scroll bars to proceed. I was glad it did this, to prevent you from moving on and missing something, but the fact that multiple images were the same size and only 1 had scroll bars could be related to a UI issue.  Study Materials As far as study materials? I used quite a few. I will list them below and will add and update this blog as i remember a few more.\nvBrownbag VCAP Series\n Not only did I look over the 6.0 series, I went back and reviewed some of the 5.5 ones as well as a lot of the information carried over.  vSAN 6.2 Essentials book\n If i needed to know about vSAN, what is a better place to learn?  VMware vSphere 6.x Datacenter Design Cookbook\n This was Hersey Cartwright\u0026rsquo;s book, that had tons of information, and was probably my primary point of studying the last 3 days.  VCAP5-DCD Official Cert Guide (VMware Press)\n Yes. This is many versions ago, however the core principals still apply and the information within is still valid minus changes in vSphere versions.  Community\n Tons of users in the community have created countless study guides and exam feedback, my last half day of studying was just reviewing these things and trying to reinforce what I already know.  Whats Next Now? I met my yearly goal, and am now a VCIX! I am very proud of this achievement and appreciate everyone who helped me along the way. People asked me about my VCDX, and I think that will wait a bit\u0026hellip;but you never know what will happen in the future.\n","permalink":"https://davidstamen.com/2017/12/21/vcap6.5-dcv-design-experience/","tags":["VCAP6.5-DCV Design"],"title":"VCAP6.5-DCV Design Experience"},{"categories":["Office"],"contents":"I have been looking for a new desk for awhile. Working from home I do not get to go into an office, or walk around to meet up with coworkers. I found myself sitting for way too long which hasn\u0026rsquo;t been best for the low back and leg pains I experience.\nI heard from a friend that getting a standing desk may be something that would be good. Standing desks come in all shapes and sizes but I knew from the start that I wanted a dedicated standing desk and just not a riser (one that sits on an existing desk).\nUpon doing research there were quite a few companies I began to research. StandDesk.co Autonomous and Fully were the ones I based my feedback on as they met my requirements of a few things, mainly price.\nThere are quite a few resources to start your search. Here are some i used.\n Work While Walking BTOD Reddit-StandingDesk and Reddit-StandingDesks  and of course the company websites themselves.\nIn the end i ended up choosing StandDesk.co\u0026rsquo;s StandDesk Simple with the Brown Bamboo top. They do give you the option of just buying a stand and using your own top separately. However I was not up to the job this time around to find one, there is a lot of recommendations to use ones from Ikea, but I wanted to get a whole package that would be protected and warrantied through one company.\nOne great thing so about StandDesk is some of the other companies offer a 1 year warranty on a desk in this range. StandDesk offers a 30 day full price guarantee, and a 5 year warranty.\nAnother positive about this desk was the installation. Doing my research I read about nightmares installing some standing desks. It was compared to Ikea instructions with many pieces and being very difficult. I was surprised to have a very nice instruction book included that was extremely clear. The install probably took me somewhere between 30-60 minutes as I had children running all over the place during the install.\nIn the end I am very pleased with the desk and quality. The support team reached out as soon as I placed my order and tracked my shipment, the day it was delivered they sent me a personal message making sure it arrived properly and if I had any questions about the installation to contact them at any moment.\nIf you are in the market for a desk, I would definately check them out!\nIf you use the following referral link, you can also save $30.\n","permalink":"https://davidstamen.com/2017/08/24/my-new-desk-by-standdesk/","tags":["StandDesk"],"title":"My New Desk by StandDesk"},{"categories":["VMware"],"contents":"So it seems to be that time of year again with new projects coming around. This time its all about vRA. This is probably my first of many blogs to come about things I have come across.\nMy question today was how do I pre-create a computer AD account, join a device to the domain and then clean it up when the machine is destroyed.\nTurns out this is super simple in vRealize Automation 7.3!\nTIP: If you want to practice or follow along you can use HOL-1733-SDC-1 (vRealize Automation 7.2: What\u0026rsquo;s New)\nvRealize Automation 7.1 introduced the ability to place new machines in specific Organizational Units based on Business Group membership or a specific blueprint. To accomplish this, the following steps must be completed in vRealize Automation.\n Create an Active Directory Endpoint Create an Active Directory Policy Assign the Policy to a Blueprint or Business Group.  Create an Active Directory Endpoint  Log in to vRA as a tenant administrator. Navigate to the Administration Tab and select vRO Configuration. From here we will choose Endpoints and create a new Active Directory endpoint. Name the endpoint. (I suggest the domain name) Enter in the ldap server hostname or IP. Set the port 389 or 636(SSL) Set the Base DN for your lookups. Select if using SSL or not. Enter in the default domain name Enter in a user that will have rights to create, delete and move computer objects. Enter the Password.  Now your Active Directory Endpoint should be created and we can proceed to the next step.\nCreate an Active Directory Policy  Log in to vRA as a tenant administrator. Navigate to the Administration Tab and select Active Directory Policies. Click new and Set an ID (This cannot be changed, I set mine to be domainNameouName) Select the previous Active Directory Endpoint you created. Enter in your domain name Enter in the OU you wish the accounts to be created in.  Now your Active Directory Policy should be created and we can proceed to the next step.\nAssign the Policy to a Business Group.  Log in to vRA as a tenant administrator. Navigate to the Administration Tab, select Users \u0026amp; Groups and then Business Groups. Edit an existing or create a new business group. Update the Active Directory Policy to be the policy you created above.  Now your Active Directory Policy is assigned to the Business Group and we can proceed to the next step. Testing!\nMake sure you have a customization specification set on your blueprint that will join to the domain and kick it off, you should see the account get created and the machine deployed.\nOnce you destroy the machine, the account will be deleted and voila lifecycle is complete.\nHope this helps anyone, and if you have questions feel free to reach out on social media.\n","permalink":"https://davidstamen.com/2017/08/vra-73-using-active-directory-policies/","tags":["vRA"],"title":"vRA 7.3 - Using Active Directory Policies"},{"categories":["VMware"],"contents":"vSphere 6.5U1 was released on July 27th. This is an incremental update a lot of people wait for before upgrading from a previous version. I have been lucky to have been running on vSphere 6.5 for quite some time and have been enjoying it very much.\nObviously we never upgrade production first, if we can help it. I decided to attempt an upgrade on one of our QA vCenters that was deployed using the VCHA Advanced workflow. I followed my standard upgrade steps Updating a VCHA 6.5 vCenter however when I went to failover the Active node to the upgraded passive/witness nodes, services would not start, I then noticed that the hostnames had reset to localhost.localdom which is kind of a big issue as vCenter relies on the hostname being set.\nI was able to workaround this issue temporarily by setting the hostname correctly in /etc/hostname and /etc/hosts to be able to recover from the failure and break VCHA. Luckily i had a snapshot to rollback to as well.\nNow we had this one upgraded, I still could not re-enable VCHA. I went through the process to configure VCHA, however every time I would deploy the passive/witness it would still reset the hostname, and when I went to finalize the configuration it would fail because the passive/witness hostnames did not match the active node. It seemed the issue was not with the servers themselves but possibly with some updated scripts that sync certain configuration files.\nI was able to find someone else who could reproduce this issue and we both opened a case with is being investigated by engineering.\nUpdate. Finally heard back from support. So it seems in some cases the VAMI configuration can be \u0026ldquo;corrupt\u0026rdquo; and can cause the hostname to reset.\nAfter upgrading your appliance, if you see the hostname reset, you can run the following command to reconfigure it properly.\n1/opt/vmware/share/vami/vami_config_net Once I used the configuration script to reconfigure the hostname I was successfully able to redeploy VCHA.\n","permalink":"https://davidstamen.com/2017/08/02/vcenter-6.5u1-update-issues-with-vcha-advanced-deployment/","tags":["vCenter Server","vSphere 6.5","vCenter HA"],"title":"vCenter 6.5U1 Update Issues with VCHA Advanced Deployment"},{"categories":["Blog"],"contents":"Another New Blog Platform! So it seems there is a bit of battle between the Jekll/Hugo/Ghost platforms. I have been trying to be a little more flexible with Jekyll and it was giving me issues, so I decided to switch to Hugo. After doing the redesign I have been getting feedback that it is much cleaner, so I hope you enjoy it too!\nAll links should be functional and moved nicely, if they dont work, please leave a comment!\n","permalink":"https://davidstamen.com/2017/07/31/another-new-blog-platform/","tags":["Hugo"],"title":"Another New Blog Platform"},{"categories":["VMware"],"contents":"I have been working on doing a vCenter Consolidation Project. This included migrating our systems to a new vRealize Operations Server. This particular one included 73 different vSOM keys, and as you may know there is currently no way to enter in multiple keys at a time. I reached out to Kyle Ruddy and he informed me there is an API to do this, and that started my adventure to get this working.\nPre-Requsites  VMware PowerCLI  Preparing to Execute the Script The script is pretty straight forward, you can either export the license keys from an old vRealize Operations Server (6.6+) or create a CSV with column (LicenseKey) to be imported.\nIf you are choosing to export keys from an existing server, it has to be on a version that currently has API support. (I used v6.6)\nYou can run the following script to export all keys to a csv file.\n1$Cred = Get-Credential 2$vrom = \u0026#34;vromold.lab.local\u0026#34; 3 4Connect-OMServer -Server $vrom -Credential $Cred 5 6$omServer = $global:DefaultOMServers[0].ExtensionData 7$omLicense = $OmServer.GetLicenseKeysForProduct() 8$omLicense.Solutionlicense|Export-Csv C:\\temp\\omkeys2.csv -NoTypeInformation If you exported the keys above, you should be immediately ready to import the keys to your new vRealize Operations Server, if not you can manually create the csv as listed above.\n1$Cred = Get-Credential 2$vrom = \u0026#34;vromnew.lab.local\u0026#34; 3 4Connect-OMServer -Server $vrom -Credential $Cred 5 6$keys = import-csv c:\\temp\\omkeys.csv 7foreach ($key in $keys) { 8 $solutionLicense = New-Object VMware.VimAutomation.VROps.Views.SolutionLicense 9 $solutionLicense.LicenseKey = $key.LicenseKey 10 $solutionLicenses = New-Object VMware.VimAutomation.VROps.Views.SolutionLicenses 11 $solutionLicenses.Solutionlicense = $solutionLicense 12 $omserver.AddLicenseKeyToProduct($solutionLicenses) 13} The documentation was pretty spotty on this as it stated you only needed to pass the key to AddLicenseKeyToProduct(), but after multiple tests I realized that was not true. I eventually found out i have to create SolutionLicense objects and link them till i got the proper format. This was quite fun as i learned alot about PowerShell and API documentation in this process.\nYou can find API documentation for vRealize Operations at https://fqdn/suite-api/docs/rest/index.html\nHope this helps you out, leave any feedback or questions below.\n","permalink":"https://davidstamen.com/2017/07/27/using-powercli-to-add-vrealize-operations-license-key/","tags":["vROPS","PowerCLI"],"title":"Using PowerCLI to Add vRealize Operations License Key"},{"categories":["Ubiquiti"],"contents":"I have been waiting for native GUI support for L2TP vpn with local users and it is finally here! Ubiquiti Unifi Equipment now supports local radius auth using the 5.5.x code of controller! Please see below on how you can get this setup. For my example i will be using the Stable Candidate 5.5.11.\nUnifi Controller 5.5.11\nConfiguration is quite simple! Just follow these few easy steps and you will be up in no time.\n The first step is to create your radius profile. to do this browse to Settings and then Profiles. Here you will create a name for your radius profile, the only thing you will change here is the IP Address of your USG and then set the Password/Pre Shared Secret. When done hit save.   Next up on the configuration is the Radius Service Configuration. Browse to Settings and Services.  First up is the user, select Users and then enter in the following details.  Name: username Password: password to be used for client conenctivity VLAN: leave blank Tunnel Type: 3 (For L2TP) Tunnel Medium Type: 1 (For IPv4)       Next up on the Radius Service configuration is the Server Configuration.  Click on Server under Servers/Radius and Enable Radius Server.  The only thing you will do here is set the L2TP Secret.       Next up on the configuration is to browse to Settings and Networks.  Here you will create a new network with the following details..  Purpose: Remote User VPN VPN Type: L2TP Server Pre Shared Key: This is the secret you configured for the Radius Server. Gateway/Subnet: IP Information for your VPN Clients Other: Fill in other fields as needed.      Once everything is complete you will now have an extra bubble with VPN statistics!\nNothing else is needed! Once the Unifi USG provisions it automatically adds in the needed firewall rules, you can now configure your normal L2TP client to connect.\n","permalink":"https://davidstamen.com/2017/04/25/configuring-unifi-controller-and-usg-for-l2tp-vpn/","tags":["Unifi","VPN","Networking","USG"],"title":"Configuring Unifi Controller and USG for L2TP VPN"},{"categories":["VMware"],"contents":"I have been working on doing a vCenter Consolidation Project. This has meant recreating multiple permissions groups. I couldnt find an easy way to apply permissions at a datacenter so I updated this script to be used.\nPre-Requsites  VMware PowerCLI  Link to Script  Set-vCenterPermissions.ps1 permissions.csv  Preparing to Execute the Script The script is pretty straight forward, just need to update columns in the CSV such as Datacenter, Group and Role.\nThis script assumes you have already launched PowerCLI and modified the csv\n1# PowerCLI Script for setting vCenter Permissions base don AD Group and Datacenter 2# @davidstamen 3# http://davidstamen.com 4 5param 6( 7 [Parameter(Mandatory=$False, 8 HelpMessage=\u0026#39;Path to CSV to Import\u0026#39;)] 9 [string[]]$permissionlist 10) 11 12#Import PowerCLI Module 13Get-Module -ListAvailable VMware* | Import-Module 14 15#Prompt for vCenter to Set Permissions 16$vCenter = Read-Host -Prompt \u0026#34;Name or IP address of vcenter\u0026#34; 17 18#Makes sure CSV was passed as parameter, if not it prompts and checks path. 19If($permissionlist -eq $NULL){ 20 $permissionlist = Read-host -Prompt \u0026#34;Csv to import\u0026#34; 21} 22If((Test-Path $permissionlist) -eq $False){Write-host \u0026#34;Could not find CSV.\u0026#34;;break} 23 24#tries to connect to vcenter and breaks script if it fails. 25Try{Connect-viserver $vCenter -ErrorAction \u0026#34;Stop\u0026#34;|Out-Null} 26Catch {Write-Warning \u0026#34;Unable to Logon to $vCenter. Exiting...\u0026#34;;break} 27 28#define variables and loop through each entry setting permissions 29$permission = Import-csv \u0026#34;$permissionlist\u0026#34; 30foreach ($item in $permission) { 31 $datacenter=$item.datacenter 32 $role=$item.role 33 $group=$item.group 34 $domain=$item.domain 35 36 Write-host \u0026#34;Setting $group permissions to $role on $vCenter\u0026#34; -ForegroundColor Green 37 $Permission=New-VIPermission -Entity (Get-Datacenter $datacenter) -Principal (Get-VIAccount -Domain $domain -Group|Where-Object {$_.Name -like \u0026#34;*$group*\u0026#34;}) -Role (Get-VIRole $role) -Propagate:$true|Out-Null 38} Execute the Script  Run .\\Set-vCenterPermissions.ps1 .\\permissions.csv  ","permalink":"https://davidstamen.com/2017/04/17/using-powercli-to-set-vcenter-permissions-on-datacenter/","tags":["PowerCLI","vCenter Server"],"title":"Using PowerCLI to Set vCenter Permissions on Datacenter"},{"categories":["Awards"],"contents":"I am honored to have been selected as a VMware vExpert once again for 2017!\nThis is my fifth year as a vExpert (2013,2014,2015,2016 and 2017). It has been great to see the community grow and the amount of vExperts increase. I did a quick count, and in 2016 we are up to 1464 vExperts!\n","permalink":"https://davidstamen.com/2017/02/08/vexpert-2017/","tags":["vExpert"],"title":"vExpert 2017"},{"categories":["VMware"],"contents":"Warning: A few others and myself have noticed that when updating a VCHA Cluster to 6.5U1 it resets the hostname to localhost.localdomain stopping vCenter Web Client from Loading. It seems to be isolated to Advanced Deployments and not Basic. I would recommend destroying your VCHA Cluster, updating, then redeploying in this scenario. Warning2: It also seems that if you try to redeploy VCHA Advanced after an upgrade, it still resets the hostname, I have a case opened and will update here as neccessary.  The first vSphere 6.5 Patch (6.5a) was just released! So far it seems there are a few critical fixes but the biggest feature is NSX 6.3 support.\nvCenter Server 6.5a Release Notes\nESXi Server 6.5a Release Notes\nYou can find patch information here. https://kb.vmware.com/kb/2148330\n To download patch do not go to my.vmware.com, you need to navigate to the VMware Patch Download Center(https://my.vmware.com/group/vmware/patch) and select VC from the Search by Product drop down, and then vSphere 6.5 You will then download the VMware-vCenter-Server-Appliance-6.5.0.5200-4944578-patch-FP.iso  Now that we have all the files we need, we can proceed with the actual upgrade.\n  Log into the vSphere webclient and put the vCenter HA into Maintenance Mode. Maintenance mode means replication still occurs but automatic failover is disabled.\n  Under Settings, select vCenter HA and click Edit.\n  Select Maintenance Mode and click OK.\n    SSH as root to the appliance shell of the Active Node using the Public IP.\n Note: Make sure you are not in shell but in appliancesh    While in SSH of the active node, SSH to the witness node IP.\n Note: Make sure you are not in shell but in appliancesh    We will now install the patches to the witness node.\n You will need to attach the patch .ISO you downloaded previously, as you cannot update straight from the URL since the witness/passive do not have internet access. To stage the patches run the following command.  software-packages install \u0026ndash;iso \u0026ndash;acceptEulas      1Command\u0026gt; software-packages install --iso --acceptEulas 2 [2017-02-03T07:46:10.034] : Validating software update payload 3 [2017-02-03T07:46:10.034] : Validation successful 4 [2017-02-03 07:46:10,986] : Copying software packages [2017-02-03T07:46:11.034] : ISO mounted successfully 534/34 6 [2017-02-03T07:46:21.034] : ISO unmounted successfully 7 [2017-02-03 07:46:21,745] : Running test transaction .... 8 [2017-02-03 07:46:22,757] : Running pre-install script..... 9 [2017-02-03T07:46:24.034] : All VMware services are stopped. 10 [2017-02-03 07:46:24,977] : Upgrading software packages .... 11 [2017-02-03 07:47:01,087] : Running post-install script..... 12 [2017-02-03T07:47:02.034] : Packages upgraded successfully, Reboot is required to complete the installation.   We will now reboot the witness node.\n To reboot the witness node, while still in appliancesh run the following command.  shutdown reboot -r \u0026ldquo;patch reboot\u0026rdquo;      While in SSH of the active node, SSH to the passive node IP.\n Note: Make sure you are not in shell but in appliancesh    We will now install the patches to the passive node.\n You will need to attach the patch .ISO you downloaded previously, as you cannot update straight from the URL since the witness/passive do not have internet access. To stage the patches run the following command.  software-packages install \u0026ndash;iso \u0026ndash;acceptEulas      1Command\u0026gt; software-packages install --iso --acceptEulas 2 [2017-02-03T12:56:57.034] : Validating software update payload 3 [2017-02-03T12:56:57.034] : Validation successful 4 [2017-02-03 12:56:57,376] : Copying software packages [2017-02-03T12:56:57.034] : ISO mounted successfully 534/34 6 [2017-02-03T12:57:07.034] : ISO unmounted successfully 7 [2017-02-03 12:57:07,957] : Running test transaction .... 8 [2017-02-03 12:57:08,966] : Running pre-install script..... 9 [2017-02-03T12:57:10.034] : All VMware services are stopped. 10 [2017-02-03 12:57:10,684] : Upgrading software packages .... 11 [2017-02-03 12:57:34,750] : Running post-install script..... 12 [2017-02-03T12:57:36.034] : Packages upgraded successfully, Reboot is required to complete the installation.   We will now reboot the passive node.\n To reboot the passive node, while still in appliancesh run the following command.  shutdown reboot -r \u0026ldquo;patch reboot\u0026rdquo;      Once the witness and passive nodes are online we will do a manual failover of the cluster.\n Log in to the vSphere Web Client select the vCenter and click Configure. Under Settings, select vCenter HA and click Initiate Failover. Click Yes to start the failover.    SSH as root to the appliance shell of the active node using the public IP.\n Note: Make sure you are not in shell but in appliancesh    While in SSH of the active node, SSH to the new passive node IP.\n Note: Make sure you are not in shell but in appliancesh    We will now stage the patches to the new passive node.\n You will need to attach the patch .ISO you downloaded previously, as you cannot update straight from the URL since the witness/passive do not have internet access. To stage the patches run the following command.  software-packages install \u0026ndash;iso \u0026ndash;acceptEulas      1Command\u0026gt; software-packages install --iso --acceptEulas 2 [2017-02-03T08:10:27.034] : Validating software update payload 3 [2017-02-03T08:10:27.034] : Validation successful 4 [2017-02-03 08:10:27,512] : Copying software packages [2017-02-03T08:10:27.034] : ISO mounted successfully 534/34 6 [2017-02-03T08:10:37.034] : ISO unmounted successfully 7 [2017-02-03 08:10:37,780] : Running test transaction .... 8 [2017-02-03 08:10:38,790] : Running pre-install script..... 9 [2017-02-03T08:10:40.034] : All VMware services are stopped. 10 [2017-02-03 08:10:40,401] : Upgrading software packages .... 11 [2017-02-03 08:11:05,450] : Running post-install script..... 12 [2017-02-03T08:11:06.034] : Packages upgraded successfully, Reboot is required to complete the installation.   We will now reboot the new passive node.\n To reboot the witness node, while still in appliancesh run the following command.  shutdown reboot -r \u0026ldquo;patch reboot\u0026rdquo;      We will now wait for the passive node to come online, and then remove vCenter HA from Maintenance Mode.\n Log in to the vSphere Web Client select the vCenter and click Configure. Under Settings, select vCenter HA and click Edit. Select Enable vCenter HA and click OK.    The upgrade is now done! After previously having to do VMware Heartbeat upgrades, this is definately much easier. This process is very straightforward and I had no issues.\nAll in all this process took my less than 30 minutes to fully upgrade with no major issues.\nLeave a comment if you have any questions!\n","permalink":"https://davidstamen.com/2017/02/03/vsphere-65-updating-appliance-configured-with-vcenter-ha/","tags":["vCenter Server","vSphere 6.5","vCenter HA"],"title":"vSphere 6.5 - Updating Appliance configured with vCenter HA"},{"categories":["VMware"],"contents":"One of my favorite new features of vSphere 6.5 is definately vCenter HA. I was checking out alerts when I noticed i had an alarm for vCenter HA being degraded.\nLooking through the GUI, I was unable to find anything in regards to why the Health was a warning and why the components would not sync. Then I remembered a previous case I had opened for VCHA.\nThere is a log file located in /var/log/vmware/vcha\nAs soon as i opened up vcha.log the issue was plain and clear.\n1--\u0026gt; VMware vCenter Server Appliance 6.5.0.5100 2--\u0026gt; 3--\u0026gt; Type: vCenter Server with an embedded Platform Services Controller 4--\u0026gt; 5--\u0026gt; WARNING: Your password has expired. 6--\u0026gt; Password change required but no TTY available. 7--\u0026gt; rsync: connection unexpectedly closed (0 bytes received so far) [sender] 8--\u0026gt; rsync error: error in rsync protocol data stream (code 12) at io.c(226) [sender=3.1.2] 9--\u0026gt; ] 102017-01-31T08:00:22.515-05:00 warning vcha[7F80E0818700] [Originator@6876 sub=RsyncRepl-largeFrp] Rsync failed for vmw, retrying in 2 secs 112017-01-31T08:00:24.666-05:00 error vcha[7F80E0818700] [Originator@6876 sub=VchaUtil] Error executing command /usr/bin/rsync: exit status=[12], stdout=[], stderr=[ My Password has expired! How is this possible? Lucky for me FÃ©idhlim O\u0026rsquo;Leary has already encountered this issue, and opened up a support case. The problem is due to the vcha user password expiring, it\u0026rsquo;s quite a simple fix.\nIf you check the password age, you can see when the last password change is. This example my password has not expired yet, you can check the expiration date but running chage \u0026ndash;list vcha\n1root@vc [ ~ ]# chage --list vcha 2Last password change : Jan 05, 2017 3Password expires : Mar 06, 2017 4Password inactive : never 5Account expires : never 6Minimum number of days between password change : 1 7Maximum number of days between password change : 60 8Number of days of warning before password expires : 7 If the password is already expired, you can reset it by typing\n1passwd vcha Note: You will need to do this on all 3 nodes. You can ssh to the peer and witness through the primary if you know those IP\u0026rsquo;s\nNow, we can set our password to not expire.\n1root@vc [ ~ ]# chage -m 0 -M 99999 vcha If we recheck the password expiration, we can now see it is set to not expire.\n1root@vc [ ~ ]# chage --list vcha 2Last password change : Jan 05, 2017 3Password expires : never 4Password inactive : never 5Account expires : never 6Minimum number of days between password change : 0 7Maximum number of days between password change : 99999 8Number of days of warning before password expires : 7 We will need to wait a few minutes for our replication cycles to complete, and voila! VCHA is now Healthy!\n","permalink":"https://davidstamen.com/2017/02/01/vcenter-ha-health-degraded-due-to-password-expiration/","tags":["vCenter HA","vSphere 6.5"],"title":"vSphere 6.5 - vCenter HA Health Degraded due to Password Expiration"},{"categories":["Linux"],"contents":"Can you easily export PowerDNS zones using a MySQL DB? The answer may not be as easy as it seems.\nI have been working on a Migration from PowerDNS using a MySQL DB. We have a custom solution which gets updated and gets pushed to Akamai. The problem is, this custom solution requires all the zones to be in bind format. Doing some research I found out there is no easy way to get these zones into a bind zone file. You could setup a secondary server and do zone transfers, but that wouldnt meet my requirements.\nLuckily I stumbled across this post by James Linden in which he created a PHP script that scrapes the entire database and then generates a bind file for each zone with the records.\nIt is actually a pretty easy script to run, you need to fill in about 5 variables and then you are good to execute it. Here is a copy of the script in case it is no longer available. (It was created in 2013, but still works flawlessly!)\nAll you need to do is update the 3 lines, to put in the MySQL DB IP, the username, password and database name. You will then enter in the nameservers and hostmaster to be used for the bind files.\n1#!/bin/env php 2\u0026lt;?php 3 4/** 5 * @copyright 2013 James Linden \u0026lt;kodekrash@gmail.com\u0026gt; 6 * @author James Linden \u0026lt;kodekrash@gmail.com\u0026gt; 7 * @url http://jameslinden.com/code/powerdns-to-bind-zone 8 * @license BSD (2 clause) \u0026lt;http://www.opensource.org/licenses/BSD-2-Clause\u0026gt; 9 */ 10 11$pdns_db = [ \u0026#39;host\u0026#39; =\u0026gt; \u0026#39;localhost\u0026#39;, \u0026#39;user\u0026#39; =\u0026gt; \u0026#39;root\u0026#39;, \u0026#39;pass\u0026#39; =\u0026gt; \u0026#39;powerdns\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;powerdns\u0026#39; ]; 12$zone_ns = [ \u0026#39;ns1.lab.local\u0026#39;, \u0026#39;ns2.lab.local\u0026#39; ]; 13$zone_adm = \u0026#39;support.lab.local\u0026#39;; 14 15$zones = []; 16$db = new mysqli( $pdns_db[\u0026#39;host\u0026#39;], $pdns_db[\u0026#39;user\u0026#39;], $pdns_db[\u0026#39;pass\u0026#39;], $pdns_db[\u0026#39;name\u0026#39;] ); 17if( $q = $db-\u0026gt;query( \u0026#39;SELECT * FROM domains\u0026#39; ) ) { 18\twhile( $r = $q-\u0026gt;fetch_assoc() ) { 19\t$d = strtolower( $r[\u0026#39;name\u0026#39;] ); 20\tif( $q1 = $db-\u0026gt;query( \u0026#39;SELECT * FROM records WHERE domain_id=\u0026#39; . $r[\u0026#39;id\u0026#39;] ) ) { 21\t$x = [ \u0026#39;A\u0026#39; =\u0026gt; [], \u0026#39;CNAME\u0026#39; =\u0026gt; [], \u0026#39;NS\u0026#39; =\u0026gt; [], \u0026#39;MX\u0026#39; =\u0026gt; [], \u0026#39;TXT\u0026#39; =\u0026gt; [] ]; 22\twhile( $r1 = $q1-\u0026gt;fetch_assoc() ) { 23\t$r1[\u0026#39;name\u0026#39;] = strtolower( $r1[\u0026#39;name\u0026#39;] ); 24\tswitch( $r1[\u0026#39;type\u0026#39;] ) { 25\tcase \u0026#39;A\u0026#39;: 26\t$x[ $r1[\u0026#39;type\u0026#39;] ][] = [ $r1[\u0026#39;name\u0026#39;], $r1[\u0026#39;content\u0026#39;] ]; 27\tbreak; 28\tcase \u0026#39;CNAME\u0026#39;: 29\t$x[ $r1[\u0026#39;type\u0026#39;] ][] = [ trim( str_replace( $d, null, $r1[\u0026#39;name\u0026#39;] ), \u0026#39;.\u0026#39; ), strtolower( $r1[\u0026#39;content\u0026#39;] ) ]; 30\tbreak; 31\tcase \u0026#39;NS\u0026#39;: 32\t$x[ $r1[\u0026#39;type\u0026#39;] ][] = strtolower( $r1[\u0026#39;content\u0026#39;] ); 33\tbreak; 34\tcase \u0026#39;MX\u0026#39;: 35\t$x[ $r1[\u0026#39;type\u0026#39;] ][] = [ (int)$r1[\u0026#39;prio\u0026#39;], strtolower( $r1[\u0026#39;content\u0026#39;] ) ]; 36\tbreak; 37\tcase \u0026#39;TXT\u0026#39;: 38\t$x[ $r1[\u0026#39;type\u0026#39;] ][] = [ trim( str_replace( $d, null, $r1[\u0026#39;name\u0026#39;] ), \u0026#39;.\u0026#39; ), $r1[\u0026#39;content\u0026#39;] ]; 39\tbreak; 40\t} 41\t} 42\t$q1-\u0026gt;free(); 43\t} 44\t$zones[ $d ] = $x; 45\t} 46\t$q-\u0026gt;free(); 47} 48$db-\u0026gt;close(); 49 50if( is_array( $zones ) \u0026amp;\u0026amp; count( $zones ) \u0026gt; 0 ) { 51\t$p = \u0026#39;./tmp/\u0026#39;; 52\tif( !is_dir( $p ) ) { 53\tif( !mkdir( $p ) ) { 54\tdie( \u0026#39;Unable to make tmp directory\u0026#39; . PHP_EOL ); 55\t} 56\t} 57\tif( count( $zones ) \u0026gt; 0 ) { 58\tforeach( $zones as $d =\u0026gt; $r ) { 59\t$x = \u0026#39; \u0026#39;; 60\t$t = [ \u0026#39;$TTL 43200\u0026#39;, null, \u0026#39;@ IN SOA \u0026#39; . $zone_ns[0] . \u0026#39;. \u0026#39; . $zone_adm . \u0026#39;. (\u0026#39;, $x . time(), $x . \u0026#39;7200\u0026#39;, $x . \u0026#39;3600\u0026#39;, $x . \u0026#39;604800\u0026#39;, $x . \u0026#39;43200 )\u0026#39;, null ]; 61\tforeach( $zone_ns as $x ) { 62\t$t[] = \u0026#39; IN NS \u0026#39; . $x . \u0026#39;.\u0026#39;; 63\t} 64\t$t[] = null; 65\tforeach( $r[\u0026#39;MX\u0026#39;] as $x ) { 66\t$t[] = \u0026#39; IN MX \u0026#39; . str_pad( $x[0], 5, \u0026#39; \u0026#39;, STR_PAD_RIGHT ) . $x[1] . ( is_numeric( substr( $x[1], -1, 1 ) ) ? null : \u0026#39;.\u0026#39; ); 67\t} 68\t$t[] = null; 69\tforeach( $r[\u0026#39;A\u0026#39;] as $x ) { 70\t$t[] = str_pad( $x[0] . \u0026#39;.\u0026#39;, 32, \u0026#39; \u0026#39;, STR_PAD_RIGHT ) . \u0026#39; IN A \u0026#39; . $x[1]; 71\t} 72\t$t[] = null; 73\tforeach( $r[\u0026#39;CNAME\u0026#39;] as $x ) { 74\t$t[] = str_pad( $x[0], 32, \u0026#39; \u0026#39;, STR_PAD_RIGHT ) . \u0026#39; IN CNAME \u0026#39; . $x[1] . \u0026#39;.\u0026#39;; 75\t} 76\t$t[] = null; 77\tforeach( $r[\u0026#39;TXT\u0026#39;] as $x ) { 78\t$t[] = str_pad( $x[0], 32, \u0026#39; \u0026#39;, STR_PAD_RIGHT ) . \u0026#39; IN TXT \u0026#39; . $x[1]; 79\t} 80\tfile_put_contents( $p . $d . \u0026#39;.zone\u0026#39;, implode( PHP_EOL, $t ) . PHP_EOL ); 81\t} 82\t} 83} 84 85?\u0026gt; Once you have populated the script, you can run it by going to a commandline that has MySQL tools and PHP installed and run\n1php scriptname.php This will create a /tmp folder in the same directory with an export of all your zones.\nThats it! I just wanted to blog about this in case other people were looking for a way to accomplish this, its actually quite simple!\nThanks for stopping by.\n","permalink":"https://davidstamen.com/2017/01/31/exporting-powerdns-zones-to-bind-files/","tags":["PowerDNS"],"title":"Exporting PowerDNS Zones to Bind Files"},{"categories":["VMware"],"contents":"I had a use case I wanted to investigate in regards to the new VCHA that is part of VMware vCenter Server 6.5. One thing I noticed, is when you have VCHA configured, there is no way to know which node of the HA cluster you are connecting to without being logged on.\nAs people have noted before William Lam\u0026rsquo;s - How to Customize Webclient Login UI\nI figured since I am using the embedded SSO, I could update the login page to show any information for that particular node. In my case I updated the text to show which node you are connected to. You can see this without even logging in!\nHow can I do this you ask? Easy! You just need to update one file, two if you would like to update your logo\u0026hellip;\n Logon to your PSC or VC with Embedded PSC via SSH or FTP. Make sure to backup the files before making any changes! Update the following file /usr/lib/vmware-sso/vmware-sts/webapps/websso/WEB-INF/views/unpentry.jsp  If you look at lines 126-131, you can see a few lines of code you will need to update. Line 127 - You can input your text here, my example was to post if i was connected to Primary or Secondary. Line 130 - I commented out to hide the \u0026ldquo;VMware vCenter Single Sign-on\u0026rdquo; logo.   To update your logo, you can overwrite the following file /usr/lib/vmware-sso/vmware-sts/webapps/websso/resources/img/vmwareLogoBigger.png  You may need to adjust your logo size for the right look   Save and Upload your file and refresh your webclient UI and you will see your new branding!  Here is a snippet of my code.\n1 \u0026lt;div id=\u0026#34;productName\u0026#34;\u0026gt; 2 Welcome to my Homelab!\u0026lt;/br\u0026gt;\u0026lt;h6\u0026gt;Connected to Primary Appliance (vcsa6-01.lab.local)\u0026lt;/h6\u0026gt;\u0026lt;/br\u0026gt; 3 \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; 4 if (isVCLogin()) { 5 //document.write(\u0026#34;\u0026lt;img id=\\\u0026#34;VCSSO-Title\\\u0026#34; src=\\\u0026#34;../../resources/img/VCSSO-title.png\\\u0026#34; /\u0026gt;\u0026#34;); 6 } Please note this is #unsupported, but extremely useful! Hope you enjoy it. Leave a comment if you have any questions.\n","permalink":"https://davidstamen.com/2017/01/19/functional-branding-of-vsphere-web-client-logon-page/","tags":["Webclient","vSphere 6.0"],"title":"Functional Branding of vSphere Web Client Logon Page"},{"categories":["VMware"],"contents":"So VMware Flings have been on a roll recently. They have released what they call \u0026ldquo;VMware Content Library Assistant.\u0026rdquo; This is a java based CLI app, that connects to your vCenter and searchers for your templates and then automatically creates and uploads them.\nYou can find the fling at the following URL\u0026hellip;https://labs.vmware.com/flings/vsphere-content-library-assistant)\nOnce you download the fling, you can just run the following command.\n1java -jar sphere-content-library-assistant-1.0.jar -s servername -u username -p password In my case my java home isn\u0026rsquo;t setup on my mac so I had to run the following command to get it to work.\n1/Library/Internet\\ Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java -jar /pathtofolder/vsphere-content-library-assistant-1.0.jar -s servername -u username -p password 1Davids-MacBook-Pro:~ davidstamen$ /Library/Internet\\ Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java -jar /Users/davidstamen/Downloads/vsphere-content-library-assistant-1.0.0/vsphere-content-library-assistant-1.0.jar -s vcsa6-01.lab.local -u administrator@vsphere.local -p Password 2 3This app can assist you to on-board VC Templates to Content Library by doing the following: 41. Scan Datastores \u0026amp; Discover VC Templates (*.vmtx) 52. Recommend optimal inventorying intelligently 63. Create Content Libraries 74. Import VC Templates as OVF to Content Libraries 8 9Connecting to Server vcsa6-01.lab.local 10Credentials: Username:administrator@vsphere.local 11Connected to: VMware VirtualCenter ServerSLF4J: Class path contains multiple SLF4J bindings. 12SLF4J: Found binding in [jar:file:/Users/davidstamen/Downloads/vsphere-content-library-assistant-1.0.0/vsphere-content-library-assistant-1.0.jar!/org/slf4j/impl/StaticLoggerBinder.class] 13SLF4J: Found binding in [jar:file:/Users/davidstamen/Downloads/vsphere-content-library-assistant-1.0.0/vsphere-content-library-assistant-1.0.jar!/lib/slf4j-log4j12-1.6.6.jar!/org/slf4j/impl/StaticLoggerBinder.class] 14SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation. 15SLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory] 16 17 18Found the following VC templates to on-board 19 20â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 21â”‚ Datastore â”‚ VC Templates â”‚ 22â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 23â”‚ NFS01 â”‚ [WIN2016, 2012R2, UBUNTU1604] â”‚ 24â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 25 26 27 28Recommending import flows 29 30High Import Speed 31 32â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 33â”‚ VC Template â”‚ Will be imported to â”‚ Created on this â”‚ Connected Hosts â”‚ 34â”‚ â”‚ new ContentLibrary â”‚ Datastore â”‚ â”‚ 35â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 36â”‚ [WIN2016, 2012R2, â”‚ NFS01_ContentLibrary_H â”‚ NFS01 â”‚ [nuc2.lab.local, â”‚ 37â”‚ UBUNTU1604] â”‚ S â”‚ â”‚ nuc1.lab.local] â”‚ 38â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 39 40 41 42 43 44High Availability 45 46â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 47â”‚ VC Template â”‚ Will be imported to â”‚ Created on this â”‚ Connected Hosts â”‚ 48â”‚ â”‚ new ContentLibrary â”‚ Datastore â”‚ â”‚ 49â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 50â”‚ [WIN2016, 2012R2, â”‚ NFS01_ContentLibrary_H â”‚ NFS01 â”‚ [nuc2.lab.local, â”‚ 51â”‚ UBUNTU1604] â”‚ A â”‚ â”‚ nuc1.lab.local] â”‚ 52â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 53 54 55 56 57Press 1 for High Import Speed 58Press 2 for High Availability 59 601 61 62Creating ContentLibrary \u0026#39;NFS01_ContentLibrary_HS\u0026#39; on \u0026#39;NFS01\u0026#39; Success 63\tImporting \u0026#39;WIN2016\u0026#39; to ContentLibrary \u0026#39;NFS01_ContentLibrary_HS\u0026#39; Success 64\tImporting \u0026#39;2012R2\u0026#39; to ContentLibrary \u0026#39;NFS01_ContentLibrary_HS\u0026#39; Success 65\tImporting \u0026#39;UBUNTU1604\u0026#39; to ContentLibrary \u0026#39;NFS01_ContentLibrary_HS\u0026#39; Success Here is an example of what it looks like after the fling is run.\n","permalink":"https://davidstamen.com/2016/12/29/using-the-vmware-content-libray-assistant-fling/","tags":["Content Library","VMware Fling"],"title":"Using the VMware Content Libray Assistant Fling"},{"categories":["Ubiquiti"],"contents":"I have been using Ubiquiti equipment for awhile at home and I figured i would finally write a blog post about it. Ubiquiti equipment is \u0026ldquo;enterprise class\u0026rdquo; equipment for the consumer.\nI figured I would create a post that goes over two ways of loading the controller. The first option will be installing it on Ubuntu on bare metal or a VM, the second option is a docker container.\nIf you are installing this on a bare metal or virtual machine, i suggest a debian based image. My preference is Ubuntu.\n1echo \u0026#34;deb http://www.ubnt.com/downloads/unifi/debian unifi5 ubiquiti\u0026#34; \u0026gt; \\ 2 /etc/apt/sources.list.d/20ubiquiti.list \u0026amp;\u0026amp; \\ 3 echo \u0026#34;deb http://downloads-distro.mongodb.org/repo/debian-sysvinit dist 10gen\u0026#34; \u0026gt; \\ 4 /etc/apt/sources.list.d/21mongodb.list \u0026amp;\u0026amp; \\ 5 apt-key adv --keyserver keyserver.ubuntu.com --recv C0A52C50 \u0026amp;\u0026amp; \\ 6 apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10 7 8apt-get -q update \u0026amp;\u0026amp; \\ 9 apt-get install -qy --force-yes --no-install-recommends unifi \u0026amp;\u0026amp; \\ 10 apt-get -q clean \u0026amp;\u0026amp; \\ 11 rm -rf /var/lib/apt/lists/* 12 13service unifi start Once that completes you can access the controller at https://iporfqdn:8443\nA second option is to use a docker container. I built an image through some testing that is hosted on dockerhub dstamen/unifi. It works and there are plenty of images out there. It is based on the following dockerfile.\nA few other containers to review that are highly recommended are linuxserver/unifi and jacobalberty/unifi\nI hope this helps you on our way to getting your controller online.\n","permalink":"https://davidstamen.com/2016/12/02/installing-ubiquiti-unifi-controller/","tags":["Networking","Unifi"],"title":"Installing Ubiquiti Unifi Controller"},{"categories":["VMware"],"contents":"So as everyone has probably seen, vSphere 6.5 is now GA. One of the features i have been waiting for the most is vCenter HA. I have spent some time trying to get this working in my lab. Unfortunately after countless tries i was stuck. Thanks to folks in the vExpert Slack for helping me try to resolve this, but unfortunately this was a case for VMware Support.\nEvery time I would try to configure vCenter HA using the Advanced Wizard, I would get the following error.\n1The operation is not allowed in the current state. 2Failed to get management network information. Verify if management interface (NIC0) is configured correctly and is reachable. Obviously, if I am accessing the vCenter the management IP has to be configured and reachable correct?\nTurns out we tried to look through the logs in /var/log/vmware/vcha and they were no help. Next the technician tried to manually prepare for VCHA by running prepare-vcha. Once we ran this we were able to see a specific error outputted.\n1Unable to get hostname resolved IP address for eth0 This is more helpful! Turns out my vCenter somehow was missing it\u0026rsquo;s reverse DNS entry. This is definitely bizarre as the VCSA requires a reverse DNS to deploy.\nOnce I created the reverse DNS, the wizard finally let me through and configure vCenter HA!\nBig thank you to the vExpert community and VMware Support.\nLook forward to a formal KB and a more descriptive error in the future.\n","permalink":"https://davidstamen.com/2016/11/21/vsphere-65-vcha-issues/","tags":["vCenter HA","Availability"],"title":"vSphere 6.5 - vCenter HA (VCHA) Issues"},{"categories":["VMware"],"contents":"So as everyone has probably seen, vSphere 6.5 is now GA. As usual right away I have upgraded the homelab and have already found a neat new feature.\nWhen you are adding in your VMware licenses, you now have an option to Import License Keys Data\u0026hellip;\nTo start you need to generate a report from my.vmware.com.\n  Log in and Navigate to Download Reports\n  Click on the Available Reports dropdown, and select the Product Licenses, Details and History. You will be asked which account you would like to select, and if there was a specific timeframe to select. In my case i have selected all accounts and then click Create.\n  The report will take about a minute to generate. You can click on Refresh Table. Once the report shows as complete. You can download it as a CSV. You will need this to complete the next steps.\n  Log into your vSphere 6.5 Flash client (http://fqdn/vsphere-client) and click on Home and then Licenses. In the top right corner you will see an option to Import License Keys Data\u0026hellip;\n    Now you will browse to the file you downloaded from my.vmware.com. If you have not downloaded it yet, you can select on Learn how to generate this CSV file to be shown the steps. Click Next.\n  At this point, the uploaded CSV file will be analyzed to see what licenses can be imported into your vCenter Inventory. Click Next.\n  The next screen will show what licenses were part of the CSV and give you an Overview. Click Next.\n  If you have any existing keys, it will update them with the My VMware settings, if there are new keys it will add them with the notes from My VMware.\n  This new feature is definitely a step in the right direction. Maybe in vNext you can log directly into your My VMware account from the Web Client and have it automatically pull in your licenses.\n","permalink":"https://davidstamen.com/2016/11/16/vsphere-65-new-license-import-from-myvmware/","tags":["vSphere 6.5","MyVMware"],"title":"vSphere 6.5 - New License Import from My VMware"},{"categories":["Microsoft"],"contents":"I have been knee deep in migrations, so after clicking through a few times to create clustered file shares, I finally decided to script them. Here is that script I thought I would share. Thanksfully there was the NTFSSecurity module published by microsoft that makes permissions a breeze. You can get more details by viewing the module page.\nPre-Requsites  NTFS Security Module  Link to Script  Create-SMBShare.ps1  Preparing to Execute the Script Fill in the appropriate variables, and execute the script.\n1Import-Module NTFSSecurity 2 3#variables 4$sharename = \u0026#34;share\u0026#34; 5$cachingmode = \u0026#34;none\u0026#34; 6$continuouslyavailable = $true 7$encryptdata = $false 8$folderenumerationmode = \u0026#34;AccessBased\u0026#34; 9$path = \u0026#34;D:\\Shares\\\u0026#34; 10$scopename = \u0026#34;ClusterORResourceName\u0026#34; 11$sharepath = $path+$sharename 12$fullaccess = \u0026#34;Everyone\u0026#34; 13 14 15#check if path exists 16$PathCheck = Test-Path $sharepath 17if ($PathCheck -eq $true) { 18 Write-Host \u0026#34;$sharepath exists.\u0026#34; 19} 20else { 21 Write-Host \u0026#34;$sharepath does not exist\u0026#34; 22 New-Item $sharepath -type directory 23} 24 25 26#create share 27New-SmbShare -Name $sharename -CachingMode $cachingmode -ContinuouslyAvailable $continuouslyavailable -EncryptData $encryptdata -FolderEnumerationMode $folderenumerationmode -Path $sharepath -ScopeName $scopename -FullAccess $fullaccess 28 29#disable inheritance and add full access 30Disable-NTFSAccessInheritance $sharepath -RemoveInheritedAccessRules 31Add-NTFSAccess $sharepath -Account BUILTIN\\Administrators -AccessRights FullControl 32Get-NTFSAccess $sharepath Execute the Script  Run .\\Create-SMBShare.ps1  ","permalink":"https://davidstamen.com/2016/08/09/using-powershell-to-create-windows-smb-shares/","tags":["Windows","Powershell"],"title":"Using Powershell to Create Windows SMB Shares"},{"categories":["Certification"],"contents":"I am about to start down my path of studying for my VCAP6-DCV Design Exam. I figured I would throw up the blueprint and fill in each section as applicable. Either way here is the blueprint laid out for anyone who may benefit. This is it as of 7/25/16.\nSection 1 â€“ Create a vSphere Conceptual Design Objective 1.1 â€“ Gather and analyze business requirements Skills and Abilities\nExisting Content from VCAP5-DCD\n Associate a stakeholder with the information that needs to be collected. Utilize inventory and assessment data from a current environment to define a baseline state. Analyze customer interview data to explicitly define customer objectives for a conceptual design Given results of the requirements gathering process, identify requirements for a conceptual design. Categorize requirements by infrastructure qualities to prepare for logical design requirements.  New Content\n Determine customer priorities for defined objectives. Ensure that Availability, Manageability, Performance, Recoverability and Security (AMPRS) considerations are applied during the requirements gathering process.  Tools\n VMware Virtualization Case Studies The Benefits of Virtualization for Small and Medium Businesses Functional vs. Non-Functional Requirements Conceptual, Logical, Physical: It is Simple Virtualize Business Critical Applications (blog) Virtualizing Business Critical Applications on vSphere  Objective 1.2 â€“ Gather and analyze application requirements Skills and Abilities\nExisting Content from VCAP5-DCD\n Gather and analyze application requirements for a given scenario. Collect information needed in order to identify application dependencies. Given one or more application requirements, determine the impact of the requirements on the design.  New Content\n Determine the requirements for a set of applications that will be included in the design.  Tools\n VMware TCO Calculator VMware Cost-Per-Application Calculator Methodology Virtualizing Oracle with VMware Virtualizing Exchange with VMware Virtualize SharePoint with VMware vSphere Virtualizing Microsoft SQL on VMware vSphere SAP and VMware Virtualization Business and Financial Benefits of Virtualization: Customer Benchmarking Study  Objective 1.3 â€“ Determine Risks, Requirements, Constraints and Assumptions Skills and Abilities\nExisting Content from VCAP5-DCD\n Differentiate between the concepts of risks, requirements, constraints, and assumptions. Given a statement, determine whether it is a risk, requirement, constraint, or an assumption. Analyze impact of VMware best practices to identified risks, constraints, and assumptions.  Tools\n Developing Your Virtualization Strategy and Deployment Plan Constraints, Assumptions (Risk, Requirements) \u0026amp; Dependencies  Section 2 â€“ Create a vSphere 6.x Logical Design from an Existing Conceptual Design Objective 2.1 â€“ Map Business Requirements to a vSphere 6.x Logical Design Skills and Abilities\nExisting Content from VCAP5-DCD\n Analyze requirements for functional and non-functional elements. Build non-functional requirements into a specific logical design. Translate stated business requirements into a logical design.  New Content\n Incorporate the current state of a customer environment into a logical design.  Tools\n Conceptual, Logical, Physical: It is Simple Whatâ€™s New in VMware vSphere 6.0 Functional vs. Non-Functional Requirements ITIL v3 Introduction and Overview Conceptual Architecture Action Guide Systems Architecture Fundamentals â€“ Conceptual, Logical, Physical Designs  Objective 2.2 â€“ Map Service Dependencies Skills and Abilities\nExisting Content from VCAP5-DCD\n Analyze services to identify upstream and downstream service dependencies.  New Content\n Evaluate dependencies for infrastructure and application services that will be included in a vSphere design. Create Entity Relationship Diagrams that map service relationships and dependencies. Analyze interfaces to be used with new and existing business processes. Determine service dependencies for logical components. Include service dependencies in a vSphere 6.x Logical Design. Navigate logical components and their interdependencies and make decisions based upon all service relationships.  Tools\n Datacenter Operational Excellence Through Automated Application Discovery \u0026amp; Dependency Mapping VMware Application Dependencies and Entity Relationship Diagrams MK2  Objective 2.3 â€“ Build Availability Requirements into a vSphere 6.x Logical Design Skills and Abilities\nExisting Content from VCAP5-DCD\n Determine availability component of service level agreements (SLAs) and service level management processes Determine potential availability solutions for a logical design based on customer requirements. Create an availability plan, including maintenance processes. Balance availability requirements with other infrastructure qualities.  New Content\n Evaluate which logical availability services can be used with a given vSphere solution. Differentiate infrastructure qualities related to availability. Describe the concept of redundancy and the risks associated with single points of failure Explain class of nines methodology Analyze a vSphere design and determine possible single points of failure.  Tools\n Datacenter Operational Excellence Through Automated Application Discovery \u0026amp; Dependency Mapping vSphere Availability Guide Protect Your Business with Automated Business Continuity Solutions VMware High Availability Deployment Best Practices  Objective 2.4 â€“ Build Manageability Requirements into a vSphere 6.x Logical Design Skills and Abilities\nNew Content\n Evaluate which management services can be used with a given vSphere Solution. Differentiate infrastructure qualities related to management. Differentiate available command line-based management tools (PowerCLI, vMA etc.) Evaluate VMware Management solutions based on customer requirements. Build interfaces into the logical design for existing operations practices. Address identified operational readiness deficiencies Define Event, Incident and Problem Management practices. Analyze Release Management practices Determine request fulfillment and release management processes. Determine requirements for Configuration Management Define change management processes based on business requirements. Based on customer requirements, identify required reporting assets and processes  Tools\n Optimizing Your VMware Environment Four Keys to Managing Your VMware Environment Operational Readiness Assessment Operational Readiness Assessment Tool vCenter Server and Host Management Guide vSphere PowerCLI documentation Center  Objective 2.5 â€“ Build Performance Requirements into a vSphere 6.x Logical Design Skills and Abilities\nNew Content\n Evaluate logical performance considerations for a given vSphere solution. Differentiate infrastructure qualities related to performance. Analyze current performance, identify and address gaps when building the logical design Using a conceptual design, create a logical design that meets performance requirements Determine performance-related functional requirements based on given non-functional requirements and service dependencies. Define capacity management practices and create a capacity plan Incorporate scalability requirements into the logical design Determine a performance component for service level agreements and service level management processes.  Tools\n Proven Practice: Implementing ITIL v3 Capacity Management in a VMware environment vSphere Monitoring and Performance Guide  Objective 2.6 â€“ Build Recoverability Requirements into a vSphere 6.x Logical Design Skills and Abilities\nNew Content\n Evaluate which logical recoverability services are available for a given vSphere solution. Differentiate infrastructure qualities related to recoverability. Determine Business Continuity and Disaster Recovery solution options for a given vSphere Design. Given recoverability requirements, analyze services that will be impacted and provide a recovery plan for impacted services. Plan a data retention policy based on customer requirements.  Tools\n VMware vCenterâ„¢ Site Recovery Manager Evaluation Guide A Practical Guide to Business Continuity and Disaster Recovery with VMware Infrastructure Mastering Disaster Recovery: Business Continuity and Virtualization Best Practices Whitepaper  Objective 2.7 â€“ Build Security Requirements into a vSphere 6.x Logical Design Skills and Abilities\nNew Content\n Evaluate which security services can be used with a given vSphere solution. Differentiate infrastructure qualities related to security. Build specific regulatory compliance requirements into the logical design. Analyze application and infrastructure security requirements. Build a role-based access model and map roles to services. Build a security policy based on existing security requirements and IT governance practices. Incorporate customer risk tolerance into the security policy. Assess the services that will be impacted and create an access management plan. Determine the proper security solution that would satisfy a regulatory requirement. Based on stated security requirements, analyze the current state for compliance/non-compliance.  Tools\n vSphere Security Guide Developing Your Virtualization Strategy and Deployment Plan Achieving Compliance in a Virtualized Environment Infrastructure Security: Getting to the Bottom of Compliance in the Cloud Securing the Cloud  Section 3 â€“ Create a vSphere 6.x Physical Design from an Existing Logical Design Objective 3.1 â€“ Transition from a Logical Design to a vSphere 6.x Physical Design Skills and Abilities\nExisting Content from VCAP5-DCD\n Based on business requirements, determine the appropriate roles for each staff member.  New Content\n Analyze design decisions and options selected from the logical design Determine impact of VMware best practices to identified risks, constraints, and assumptions in a given vSphere design.  Tools\n Conceptual, Logical, Physical: It is Simple vSphere Server and Host Management Guide vSphere Virtual Machine Administration Guide  Objective 3.2 â€“ Create a vSphere 6.x Physical Network Design from an Existing Logical Design Skills and Abilities\nExisting Content from VCAP5-DCD\n Analyze VLAN options with respect to virtual and physical switches. Given business requirements, determine the design for virtual network components:  STP Jumbo Frames Load-balancing Trunking and link aggregation groups   Evaluate network redundancy considerations for a given design.  New Content\n Analyze design for inclusion of Network I/O Control capabilities. Determine use case for multiple TCP/IP stacks in a given design. Based on given functional requirements for each service: Determine the most appropriate networking technologies for the design Implement the service based on the required infrastructure qualities (AMPRS.) Analyze design for appropriate network teaming and failover solution. Determine network security and firewall requirements for a virtual network design Based on service level requirements, determine appropriate network performance characteristics. Given a current network configuration as well as technical requirements and constraints, determine the appropriate virtual switch solution:  vSphere Standard Switch vSphere Distributed Switch NSX Hybrid solutions   Based on an existing logical design, determine appropriate host networking resources. Properly apply converged networking considering VMware best practices.  Tools\n vSphere Server and Host Management Guide vSphere Installation and Setup Guide vSphere Networking Guide Network Port Diagram for vSphere 6.x VMware Virtual SAN Network Design Guide Leveraging NIC Technology to Improve Network Performance in VMware vSphere Performance Evaluation of Network I/O Control in VMware vSphere 6 vMotion Architecture, Performance and Best Practices in VMware vSphere 5  Objective 3.3 â€“ Create a vSphere 6.x Physical Storage Design from an Existing Logical Design Skills and Abilities\nExisting Content from VCAP5-DCD\n Based on the logical design and given functional requirements, for each service:  Determine the most appropriate storage technologies for the design Implement the service based on the required infrastructure qualities   Based on service level requirements include VMware technologies in the design, such as:  Storage I/O Control and Network I/O Control Storage Policies Storage vMotion Storage DRS    New Content\n Evaluate criteria, capabilities and limitations between storage types (Block, NAS, Object Based) In a given design, determine Storage Policy availability and performance characteristics Based on service level requirements include VMware technologies in the design, such as:  Virtual SAN   Ensure storage array capabilities are supported in a vSphere 6.x design:  Active/Active, Active/Passive ALUA, VAAI, VASA PSA (including PSPs and SATPs)   Given the functional requirements, size the storage for capacity, availability and performance, including:  Datastores, RDMs, Virtual Disks Physical Storage (LUNs, Storage Tiering) Based on the logical design, select and incorporate an appropriate storage network into the physical design: Block (FC, iSCSI, FCoE, SAS) NAS (NFSv3, NFSv4) Object Based (Virtual SAN, Virtual Volumes    Tools\n Whatâ€™s New: VMware Virtual SAN 6.0 VMware Virtual SAN 6.0 Design and Sizing Guide VMware Virtual SAN Diagnostics and Troubleshooting Reference Manual The VMware Perspective on Software-Defined Storage vSphere Storage Resource Management Guide Virtual SAN TCO and Sizing Calculator Whatâ€™s New: VMware vSphere Virtual Volumes vSphere Installation and Setup Guide VMware Virtual Machine File System: Technical Overview and Best Practices  Objective 3.4 â€“ Determine Appropriate Compute Resources for a vSphere 6.x Physical Design Skills and Abilities\n Analyze best practices with respect to CPU family choices. Evaluate NUMA and vNUMA with ESXi hosts and Virtual machines in a given design. Analyze the following in a vSphere design: Enhanced vMotion compatibility Implications of vSMP in virtual machines Transparent Page Sharing (TPS) and large pages Resource overcommitment Based on the service catalog and given functional requirements: Determine the most appropriate compute technologies for the design Implement the service based on the required infrastructure qualities. Determine the impact of a technical design on the choice of server density: Scale Up/Out Auto Deploy Calculate the required number of nodes in an HA cluster based upon host failures and resource guarantees Evaluate the implications of using reservations, limits, and shares on the physical design. Specify the resource pool and vApp configuration based upon resource requirements. Size the following resources appropriately: Memory CPU I/O devices Internal storage Given a constraint to use existing hardware, determine suitability of the hardware for the design.  Tools\n vSphere Server and Host Management Guide Whatâ€™s New in the VMware vSphereÂ® 6.0 Platform vSphere Installation and Setup Guide vSphere Resource Management Guide Performance Best Practices for VMware vSphere 6.0 VMware vCenter Server Performance and Best Practices Best Practices for Performance Tuning of Latency-Sensitive Workloads in vSphere VMs Performance Characterization of Microsoft SQL Server on VMware vSphere 6  Microsoft Exchange 2013 on VMware Best Practices Guide vSphere Monitoring and Performance Guide Interpreting esxtop statistics  Objective 3.5 â€“ Determine Virtual Machine Configuration for a vSphere 6.x Physical Design Skills and Abilities\n Analyze the use of an RDM or a virtual disk for a given VM. Evaluate Virtual Machine memory management techniques (ballooning, compression, swapping) in a given vSphere design. Based on business requirements, determine the design significance of VM Swap location. Determine the latency sensitivity requirements of a given virtual machine workload. Evaluate virtual machine features based on the logical, functional and application requirements. Use VMware best practices to size virtual machines according to application requirements. Determine if reservations, shares, and limits are necessary. Based on an existing logical design, determine virtual hardware options. Build a Content Library of appropriate virtual machine offerings (e.g. templates, OVFs, ISOs.) Determine appropriate use cases for vApps. Evaluate the suitability of using VMware FT or 3rd party clustering products (e.g. Microsoft Clustering, etc.) based on application requirements. Determine the impact of scheduled guest activities (e.g. anti-virus, backup, etc) to the design. Evaluate vFlash read cache requirements in a given design.  Tools\n Virtual Machine Administration Guide Best Practices for Performance Tuning of Latency-Sensitive Workloads in vSphere VMs Virtualizing a Windows Active Directory Domain Infrastructure Guest Operating System Installation Guide vSphere Resource Management Guide Understanding Memory Management in VMware vSphere 6.0  Objective 3.6 â€“ Determine Data Center Management Options for a vSphere 6.x Physical Design Skills and Abilities\n Based on business requirements, determine client access options in a vSphere solution. Analyze business requirements when integrating vSphere with other VMware solutions. Evaluate the impact of the VMware Certificate Authority and the VMware Endpoint Certificate Store to the design. Based on the logical design and given functional requirements: Determine the most appropriate datacenter management options for the design. Implement the service based on the required infrastructure qualities. Analyze cluster requirements: Availability requirements for HA and FT Performance requirements for DRS and vMotion Storage performance requirements for SDRS and Storage vMotion Determine appropriate vCenter Server design and sizing requirements: vCenter Server Enhanced Linked Mode vCenter Server virtual appliance vs vCenter Server for Windows Platform Services Controller Evaluate access control methodologies for creating roles and assignment of users to roles. Determine proper structure for access control settings (i.e. folders, resource pools, etc.) Develop appropriate host and virtual machine deployment options. Include in the design appropriate technologies for: Asset management Event, incident and problem management Logging, monitoring and reporting  Tools\n vSphere Monitoring and Performance Guide VMware vCenter Server 6.0 Availability Guide vCenter Server and Host Management Guide VMware vCenter Update Manager 6.0 Performance and Best Practices vCenter Server Deployment Guide VMware Interoperability Matrix VMware Proactive Incident Whitepaper  ","permalink":"https://davidstamen.com/2016/07/25/vmware-certified-advanced-professional-6-data-center-virtualization-design-guide-3v0-622/","tags":["VCAP6-DCV Design","Study Guide"],"title":"VMware Certified Advanced Professional 6 â€“ Data Center Virtualization Design Guide (3V0 622)"},{"categories":["Certification"],"contents":"Today I took my VCAP6-DCV exam. This exam was announced with a two week availability in the US priced at $100.\nMy experience with the exam was actually pretty good. The new interface for the advanced exams is that of an HOL. You are dropped onto the desktop and have a window that slides in and out to pull up the manual and other consoles.\nI would definately read up on Josh Andrew\u0026rsquo;s post about what to expect.\nI would also recommend going over the interface guide as well as this has lots of detailed information about the console, and limitations about the control key, akt key and backspace key (I will expand on that more below). Also please make note of the sections about optimizing the console, this is also in the on screen manual, I tried to skip over it, but without following these steps alot of the screen will be cutoff, go ahead and do it. It will make it easier for you.\nThe new interface is now HTML5 based and is extremely quick, in my testing center i did not experience any of the lag I did when i took the VCAP5.\nHowever there are a few things to make note of when taking try new exam. The following keys are disabled\u0026hellip; Ctrl, alt and backspace. This made a few tasks difficult I knew about ctrl going into the exam, but not having backspace at my disposal made a few things harder. The delete key is still active so at least you can clear some of the text you typed incorrectly.\none thing to add, there may not be a copy padte in all places but if you need to \u0026ldquo;copy\u0026rdquo; something from the manual you can highlight it and then drag it to a field in the console and it will \u0026ldquo;paste\u0026rdquo; thr content there.\nAs far as content, I think it was very good. I didn\u0026rsquo;t feel strapped on time and it was one of the better beta exam experiences I have had. I definitely recommend taking it if you can.\nThe exam never strayed off the blueprint, so If you are looking for something to study I would definitely make sure you cover all topics on the blueprint, it will help you in the long run.\nSome of the resources I used to study were the following.\n VMware Official Blueprint  https://mylearn.vmware.com/mgrReg/plan.cfm?plan=88753\u0026amp;ui=www_cert   vJenner Blog  http://www.vjenner.com/vcap6-dcv-deployment-study-guide/   vPentathlon  http://vpentathlon.com/vcap-dcv-deploy-study-guide/   Google Community for VCAP6-DCV  https://plus.google.com/communities/108002000588564278612   Tom Greene (This was really great to focus on where to study, it covers differences between VCAP5 and VCAP6)  http://www.thomgreene.com/blog/2016/6/16/vcap6-dcv-deploy-blueprint-changes-from-vcap5-dca   VMware HOL\u0026rsquo;s  HOL-SDC-1627 - VVol, Virtual SAN \u0026amp; Storage Policy-Based Management. I think I spent the MOST time in this lab, it is a great lab that has VDP, VR, VSAN, VVOL and pretty much anything you need. I probably enrolled in this lab over 15 times.    Update 6/27 Please make sure to check out Beta experience\u0026rsquo;s as well!\n Ariel Sanchez  https://sites.google.com/site/arielsanchezmora/home/study-guides/vcap6-dcv-deploy-beta    ","permalink":"https://davidstamen.com/2016/06/24/my-vcap6-dcv-deploy-beta-experience/","tags":["VCAP6-DCV Deploy"],"title":"My VCAP6 DCV Deploy Beta Experience"},{"categories":["VMware"],"contents":"I have been in process in configuring traffic shaping for multiple port groups. It seems with PowerCLI 6.3 R1 there are no native Powershell Cmdlets. Luckily I stumbled across @Lucd and his PowerCLI functions to manage these settings, i have put these into a script to mass get and set the settings for all port groups of a DVS\u0026rsquo;s.\nPre-Requsites  VMware PowerCLI  Link to Script  Get-VMwareTrafficShapingSettings.ps1 Set-VMwareTrafficShapingSettings.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\nThis script assumes you have already launched PowerCLI and modified the variables\nGet Traffic Shaping Settings 1Foreach ($VirtualSwitch in Get-VirtualSwitch -Distributed) { 2 Foreach ($VirtualPortGroup in Get-VirtualPortGroup -VirtualSwitch $VirtualSwitch|Where {$_.Name -notlike \u0026#34;*DVUplinks*\u0026#34;}) { 3 Write \u0026#34;$VirtualPortGroup on $VirtualSwitch\u0026#34; 4 $dvPg = Get-dvSwPg -dvSw $VirtualSwitch.ExtensionData -PGName $VirtualPortGroup 5 Get-dvPgTrafficShaping -dvPg $dvPg|ft 6 } 7} Set Traffic Shaping Settings 1 2Foreach ($VirtualSwitch in Get-VirtualSwitch -Distributed) { 3 Foreach ($VirtualPortGroup in Get-VirtualPortGroup -VirtualSwitch $VirtualSwitch|Where {$_.Name -notlike \u0026#34;*DVUplinks*\u0026#34;}) { 4 Write \u0026#34;$VirtualPortGroup on $VirtualSwitch\u0026#34; 5 $dvPg = Get-dvSwPg -dvSw $VirtualSwitch.ExtensionData -PGName $VirtualPortGroup 6 Set-dvPgTrafficShaping -dvPg $dvPg -InShaping -inAverageKbps 10485760 -inBurstKB 102400 -inPeakKbps 10485760 -OutShaping -outAverageKbps 10485760 -outBurstKB 102400 -outPeakKbps 10485760 7 } 8} Execute the Script  Run .\\Get-VMwareTrafficShapingSettings.ps1 Run .\\Set-VMwareTrafficShapingSettings.ps1  Screenshots ","permalink":"https://davidstamen.com/2016/04/21/using-powercli-to-get-and-set-dvs-traffic-shaping-settings/","tags":["PowerCLI","Networking"],"title":"Using PowerCLI to Get and Set DVS Traffic Shaping Settings"},{"categories":["Backup"],"contents":"Hello! Welcome to my First Veeam PowerShell Script! I have been working on tons of migrations using Veeam Backup and Replication and need to create re-ip rules to update the static IP assignments. Obviously the first rule of scripting if you do something more than once, automate! I was bad at this one, I originally tried and gave up so I did about 20 manually which started to become a huge headache.\nThanks to Marcus Puckett (@mpuckett259) he helped me on the side figure out the syntax to get the rule to append and not overwrite. See below for the script. Check out the Github for the bits!\nPre-Requsites  Veeam Powershell  Link to Script  Create-VeeamReIPRule.ps1 ReIPRule-Template.csv  Preparing to Execute the Script The script is pretty straight forward, just update the CSV file and then you execute the script.\n1#Define Variables 2param 3( 4 [Parameter(Mandatory=$False, 5 HelpMessage=\u0026#39;Path to CSV to Import\u0026#39;)] 6 [string[]]$csvlist 7) 8 9#Load Veeam Plugin 10Add-PSSnapin -Name VeeamPSSnapIn -ErrorAction SilentlyContinue 11 12#Check if CSV was specified, if not prompt. 13If($csvlist -eq $NULL){ 14 $csvlist = Read-host -Prompt \u0026#34;Csv to import\u0026#34; 15} 16If((Test-Path $csvlist) -eq $False){Write-host \u0026#34;Could not find CSV.\u0026#34;;break} 17 18#Import CSV 19$iplist = Import-csv \u0026#34;$csvlist\u0026#34; 20 21#Cycle through each row and add in the ReIP Rule 22Foreach ($item in $iplist) { 23 $Description = $item.Description 24 $Job = $item.Job 25 $SourceIp = $item.SourceIp 26 $SourceMask = $item.SourceMask 27 $TargetIp = $item.TargetIp 28 $TargetMask = $item.TargetMask 29 $TargetGateway = $item.TargetGateway 30 $DNS1 = $item.DNS1 31 $DNS2 = $item.DNS2 32 33 $currentiprules = Get-VBRJob -Name $Job | Get-VBRViReplicaReIpRule 34 $newiprule = New-VBRViReplicaReIpRule -SourceIp $SourceIp -SourceMask $SourceMask -TargetIp $TargetIp -TargetMask $TargetMask -TargetGateway $TargetGateway -DNS $DNS1,$DNS2 -Description $Description 35 $newrules = @($currentiprules) + @($newiprule) 36 $replicajob = Get-VBRJob -Name $Job 37 Set-VBRViReplicaJob -Job $replicajob -EnableReIp -ReIpRule $newrules 38 39} Execute the Script  Run .\\Create-VeeamReIPRule.ps1 pathto.csv  ","permalink":"https://davidstamen.com/2016/04/18/using-veeam-powershell-to-manage-reip-rules/","tags":["Veeam","Powershell","Availability"],"title":"Using Veeam Powershell to Manage ReIP Rules"},{"categories":["VMware"],"contents":"I have been having issues ever since I updated to vSphere 6.x getting the Cisco Drivers to properly update through VMware Update Manager(VUM). Every time I would run through a compliance check, they would always report they were up to date even when they were running an older version.\nI have recently made a breakthrough working with VMware Support and stumbling through some old blogs. Cisco Support has been terrible on this issue and after repeated attempts to get this case escalated i think the 10th time is a charm.\nFrom what I have found the issue lies in the metadata of the offline bundle. As you can see in the below screenshot. The ENIC driver is showing 6.x but the FNIC driver is showing 5.x. In this case the ENIC driver works and the FNIC driver does not.\nNote: The ENIC driver for 2.3.0.7 was recently updated to fix this, but every other driver is currently broken.\nTo update the metadata of the offline bundle and get VUM to work you need to perform the following steps.\n  Make sure you have 7zip and setup an editor within 7zip. I used notepad++.\n  Open the offline_bundle zip file\n  Edit the vendor-index.xml file and replace the 5 with 6\n  Open up the metadata.zip file\n  Edit the vendor-index.xml file and replace the 5 with 6\n  Edit the vmware.xml file and replace the 5 with 6\n  If you perform these steps, you can now import your customized offline bundle and it will accurately report 6.x in VUM and allow you to remediate your hosts. Please post any feedback below!\n","permalink":"https://davidstamen.com/2016/04/08/troubleshooting-cisco-enic-and-fnic-drivers-with-vmware-update-manager-6x/","tags":["Cisco UCS","Update Manager"],"title":"Troubleshooting Cisco ENIC and FNIC Drivers with VMware Update Manager 6.x"},{"categories":["Pure Storage"],"contents":"Currently working on the final steps of getting our new equipment configured. The next step was to configure Syslog on all of our Pure Arrays. Another reason to script this task! Easily populate your arrays and server and at the click of a button you can configure all your arrays easily.\nPre-Requsites  PureStorage Powershell SDK  Link to Script  Set-PureStorageSyslog.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\n1#Import Module 2Import-Module PureStoragePowershellSDK 3 4#Define Variables 5$cred = Get-Credential 6$arrays = \u0026#34;pure.lab.local\u0026#34; 7$SysLogServers = \u0026#34;tcp://syslog.lab.local:514\u0026#34; 8 9#Cycles through each UCS setting values 10Foreach ($array in $arrays) { 11 Write-Host \u0026#34;Setting Syslog Information for $array\u0026#34; 12 $FlashArray = New-PfaArray -EndPoint $array -Credentials $cred -IgnoreCertificateError 13 Set-PfaSyslogServers -Array $FlashArray -SyslogServers $SyslogServers|fl 14} Execute the Script  Run .\\Set-PureStorageSyslog.ps1  ","permalink":"https://davidstamen.com/2016/03/14/using-purestorage-powershell-to-configure-syslog-servers/","tags":["Powershell","Syslog"],"title":"Using PureStorage Powershell to Configure SysLog Servers"},{"categories":["Cisco"],"contents":"Time for more UCS Scripting! This time to configure Syslog. The script is pretty straightforward, but nice to have to easily set up Syslog across multiple UCS domains.\nPre-Requsites  UCS Powertool  Link to Script  Set-UcsSyslog.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\n1# UCS PowerTool Script that to set Syslog 2# @davidstamen 3# http://davidstamen.com 4 5#Define Variables 6$cred = Get-Credential 7$domains = \u0026#34;ucs01.lab.local\u0026#34;,\u0026#34;ucs02.lab.local\u0026#34; 8$SyslogServer = \u0026#34;syslog.lab.local\u0026#34; 9$Name = \u0026#34;primary\u0026#34; 10$Facility = \u0026#34;local7\u0026#34; 11$AdminState = \u0026#34;enabled\u0026#34; 12$Severity = \u0026#34;notifications\u0026#34; 13 14#Cycles through each UCS setting values 15Foreach ($ucs in $domains) { 16 Connect-UCS $ucs -Credential $cred 17 Get-UcsSyslogClient -Name $Name | Set-UcsSyslogClient -AdminState $AdminState -ForwardingFacility $Facility -Hostname $SyslogServer -Severity $Severity -Force 18 Disconnect-UCS 19} Execute the Script  Run .\\Set-UcsSyslog.ps1  ","permalink":"https://davidstamen.com/2016/03/14/using-ucs-powertool-to-configure-syslog-servers/","tags":["Cisco UCS","Syslog","Powershell"],"title":"Using UCS PowerTool to Configure Syslog Servers"},{"categories":["VMware"],"contents":"So currently Cisco has an issue with installing their ENIC and FNIC VIBs through Update Manager for ESXi 6.x. Until that is resolved I need to manually push out patches to these hosts. Obviously I do not want to do this manually, so I will be utilizing PowerCLI to accomplish this task.\nPre-Requsites  VMware PowerCLI  Link to Script  Install-HostVIB.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\nThis script assumes you have already launched PowerCLI and modified the variables\n1# Define Variables 2$Cluster = \u0026#34;Cluster\u0026#34; 3$VIBPATH = \u0026#34;/vmfs/volumes/NFS01/VIB/cisco/scsi-fnic_1.6.0.24-1OEM.600.0.0.2494585.vib\u0026#34; 4$vcenter = \u0026#34;vcenter.lab.local\u0026#34; 5$cred = Get-Credential 6 7# Connect to vCenter 8Connect-VIServer -Server $vcenter -Credential $cred 9 10# Get each host in specified cluster that meets criteria 11Get-VMhost -Location $Cluster | where { $_.PowerState -eq \u0026#34;PoweredOn\u0026#34; -and $_.ConnectionState -eq \u0026#34;Connected\u0026#34; } | foreach { 12 13 Write-host \u0026#34;Preparing $($_.Name) for ESXCLI\u0026#34; -ForegroundColor Yellow 14 15 $ESXCLI = Get-EsxCli -VMHost $_ 16 17 # Install VIBs 18 Write-host \u0026#34;Installing VIB on $($_.Name)\u0026#34; -ForegroundColor Yellow 19 $action = $ESXCLI.software.vib.install($null,$null,$null,$null,$null,$true,$null,$null,$VIBPATH) 20 21 # Verify VIB installed successfully 22 if ($action.Message -eq \u0026#34;Operation finished successfully.\u0026#34;){Write-host \u0026#34;Action Completed successfully on $($_.Name)\u0026#34; -ForegroundColor Green} else {Write-host $action.Message -ForegroundColor Red} 23} Execute the Script  Run .\\Install-HostVIB.ps1  ","permalink":"https://davidstamen.com/2016/03/03/using-powercli-to-install-host-vibs/","tags":["PowerCLI","ESXi"],"title":"Using PowerCLI to Install Host VIBs"},{"categories":["Cisco"],"contents":"Time for more UCS Scripting! This time to enable SNMP. The script is pretty straightforward, but nice to have to easily set up SNMP across multiple UCS domains.\nPre-Requsites  UCS Powertool  Link to Script  Set-UcsSnmpConfiguration.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\n1#Define Variables 2$cred = Get-Credential 3$domains = \u0026#34;ucs01.lab.local\u0026#34;,\u0026#34;ucs02.lab.local\u0026#34; 4$Descr = \u0026#34;SNMP config for UCS\u0026#34; 5$AdminState = \u0026#34;enabled\u0026#34; 6$SysContact = \u0026#34;admin@lab.local\u0026#34; 7$SysLocation = \u0026#34;US\u0026#34; 8$Community = \u0026#34;public\u0026#34; 9 10#Cycles through each UCS setting values 11Foreach ($ucs in $domains) { 12 Connect-UCS $ucs -Credential $cred 13 $servers = Get-UCSRackUnit 14 Foreach ($server in $servers) { 15 Set-UcsSnmp -Descr $Descr -AdminState $AdminState -SysContact $SysContact -SysLocation $SysLocation -Community $Community -force 16 } 17 Disconnect-UCS 18} Execute the Script  Run .\\Set-UcsSnmpConfiguration.ps1  ","permalink":"https://davidstamen.com/2016/03/01/using-ucs-powertool-to-set-snmp-configuration/","tags":["Cisco UCS","SNMP","Powershell"],"title":"Using UCS PowerTool To Set SNMP Configuration"},{"categories":["Awards"],"contents":"I am honored to have been selected as a VMware vExpert once again for 2016!\nThis is my fourth year as a vExpert (2013,2014,2015 and 2016). It has been great to see the community grow and the amount of vExperts increase. I did a quick count, and in 2016 we are up to 1360 vExperts!\nCan\u0026rsquo;t wait to see what this year brings.\n","permalink":"https://davidstamen.com/2016/02/05/vexpert-2016/","tags":["vExpert"],"title":"vExpert 2016"},{"categories":["Automation"],"contents":"In the midst of playing with Ansible and figured my most common use case would be executing powershell scripts on remote servers, so scavenged around and put this together.\nPre-Requsites  ansible ansible-winrm  Link to Git Project  ansible_powershell  Preparing to Execute the Script This script assumes you have already installed and configured Ansible, downloaded the Git Repo and installed the WinRM python module.\nDefine your group variables. Create a hostgroup.yml file in this folder. This is where you specify the username, password and WinRM port to use. This file should mimit the host group defined in your hosts file.\n1ansible_ssh_user: admin 2ansible_ssh_pass: password 3ansible_ssh_port: 5985 4ansible_connection: winrm 5ansible_winrm_server_cert_validation: ignore Here is the yaml code responsible for launching the script. Copy the script into the scripts directory and update the file.\n1- name:RunPowershellScripts2hosts:test3tasks:4- name:runapowershellscript5script:scripts/hello.ps16register:out7- debug:var=outExecute the Script  Run ansible-playbook powershell.yml -i hosts  ","permalink":"https://davidstamen.com/2016/02/04/using-ansible-to-run-powershell-scripts/","tags":["Ansible","Powershell"],"title":"Using Ansible to Run Powershell Scripts"},{"categories":["Automation"],"contents":"In the midst of rolling out Cisco ACI, we have a need to automation creation of filters to apply to contracts. I tried to use the ACI-PowerTool for this task, however it doesnt seem to work with the newer code we are on. So I went back and attempted to use the ansible modules and it worked flawlessly, below is a sample playbook that will create a filter and add the associated filter entries. The below example are the required ports for Horizon View.\nPre-Requsites  aci-ansible ansible  Link to Script  horizonviewports.yml  Preparing to Execute the Script This script assumes you have already installed and configured Ansible, downloaded the Git Repo and installed the Cisco ACI Cobra SDK.\n1--- 2 3- name: playbook to create HorizonViewPorts-FIL 4 hosts: apic 5 connection: local 6 gather_facts: no 7 8 tasks: 9 # ensure filters exist 10 - aci_filter: name={{ item }} tenant=common host={{ inventory_hostname }} username={{ user }} password={{ pass }} 11 with_items: 12 - HorizonViewPorts 13 14 # ensure filter entries exist 15 - aci_filter_entry: name=HighEndPorts-tcp proto=tcp tenant=common filter=HorizonViewPorts-FIL dest_from_port=40000 dest_to_port=65000 state=present host={{ inventory_hostname }} username={{ user }} password={{ pass }} 16 - aci_filter_entry: name=HighEndPorts-udp proto=udp tenant=common filter=HorizonViewPorts-FIL dest_from_port=40000 dest_to_port=65000 state=present host={{ inventory_hostname }} username={{ user }} password={{ pass }} 17 - aci_filter_entry: name=HTML-Access proto=tcp tenant=common filter=HorizonViewPorts-FIL dest_from_port=22443 dest_to_port=22443 state=present host={{ inventory_hostname }} username={{ user }} password={{ pass }} 18 - aci_filter_entry: name=http proto=tcp tenant=common filter=HorizonViewPorts-FIL dest_from_port=http dest_to_port=http state=present host={{ inventory_hostname }} username={{ user }} password={{ pass }} 19 - aci_filter_entry: name=https proto=tcp tenant=common filter=HorizonViewPorts-FIL dest_from_port=https dest_to_port=https state=present host={{ inventory_hostname }} username={{ user }} password={{ pass }} 20 - aci_filter_entry: name=JMS proto=tcp tenant=common filter=HorizonViewPorts-FIL dest_from_port=4001 dest_to_port=4002 state=present host={{ inventory_hostname }} username={{ user }} password={{ pass }} 21 - aci_filter_entry: name=MMR proto=tcp tenant=common filter=HorizonViewPorts-FIL dest_from_port=9427 dest_to_port=9427 state=present host={{ inventory_hostname }} username={{ user }} password={{ pass }} 22 - aci_filter_entry: name=PCoIP proto=tcp tenant=common filter=HorizonViewPorts-FIL dest_from_port=4172 dest_to_port=4172 state=present host={{ inventory_hostname }} username={{ user }} password={{ pass }} 23 - aci_filter_entry: name=PCoIP-udp proto=udp tenant=common filter=HorizonViewPorts-FIL dest_from_port=4172 dest_to_port=4172 state=present host={{ inventory_hostname }} username={{ user }} password={{ pass }} 24 - aci_filter_entry: name=USB proto=tcp tenant=common filter=HorizonViewPorts-FIL dest_from_port=32111 dest_to_port=32111 state=present host={{ inventory_hostname }} username={{ user }} password={{ pass }} 25 Execute the Script  Run ansible-playbook horizonviewports.yml -i hosts  ","permalink":"https://davidstamen.com/2016/02/03/using-ansible-to-create-cisco-aci-filters/","tags":["Ansible","Cisco ACI"],"title":"Using Ansible to Create Cisco ACI Filters"},{"categories":["Awards"],"contents":"I am honored to have been accepted once again as a Cisco Champion for 2016!\nI had a bit of a gap in blog posts this past year due to a job change. However, look forward to more posts on Cisco UCS and maybe even some Cisco ACI.\nI am a member of the Cisco Champions Program. Cisco Champions are passionate about Cisco and enjoy sharing our knowledge, expertise, and thoughts across the social web and with Cisco. I am not a representative of Cisco. My views as a Cisco Champion are my own.\nLearn more information about the Cisco Champions program and related benefits.\n","permalink":"https://davidstamen.com/2016/01/31/cisco-champion-2016/","tags":["Cisco Champion"],"title":"Cisco Champion 2016"},{"categories":["VMware"],"contents":"I have been constantly trying to figure out the best way to deploy updated agents to some of our virtual desktops. It isnt a large environment so I have no need for SCCM or other deployment tools, but its big enough having to RDP to each VM was a pain. I finally decided to bang out a script, and surprised how well it works.\nPre-Requsites  VMware PowerCLI  Link to Script  InstallVMSoftware.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\nThis script assumes you have already launched PowerCLI and connected to the vCenter using Connect-VIServer\n1#Define Variables 2Write-Host \u0026#34;Prompt For Guest Credentials\u0026#34; -ForegroundColor Yellow 3$Cred = Get-Credential 4$VMs = \u0026#34;VM1\u0026#34;,\u0026#34;VM2\u0026#34; 5#$VMs = Get-VM VM* | Sort Name 6 7Foreach ($VMName in $VMs) { 8 $VM = Get-VM $VMName 9 10#Define file information. Include File Name, Parameters, Source and Destination 11 $File = \u0026#34;VMware-v4vdesktopagent-x86_64-6.2.0-3295266.exe\u0026#34; 12 $Param = \u0026#34;/s /v/qn REBOOT=Reallysuppress\u0026#34; 13 $SrcPath = \u0026#34;c:\\\u0026#34; 14 $DstPath = \u0026#34;c:\\temp\\\u0026#34; 15 $Fullpath = $SrcPath + $File 16 17 Write-Host Copying $Fullpath to $VMName -ForegroundColor Cyan 18 Copy-VMGuestFile -VM $VM -Source $Fullpath -Destination $DstPath -LocalToGuest -GuestCredential $Cred -Force 19 20 #Define Install File Command 21 $Command = $DstPath + $File + $Param 22 #Define Delete File Command 23 $Command2 = \u0026#34;del \u0026#34; + $DstPath + $File 24 25 Write-Host Executing $Command within guest operating system of $VMName -ForegroundColor White 26 $Result = Invoke-VMScript -VM $VM -ScriptText $Command -GuestCredential $Cred 27 $ExitCode = $Result.ExitCode 28 if ($ExitCode = \u0026#34;0\u0026#34;) { 29 Write-Host $VMName returned exit code $ExitCode -ForegroundColor Green 30 } 31 Else { 32 Write-Host $VMName returned exit code $ExitCode -ForegroundColor Red 33 } 34 Write-Host Executing $Command2 within guest operating system of $VMName -ForegroundColor White 35 $Result2 = Invoke-VMScript -VM $VM -ScriptText $Command2 -GuestCredential $Cred 36 $ExitCode2 = $Result2.ExitCode 37 if ($ExitCode2 = \u0026#34;0\u0026#34;) { 38 Write-Host $VMName returned exit code $ExitCode2 -ForegroundColor Green 39 } 40 Else { 41 Write-Host $VMName returned exit code $ExitCode2 -ForegroundColor Red 42 } 43} 44 Execute the Script  Run .\\InstallVMSoftware.ps1  ","permalink":"https://davidstamen.com/2016/01/29/using-powercli-to-install-software-in-a-guest-vm/","tags":["PowerCLI"],"title":"Using PowerCLI to Install Software in a Guest VM"},{"categories":["VMware"],"contents":"We have multiple clusters within our vCenters that are defined as a rack. Each rack has its own storage, so storage is not shared between clusters. I needed to develop a way to easily replicate templates between clusters, so a local copy existed on each cluster to take advantage of VAAI.\nI really wanted to utilize the vSphere Content Libary for these, but there is currently no publicly available documentation on how to deploy a VM from a Content Library via a Script. I am hoping when that is available, I will update this post.\nPre-Requsites  VMware PowerCLI  Link to Script  CloneTemplateToClusters.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\nThis script assumes the datastore you would like to deploy to is a datastore cluster. Mine are named cluster-dsc so this script was easily scaleable.\n1#Import PowerCLI Module 2Add-PSSnapin VMware.VimAutomation.Core 3 4#Define Variables 5$Credential = Get-Credential 6$vCenter = \u0026#34;vcenter.lab.local\u0026#34; 7$clusters = \u0026#34;Cluster01\u0026#34;,\u0026#34;Cluster02\u0026#34; 8$location = \u0026#34;Templates\u0026#34; 9$templates = \u0026#34;Template1\u0026#34;,\u0026#34;Template2\u0026#34; 10 11#Connect to vCenter 12Connect-VIServer $vCenter -Credential $Credential 13 14foreach ($template in $templates){ 15 foreach ($cluster in $clusters){ 16 #Check if Template exists 17 Try{Get-Template $template-$cluster -ErrorAction Stop;$TemplateExists = $true}Catch {$TemplateExists = $false} 18 #Create VM 19 If($TemplateExists -eq $true){ 20 #Remove Old Template 21 Get-Template -Name $template-$cluster |Remove-Template -DeletePermanently -Confirm:$false 22 #Clone the Template 23 New-VM -Name $template-$cluster -Template $template -ResourcePool $cluster -Datastore $cluster-DSC -Location $location 24 #Convert to Template 25 Set-VM -VM $template-$cluster -ToTemplate -Confirm:$false 26 } 27 ElseIf($TemplateExists -eq $false){ 28 #Clone the Template 29 New-VM -Name $template-$cluster -Template $template -ResourcePool $cluster -Datastore $cluster-DSC -Location $location 30 #Convert to Template 31 Set-VM -VM $template-$cluster -ToTemplate -Confirm:$false 32 } 33 } 34} 35#Disconnect from vCenter 36Disconnect-VIServer $vCenter -Force -Confirm:$false Execute the Script  Run .\\CloneTemplateToClusters.ps1  ","permalink":"https://davidstamen.com/2016/01/26/using-powercli-to-replicate-templates-to-multiple-clusters/","tags":["PowerCLI"],"title":"Using PowerCLI to Replicate Templates to Multiple Clusters"},{"categories":["Cisco"],"contents":"For conformity, we like to set the UCS Equipment labels to match the Service Profile Name. This allows us to match it quickly without having to dig down into the assigned profile. This script will set the UsrLbl and Name fields on the equipment tab to match the name of the Service Profile.\nPre-Requsites  UCS Powertool  Link to Script  Set-UCSEquipmentLabel.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\nThis script is currently setup to be applied to Rack Units. To have this work for blades, change the Get-UCSRackUnit and Set-UCSRackunit to be Get-UCSBlade and Set-UCSBlade.\n1#Define Variables 2$cred = Get-Credential 3$domains = \u0026#34;ucs01.lab.local\u0026#34;,\u0026#34;ucs02.lab.local\u0026#34; 4 5#Cycles through each UCS setting values 6Foreach ($ucs in $domains) { 7 Connect-UCS $ucs -Credential $cred 8 $servers = Get-UCSRackUnit 9 Foreach ($server in $servers) { 10 Get-UCSRackUnit -id $server.id | Set-UCSRackunit -UsrLbl $server.assignedtodn.substring(12) -Name $server.assignedtodn.substring(12) -force 11 } 12 Disconnect-UCS 13} Execute the Script  Run .\\Set-UCSEquipmentLabel.ps1  ","permalink":"https://davidstamen.com/2016/01/15/using-ucs-powertool-to-set-equipment-labels/","tags":["Cisco UCS","Powershell"],"title":"Using UCS PowerTool To Set Equipment Labels"},{"categories":["Cisco"],"contents":"Automation, Automation, Automation! I had to download some support bundles for every chassis in our multiple zones. Instead of manually going through the GUI, I figured why not script it! This script will connect to each UCS domain and automatically generate a support bundle and download it for each chassis.\nPre-Requsites  UCS Powertool  Link to Script  Create-UCSTechSupport.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\n1#Define Variables 2$cred = Get-Credential 3$domains = \u0026#34;ucs01.lab.local\u0026#34;,\u0026#34;ucs02.lab.local\u0026#34; 4$fileloc = \u0026#34;C:\\Users\\david\\desktop\\logs\\\u0026#34; 5 6#Cycles through each UCS creating a tech support for each chassis. 7Foreach ($ucs in $domains) { 8Connect-UCS $ucs -Credential $cred 9$Chassis = Get-UCSChassis 10 Foreach ($chassis in $chassis) { 11 $id = $chassis.id 12 $filename = \u0026#34;$fileloc$ucs-techsupp-chassis-$id.tar\u0026#34; 13 Get-UcsTechSupport -PathPattern $filename -RemoveFromUcs -TimeoutSec 600 -ChassisId $id -CIMC \u0026#39;all\u0026#39; 14 } 15Disconnect-UCS 16} 17 Execute the Script  Run .\\Create-UCSTechSupport.ps1  ","permalink":"https://davidstamen.com/2016/01/14/using-ucs-powertool-to-generate-tech-supports/","tags":["Cisco UCS","Powershell"],"title":"Using UCS PowerTool To Generate Tech Supports"},{"categories":["VMware"],"contents":"For the past week, I have been troubleshooting the strangest issue. I have been attempting to move some Windows 8.1 VM\u0026rsquo;s from our legacy datacenter(iSCSI) to our new datacenter(FC).\nWhenever I would move the VM to our new DC, it would fail to boot properly. It would boot straight to Windows Recovery. If I moved the same VM to any other type of storage(NFS, iSCSI, Local) the VM would boot perfectly fine. I opened a case with VMware and our Storage vendor and no one had any idea what was causing it.\nStrangely enough my coworker found the following article today that explains and provides a workaround. KB2137402\nAlso, our storage vendor Pure Storage also had an article explaining the issue. [Windows-2012-R2-and-Windows-8-boot-fails-after-Storage-VMotion]http://community.purestorage.com/t5/Pure-Customer-Knowledge-Base/Windows-2012-R2-and-Windows-8-boot-fails-after-Storage-VMotion/ta-p/4109]\nSo today I went and modified a host to have the DiskMaxIOSize to be 4096 instead of the default 32767, and the VM booted up fine! All my stress and troubleshooting could finally be resolved. Strange enough this issue has been around since 5.5 and there is still no actual resolution. I am not even sure if this is an array or VMware issue as this seems to affect 3Par and XtremIO as well.\nHowever, since I had to replicate this change to a bunch of hosts I created a script to make this change.\nLink to Script  Set-MaxDiskIO.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\n1# PowerCLI Script for setting Disk Max IO Size 2# @davidstamen 3# http://davidstamen.com 4 5#Define Variables 6$cred = Get-Credential 7$VC = \u0026#34;vc.lab.local\u0026#34; 8$Cluster = \u0026#34;Production\u0026#34; 9 10#Connect to vCenter 11Connect-VIServer $VC -Credential $cred 12 13#Get all Hosts 14$esxHosts = Get-Cluster $Cluster | Get-VMHost | Where { $_.PowerState -eq \u0026#34;PoweredOn\u0026#34; -and $_.ConnectionState -eq \u0026#34;Connected\u0026#34; } | Sort Name 15 16#For each host set DiskMaxIOsize to 4MB 17foreach ($esx in $esxHosts) { 18 Get-AdvancedSetting -Entity $esx -Name Disk.DiskMaxIOSize | Set-AdvancedSetting -Value 4096 -Confirm:$false 19} Execute the Script  Run .\\Set-MaxDiskIO.ps1  Hopefully this helps anyone else who comes across this issue, not alot of people have seen it.\n","permalink":"https://davidstamen.com/2016/01/13/unable-to-boot-efi-vm-on-esxi-fc-storage/","tags":["PowerCLI","Storage"],"title":"Unable to Boot EFI VM on ESXi FC Storage"},{"categories":["VMware"],"contents":"Welcome to my post about upgrading your VMware vCenter Server Appliance (VCSA) to 6.0 U1b.\nThis process is very straight forward. We will begin with updating our Platform Service Controllers (PSC) and then proceed with the vCenter Appliance.\n SSH to your Primary PSC. If you are currently in the bash shell, type appliancesh to switch shells to run the update. Run software-packages install \u0026ndash;url \u0026ndash;acceptEulas to download and install the packages from the VMware Repo.  You can use the \u0026ndash;ISO switch or supply a custom url as well if needed.   Sit back and wait. Once it is finished you will be prompted to reboot.  Reboot by typing shutdown reboot /r reason     When VM boots you will now be at the latest version.   Repeat if you have additional PSC\u0026rsquo;s in your environment.  Now that our Platform Service Controllers are upgraded we can proceed on with our vCenter Appliance.\n SSH to your vCenter Appliance. If you are currently in the bash shell, type appliancesh to switch shells to run the update. Run software-packages install \u0026ndash;url \u0026ndash;acceptEulas to download and install the packages from the VMware Repo.  You can use the \u0026ndash;ISO switch or supply a custom url as well if needed.   Sit back and wait. Once it is finished you will be prompted to reboot.  Reboot by typing shutdown reboot /r reason     When VM boots you will now be at the latest version.  ","permalink":"https://davidstamen.com/2016/01/12/upgrading-vcsa-from-60-u1a-to-60u1b/","tags":["vSphere 6.0"],"title":"Upgrading VCSA from 6.0 U1a to 6.0U1b using CLI"},{"categories":["Cisco"],"contents":"It\u0026rsquo;s patch time! That means time to upload the firmware bundles to all my UCS domains. Instead of doing it manually I figured i would create a quick script to do that for me.\nPre-Requsites  UCS Powertool  Link to Script  UploadUCSFirmware.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\n1#Define Variables 2$cred = Get-Credential 3$domains = \u0026#34;ucs01.lab.local\u0026#34;,\u0026#34;ucs02.lab.local\u0026#34; 4$fileName = \u0026#34;C:\\Users\\david\\Downloads\\ucs-k9-bundle-infra.2.2.6e.A.bin\u0026#34; 5 6#Cycles through each UCS uploading the UCS Firmware 7Foreach ($ucs in $domains) { 8 Connect-UCS $ucs -Credential $cred 9 Send-UcsFirmware -LiteralPath $fileName | Watch-Ucs -Property TransferState -SuccessValue downloaded -PollSec 30 -TimeoutSec 600 10 Disconnect-UCS 11} Execute the Script  Run .\\UploadUCSFirmware.ps1  ","permalink":"https://davidstamen.com/2016/01/11/using-ucs-powertool-to-upload-ucs-firmware/","tags":["Cisco UCS","Powershell"],"title":"Using UCS PowerTool To Upload UCS Firmware"},{"categories":["Certification"],"contents":"It is now VCAP6-Design study time! Here is my blueprint laid out, and hopefully will be populated with some content.\nSection 1 â€“ Create a vSphere Conceptual Design Objective 1.1 â€“ Gather and analyze business requirements Skills and Abilities\n Associate a stakeholder with the information that needs to be collected. Utilize inventory and assessment data from a current environment to define a baseline state. Analyze customer interview data to explicitly define customer #### Objectives for a conceptual design. Determine customer priorities for defined #### Objectives. Ensure that Availability, Manageability, Performance, Recoverability and Security (AMPRS) considerations are applied during the requirements gathering process. Given results of the requirements gathering process, identify requirements for a conceptual design. Categorize requirements by infrastructure qualities to prepare for logical design requirements.  Tools\n VMware Virtualization Case Studies The Benefits of Virtualization for Small and Medium Businesses Functional vs. Non-Functional Requirements Conceptual, Logical, Physical: It is Simple Virtualize Business Critical Applications (blog) Virtualizing Business Critical Applications on vSphere  Objective 1.2 â€“ Gather and analyze application requirements Skills and Abilities\n Gather and analyze application requirements for a given scenario. Determine the requirements for a set of applications that will be included in the design. Collect information needed in order to identify application dependencies. Given one or more application requirements, determine the impact of the requirements on the design.  Tools\n VMware TCO Calculator VMware Cost-Per-Application Calculator Methodology Virtualizing Oracle with VMware Virtualizing Exchange with VMware Virtualize SharePoint with VMware vSphere Virtualizing Microsoft SQL on VMware vSphere SAP and VMware Virtualization Business and Financial Benefits of Virtualization: Customer Benchmarking Study  Objective 1.3 â€“ Determine Risks, Requirements, Constraints and Assumptions Skills and Abilities\n Differentiate between the concepts of risks, requirements, constraints, and assumptions. Given a statement, determine whether it is a risk, requirement, constraint, or an assumption. Analyze impact of VMware best practices to identified risks, constraints, and assumptions.  Tools\n Developing Your Virtualization Strategy and Deployment Plan Constraints, Assumptions (Risk, Requirements) \u0026amp; Dependencies  Section 2 â€“ Create a vSphere 6.x Logical Design from an Existing Conceptual Design Objective 2.1 â€“ Map Business Requirements to a vSphere 6.x Logical Design Skills and Abilities\n Analyze requirements for functional and non-functional elements. Build non-functional requirements into a specific logical design. Translate stated business requirements into a logical design. Incorporate the current state of a customer environment into a logical design.  Tools\n Conceptual, Logical, Physical: It is Simple Whatâ€™s New in VMware vSphere 6.0 Functional vs. Non-Functional Requirements ITIL v3 Introduction and Overview Conceptual Architecture Action Guide Systems Architecture Fundamentals â€“ Conceptual, Logical, Physical Designs  Objective 2.2 â€“ Map Service Dependencies Skills and Abilities\n Evaluate dependencies for infrastructure and application services that will be included in a vSphere design. Create Entity Relationship Diagrams that map service relationships and dependencies. Analyze interfaces to be used with new and existing business processes. Determine service dependencies for logical components. Include service dependencies in a vSphere 6.x Logical Design. Analyze services to identify upstream and downstream service dependencies. Navigate logical components and their interdependencies and make decisions based upon all service relationships.  Tools\n Datacenter Operational Excellence Through Automated Application Discovery \u0026amp; Dependency Mapping VMware Application Dependencies and Entity Relationship Diagrams MK2  Objective 2.3 â€“ Build Availability Requirements into a vSphere 6.x Logical Design Skills and Abilities\n Evaluate which logical availability services can be used with a given vSphere solution. Differentiate infrastructure qualities related to availability. Describe the concept of redundancy and the risks associated with single points of failure Explain class of nines methodology Determine availability component of service level agreements (SLAs) and service level management processes Determine potential availability solutions for a logical design based on customer requirements. Create an availability plan, including maintenance processes. Balance availability requirements with other infrastructure qualities. Analyze a vSphere design and determine possible single points of failure.  Tools\n Datacenter Operational Excellence Through Automated Application Discovery \u0026amp; Dependency Mapping vSphere Availability Guide Protect Your Business with Automated Business Continuity Solutions VMware High Availability Deployment Best Practices  Objective 2.4 â€“ Build Manageability Requirements into a vSphere 6.x Logical Design Skills and Abilities\n Evaluate which management services can be used with a given vSphere Solution. Differentiate infrastructure qualities related to management. Differentiate available command line-based management tools (PowerCLI, vMA etc.) Evaluate VMware Management solutions based on customer requirements. Build interfaces into the logical design for existing operations practices. Address identified operational readiness deficiencies Define Event, Incident and Problem Management practices. Analyze Release Management practices Determine request fulfillment and release management processes. Determine requirements for Configuration Management Define change management processes based on business requirements. Based on customer requirements, identify required reporting assets and processes  Tools\n Optimizing Your VMware Environment Four Keys to Managing Your VMware Environment Operational Readiness Assessment Operational Readiness Assessment Tool vCenter Server and Host Management Guide vSphere PowerCLI documentation Center  Objective 2.5 â€“ Build Performance Requirements into a vSphere 6.x Logical Design Skills and Abilities\n Evaluate logical performance considerations for a given vSphere solution. Differentiate infrastructure qualities related to performance. Analyze current performance, identify and address gaps when building the logical design Using a conceptual design, create a logical design that meets performance requirements Determine performance-related functional requirements based on given non-functional requirements and service dependencies. Define capacity management practices and create a capacity plan Incorporate scalability requirements into the logical design Determine a performance component for service level agreements and service level management processes.  Tools\n Proven Practice: Implementing ITIL v3 Capacity Management in a VMware environment vSphere Monitoring and Performance Guide  Objective 2.6 â€“ Build Recoverability Requirements into a vSphere 6.x Logical Design Skills and Abilities\n Evaluate which logical recoverability services are available for a given vSphere solution. Differentiate infrastructure qualities related to recoverability. Determine Business Continuity and Disaster Recovery solution options for a given vSphere Design. Given recoverability requirements, analyze services that will be impacted and provide a recovery plan for impacted services. Plan a data retention policy based on customer requirements.  Tools\n VMware vCenterâ„¢ Site Recovery Manager Evaluation Guide A Practical Guide to Business Continuity and Disaster Recovery with VMware Infrastructure Mastering Disaster Recovery: Business Continuity and Virtualization Best Practices Whitepaper  Objective 2.7 â€“ Build Security Requirements into a vSphere 6.x Logical Design Skills and Abilities\n Evaluate which security services can be used with a given vSphere solution. Differentiate infrastructure qualities related to security. Build specific regulatory compliance requirements into the logical design. Analyze application and infrastructure security requirements. Build a role-based access model and map roles to services. Build a security policy based on existing security requirements and IT governance practices. Incorporate customer risk tolerance into the security policy. Assess the services that will be impacted and create an access management plan. Determine the proper security solution that would satisfy a regulatory requirement. Based on stated security requirements, analyze the current state for compliance/non-compliance.  Tools\n vSphere Security Guide Developing Your Virtualization Strategy and Deployment Plan Achieving Compliance in a Virtualized Environment Infrastructure Security: Getting to the Bottom of Compliance in the Cloud Securing the Cloud  Section 3 â€“ Create a vSphere 6.x Physical Design from an Existing Logical Design Objective 3.1 â€“ Transition from a Logical Design to a vSphere 6.x Physical Design Skills and Abilities\n Analyze design decisions and options selected from the logical design Determine impact of VMware best practices to identified risks, constraints, and assumptions in a given vSphere design. Based on business requirements, determine the appropriate roles for each staff member.  Tools\n Conceptual, Logical, Physical: It is Simple vSphere Server and Host Management Guide vSphere Virtual Machine Administration Guide  Objective 3.2 â€“ Create a vSphere 6.x Physical Network Design from an Existing Logical Design Skills and Abilities\n Analyze VLAN options with respect to virtual and physical switches. Given business requirements, determine the design for virtual network components:  STP Jumbo Frames Load-balancing Trunking and link aggregation groups   Evaluate network redundancy considerations for a given design. Analyze design for inclusion of Network I/O Control capabilities. Determine use case for multiple TCP/IP stacks in a given design. Based on given functional requirements for each service:  Determine the most appropriate networking technologies for the design. Implement the service based on the required infrastructure qualities (AMPRS.)   Analyze design for appropriate network teaming and failover solution. Determine network security and firewall requirements for a virtual network design Based on service level requirements, determine appropriate network performance characteristics. Given a current network configuration as well as technical requirements and constraints, determine the appropriate virtual switch solution:  vSphere Standard Switch vSphere Distributed Switch NSX Hybrid solutions   Based on an existing logical design, determine appropriate host networking resources. Properly apply converged networking considering VMware best practices.  Tools\n vSphere Server and Host Management Guide vSphere Installation and Setup Guide - vSphere Networking Guide - Network Port Diagram for vSphere 6.x VMware Virtual SAN Network Design Guide Leveraging NIC Technology to Improve Network Performance in VMware vSphere Performance Evaluation of Network I/O Control in VMware vSphere 6 vMotion Architecture, Performance and Best Practices in VMware vSphere 5  Objective 3.3 â€“ Create a vSphere 6.x Physical Storage Design from an Existing Logical Design Skills and Abilities\n Evaluate criteria, capabilities and limitations between storage types (Block, NAS, Object Based) In a given design, determine Storage Policy availability and performance characteristics. Based on the logical design and given functional requirements, for each service:  Determine the most appropriate storage technologies for the design. Implement the service based on the required infrastructure qualities.   Ensure storage array capabilities are supported in a vSphere 6.x design:  Active/Active, Active/Passive ALUA, VAAI, VASA PSA (including PSPs and SATPs)   Based on service level requirements include VMware technologies in the design, such as:  Storage I/O Control and Network I/O Control Storage Policies Storage vMotion Storage DRS Virtual SAN   Given the functional requirements, size the storage for capacity, availability and performance, including:  Datastores, RDMs, Virtual Disks Physical Storage (LUNs, Storage Tiering) Based on the logical design, select and incorporate an appropriate storage network into the physical design: Block (FC, iSCSI, FCoE, SAS) NAS (NFSv3, NFSv4) Object Based (Virtual SAN, Virtual Volumes)    Tools\n Whatâ€™s New: VMware Virtual SAN 6.0 VMware Virtual SAN 6.0 Design and Sizing Guide VMware Virtual SAN Diagnostics and Troubleshooting Reference Manual The VMware Perspective on Software-Defined Storage vSphere Storage Resource Management Guide Virtual SAN TCO and Sizing Calculator Whatâ€™s New: VMware vSphere Virtual Volumes vSphere Installation and Setup Guide VMware Virtual Machine File System: Technical Overview and Best Practices TechNote: Bootstrapping VSAN without vCenter  Objective 3.4 â€“ Determine Appropriate Compute Resources for a vSphere 6.x Physical Design Skills and Abilities\n Analyze best practices with respect to CPU family choices. Evaluate NUMA and vNUMA with ESXi hosts and Virtual machines in a given design. Analyze the following in a vSphere design:  Enhanced vMotion compatibility Implications of vSMP in virtual machines Transparent Page Sharing (TPS) and large pages Resource overcommitment   Based on the service catalog and given functional requirements:  Determine the most appropriate compute technologies for the design. Implement the service based on the required infrastructure qualities.   Determine the impact of a technical design on the choice of server density:  Scale Up/Out Auto Deploy   Calculate the required number of nodes in an HA cluster based upon host failures and resource guarantees. Evaluate the implications of using reservations, limits, and shares on the physical design. Specify the resource pool and vApp configuration based upon resource requirements. Size the following resources appropriately:  Memory CPU I/O devices Internal storage   Given a constraint to use existing hardware, determine suitability of the hardware for the design.  Tools\n vSphere Server and Host Management Guide Whatâ€™s New in the VMware vSphereÂ® 6.0 Platform vSphere Installation and Setup Guide vSphere Resource Management Guide Performance Best Practices for VMware vSphere 6.0 VMware vCenter Server Performance and Best Practices Best Practices for Performance Tuning of Latency-Sensitive Workloads in vSphere VMs Performance Characterization of Microsoft SQL Server on VMware vSphere 6 Microsoft Exchange 2013 on VMware Best Practices Guide - vSphere Monitoring and Performance Guide Interpreting esxtop statistics  Objective 3.5 â€“ Determine Virtual Machine Configuration for a vSphere 6.x Physical Design Skills and Abilities\n Analyze the use of an RDM or a virtual disk for a given VM. Evaluate Virtual Machine memory management techniques (ballooning, compression, swapping) in a given vSphere design. Based on business requirements, determine the design significance of VM Swap location. Determine the latency sensitivity requirements of a given virtual machine workload. Evaluate virtual machine features based on the logical, functional and application requirements. Use VMware best practices to size virtual machines according to application requirements. Determine if reservations, shares, and limits are necessary. Based on an existing logical design, determine virtual hardware options. Build a Content Library of appropriate virtual machine offerings (e.g. templates, OVFs, ISOs.) Determine appropriate use cases for vApps. Evaluate the suitability of using VMware FT or 3rd party clustering products (e.g. Microsoft Clustering, etc.) based on application requirements. Determine the impact of scheduled guest activities (e.g. anti-virus, backup, etc) to the design. Evaluate vFlash read cache requirements in a given design.  Tools\n Virtual Machine Administration Guide Best Practices for Performance Tuning of Latency-Sensitive Workloads in vSphere VMs Virtualizing a Windows Active Directory Domain Infrastructure Guest Operating System Installation Guide vSphere Resource Management Guide Understanding Memory Management in VMware vSphere 6.0  Objective 3.6 â€“ Determine Data Center Management Options for a vSphere 6.x Physical Design Skills and Abilities\n Based on business requirements, determine client access options in a vSphere solution. Analyze business requirements when integrating vSphere with other VMware solutions. Evaluate the impact of the VMware Certificate Authority and the VMware Endpoint Certificate Store to the design. Based on the logical design and given functional requirements:  Determine the most appropriate datacenter management options for the design. Implement the service based on the required infrastructure qualities.   Analyze cluster requirements:  Availability requirements for HA and FT Performance requirements for DRS and vMotion Storage performance requirements for SDRS and Storage vMotion   Determine appropriate vCenter Server design and sizing requirements:  vCenter Server Enhanced Linked Mode vCenter Server virtual appliance vs vCenter Server for Windows Platform Services Controller   Evaluate access control methodologies for creating roles and assignment of users to roles. Determine proper structure for access control settings (i.e. folders, resource pools, etc.) Develop appropriate host and virtual machine deployment options. Include in the design appropriate technologies for:  Asset management Event, incident and problem management Logging, monitoring and reporting    Tools\n vSphere Monitoring and Performance Guide VMware vCenter Server 6.0 Availability Guide vCenter Server and Host Management Guide VMware vCenter Update Manager 6.0 Performance and Best Practices vCenter Server Deployment Guide VMware Interoperability Matrix VMware Proactive Incident Whitepaper  ","permalink":"https://davidstamen.com/2015/12/17/vcap6-design-beta-study-guide/","tags":["VCAP6-DCV Design"],"title":"VCAP6-Design Beta Study Guide"},{"categories":["Cisco"],"contents":"Im finally getting to dive back in to working with UCS. My latest task with my project of configuring 9 UCS Domains, was configuring the Policy Backup and Export. See below on how to automate this process!\nPre-Requsites  UCS Powertool  Link to Script  Set-UCSPolicyBackupandExport.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\n1#Define Variables 2$UCS = \u0026#34;FQDNofUCS\u0026#34; #FQDN of UCS To COnnect To 3$Hostname = \u0026#34;ucs.lab.local\u0026#34; #Hostname to Upload backup to. 4$Protocol = \u0026#34;scp\u0026#34; #Transfer Protocol. ftp,scp,tftp,sftp 5$User = \u0026#34;ftpuser\u0026#34; #Username 6$Password = \u0026#34;ftpuser\u0026#34; #Password 7$MgmtBackupRemoteFile = \u0026#34;Full\u0026#34; #Location/Prefix of File. Location/Prefix will be in front of filename 8$ConfigBackupRemoteFile = \u0026#34;AllConfig\u0026#34; #Location/Prefix of File. Location/Prefix will be in front of filename 9$AdminState = \u0026#34;enable\u0026#34; #enable or disable 10$Schedule = \u0026#34;1day\u0026#34; #1day, 7day, 14day for daily, weekly or biweekly backups Execute the Script  Run .\\Set-UCSPolicyBackupandExport.ps1 Logon and UCSM, Navigate to Admin/All and Then select the Policy Backup \u0026amp; Export.  Verify Settings.    Hope this helps anyone else out wanted to automate policy backup \u0026amp; export on Cisco UCS. ","permalink":"https://davidstamen.com/2015/12/11/using-ucs-powertool-to-configure-ucs-policy-backup-and-export/","tags":["Cisco UCS","Powershell"],"title":"Using UCS PowerTool To Configure UCS Policy Backup and Export"},{"categories":["Cisco"],"contents":"Im finally getting to dive back in to working with UCS. My latest task with my project of configuring 9 UCS Domains, was swapping out certificates. The first few I did via the GUI, and I thought can this be scripted? Well the answer is yes! See below for information on executing the script.\nPre-Requsites  UCS Powertool  Link to Script  AddUCSCert.ps1  Preparing to Execute the Script The script is pretty straight forward, just need to define a few variables seen below and then you execute the script. I will walk you through the process.\n1#Define Variables 2$UCS = \u0026#34;FQDNofUCS\u0026#34; #Used to Connect to UCSM via PowerTool 3$TrustPoint = \u0026#34;TP-Name\u0026#34; #Name of TrustPoint, AKA Root CA 4$KeyRing = \u0026#34;KeyRingName\u0026#34; #name of KeyRing. Stores Certificate Information 5$Modulus = \u0026#34;mod2048\u0026#34; #2048 bit key this can be 1024,2048,4096, etc 6$CertDNS = \u0026#34;FQDNofUCS\u0026#34; #FQDN for Cert Request 7$CertLocality = \u0026#34;City\u0026#34; #City for Cert Request 8$CertState = \u0026#34;State\u0026#34; #State for Cert Request 9$CertCountry = \u0026#34;US\u0026#34; #Country for Cert Request 10$CertOrgName = \u0026#34;Org\u0026#34; #OrgName for Cert Request 11$CertEmail = \u0026#34;me@lab.com\u0026#34; #Email for Cert Request 12$CertSubjName = \u0026#34;FQDNofUCS\u0026#34; #FQDN for Cert Request 13$CertIP = \u0026#34;FI-VIP-IP\u0026#34; #FI-VIP IP for Cert Request 14$CertIpA = \u0026#34;FI-A-IP\u0026#34; #FI-A IP for Cert Request 15$CertIpB = \u0026#34;FI-B-IP\u0026#34; #FI-B IP for Cert Request 16$TPChain = \u0026#34;-----BEGIN CERTIFICATE----- 17PASTE CERT CONTENT HERE FOR ROOTCA 18-----END CERTIFICATE----- 19-----BEGIN CERTIFICATE----- 20PASTE CERT CONTENT HERE FOR SUB CA 21-----END CERTIFICATE-----\u0026#34; #Delete Second part if not using a Root/Sub Scenario. To gather information for the variables above you should have most the information handy. To get the TPChain(The Root/Sub Certs) you can follow these steps.\n If using a Microsoft CA navigate to http://caroot/certsrv. From here you can download the CA Certificate. Make sure to download it in the Base 64 format. If using a Microsoft Sub CA as well, navigate to http://casub/certsrv. From here you can download the CA Certificate. Make sure to download it in the Base 64 format.   If using a Non-Microsoft CA, contact your certificate provider for their root certificate and following the remaining steps. Open Certificate using a text editor and you should have it in a standard format, paste that info in the variable field. If not using a Sub, Delete the second part.  Executing the Script  Navigate to the directory using PowerShell and run .\\AddUCSCert.ps1 If you look inside UCSM you will see the script create the TrustPoint and KeyRing for the new certificate   If you navigate to the KeyRing you will see the completed certificate Request.   You will also see a popup, asking you for the completed certificate information. From here you will either submit it to your microsoft ca at htt://ca/certsrv and request an advanced web server certificate based on the CSR info in the keyring, or submit this to your 3rd party certificate provider.   Once you paste the completed certificate in the script will finish executing, and will input the certificate information and set UCSM to use the new certificate. (You will be disconnected and have to reconnect.) You can verify the certificate information by logging back in and selecting the Certificate Details button on the keyring.  Hope this helps anyone else out wanted to automate certificate replacement on Cisco UCS. ","permalink":"https://davidstamen.com/2015/12/10/using-ucs-powertool-to-configure-ucs-certificates/","tags":["Cisco UCS","Powershell"],"title":"Using UCS PowerTool To Configure UCS Certificates"},{"categories":["VMware"],"contents":"Normally when i need to install and update a host VIB I use Update Manager. However there is currently a bug with Cisco\u0026rsquo;s latest enic/fnic drivers that wont let you install them via UM.\nI had to run these updates on over 50 hosts and I really didn\u0026rsquo;t want to have to ssh and install it manually. Lucky I remember Brian Graf\u0026rsquo;s Host Client Install Fling and borrowed some of the code to come up with the below script.\nAll you need to do is input your cluster and specify what VIB\u0026rsquo;s you want to install. You can see the VIBPath and the Actions and just add or delete them as needed for the VIB\u0026rsquo;s you want to install.\n1# Define Variables 2$Cluster = \u0026#34;Cluster\u0026#34; 3$VIBPATH1 = \u0026#34;/vmfs/volumes/NFS01/VIB/cisco/net-enic-2.1.2.71-1OEM.550.0.0.1331820.x86_64.vib\u0026#34; 4$VIBPATH2 = \u0026#34;/vmfs/volumes/NFS01/VIB/cisco/scsi-fnic-1.6.0.17a-1OEM.550.0.0.1331820.x86_64.vib\u0026#34; 5 6 7# Get each host in specified cluster that meets criteria 8Get-VMhost -Location $Cluster | where { $_.PowerState -eq \u0026#34;PoweredOn\u0026#34; -and $_.ConnectionState -eq \u0026#34;Connected\u0026#34; } | foreach { 9 10 Write-host \u0026#34;Preparing $($_.Name) for ESXCLI\u0026#34; -ForegroundColor Yellow 11 12 $ESXCLI = Get-EsxCli -VMHost $_ 13 14 # Install VIBs 15 Write-host \u0026#34;Installing VIB on $($_.Name)\u0026#34; -ForegroundColor Yellow 16 $action = $ESXCLI.software.vib.install($null,$null,$null,$null,$null,$true,$null,$null,$VIBPATH1) 17 $action2 = $ESXCLI.software.vib.install($null,$null,$null,$null,$null,$true,$null,$null,$VIBPATH2) 18 19 # Verify VIB installed successfully 20 if ($action.Message -eq \u0026#34;Operation finished successfully.\u0026#34;){Write-host \u0026#34;Action Completed successfully on $($_.Name)\u0026#34; -ForegroundColor Green} else {Write-host $action.Message -ForegroundColor Red} 21 if ($action2.Message -eq \u0026#34;Operation finished successfully.\u0026#34;){Write-host \u0026#34;Action Completed successfully on $($_.Name)\u0026#34; -ForegroundColor Green} else {Write-host $action.Message -ForegroundColor Red} 22} Hope this helps anyone else out wanting to automate vib installation using PowerCLI.\n","permalink":"https://davidstamen.com/2015/11/30/installing-host-vibs-using-powercli/","tags":["PowerCLI","ESXi"],"title":"Installing Host VIB's Using PowerCLI"},{"categories":["VMware"],"contents":"Ever needed to modify a DVS uplink configuration from ESXi Shell? I am currently troubleshooting some issues with DVS uplinks no longer being assigned on reboot.\nAs a heads up. If you are doing this on ESXi 6.0.. don\u0026rsquo;t. It can cause an issue with the proxy DVS having different ID than the actual DVS causing my original issue, still working with VMware Support to find out more details.\nAfter \u0026ldquo;Restoring Network Configuration\u0026rdquo; a few too many times, I finally realized I could just add the uplinks back via CLI until support can figure out why this is occurring, here are the details on how to manage the uplinks on a DVS via CLI.\nTo view your current dvs configuration you can run esxcfg-vswitch -l. Here you can see the DVS Name, Uplinks and DVPort ID which is all information you need to move forward.\n1DVS Name Num Ports Used Ports Configured Ports MTU Uplinks 2dvSwitch 256 3 256 1500 vmnic0,vmnic1 3 4 DVPort ID In Use Client 5 0 1 vmnic0 6 1 1 vmnic1 To REMOVE an Uplink you can use these steps. Where -Q is to remove the vmnic, -V is the DVPort ID and dvSwitch is the name of the DVS.\n1esxcfg-vswitch -Q vmnic1 -V 1 dvSwitch To ADD an Uplink you can use these steps. Where -P is to add the vmnic, -V is the DVPort ID and dvSwitch is the name of the DVS.\n1esxcfg-vswitch -P vmnic1 -V 1 dvSwitch ","permalink":"https://davidstamen.com/2015/11/30/using-cli-to-manage-dvs-host-uplinks/","tags":["Networking","ESXCLI"],"title":"Using CLI to Manage DVS Host Uplinks"},{"categories":["Cisco"],"contents":"We are currently working on some Cisco ACI Integration and wanted to add a large VLAN Pool to a UCS Configuration.\nSince currently Cisco UCS does not allow selecting multiple VLAN\u0026rsquo;s easily when adding to a VLAN Group or vNIC Template, we now have a pretty decent script that will do it for you.\nThe script can be found here.\n1# PowerCLI Script for adding VLAN to VLAN Group and vNIC Template 2# @davidstamen 3# http://davidstamen.com 4 5#Define Variables 6$cred = Get-Credential 7$ucs = \u0026#34;ucs01\u0026#34; 8$startvlan = \u0026#34;100\u0026#34; 9$endvlan = \u0026#34;150\u0026#34; 10$vnictemplate = \u0026#34;vnic-template\u0026#34; 11$vlangroup = \u0026#34;vlan-group\u0026#34; 12 13#Connect to UCS 14Connect-UCS $ucs -credential $cred 15 16#Assumes VLAN Name is the VLANID. Adds VLAN from start to end to vlan group 17for($i=$startvlan;$i -le $endvlan;$i++){Get-UcsFabricNetGroup -Name $vlangroup |Add-UcsFabricPooledVlan -Name \u0026#34;$i\u0026#34;} 18 19#Assumes VLAN Name is the VLANID. Adds VLAN from start to end to vnic template 20for($i=$startvlan;$i -le $endvlan;$i++){Get-UcsVnicTemplate -Name $vnictemplate | Add-UcsVnicInterface -ModifyPresent -DefaultNet false -Name \u0026#34;$i\u0026#34;} 21Disconnect-UCS You now are done! In my case I had to add 500 VLAN\u0026rsquo;s, so this script saved me quite a bit of time.\n","permalink":"https://davidstamen.com/2015/11/23/configuring-multiple-ucs-vlans/","tags":["Cisco UCS","Networking"],"title":"Configuring Multiple UCS VLAN's"},{"categories":["VMware"],"contents":"Ever wonder why a VM isn\u0026rsquo;t on the network?\nI was working on deploying some test VM\u0026rsquo;s and for some reason all the VM\u0026rsquo;s that were cloned decided to start with the network disconnected, and the connect on power on was also not selected.\nI decided to throw together this quick one-liner that will make sure every VM is set to start connected on power on and is currently connected.\n1Get-VM|Get-NetworkAdapter|Set-NetworkAdapter -StartConnected $true -Connected $true -Confirm:$false Voila! You are done.\n","permalink":"https://davidstamen.com/2015/11/18/disconnected-vnics/","tags":["Networking","PowerCLI"],"title":"Disconnected vNIC's?"},{"categories":["VMware"],"contents":"Have you ever worked with a Horizon View pool with 10 VM\u0026rsquo;s and deleted 3 and it recreated as 11? May want to pay attention to learn how you can reuse view desktop names.\nFirst you will need to connect to the ADAM database on one of your servers. Use KB2012377 for instructions.\nTo connect to the View ADAM database:\n Log in to one of the View Connection Servers as Domain Administrator. Click Start \u0026gt; Administrative Tools \u0026gt; ADSI Edit. In the console window, right-click ADSI Edit and click Connect to. In the Name field type:  View ADAM Database   Select Select or type a Distinguished Name or Naming Context. In the field below Select or type a Distinguished Name or Naming Context, type:  dc=vdi,dc=vmware,dc=int   Select Select or type a domain or server. In the field below Select or type a domain or server, type:  localhost:389   Click OK. Click View ADAM Database [localhost:389] to expand. Click DC=vdi,dc=vmware,dc=int to expand.  Now perform the following steps to set the pool to reuse the VM Names\n Expand dc=vdi,dc=vmware,dc=int Expand OU=Server Groups Double Click CN=(Pool Name) Find the entry \u0026ldquo;pae-VmNameReuseAllowed\u0026rdquo;  Open this entry and change the value to 1    The next VM should now start reusing the old VM names that were in the pool.\n","permalink":"https://davidstamen.com/2015/11/11/reusing-horizon-view-desktop-names/","tags":["Horizon View"],"title":"Reusing Horizon View Desktop Names"},{"categories":["Certification"],"contents":"Section 10 of the VCP6-DCV blueprint\nObjective 10.1: Configure Advanced vSphere Virtual Machine Settings  Determine how using a shared USB device impacts the environment Configure virtual machines for vGPUs, DirectPath I/O and SR-IOV Configure virtual machines for multicore vCPUs Differentiate virtual machine configuration settings Interpret virtual machine configuration files (.vmx) settings Enable/disable advanced virtual machine settings  Objective 10.2: Create and Manage a Multi-site Content Library  Publish a content catalog Subscribe to a published catalog Determine which privileges are required to globally manage a content catalog Compare the functionality of Automatic sync and On-Demand sync Configure Content Library to work across sites Configure Content Library authentication Set/configure Content Library roles Add/remove Content Libraries  Objective 10.3: Configure and Maintain a vCloud Air Connection  Create a VPN connection between vCloud Air and an on-premise site Deploy a virtual machine using vCloud Air Migrate a virtual machine to vCloud Air Verify VPN connection configuration to vCloud Air Configure vCenter Server connection to vCloud Air Configure replicated objects in vCloud Air Disaster Recovery service Given a scenario, determine the required settings for virtual machines deployed in vCloud Air  Check out another blueprint section  Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/16/section-10-administer-and-manage-vsphere-virtual-machines/","tags":["VCP6-DCV","Study Guide"],"title":"Section 10: Administer and Manage vSphere Virtual Machines"},{"categories":["Certification"],"contents":"Section 1 of the VCP6-DCV blueprint\nObjective 1.1: Configure and Administer Role-based Access Control   Compare and contrast propagated and explicit permission assignments\n An example of a propagated permission:  Most inventory objects inherit permissions from a single parent object in the hierarchy. For example, a datastore inherits permissions from either its parent datastore folder or parent data center. Virtual machines inherit permissions from both the parent virtual machine folder and the parent host, cluster, or resource pool simultaneously.   An example of an explicit permission:  User1 is assigned Permission to only see and modify VM1      View/Sort/Export user and group lists\n You can view, sort, and export lists of a hostâ€™s local users to a file that is in HTML, XML, Microsoft Excel, or CSV format.    Add/Modify/Remove permissions for users and groups on vCenter Server inventory objects\n Add a Permission to an Inventory Object  Browse to the object for which you want to assign permissions in the vSphere Web Client object navigator. Click the Manage tab and select Permissions. Click the Add icon, and click Add. Identify the user or group that will have the privileges defined by the selected role.  From the Domain drop-down menu, select the domain where the user or group is located. Type a name in the Search box or select a name from the list. Select the user or group and click Add. Click OK.   Select a role from the Assigned Role drop-down menu. (Optional) To limit propagation, deselect the Propagate to Child Objects check box. Click OK to add the permission.   Change Permissions  Browse to the object in the vSphere Web Client object navigator. Click the Manage tab and select Permissions. Click the line item to select the user or group and role pair. Click Change role on permission. Select a role for the user or group from the Assigned Role drop-down menu. To propagate the privileges to the children of the assigned inventory object, click the Propagate check box and click OK.   Remove Permissions  Browse to the object in the vSphere Web Client object navigator. Click the Manage tab and select Permissions. Click the appropriate line item to select the user or group and role pair. Click Remove permission.      Determine how permissions are applied and inherited in vCenter Server\n Global permissions are applied to a global root object that spans solutions, for example, both vCenter Server and vCenter Orchestrator. Use global permissions to give a user or group privileges for all objects in all object hierarchies.    Create/Clone/Edit vCenter Server Roles\n Create a Custom Role  Log in to vCenter Server with the vSphere Web Client. Select Home, click Administration, and click Roles. Click the Create role action (+) button. Type a name for the new role. Select privileges for the role and click OK.   Clone a Role  Log in to vCenter Server with the vSphere Web Client. Select Home, click Administration, and click Roles. Select a role, and click the Clone role action icon. Type a name for the cloned role. Select or deselect privileges for the role and click OK.   Edit a Role  Log in to vCenter Server with the vSphere Web Client. Select Home, click Administration, and click Roles. Select a role and click the Edit role action button. Select or deselect privileges for the role and click OK.      Configure VMware Directory Service\n Select a host in the vSphere Client inventory, and click the Configuration tab. Under Software, click Authentication Services. Click Properties. In the User Directory Services dialog box, select the directory service from the drop-down menu. Enter a domain. Click Join Domain. Enter the user name and password of a directory service user who has permissions to join the host to the domain, and click OK. Click OK to close the Directory Services Configuration dialog box.    Apply a role to a User/Group and to an object or group of objects\n Identify the user or group that will have the privileges defined by the selected role.  From the Domain drop-down menu, select the domain where the user or group is located. Type a name in the Search box or select a name from the list. Select the user or group and click Add. Click OK.   Select a role from the Assigned Role drop-down menu. Leave the Propagate to children check box selected in most cases. Click OK.    Change permission validation settings\n  vCenter Server periodically validates its user and group lists against the users and groups in the user directory. It then removes users or groups that no longer exist in the domain. You can disable validation or change the interval between validations. If you have domains with thousands of users or groups, or if searches take a long time to complete, consider adjusting the search settings.\n Browse to the vCenter Server system in the vSphere Web Client object navigator. Select the Manage tab and click Settings. Click General and click Edit. Select User directory. Change the values as needed. Click OK.      Determine the appropriate set of privileges for common tasks in vCenter Server\n Many tasks require permissions on more than one object in the inventory. You can review the privileges that are required to perform the tasks and, where applicable, the appropriate sample roles.    Compare and contrast default system/sample roles\n  System roles\n Cannot be modified or deleted.    Sample roles\n Apply to different user communities or restrict access for add-on tools. Several predefined user roles are included with vCenter Server and with ESXi systems. You can create new roles using these predefined user roles as a starting point.      Determine the correct permissions needed to integrate vCenter Server with other VMware products\n Global permissions are applied to a global root object that spans solutions, for example, both vCenter Server and vCenter Orchestrator. Use global permissions to give a user or group privileges for all objects in all object hierarchies. Each solution has a root object in its own object hierarchy. The global root object acts as a parent object to each solution object. You can assign global permissions to users or groups, and decide on the role for each user or group. The role determines the set of privileges. You can assign a predefined role or create custom roles. It is important to distinguish between vCenter Server permissions and global permissions.    Objective 1.2: Secure ESXi, vCenter Server, and vSphere Virtual Machines  Harden virtual machine access  Control VMware Tools installation  VM.disable-VMtools-autoinstall  Parameter: isolation.tools.autoInstall.disable Value: TRUE     Control VM data access Configure virtual machine security policies  The guest operating system that runs in the virtual machine is subject to the same security risks as a physical system. Secure virtual machines as you would secure physical machines.     Harden a virtual machine against Denial-of-Service attacks  Control VM-VM communications Control VM device connections Configure network security policies  Networking security policies determine how the adapter filters inbound and outbound frames. 3 types are as follows  Promiscuous Mode  Reject â€” Placing a guest adapter in promiscuous mode has no effect on which frames are received by the adapter. Accept â€” Placing a guest adapter in promiscuous mode causes it to detect all frames passed on the vSphere standard switch that are allowed under the VLAN policy for the port group that the adapter is connected to.   Mac Address Changes  Reject â€” If you set the MAC Address Changes to Reject and the guest operating system changes the MAC address of the adapter to anything other than what is in the .vmx configuration file, all inbound frames are dropped. Accept â€” Changing the MAC address from the Guest OS has the intended effect: frames to the new MAC address are received.     Forged Transmits  Reject â€” Any outbound frame with a source MAC address that is different from the one currently set on the adapter are dropped. Accept â€” No filtering is performed and all outbound frames are passed.       Harden ESXi Hosts  Enable/Configure/Disable services in the ESXi firewall  You can configure firewall properties to allow or deny access for a service or management agent. This can currently be set via the vSphere Web Client, vSphere client or command line.  Select a host from the inventory view and select configuration and then Security Profile.     Change default account access Add an ESXi Host to a directory service  You can configure a host to use a directory service such as Active Directory to manage users and groups. When you add an ESXi host to Active Directory all user and group accounts are assigned full administrative access to the host if the group ESX Admins exists.   Apply permissions to ESXi Hosts using Host Profiles  When you join a host to an Active Directory domain, you must define roles on the host for a user or group in that domain. Otherwise, the host is not accessible to Active Directory users or groups. You can use host profiles to set a required role for a user or group and to apply the change to one or more hosts. In the vSphere client select Management and then Host Profiles you can either use an existing or new host profile. Expand the profile tree and select Security Configuration, Permission Rules, Add Profile, Permission and then within configuration details use require a permission rule and add the appropriate settings. You can then select propagate permission and select ok.   Enable Lockdown Mode  Select a host from the inventory view and select configuration and then Security Profile. Click edit next to lockdown mode and select Enable.   Control access to hosts (DCUI/Shell/SSH/MOB)  By default, the ESXi Shell and SSH services are not running and only the root user can log in to the Direct Console User Interface (DCUI). If you decide to enable ESXi or SSH access, you can set timeouts to limit the risk of unauthorized access.     Harden vCenter Server  Control datastore browser access  You can use the Datastore.Low level file operations priveledge to restrict access to the database browser.  Allows performing read, write, delete, and rename operations in the datastore browser.     Create/Manage vCenter Server Security Certificates  The vSphere Certificate Manager utility allows you to perform most certificate management tasks interactively from the command line. vSphere Certificate Manager prompts you for the task to perform, for certificate locations and other information as needed, and then stops and starts services and replaces certificates for you.   Control MOB access  Use the Managed Object Browser only for debugging, and ensure that it is disabled in production systems.  Select the host in the vSphere Web Client and go to Advanced System Settings. Check the value of Config.HostAgent.plugins.solo.enableMob and change it as appropriate.     Change default account access  Because many appliances do not include default user accounts, the root account may still be able to directly login via SSH. To meet the compliance standards for non- repudiation, the SSH server on all hardened appliances comes preconfigured with the AllowGroups wheel entry to restrict ssh access to the secondary group wheel.   Restrict administrative privileges  Many tasks can be performed by the root user by default. Instead of allowing administrators to log in to the ESXi host using the root user account, you can apply different host configuration privileges to different named users from the vCenter Server permissions management interface. You can create a custom roles, assign privileges to the role, and associate the role with a named user and an ESXi host object from the vSphere Web Client.     Understand the implications of securing a vSphere environment  Security hardening for a typical Linux system potentially requires dozens of steps, such as changing file permissions, disabling services, and managing user privileges; ESXi requires none of these steps, most of which either are impossible to perform or have no effect. The primary measures required for hardening an ESXi host involve securing and properly managing the interfaces with the system that are used for configuration, management, and troubleshooting.    Objective 1.3: Enable SSO and Active Directory Integration   Describe SSO architecture and components\n vCenter Single Sign-On allows vSphere components to communicate with each other through a secure token mechanism instead of requiring users to authenticate separately with each component. Below are some examples of the SSO architecture for human and solution users    Differentiate available authentication methods with VMware vCenter\n vCenter Single Sign-On uses a combination of STS (Security Token Service), SSL for secure traffic, and authentication of human users through Active Directory or OpenLDAP and of solution users through certificates.    Perform a multi-site SSO installation\n In this configuration each site is independent with PSC replication between sites. The vCenter Server is aware of the site topologies and use the local PSC under normal circumstances. Customers are able to seamlessly move the vCenter Servers between PSCs when necessary. This topology allows for Enhanced Linked Mode (ELM) which is facilitated by the PSC. Enhanced Linked Mode provides for a single point of management for all vCenter Servers in the same vSphere domain. In vSphere 6 the Windows-based and Virtual Appliance-based vCenter Servers have the same operational maximums and can belong to the same linked mode configuration. The configuration replicates all license, global permissions, tags and roles across all sites    Configure/Manage Active Directory Authentication\n Active Directory authentication is configured from the Single Sign-On administration page, here you will add an additional identify source for Active Directory. If using Microsoft Active Directory, select Active Directory (Integrated Windows Authentication). It will auto-populate the root domain in the forest. If using Open LDAP, select and configure it.    Configure/Manage Platform Services Controller (PSC)\n The PSC includes common services used across VMware vCloudÂ® Suite. This includes VMware vCenter Single Sign-Onâ„¢, licensing, and certificate management. This is managed and configured by using the vSphere Web Client and selecting Administration and then System configuration and choosing the appropriate node.    Configure/Manage VMware Certificate Authority (VMCA)\n VMCA is included in each Platform Services Controller and in each embedded deployment. VMCA provisions each node, each vCenter Server solution user, and each ESXi host with a certificate that is signed by VMCA as the certificate authority. vCenter Server solution users are groups of vCenter Server services. See vSphere Security for a list of solution users. You can replace the default certificates. For vCenter Server components, you can use a set of command-line tools included in your installation. You have several options. You can either use the VMCA as a certificate authority or configure it to be an intermediate CA.    Enable/Disable Single Sign-On (SSO) Users\n You configure vCenter Single Sign-On from the vSphere Web Client. To configure vCenter Single Sign-On, you must have vCenter Single Sign-On administrator privileges. Having vCenter Single Sign-On administrator privileges is different from having the Administrator role on vCenter Server or ESXi. By default, only the user administrator-vsphere.local has administrator privileges on the vCenter Single SignOn server in a new installation Identify available authentication methods with VMware vCenter    Upgrade a single/multi-site SSO installation\n  Configure SSO policies\n Password Policy: You can configure the following parameters:  Description â€“ Password policy description. Required. Maximum lifetime â€“ Maximum number of days that a password can exist before it has to be changed. Restrict re-use â€“ Number of the userâ€™s previous passwords that cannot be set again. Maximum length â€“ Maximum number of characters that are allowed in the password. Minimum length â€“ Minimum number of characters required in the password. Character requirements â€“ Minimum number of different character types required in the password. Identical adjacent characters â€“ Maximum number of identical adjacent characters allowed in the password.   Lockout Policy: Specifies the condition under which a vCenter SSO account is locked when the user attempts to log in with incorrect credentials. Five login attempts and three minutes between failures are set by default. This policy also specifies the time that must elapse before the account is automatically unlocked.  Description â€“ Description of the lockout policy. Required. Max. number of failed login attempts â€“ Maximum number of failed login attempts that are allowed before the account is locked. Time interval between failures (seconds) â€“ Time period in which failed login attempts must occur to trigger a lockout. Unlock time (seconds) â€“ Amount of time that the account remains locked. If you enter 0, the account must be explicitly unlocked by an administrator.   Token Policy  Maximum token renewal count Maximum token delegation count Maximum bearer token lifetime Maximum holder-of-key token lifetime      Add/Edit/Remove SSO identity sources\n Open your Web browser and navigate to https://vcenter:9443, where vcenter is the FQDN of the vCenter Server. Log in with User name administrator@vsphere.local and the Password used during installation. Click Administration in the left-hand Navigator pane Click Configuration under vCenter Single Sign-On Click Identity Sources Click the green plus icon to Add Identity Source. If using Microsoft Active Directory, select Active Directory (Integrated Windows Authentication). It will autopopulate the root domain in the forest. If using Open LDAP, select and configure it. Highlight the newly added identity source. Click the Set as Default Domain icon. Click Yes in the pop-up.    Add an ESXi Host to an AD domain\n Select a host in the vSphere Client inventory, and click the Configuration tab. Under Software, click Authentication Services. Click Properties. In the User Directory Services dialog box, select the directory service from the drop-down menu. Enter a domain. Click Join Domain. Enter the user name and password of a directory service user who has permissions to join the host to the domain, and click OK. Click OK to close the Directory Services Configuration dialog box.    Check out another blueprint section  Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/16/section-1-configure-and-administer-vsphere-6x-security/","tags":["VCP6-DCV","Study Guide"],"title":"Section 1: Configure and Administer vSphere 6.x Security"},{"categories":["Certification"],"contents":"Section 2 of the VCP6-DCV blueprint\nObjective 2.1: Configure Advanced Policies/Features and Verify Network Virtualization Implementation   Create/Delete a vSphere Distributed Switch\n In the vSphere Web Client, navigate to a data center. In the navigator, right-click the data center and select Distributed Switch \u0026gt; New Distributed Switch. In Name and Location, type a name for the new distributed switch, or accept the generated name, and click Next. In Select version, select a distributed switch version and click Next. In Edit Settings configure the distributed switch settings.  Use the arrow buttons to select the Number of uplinks. Use the drop-down menu to enable or disable Network I/O Control. Select the Create a default port group check box to create a new distributed port group with default settings for this switch. (Optional) To create a default distributed port group, type the port group name in the Port group name, or accept the generated name. Click Next.   In Ready to complete, review the settings you selected and click Finish.    Add/Remove ESXi Hosts from a vSphere Distributed Switch\n In the vSphere Web Client, navigate to the distributed switch. From the Actions menu, select Add and Manage Hosts. Select Add hosts and click Next. Click New hosts, select from the hosts in your data center, and click OK. Select the tasks for configuring network adapters to the distributed switch and click Next. Configure physical NICs on the distributed switch.  From the On other switches/unclaimed list, select a physical NIC. Click Assign uplink. Select an uplink and click OK.   Click Next. Configure VMkernel adapters.  Select a VMkernel adapter and click Assign port group. Select a distributed port group and click OK.   Review the impacted services as well as the level of impact.   Click Next. Configure virtual machine networking.  To connect all network adapters of a virtual machine to a distributed port group, select the virtual machine, or select an individual network adapter to connect only that adapter. Click Assign port group. Select a distributed port group from the list and click OK.   Click Next and click Finish.    Add/Configure/Remove dvPort groups\n In the vSphere Web Client, navigate to the distributed switch. Right-click the distributed switch and select Distributed port group \u0026gt; New distributed port group. In the Select name and location section, type the name of the new distributed port group, or accept the generated name, and click Next. In the Configure settings section, set the general properties for the new distributed port group and click Next.   (Optional) In the Security section, edit the security exceptions and click Next.    Add/Remove uplink adapters to dvUplink groups\n In the vSphere Web Client, navigate to the distributed switch. From the Actions menu, select Add and Manage Hosts. Select Manage host networking and click Next. Click Attached hosts and select from the hosts that are associated with the distributed switch. Click Next. Select Manage physical adapters and click Next. From the On other switches/unclaimed list select a physical NIC . Click Assign uplink. Select an uplink or select Auto-assign. Click Next. Review the impacted services as well as the level of impact.   Click Next and click Finish.    Configure vSphere Distributed Switch general and - dvPort group settings\n In the vSphere Web Client, navigate to the distributed switch. Click Manage tab, click Settings, and select Properties. Click Edit. Click General to edit the vSphere Distributed Switch settings.   Click Advanced to edit the vSphere Distributed Switch settings.   Click OK.    Create/Configure/Remove virtual adapters\n In the vSphere Web Client, navigate to the distributed switch. From the Actions menu, select Add and Manage Hosts. Select Manage host networking and click Next. Click Attached hosts and select from the hosts that are associated with the distributed switch. Click Next. Select Manage VMkernel adapters and click Next. Click New adapter. On the Select target device page of the Add Networking wizard, select a distributed port group. On the Port properties page, configure the settings for the VMkernel adapter.   If you selected the vMotion TCP/IP or the Provisioning stack, click OK in the warning dialog that appears. (Optional) On the IPv4 settings page, select an option for obtaining IP addresses.   (Optional) On the IPv6 settings page, select an option for obtaining IPv6 addresses.   Review your setting selections in the Ready to complete page and click Finish. Follow the prompts to complete the wizard.    Migrate virtual machines to/from a vSphere Distributed Switch\n In the vSphere Web Client, navigate to the distributed switch. From the Actions menu, select Add and Manage Hosts. Select Manage host networking and click Next. Click Attached hosts and select from the hosts that are associated with the distributed switch. Click Next. Select Migrate virtual machine networking and click Next. Configure virtual machine network adapters to the distributed switch.  To connect all network adapters of a virtual machine to a distributed port group, select the virtual machine, or select an individual network adapter to connect only that adapter. Click Assign port group. Select a distributed port group from the list and click OK.   Click Next and click Finish.    Configure LACP on vDS given design parameters\n You configure a LAG with two or more ports and connect physical NICs to the ports. LAG ports are teamed within the LAG, and the network traffic is load balanced between the ports through an LACP hashing algorithm. You can use a LAG to handle the traffic of distributed port groups to provide increased network bandwidth, redundancy, and load balancing to the port groups. When you create a LAG on a distributed switch, a LAG object is also created on the proxy switch of every host that is connected to the distributed switch. For example, if you create LAG1 with two ports, LAG1 with the same number of ports is created on every host that is connected to the distributed switch. On a host proxy switch, you can connect one physical NIC to only one LAG port. On the distributed switch, one LAG port can have multiple physical NICs from different hosts connected to it. The physical NICs on a host that you connect to the LAG ports must be connected to links that participate in an LACP port channel on the physical switch. You can create up to 64 LAGs on a distributed switch. A host can support up to 32 LAGs. However, the number of LAGs that you can actually use depends on the capabilities of the underlying physical environment and the topology of the virtual network. For example, if the physical switch supports up to four ports in an LACP port channel, you can connect up to four physical NICs per host to a LAG.    Describe vDS Security Polices/Settings\n In the vSphere Web Client, navigate to the distributed switch. Navigate to the Security policy for the distributed port group or port.   Reject or accept promiscuous mode activation or MAC address changes in the guest operating system of the virtual machines attached to the distributed port group or port.   Review your settings and apply the configuration.    Configure dvPort group blocking policies\n In the vSphere Web Client, navigate to the distributed switch. Right-click the distributed switch in the object navigator and select Distributed Port Group \u0026gt; Manage Distributed Port Groups. Select the Miscellaneous check box and click Next. Select one or more distributed port group to configure and click Next. From the Block all ports drop-down menu, enable or disable port blocking, and click Next. Review your settings and click Finish.    Configure load balancing and failover policies\n In the vSphere Web Client, navigate to the distributed switch. Navigate the Teaming and Failover policy on the distributed port group or port.   From the Load Balancing drop-down menu, specify how the virtual switch load balances the outgoing traffic between the physical NICs in a team.   From the Network Failover Detection drop-down menu, select the method that the virtual switch uses for failover detection.   From the Notify Switches drop-down menu, select whether the standard or distributed switch notifies the physical switch in case of a failover. From the Failback drop-down menu, select whether a physical adapter is returned to active status after recovering from a failure.  If failback is set to Yes, the default selection, the adapter is returned to active duty immediately upon recovery, displacing the standby adapter that took over its slot, if any.  If failback is set to No for a distributed port, a failed adapter is left inactive after recovery only if the associated virtual machine is running. When the Failback option is No and a virtual machine is powered off, if all active physical adapters fail and then one of them recovers, the virtual NIC is connected to the recovered adapter instead of to a standby one after the virtual machine is powered on. Powering a virtual machine off and then on leads to reconnecting the virtual NIC to a distributed port. The distributed switch considers the port as newly added, and assigns it the default uplink port, that is, the active uplink adapter.     Specify how the uplinks in a team are used when a failover occurs by configuring the Failover Order list.  If you want to use some uplinks but reserve others for emergencies in case the uplinks in use fail, use the up and down arrow keys to move uplinks into different groups.     Review your settings and apply the configuration.    Configure VLAN/PVLAN settings for VM\u0026rsquo;s given communication requirements\n A private VLAN is identified by its primary VLAN ID. A primary VLAN ID can have multiple secondary VLAN IDs associated with it. Primary VLANs are Promiscuous, so that ports on a private VLAN can communicate with ports configured as the primary VLAN. Ports on a secondary VLAN can be either Isolated, communicating only with promiscuous ports, or Community, communicating with both promiscuous ports and other ports on the same secondary VLAN. In the vSphere Web Client, navigate to the distributed switch. On the Manage tab, click Settings. Select Private VLAN and click Edit. To add a primary VLAN, under Primary VLAN ID click Add and enter the ID of a primary VLAN. Click the plus sign (+) in front of the primary VLAN ID to add it to the list. To add a secondary VLAN, in the right pane click Add and enter the ID of the VLAN. Click the plus sign (+) in front of the secondary VLAN ID to add it to the list. From the drop-down menu in the Secondary VLAN type column, select either Isolated or Community. Click OK.    Configure traffic shaping policies\n In the vSphere Web Client, navigate to the distributed switch. Navigate to the Traffic Shaping policy for the distributed port group or port.   Configure traffic shaping policies.   Review your settings and apply the configuration.    Enable TCP Segmentation Offload support for a virtual machine\n  Enable Jumbo Frames support on appropriate components\n  Recognize behavior of vDS Auto-Rollback\n  Configure vDS across multiple vCenter Servers to support [Long Distance vMotion]\n  Compare and contrast vSphere Distributed Switch (vDS) capabilities\n  Objective 2.2: Configure Network I/O Control (NIOC)  Define NIOC Explain NIOC capabilities Configure NIOC shares/limits based on VM requirements Explain the behavior of a given NIOC setting Determine Network I/O Control requirements Differentiate Network I/O Control capabilities Enable/Disable Network I/O Control Monitor Network I/O Control  Check out another blueprint section  Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/16/section-2-configure-and-administer-advanced-vsphere-6x-networking/","tags":["VCP6-DCV","Study Guide"],"title":"Section 2: Configure and Administer Advanced vSphere 6.x Networking"},{"categories":["Certification"],"contents":"Section 3 of the VCP6-DCV blueprint\nObjective 3.1: Manage vSphere Storage Virtualization  Discover new storage LUNs Configure FC/iSCSI/FCoE LUNs as ESXi boot devices Create an NFS share for use with vSphere Enable/Configure/Disable vCenter Server storage filters Configure/Edit hardware/dependent hardware initiators Enable/Disable software iSCSI initiator Configure/Edit software iSCSI initiator settings Configure iSCSI port binding Enable/Configure/Disable iSCSI CHAP Determine use cases for fiber channel zoning Compare and contrast array thin provisioning and virtual disk thin provisioning  Objective 3.2: Configure Software-defined Storage  Discover new storage LUNs Configure FC/iSCSI/FCoE LUNs as ESXi boot devices Create an NFS share for use with vSphere Enable/Configure/Disable vCenter Server storage filters Configure/Edit hardware/dependent hardware initiators Enable/Disable software iSCSI initiator Configure/Edit software iSCSI initiator settings Configure iSCSI port binding Enable/Configure/Disable iSCSI CHAP Determine use cases for fiber channel zoning Compare and contrast array thin provisioning and virtual disk thin provisioning  Objective 3.3: Configure vSphere Storage Multi-pathing and Failover  Explain common multi-pathing components Differentiate APD and PDL states Given a scenario, compare and contrast Active Optimized vs. Active non-Optimized port group states Explain features of Pluggable Storage Architecture (PSA) Understand the effects of a given claim rule on multipathing and failover vExplain the function of claim rule elements:  Vendor Model Device ID SATP PSP   Change the Path Selection Policy using the UI Determine required claim rule elements to change the default PSP Determine the effect of changing PSP on Multipathing and failover Determine the effects of changing SATP on relevant device behavior Configure/Manage Storage Load Balancing Differentiate available Storage Load Balancing options Differentiate available Storage Multi-pathing Policies Configure Storage Policies Locate failover events in the UI  Objective 3.4: Perform Advanced VMFS and NFS Configurations and Upgrades  Describe VAAI primitives for block devices and NAS Differentiate VMware file system technologies Upgrade VMFS3 to VMFS5 Compare functionality of newly created vs. upgraded VMFS5 datastores Differentiate Physical Mode RDMs and Virtual Mode RDMs Create a Virtual/Physical Mode RDM Differentiate NFS 3.x and 4.1 capabilities Compare and contrast VMFS and NFS datastore properties Configure Bus Sharing Configure Multi-writer locking Connect an NFS 4.1 datastore using Kerberos Create/Rename/Delete/Unmount VMFS datastores Mount/Unmount an NFS datastore Extend/Expand VMFS datastores Place a VMFS datastore in Maintenance Mode Select the Preferred Path/Disable a Path to a VMFS datastore Enable/Disable vStorage API for Array Integration (VAAI) Given a scenario, determine a proper use case for multiple VMFS/NFS datastores  Objective 3.5: Setup and Configure Storage I/O Control  Describe the benefits of SIOC Enable and configure SIOC Configure/Manage SIOC Monitor SIOC Differentiate between SIOC and Dynamic Queue Depth - Throttling features Given a scenario, determine a proper use case for SIOC Compare and contrast the effects of I/O contention in environments with and without SIOC  Check out another blueprint section  Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/16/section-3-configure-and-administer-advanced-vsphere-6x-storage/","tags":["VCP6-DCV","Study Guide"],"title":"Section 3: Configure and Administer Advanced vSphere 6.x Storage"},{"categories":["Certification"],"contents":"Section 4 of the VCP6-DCV blueprint\nObjective 4.1: Perform ESXi Host and Virtual Machine Upgrades  Configure download source(s) Setup UMDS to setup download repository Import ESXi images Create Baselines and/or Baseline groups Attach Baselines to vSphere objects Scan vSphere objects Stage patches \u0026amp; Extensions Remediate an object Upgrade a vSphere Distributed Switch Upgrade VMware Tools Upgrade Virtual Machine hardware Upgrade an ESXi Host using vCenter Update Manager Stage multiple ESXi Host upgrades Align appropriate baselines with target inventory objects.  Objective 4.2: Perform vCenter Server Upgrades  Compare the methods of upgrading vCenter Server Backup vCenter Server database, configuration and certificate datastore Perform update as prescribed for Appliance or Installable Upgrade vCenter Server Appliance (vCSA) Given a scenario, determine the upgrade compatibility of an environment Determine correct order of steps to upgrade a vSphere implementation  Check out another blueprint section  Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/16/section-4-upgrade-a-vsphere-deployment-to-6x/","tags":["VCP6-DCV","Study Guide"],"title":"Section 4: Upgrade a vSphere Deployment to 6.x"},{"categories":["Certification"],"contents":"Section 5 of the VCP6-DCV blueprint\nObjective 5.1: Configure Advanced/Multilevel Resource Pools  Understand/Apply Determine the effect of the Expandable Reservation parameter on resource allocation Create a resource pool hierarchical structure Configure custom resource pool attributes Determine how resource pools apply to vApps Describe vFlash architecture Create/Remove a Resource Pool Add/Remove virtual machines from a Resource Pool Create/Delete vFlash Resource Pool Assign vFlash resources to VMDKs Given a scenario, determine appropriate shares, reservations and limits for hierarchical Resource Pools  Check out another blueprint section  Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/16/section-5-administer-and-manage-vsphere-6x-resources/","tags":["VCP6-DCV","Study Guide"],"title":"Section 5: Administer and Manage vSphere 6.x Resources"},{"categories":["Certification"],"contents":"Section 6 of the VCP6-DCV blueprint\nObjective 6.1: Configure and Administer a vSphere Backups/Restore/Replication Solution  Compare and contrast vSphere Replication compression methods Differentiate VMware Data Protection capabilities Configure recovery point objective (RPO) for a protected virtual machine Explain VMware Data Protection sizing guidelines Create/Delete/Consolidate virtual machine snapshots Install and Configure VMware Data Protection Create a backup job with VMware Data Protection Backup/Restore a virtual machine with VMware Data Protection Install/Configure/Upgrade vSphere Replication Configure VMware Certificate Authority (VMCA) integration with vSphere Replication Configure vSphere Replication for Single/Multiple VMs Recover a VM using vSphere Replication Perform a failback operation using vSphere Replication Deploy a pair of vSphere Replication virtual appliances  Check out another blueprint section  Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/16/section-6-backup-and-recover-a-vsphere-deployment/","tags":["VCP6-DCV","Study Guide"],"title":"Section 6: Backup and Recover a vSphere Deployment"},{"categories":["Certification"],"contents":"Section 7 of the VCP6-DCV blueprint\nObjective 7.1: Troubleshoot vCenter Server, ESXi Hosts, and Virtual Machines  Monitor status of the vCenter Server service Perform basic maintenance of a vCenter Server database Monitor status of ESXi management agents Determine ESXi Host stability issues and gather diagnostics information Monitor ESXi system health Locate and analyze vCenter Server and ESXi logs Determine the appropriate Command Line Interface (CLI) command for a given troubleshooting task Troubleshoot common issues, including:  vCenter Server service SSO vCenter Server connectivity Virtual machine resource contention, configuration and operation Platform Services Controller (PSC) Problems with installation VMware Tools installation Fault Tolerant network latency    Objective 7.2: Troubleshoot vSphere Storage and Network Issues  Identify and isolate network and storage resource contention and latency issues Monitor networking and storage resources using vROps alerts and all badges Verify network and storage configuration Verify a given virtual machine is configured with the correct network resources Monitor/Troubleshoot Storage Distributed Resource Scheduler (SDRS) issues Recognize the impact of network and storage I/O control configurations Recognize a connectivity issue caused by a VLAN/PVLAN Troubleshoot common issues with:  Storage and network Virtual switch and port group configuration Physical network adapter configuration VMFS metadata consistency    Objective 7.3: Troubleshoot vSphere Upgrades  Collect upgrade diagnostic information Recognize common upgrade issues with vCenter Server and vCenter Server Appliance Create/Locate/Analyze VMware log bundles Determine alternative methods to upgrade ESXi Hosts in event of failure Configure vCenter Server logging options  Objective 7.4: Troubleshoot and Monitor vSphere Performance  Monitor CPU and memory usage (including vRealize OM badges and alerts) Identify and isolate CPU and memory contention issues Recognize impact of using CPU/memory limits, reservations and shares Describe and differentiate critical performance metrics Describe and differentiate common metrics, including:  Memory CPU Network Storage   Monitor performance through esxtop Troubleshoot Enhanced vMotion Compatibility (EVC) issues Troubleshoot virtual machine performance with vRealize Operations Compare and contrast Overview and Advanced Charts  Objective 7.5: Troubleshoot HA and DRS Configurations and Fault Tolerance  Troubleshoot issues with:  DRS workload balancing HA failover/redundancy, capacity and network configuration HA/DRS cluster configuration vMotion/Storage vMotion configuration and/or migration Fault Tolerance configuration and failover issues   Explain the DRS Resource Distribution Graph and Target/Current Host Load Deviation Explain vMotion Resource Maps  Check out another blueprint section  Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/16/section-7-troubleshoot-a-vsphere-deployment/","tags":["VCP6-DCV","Study Guide"],"title":"Section 7: Troubleshoot a vSphere Deployment"},{"categories":["Certification"],"contents":"Section 8 of the VCP6-DCV blueprint\nObjective 8.1: Deploy ESXi Hosts Using Autodeploy  Describe the components and architecture of an Auto Deploy environment Use Auto Deploy Image Builder and PowerCLI scripts Implement Host Profiles with an Auto Deploy of an ESXi Host Install and configure Auto Deploy Understand PowerCLI cmdlets for Auto Deploy Deploy multiple ESXi Hosts using Auto Deploy Given a scenario, explain the Auto Deploy deployment model needed to meet a business requirement  Objective 8.2: Customize Host Profile Settings  Edit answer file to customize ESXi Host settings Modify and apply a storage path selection plugin (PSP) to a device using host profiles Modify and apply switch configurations across multiple hosts using a Host Profile Create/Edit/Remove a Host Profile from an ESXi Host Import/Export a Host Profile Attach and apply a Host Profile to ESXi Hosts in a cluster Perform compliance scanning and remediation of an ESXi Hosts and clusters using Host Profiles Enable or disable Host Profile components  Objective 8.3: Consolidate Physical Workloads using VMware Converter  Install vCenter Converter standalone instance Convert physical workloads using vCenter Converter Modify server resources during conversion Interpret and correct errors during conversion Deploy a physical host as a virtual machine using vCenter Converter Collect diagnostic information during conversion operation Resize partitions during the conversion process Given a scenario, determine which virtual disk format to use  Check out another blueprint section  Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/16/section-8-deploy-and-consolidate-vsphere-data-center/","tags":["VCP6-DCV","Study Guide"],"title":"Section 8: Deploy and Consolidate vSphere Data Center"},{"categories":["Certification"],"contents":"Section 9 of the VCP6-DCV blueprint\nObjective 9.1: Configure Advanced vSphere HA Features  Modify vSphere HA advanced cluster settings Configure a network for use with HA heartbeats Apply an admission control policy for HA Enable/disable advanced vSphere HA settings Configure different heartbeat datastores for an HA cluster Apply virtual machine monitoring for a cluster Configure Virtual Machine Component Protection (VMCP) settings Implement vSphere HA on a Virtual SAN cluster Explain how vSphere HA communicates with Distributed Resource Scheduler and Distributed Power Management  Objective 9.2: Configure Advanced vSphere DRS Features  Configure VM-Host affinity/anti-affinity rules Configure VM-VM affinity/anti-affinity rules Add/remove Host DRS Group Add/remove virtual machine DRS Group Enable/disable Distributed Resource Scheduler (DRS) affinity rules Configure the proper Distributed Resource Scheduler (DRS) automation level based on a set of business requirements Explain how DRS affinity rules effect virtual machine placement  Check out another blueprint section  Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/16/section-9-configure-and-administer-vsphere-availability-solutions/","tags":["VCP6-DCV","Study Guide"],"title":"Section 9: Configure and Administer vSphere Availability Solutions"},{"categories":["Certification"],"contents":"About to start to study for the VCP6 once again. So I figured I would start over with the guide as much of the blueprint has changed.\nAs I progress through the sections this page will be updated with new content.\n Section 1: Configure and Administer vSphere 6.x Security Section 2: Configure and Administer Advanced vSphere 6.x Networking Section 3: Configure and Administer Advanced vSphere 6.x Storage Section 4: Upgrade a vSphere Deployment to 6.x Section 5: Administer and Manage vSphere 6.x Resources Section 6: Backup and Recover a vSphere Deployment Section 7: Troubleshoot a vSphere Deployment Section 8: Deploy and Consolidate vSphere Data Center Section 9: Configure and Administer vSphere Availability Solutions Section 10: Administer and Manage vSphere Virtual Machines  ","permalink":"https://davidstamen.com/2015/10/14/vcp6-dcv-study-guide/","tags":["Study Guide","VCP6-DCV"],"title":"VCP6-DCV Study Guide"},{"categories":["VMware"],"contents":"So I am in the process of doing some vSphere 6 testing and needed to test a redeployment of one of my VCSA\u0026rsquo;s. The problem is when I went to redeploy it I got the following error.\nDecoding the error, I pretty much figured that the object already existed in the SSO database and I needed to delete the existing object. Here is how you do that.\n Log in as root to the appliance shell of the Platform Services Controller appliance with which the vCenter Server Appliance is registered. To enable the Bash shell, run the shell.set \u0026ndash;enabled true command.  Run the shell command to start the Bash shell and log in.   Run the cmsso-util unregister command to unregister the powered off vCenter Server Appliance.  cmsso-util unregister \u0026ndash;node-pnid vCenter-FQDNorIP \u0026ndash;username administrator@your_domain_name \u0026ndash;passwd vCenter-Single-Sign-On-password    The object is now deleted and you can redeploy your VCSA!\n","permalink":"https://davidstamen.com/2015/10/13/unregistering-vsphere-6-vcsa-from-psc/","tags":["vSphere 6.0","PSC"],"title":"Unregistering vSphere 6 VCSA from PSC"},{"categories":["Automation"],"contents":"With all this talk about VMware vs KVM I figured that I would attempt to load a base install of KVM to see what it was all about.\nHere is a quick vagrant runbook that will quickly get a 3 linux servers deployed and installed with KVM to play with.\nThere are 3 nodes..MGMT01,KVM01 and KVM02. I use MGMT01 VMM to manage KVM01 and KVM02.\nThe code can be found here.\nThe bootstrap_installkvm.sh file runs the following commands to install KVM.\n1sudo apt-get install --no-install-recommends lubuntu-desktop -y 2sudo apt-get install qemu-kvm qemu-system libvirt-bin bridge-utils virt-manager -y 3sudo adduser vagrant libvirtd 4sudo reboot ","permalink":"https://davidstamen.com/2015/10/12/using-vagrant-to-deploy-an-ubuntu-server-running-kvm/","tags":["Vagrant","Ubuntu","KVM"],"title":"Using Vagrant to Deploy an Ubuntu Server running KVM"},{"categories":["VMware"],"contents":"I wanted to share this handy script i created when you have a need to build out a new vCenter.\nThis script can be extremely handy as it will take care of creating the datacenter, cluster, adding hosts, creating datastores and then applying the appropriate host profile. It is all done via CSV files so it is extremely customizable.\nFiles to modify to customize your configuration  createdatacenter.csv - Contains the name of the datacenter to create. createcluster.csv - Contains the name of the cluster to create and the datacenter to put it in. createhosts.csv - Contains the Name of the host and which cluster to place them in. createdatastores.csv - Contains the name of the datastore, naaid of the lun and the datastore cluster to put it in. applyhostprofile.csv - Contains the name of the host and hostprofile to apply.  The code and Github Link can be found below.\nConfigvCenter.ps1\n1# Variables 2$vcenter = \u0026#34;vc.lab.local\u0026#34; 3$esxusername = \u0026#34;root\u0026#34; 4$esxpassword = \u0026#34;password\u0026#34; 5$DSC = \u0026#34;DSC01\u0026#34; 6$Datacenter = \u0026#34;Lab\u0026#34; 7 8#Connect to vCenter 9#Connect-VIServer -Server $vCenter 10 11# Create Datacenters 12Write-Host \u0026#34;Creating Datacenter\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; 13$csv = Import-CSV .\\createdatacenter.csv 14foreach ($datacenter in $csv) { 15 New-Datacenter -Location (Get-Folder -NoRecursion) -Name $datacenter.Name 16} 17 18# Create Clusters 19Write-Host \u0026#34;Creating Clusters\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; 20$csv = Import-CSV .\\createcluster.csv 21foreach ($cluster in $csv) { 22 New-Cluster -Name $cluster.Name -Location $cluster.Datacenter -DRSEnabled -DrsAutomationLevel FullyAutomated -HAEnabled 23} 24 25# Create Clusters 26Write-Host \u0026#34;Adding Hosts\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; 27$csv = Import-CSV .\\createhosts.csv 28foreach ($vmhost in $csv) { 29 Add-VMHost -Name $vmhost.Name -Location $vmhost.Cluster -User $esxusername -Password $esxpassword 30 Set-VMHost -VMHost $vmhost.Name -State Maintenance 31} 32 33# Create Datastores 34Write-Host \u0026#34;Creating Datastores\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; 35$csv = Import-CSV .\\createdatastores.csv 36foreach ($datastore in $csv) { 37 New-Datastore -VMHost $datastore.host -Name $datastore.Name -Path $datastore.NAAID -VMFS 38} 39 40# Create Datastore Cluster and Move Datastores In 41Write-Host \u0026#34;Creating Datastore Cluster and Adding Datastores\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; 42$csv = Import-CSV .\\createdatastores.csv 43New-DatastoreCluster -Name $DSC -Location $Datacenter 44foreach ($datastore in $csv) { 45 Move-Datastore $datastore.Name -Destination $datastore.DatastoreCluster 46} 47 48# Apply HostProfile 49Write-Host \u0026#34;Applying HostProfiles\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; 50$csv = Import-CSV .\\applyhostprofile.csv 51foreach ($hostprofile in $csv) { 52 Apply-VMHostProfile -Entity $hostprofile.Entity -Profile $hostprofile.Profile -Confirm:$false 53} 54 55Write-Host \u0026#34;Complete!\u0026#34; -ForegroundColor \u0026#34;Green\u0026#34; ","permalink":"https://davidstamen.com/2015/10/08/using-powercli-to-build-out-vcenter/","tags":["PowerCLI","vCenter Server"],"title":"Using PowerCLI to Build Out vCenter"},{"categories":["VMware"],"contents":"ESXi 5.5 Update 3a and its associated patch have been released. If you have been following KB2133118 in regards to the the Snapshot Consolidation causing Virtual Machines to crash a fix is now available.\nIf you are currently running ESXi 5.5 U3 you can use update manager to install the patch.\nIf you are looking to install ESXi 5.5 U3 from scratch or update from a previous version you should make sure you update to 5.5 U3a which includes the snapshot consolidation patch.\n","permalink":"https://davidstamen.com/2015/10/06/esxi-55-update-3a-released/","tags":["vSphere 5.5"],"title":"ESXi 5.5 Update 3a Released"},{"categories":["VMware"],"contents":"ESXi 6.0 Update 1a has been released. If you have been following KB2124669 in regards to the the NETDEV WATCHDOG issue causing an ESXi host to hang. The update is now available.\nIf you are currently running ESXi 6.0/6.0U1 you can use update manager to install the update.\nIf you are looking to install ESXi 6.0 U1 from scratch or update from a previous version you should make sure you update to use the latest ISO.\n","permalink":"https://davidstamen.com/2015/10/06/esxi-60-update-1a-released/","tags":["vSphere 6.0"],"title":"ESXi 6.0 Update 1a Released"},{"categories":["Automation"],"contents":"So I am in the process of rolling out a new 2012R2 DHCP Server Cluster, and I thought i would share my scripts with the community.\nI have also rolled it into a Vagrant package so you can easily test it on your own, and execute the scripts by themselves against your environment to deploy.\nHere is a link to the GitHub repository containing all the code.\nThe code is also fairly simple, it pulls in data from a few .CSV files and deploy\u0026rsquo;s the servers, installs the roles, creates the scopes, creates MAC Address allow policies and then creates a couple reservations.\nFiles to modify to customize your installation  dhcpservers.csv - IP\u0026rsquo;s of your two DHCP servers createscopes.csv - Contains your Scope Name, StartRange, EndRange, Mask and Server to deploy to scopeoptions.csv - Contains your server specific options. You can add more columns and adjust the code to add alternate options scopeoptions.csv - Contains your scope specific options. You can add more columns and adjust the code to add alternate options scopefailover.csv - Used to create Failover Scopes, Specify the ScopeID, PartnerServer, LoadBalancePercent, MaxClientLeadTime, AutoStateTransition, StateSwitchInterval and Server to deploy against scopepolicy.csv - Used to create Scope Policies. In this example it creates a MAC Allow list, so only Mac Addresses listed will be allowed to pull leases. scopereservations.csv - Used to create Scope Reservations. Input your ScopeID, MAC Address and Reservation Name. It automatically pulls an available IP and reserves it.  Execute the Vagrant package by downloading it and running.\n1vagrant up Execute the powershell script by downloading the scripts folder and running.\n1.\\install_ha_dhcp.ps1 Here is a copy of the raw code. 1# Powershell Script for Vagrant to install and configure DHCP 2# @davidstamen 3# http://davidstamen.com 4 5cd c:\\vagrant\\scripts 6 7$username = \u0026#34;vagrant\u0026#34; 8$password = \u0026#34;vagrant\u0026#34; 9$secstr = New-Object -TypeName System.Security.SecureString 10$password.ToCharArray() | ForEach-Object {$secstr.AppendChar($_)} 11$cred = new-object -typename System.Management.Automation.PSCredential -argumentlist $username, $secstr 12 13# Install the DHCP Role 14Write-Host \u0026#34;Installing DHCP Server Role\u0026#34; -ForegroundColor \u0026#34;Red\u0026#34; 15$csv = Import-CSV .\\dhcpservers.csv 16foreach ($server in $csv) { 17 Install-WindowsFeature DHCP -IncludeAllSubFeature -IncludeManagementTools -Computer $server.IP -Credential $cred -Verbose 18} 19 20# Authorize the DHCP server in Active Directory 21#Write-Host \u0026#34;Adding DHCP Server to AD\u0026#34; -ForegroundColor \u0026#34;Red\u0026#34; 22#$csv = Import-CSV .\\dhcpservers.csv 23#foreach ($server in $csv) { 24#Add-DhcpServerInDC -DnsName $server.Name -IPAddress $server.IP 25#} 26 27# Create an IPv4 DHCP scope 28Write-Host \u0026#34;Adding DHCP Scopes\u0026#34; -ForegroundColor \u0026#34;Red\u0026#34; 29$csv = Import-CSV .\\createscopes.csv 30foreach ($scope in $csv) { 31 Add-DhcpServerv4Scope -ComputerName $scope.Server -Name $scope.Name -StartRange $scope.Start -EndRange $scope.End -SubnetMask $scope.mask -Verbose 32} 33 34# Set DHCP Server Options 35Write-Host \u0026#34;Setting DHCP Server Options\u0026#34; -ForegroundColor \u0026#34;Red\u0026#34; 36$csv = Import-CSV .\\serveroptions.csv 37foreach ($scope in $csv) { 38 Set-DhcpServerv4OptionValue -ComputerName $scope.Server -DnsDomain $scope.DNSDomain -DNSServer $scope.DNSServer -Verbose 39} 40 41# Set DHCP Scope Options 42Write-Host \u0026#34;Setting DHCP Scope Options\u0026#34; -ForegroundColor \u0026#34;Red\u0026#34; 43$csv = Import-CSV .\\scopeoptions.csv 44foreach ($scope in $csv) { 45 Set-DhcpServerv4OptionValue -ComputerName $scope.Server -ScopeId $scope.scopeID -Router $scope.Router -Verbose 46 Set-DhcpServerv4Scope -ComputerName $scope.Server -ScopeId $scope.scopeID -LeaseDuration $scope.Lease -Verbose 47} 48 49# Configure Failover 50Write-Host \u0026#34;Configuring DHCP Failover\u0026#34; -ForegroundColor \u0026#34;Red\u0026#34; 51$csv = Import-CSV .\\scopefailover.csv 52foreach ($scope in $csv) { 53 Add-DhcpServerv4Failover -ComputerName $scope.Server -Name $scope.scopeID -PartnerServer $scope.PartnerServer -ScopeId $scope.scopeID -LoadBalancePercent $scope.LoadBalancePercent -MaxClientLeadTime $scope.MaxClientLeadTime -AutoStateTransition ([System.Convert]::ToBoolean($scope.AutoStateTransition)) -StateSwitchInterval $scope.StateSwitchInterval -Verbose 54} 55 56#Create MAC Allow List DHCP policy 57Write-Host \u0026#34;Creating MAC Allow List Policy\u0026#34; -ForegroundColor \u0026#34;Red\u0026#34; 58$csv = Import-CSV .\\scopepolicy.csv 59foreach ($scope in $csv) { 60 $maclist = @() 61 $operator = $scope.Operator 62 $maclist+=$operator 63 $maclist+=$Scope.MAC1 64 $maclist+=$Scope.MAC2 65 Add-DhcpServerv4Policy -ComputerName $scope.Server -Name $scope.Name -Description $scope.Description -ScopeId $scope.ScopeID -Condition $scope.Condition -MacAddress $maclist -Verbose 66 Add-DhcpServerv4PolicyIPRange -ComputerName $scope.Server -Name $scope.Name -ScopeId $scope.ScopeID -StartRange (Get-DHCPServerv4Scope $scope.ScopeID).StartRange -EndRange (Get-DHCPServerv4Scope $scope.ScopeID).EndRange -Verbose 67} 68 69#Reserve IP\u0026#39;s 70Write-Host \u0026#34;Reserving DHCP IPs\u0026#34; -ForegroundColor \u0026#34;Red\u0026#34; 71$csv = Import-CSV .\\scopereservations.csv 72foreach ($scope in $csv) { 73 Add-DhcpServerv4Reservation -ComputerName $scope.Server -ScopeId $scope.ScopeID -IPAddress (Get-DhcpServerv4FreeIPAddress -ComputerName $scope.Server -ScopeId $scope.ScopeID) -ClientId $Scope.MAC -Name $scope.Name -Verbose 74} 75 76#Replicate Settings 77Write-Host \u0026#34;Forcing Replication\u0026#34; -ForegroundColor \u0026#34;Red\u0026#34; 78Get-DhcpServerv4Failover -ComputerName $scope.Server|Invoke-DhcpServerv4FailoverReplication -ComputerName $scope.Server -Force 79#Convert Leases to Reservation 80#Get-DhcpServerv4Lease -ComputerName $server1 -ScopeID 10.10.10.0 | Add-DhcpServerv4Reservation -ComputerName $server1 81 ","permalink":"https://davidstamen.com/2015/10/01/using-vagrant-to-deploy-a-2012r2-dhcp-failover-cluster/","tags":["Vagrant","Windows"],"title":"Using Vagrant to Deploy a 2012R2 DHCP Failover Cluster"},{"categories":["VMware"],"contents":"I am currently troubleshooting some issues with the Horizon event database having some performance issues. Working with support they pointed me to KB2094580.\nBy Default the view event database is not indexed. I was curious as to way I always had issues pulling up events in the Horizon View Administrative interface, but as soon as I followed the steps, it was almost immediate now, where i use to have to wait an extremely long time.\nTo create an index on your event database run the following command on your SQL event database. XXX is the prefix of your database, if you do not have a prefix set, just leave it as dbo.event_data.\n1CREATE INDEX IX_eventid ON dbo.XXXevent_data (eventid) Your Horizon View DB is now Indexed. Enjoy the Speed!\n","permalink":"https://davidstamen.com/2015/09/30/indexing-your-horizon-view-database/","tags":["Horizon View"],"title":"Indexing your Horizon View Database"},{"categories":["VMware"],"contents":"Horizon 6.2 is now available and Linux support has improved. Previously it was only supported on a limited set of older operating systems.\nOriginally when we deployed we had deployed Ubuntu 12.04, however now the newer kernel 14.04 is supported so I will show you how to upgrade your desktop to the latest version and now use the new agent as well.\nIf you followed my [previous]({{ site.url }}/horizon%20view/horizon-view-block-linux-vdi-console-access/) post to disable Console access. Go ahead and shutdown the desktop and change it back to 1 to enable console, or you can do this all via SSH as well.\nLoad up xterm and type in the following commmand to upgrade the linux kernel.\n1do-release-upgrade This process will take some time and will run through all the updates, it can take a bit of time so grab a cup of coffee and sit back and wait.\nOnce it is done, it will let you know its time to reboot.\nNow that the system is upgraded we can now upgrade the view agent which is very simple.\nDownload the latest View Agent for Linux.\n SCP/SFTP/Etc\u0026hellip;the agent to your linux box. In my case I put it in /tmp cd to /tmp and run tar -xzvf  cd to the directory based on the name of your file Run sudo ./install_viewagent.sh Reboot and you are now done. If you enabled console again, follow the steps in the [post]({{ site.url }}/horizon%20view/horizon-view-block-linux-vdi-console-access/) to block console sessions again.  Your View Linux Desktop is now upgraded! Now enjoy the new features!\n","permalink":"https://davidstamen.com/2015/09/24/upgrading-horizon-view-linux-desktop/","tags":["Horizon View"],"title":"Upgrading Horizon View Linux Desktop"},{"categories":["VMware"],"contents":"vRealize Operations 6.1 is now available, I thought I would put a quick guide together as I go through the upgrade process. This guide will show how to upgrade the Horizon Adapter for vROPS.\nTo upgrade from vRealize Operations Horizon Adapter to the most recent version, follow these steps.\nDownload the neccessary file(s) needed. In my case I needed the vRealize Operations for Horizon Broker Agent and the vRealize Operations for Horizon Adapter.\n Log on to the View Connection server where the previous broker agent is installed.  Select the vRealize Operations View Broker Agent Settings and stop the Broker Agent Service.   Log on to the vRealize Operations Manager user interface with administrative permissions.  On the left pane select Administration and then Solutions. On the Solutions tab, select VMware Horizon and click the Add icon. Browse to the Horizon Adapter that you downloaded and select the .PAK file. Select Install the PAK file even if it is already installed. and Reset predefined content to a newer version provided by this update. and click Upload  Accept the EULA. Click Finish when the upgrade Completes.   Log back on to the View Connection Server where the previous broker agent is installed.  Run the vRealize Operations for Horizon Broker Agent file that you downloaded above. When finished, select the vRealize Operations View Broker Agent Settings and start the Broker Agent Service.    vRealize Operations Horizon Adapter is now upgraded! Now time to play with the new features.\n","permalink":"https://davidstamen.com/2015/09/22/upgrading-vrealize-operations-horizon-adapter-to-61/","tags":["vROPS"],"title":"Upgrading vRealize Operations Horizon Adapter to 6.1"},{"categories":["VMware"],"contents":"vRealize Operations 6.1 is now available, I thought I would put a quick guide together as I go through the upgrade process.\nTo upgrade from vRealize Operations Manager to the most recent version, follow these steps.\nDownload the PAK file(s) needed based on the type of cluster.\n vApp clusters  The vApp cluster requires the deployment of the OS upgrade and the product upgrade .pak files.  For an OS upgrade, the file is: vRealize_Operations_Manager-VA-OS-xxx.pak For the product upgrade of vApp clusters, the file is: vRealize_Operations_Manager-VA-xxx.pak     vApp heterogeneous clusters  The vApp heterogeneous cluster requires the deployment of the OS upgrade and the product upgrade .pak files.  For an OS upgrade, the file is: vRealize_Operations_Manager-VA-OS-xxx.pak For the product upgrade of a heterogeneous cluster that has VA nodes with Windows Remote Collectors, the file is: vRealize_Operations_Manager-VA-WIN-xxx.pak     RHEL standalone clusters  The RHEL standalone cluster requires the deployment of only the product upgrade .pak file. For the product upgrade of RHEL clusters, the file is: vRealize_Operations_Manager-RHEL-xxx.pak   RHEL heterogeneous clusters  The RHEL heterogeneous cluster requires the deployment of only the product upgrade .pak file. For the product upgrade of a heterogeneous cluster that has RHEL nodes with Windows Remote Collectors, the file is: vRealize_Operations_Manager-RHEL-WIN-xxx.pak   Windows clusters  The Windows cluster requires the deployment of only the product upgrade .pak file. For the product upgrade of Windows clusters, the file is: vRealize_Operations_Manager-WIN-xxx.pak    The rest of the upgrade process is pretty straightforward.\n On your existing vRealize Operations Manager cluster, log in to the administrator interface. https://FQDN/admin On the left, click Software Update. Click Install a Software Update. Perform the OS upgrade.  Select the .PAK file as listed above. Once uploaded, you will get the details that it is ready to install. Click Next  Accept the EULA You may get disconnected. Log back on and view the Software Update tab and you can see when the update is complete.    Install the cluster upgrade file.  Select the .PAK file as listed above. Once uploaded, you will get the details that it is ready to install. Click Next  Accept the EULA You may get disconnected. Log back on and view the Software Update tab and you can see when the update is complete.    vRealize Operations is now upgraded! Now proceed to update any adapters.\n","permalink":"https://davidstamen.com/2015/09/22/upgrading-vrealize-operations-to-61/","tags":["vROPS"],"title":"Upgrading vRealize Operations to 6.1"},{"categories":["VMware"],"contents":"I am actually pretty surprised this bug still exists. I came across this issue with my first deployment of vSphere 6. Now I am circling back around to do a POC and it still exists.\nWhen trying to join a Platform Services Controller to the domain via the vSphere Webclient I get the following error: \u0026ldquo;java.lang.reflect.invocationTargetException\u0026rdquo;\nThere are currently two workarounds now with 6.0U1 I am aware of.\n The first method is to join to the domain using the CLI.  1/opt/likewise/bin/domainjoin-cli join domain username  The second method is to use the new PSC interface to join to the domain.  Navigate to https://fqdnofpsc/psc Select Appliance Settings Click on Manage Under Active Directory Select Join and enter in your details    Why this method works here, and not in the VCSA Webclient is confusing to me, however here you go. Hopefully it helps you resolve the issue the next time you come across it.\n","permalink":"https://davidstamen.com/2015/09/21/unable-to-join-psc-to-domain-via-webclient/","tags":["PSC","Webclient"],"title":"Unable to join PSC to Domain via Webclient"},{"categories":["VMware"],"contents":"So I am in the midst of setting up a vSphere 6 POC and it has been a bit since I played with it. I came across a problem I thought i would document and share.\nWhile trying to setup my Platform Service Controllers for HA. I was having issues sshing into the appliance. I kept on getting errors, that the packet sizes were too big or just authentication would fail.\nBy Default the PSC and VCSA have a default shell of /bin/appliancesh.\nTo correct the issue we need to change the shell.\n1chsh -s \u0026#34;/bin/bash\u0026#34; root Once it is changed, we can now ssh/scp to it.\n","permalink":"https://davidstamen.com/2015/09/21/unable-to-ssh-to-vsphere-6-vcsa-or-psc/","tags":["SSH","vSphere 6.0"],"title":"Unable to SSH to vSphere 6 VCSA or PSC"},{"categories":["VMware"],"contents":"Horizon 6.2 Introduced Biometric Authentication, with initial support for TouchID on IOS devices.\nThis post will explain how to enable it, as its not really something greatly documented right now. I think they are aware and hopefully in a future update this will be easier.\nHere is a link to the current VMware documentation.\nNOTE: This feature does require a 3rd party trusted signed certificate to work. From my current testing and speaking with others self-signed certificates will not function.\n Log on to your connection server and launch ADSI Edit. In the Connection Settings dialog box, select or connect to DC=vdi,DC=vmware,DC=int. In the Computer pane, select or type localhost:389 or the fully qualified domain name (FQDN) of the View Connection Server host followed by port 389.  For example: localhost:389 or mycomputer.mydomain.com:389     On the object CN=Common, OU=Global, OU=Properties, edit the pae-ClientConfig attribute and add the value BioMetricsTimeout=-1.   The new setting takes effect immediately. You do not need to restart the View Connection Server service or the client device.  ","permalink":"https://davidstamen.com/2015/09/16/enabling-biometrics-in-horizon-view-62/","tags":["Horizon View"],"title":"Enabling Biometrics in Horizon View 6.2"},{"categories":["VMware"],"contents":"I had the opportunity to upgrade my Horizon View environment from 6.1 to 6.2. As always VMware has made this very easy!\nFirst download the bits from here.\nThe upgrade documentation can also be found here.\nWarning: In my environment I do not have a composer server, if you had one this would be upgraded first The upgrade order is as follows. Composer Server, Connection Servers and then Security Servers.\n Log on to your connection server and launch the executable.   Accept the End User License Agreement   Click Install to Upgrade.   Click Finish. Repeat Process for the rest of your connection servers.   Log on to your security server and launch the executable. If using IPSEC log on to View Administrator and \u0026ldquo;Prepare the Security Server for Upgrade or Reinstallation\u0026rdquo;   Accept the End User License Agreement   This screen should show the paired connection server. Click Next.   Logon to the paired connection server, and generate a server pairing password.   Enter in the password.   If you are not using IPSEC you will get the following warning. Click OK.   Verify the URL\u0026rsquo;s are correct, it should inherit these settings.   Allow the setup to automatically configure the windows firewall.   Hit Finish and Enjoy!  Im glad VMware has continued to make this process simple. I am looking forward to the features and ease of use with the new Horizon Access Point\u0026rsquo;s as well.\n","permalink":"https://davidstamen.com/2015/09/16/upgrading-horizon-view-61-to-62/","tags":["Horizon View"],"title":"Upgrading Horizon View 6.1 to 6.2"},{"categories":["VMware"],"contents":"I wanted to share this handy script i created when you have a need to extend a disk.\nThis script can be extremely handy as it will take care of extending the VMDK and then going to the OS and then performing the expansion there as well. This has been helpful when needing to extend a large batch of servers (60+).\nSyntax: .\\ExtendVMDKandGuest VMNAME\nYou will then be prompted to enter in the Hard Disk #, the size you want to be extended, and then which drive letter that volume belongs to.\nThe code and Github Link can be found below.\nExtendVMDKandGuest.ps1\n1# PowerCLI Script for adding vmdk to VM and extending disk in windows 2# @davidstamen 3# http://davidstamen.com 4 5param( 6 [string]$VM 7) 8$VM = Get-VM $VM 9Get-VM $VM|Get-HardDisk|FT Parent, Name, CapacityGB -Autosize 10$HardDisk = Read-Host \u0026#34;Enter VMware Hard Disk (Ex. 1)\u0026#34; 11$HardDisk = \u0026#34;Hard Disk \u0026#34; + $HardDisk 12$HardDiskSize = Read-Host \u0026#34;Enter the new Hard Disk size in GB (Ex. 50)\u0026#34; 13$VolumeLetter = Read-Host \u0026#34;Enter the volume letter (Ex. c,d,e,f)\u0026#34; 14Get-HardDisk -vm $VM | where {$_.Name -eq $HardDisk} | Set-HardDisk -CapacityGB $HardDiskSize -Confirm:$false 15Invoke-VMScript -vm $VM -ScriptText \u0026#34;echo rescan \u0026gt; c:\\diskpart.txt \u0026amp;\u0026amp; echo select vol $VolumeLetter \u0026gt;\u0026gt; c:\\diskpart.txt \u0026amp;\u0026amp; echo extend \u0026gt;\u0026gt; c:\\diskpart.txt \u0026amp;\u0026amp; diskpart.exe /s c:\\diskpart.txt\u0026#34; -ScriptType BAT ","permalink":"https://davidstamen.com/2015/09/15/using-powercli-to-extend-vmdk-and-windows-os-disk/","tags":["PowerCLI","Storage"],"title":"Using PowerCLI to Extend VMDK and Windows OS Disk"},{"categories":["VMware"],"contents":"I thought I would share this script, its been circulating a bit but I feel it is a nice one to have in your toolkit.\nHave you ever had to remove a LUN from a cluster and thought \u0026ldquo;Do I really need to detach all the LUN\u0026rsquo;s, before un-mapping from my SAN?\u0026rdquo;\n Unmount Datastore Detach LUN Un-map from SAN Rescan Cluster  Well here is a handy script with output. All you need to do is unmount your datastore(s), and then enter in your naaid of your LUN\u0026rsquo;s and the cluster you want to remove it from, save it an execute. All the LUN\u0026rsquo;s will be detached without having to manually go and detach it from every LUN in your cluster.\nThe code and Github Link can be found below.\nDetach-ScsiLun.ps1\n1# PowerCLI Script for detaching luns from a cluster 2# @davidstamen 3# http://davidstamen.com 4 5$LunIDs = \u0026#34;naa.6000000001\u0026#34;,\u0026#34;naa.600000002\u0026#34; 6$Clustername = \u0026#34;MyCluster\u0026#34; 7 8function Detach-Disk { 9 param( 10 [VMware.VimAutomation.ViCore.Impl.V1.Inventory.VMHostImpl]$VMHost, 11 [string]$CanonicalName ) 12 13 $storSys = Get-View $VMHost.Extensiondata.ConfigManager.StorageSystem 14 $lunUuid = (Get-ScsiLun -VmHost $VMHost | where {$_.CanonicalName -eq $CanonicalName}).ExtensionData.Uuid 15 16 $storSys.DetachScsiLun($lunUuid) 17} 18 19$ClusterHosts = Get-Cluster $Clustername | Get-VMHost 20 21Foreach($VMHost in $ClusterHosts) 22{ 23 Foreach($LUNid in $LunIDs) 24 { 25 Write-Host \u0026#34;Detaching\u0026#34; $LUNid \u0026#34;from\u0026#34; $VMHost -ForegroundColor \u0026#34;Yellow\u0026#34; 26 Detach-Disk -VMHost $VMHost -CanonicalName $LUNid 27 } 28} 29 ","permalink":"https://davidstamen.com/2015/09/14/using-powercli-to-detach-luns/","tags":["PowerCLI","Storage"],"title":"Using PowerCLI to Detach Luns"},{"categories":["VMware"],"contents":"Today vSphere 6.0 U1 is released. This is normally the update everyone waits for before upgrading their production environments to the latest version. I think the first time in awhile, a lot of people will wait.\nYou see, VMware has had a bug KB2124669 since ESXi 6.0 that can cause an ESXi host to randomly lose connection, freeze and overall act really terrible. With the release of 6.0U1 it still exists.\nHere is VMware\u0026rsquo;s exlanation of the cause.\n1ESXi migrates interrupts across physical CPUs in order to load balance the interrupt activity in the system. As part of the ESXi 26.0 changes to increase the number of interrupts supported, provisions were made to retire a vector on an old physical CPU when 3the interrupt migrates to a new one. In 6.0, interrupts tend to arrive at retired vectors, for unknown reasons at this time. There is however a workaround, but it can have an impact on CPU performance, and who want\u0026rsquo;s that?\nTo Install/Enable the script:\n11. Download the attached 2124669_stop_intr_mig.zip file. 22. Extract the file. 33. Copy the stop_intr_mig.py to the target ESXi host. 44. Enable the script when the system is running its most common \u0026#39;steady state\u0026#39; workload. (Not idling. Not spiking.) 55. Run this command chmod +x stop_intr_mig.py. 66. To enable the script execute stop_intr_mig.py 1 or /bin/python stop_intr_mig.py 1 However if you do feel like upgrading which I know must of us will at least do to our labs, here are the details.\nDownload vSphere 6.0 U1\nvCenter 6.0 U1 Release Notes\nESXI 6.0 U1 Release Notes\n","permalink":"https://davidstamen.com/2015/09/10/vsphere-60-update-1-released/","tags":["vSphere 6.0"],"title":"vSphere 6.0 Update 1 Released"},{"categories":["Blog"],"contents":"Did you know you could get host your own blog on Ravello Systems?\nIts actually quite easy and even easier with Jekyll. Jekyll is a great static content platform perfect for hosting your blog. It is all based on html/css/markdown and requires absolutely no database.\nPlease use my previous [blog]({% post_url 2015-09-08-how-to-deploy-a-jekyll-blog %}) on how to get it deployed.\nDisclaimer: This is in no way supported or recommended by Ravello Systems, running this 24x7 even with 1CPU will consume most of your free trial/vExpert hours. So please use this at your own risk. Lets get started!\n Logon to your existing Ravello account. If you do not have one you can sign up for the free trial Create your Application   Once your application is created you will be dropped to the Canvas. Here we can use a pre-existing blueprint(template) as our base. I used Ubuntu Server 14.04.1 20150301. Click and drag it to your Canvas.   By Default, the blueprint is a 1CPU, 2GB RAM, 32GB HDD which should be plenty to run your blog. You can customize your virtual machine on the following fields. Make sure to hit save!  Summary: Overall Details of your VM General: Name your VM here, add a description and hostname. You will also create and choose your keypair to use to logon to the linux server System: Allocate your CPU and RAM here Disks: Modify disk size or allocate additional space Network: Set IP to be DHCP or Static within your application.  Pro Tip: Use an Elastic IP so your server always has the same external IP   Services: Set what ports you want available externally, by default 22 for ssh is there, you will want to add http(port80) for your website to become available.   You will now see your updated VM and tabs for the enabled services. Now you are ready to Publish it.   Here you will chose whether you want to publish your VM for cost or performance and if you want to use Amazon or Google clouds.  I have chosen to use Amazon Performance based out of Virginia. You can see the details and breakdown on cost.     Your VM will now be published and started.  Once it is started you will see the status and the information to access it.     You can ssh to yoserver-jekyll-eagwapmr.srv.ravcloud.com linux VM with the following syntax.  ssh ubuntu@server-jekyll-eagwapmr.srv.ravcloud.com -i keyfilename.pem   Now you are logged on you can install and configure NGINX to host your website.  Update the repository: sudo apt-get update Install NGINX: sudo apt-get install nginx   Access your blog http://server-jekyll-eagwapmr.srv.ravcloud.com/  If you setup your services appropriately you will now see the Welcome to nginx! site. What?! It is that easy? Yep!     We will go one step further to reconfigure to host our own blog.  Create directory to host your site: sudo mkdir /var/www/mydomain.com Make website folder available publically: sudo chmod 775 /var/www/mydomain.com Upload your website content here. For Jekyll upload the built _sites folder.   Now lets configure nginx to host your new website!  Copy default configuration file as a template: sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/mydomain.com Use VIM to update file: VIM /etc/nginx/sites-available/mydomain.com We only need to edit a few lines here:  Change host directory from: root /usr/share/nginx/html; to root /var/www/mydomain.com Change server_name to be your websites URL: server_name localhost; to server_name www.mydomain.com mydomain.com;     Create link to publish site: sudo ln -s /etc/nginx/sites-available/mydomain.com /etc/nginx/sites-enabled/ Reload nginx config: sudo service nginx restart Your new site is now available! Enjoy being your own hosting provider.  ","permalink":"https://davidstamen.com/2015/09/08/deploying-and-hosting-jekyll-on-ravello-systems/","tags":["Jekyll","Ravello"],"title":"Deploying and Hosting Jekyll on Ravello Systems"},{"categories":["Blog"],"contents":"So after getting my blog up and running I figured I would do a quick how-to, on how to get a blog up and running. Its actually something you can do in less than 15 minutes.\n1~ $ gem install jekyll 2~ $ jekyll new myblog 3~ $ cd myblog 4~/myblog $ jekyll serve 5# =\u0026gt; Now browse to http://localhost:4000 and you will see the blog running! Easy Enough? Now how do you create a blog post?\nCreate a file with the following name in the _posts directory.\n1# Create a file with the following syntax 2YEAR-MONTH-DAY-title.md 3# Example: 2015-09-08-hi-to-my-new-blog.md Edit the above file and add this content. The format is done in markdown which is a very easy to write code. You can find some quick information here\n1--- 2layout: post 3title: \u0026#34;How To Deploy a Jekyll Blog\u0026#34; 4tags: 5- Category 6--- 7Type your blogpost here. Once you save your file, you can refresh your browser pointing to http://127.0.0.1:4000 and see your change. Once you are happy with your content you have two ways to publish this to the internet.\nYour own host.\nRun the following command and then upload the content in the _site directory.\n1jekyll build GitHub Pages You can also load the site into GitHub pages and have a fully functioning site at username.github.io You can use the following link for details. Host Jekyll Site using GitHub Pages\nOnce you get it all up and running you can look at other themes that you can clone from github and port over your posts and content.\nBe on the lookout for a future blogpost on how to get an Ubuntu Server running NGINX to host your Jekyll Blog.\n","permalink":"https://davidstamen.com/2015/09/08/how-to-deploy-a-jekyll-blog/","tags":["Jekyll"],"title":"How To Deploy a Jekyll Blog"},{"categories":["Automation"],"contents":"So as I was getting around to trying to get a host platform setup for a Jekyll blog I was looking at an alternative to GitHub Pages. I decided I would run it on Ubuntu Server using NGINX as the web platform.\nHere is a quick vagrant runbook that will quickly get a linux server deployed and install NGINX to host your website.\nThe code can be found here.\nThe bootstrap_linux_nginx.sh file runs the following commands to install NGINX. You can add commands to your file to automatically create your configuration and sites to publish automatically. By default this will just bring up the default nginx site.\n1sudo apt-get install nginx -y 2sudo service nginx start 3update-rc.d nginx defaults ","permalink":"https://davidstamen.com/2015/09/08/using-vagrant-to-deploy-an-ubuntu-server-running-nginx/","tags":["Vagrant","Ubuntu","Nginx"],"title":"Using Vagrant to Deploy an Ubuntu Server running NGINX"},{"categories":["Blog"],"contents":"New Blog Platform! I have had a bit of issues with performance on my blog recently and looking on how to not overpay for hosting services. A good friend of mine suggested using Jekyll and GitHub Pages, so I took the challenge. Within a day I was able to get my blog posts exported from Wordpress and published on a new platform and it was quite simple! Be on the lookout for some upcoming posts.\nAlso expect some new content, I have been doing some playing around with Vagrant and have some neat things to share2\n","permalink":"https://davidstamen.com/2015/09/04/updated-platform/","tags":["Jekyll"],"title":"Welcome to Jekyll!"},{"categories":["VMware"],"contents":"So I have had some time to play around with the new Linux Horizon View Agent and using Ubuntu as a VDI guest and it works pretty well. However as most of us have seen, when a user is logged onto the guest the screen is shown in the console. In some organizations this may pose a privacy or security risk.\nRight now there is no true workaround as that is how the view session is handled, however there is a workaround to disable console access.\nTo disable console access perform the following steps.  Shutdown VM. Edit Settings Select Options Tab, General and then select Configuration Parameters Select Add Row   For Name type in RemoteDisplay.maxConnections For Value type in 0  Hit OK, and Power on your VM.  This does limit some troubleshooting as if a user has issues you wont be able to see the console of the VM, but it is currently the only workaround and has a small tradeoff.\n","permalink":"https://davidstamen.com/2015/07/23/horizon-view-block-linux-vdi-console-access/","tags":["Horizon View"],"title":"Horizon View - Block Linux VDI Console Access"},{"categories":["VMware"],"contents":"So Horizon View 6.1.1 was released recently with added support for published applications to finally be accessible via the HTML client. The process is pretty straightforward, however I came across one hiccup I wanted to share.\nI am assuming you have already upgraded your View Composer, Connection and Security Servers and are now focused on getting the agents up to date.\n Install/Update Agents on virtual desktops to 6.1.1 (The HTML Access 3.4 client will not work with previous agent versions) Install/Update Agents on RDS servers to 6.1.1 Install the HTML Access 3.4 to all your connection servers within the appropriate enviroment if load balanced Now you can logon to your HTML Client and look for your published apps\u0026hellip;.however you will see that they are missing\u0026hellip;.looking into the actual guide for the html access there is an additional step.   HTML Access Guide  Log on to a connection server running 6.1.1 (If you are in a mixed enviroment this change cannot be made on a previous version. Navigate to Farms and then edit each RDS farm to enable HTML Access.  Voila you now have access to all your applications via the HTML client with a fancy new interface!   ","permalink":"https://davidstamen.com/2015/06/10/html-based-published-apps-with-horizon-view-6-1-1/","tags":["Horizon View"],"title":"HTML Based Published Apps with Horizon View 6.1.1"},{"categories":["Awards"],"contents":"I have been glad to have been accepted as a PernixPro. Look forward to seeing some more FVP related content on this blog, I am honored to have this title.\nPernixProâ„¢ members are an elite community of IT professionals committed to advancing FVP storage acceleration technology. By facilitating collaboration between PernixData experts and the industryâ€™s top luminaries, PernixPro breaks down the barriers to widespread adoption of server-side storage, giving companies of all sizes a cost-effective solution for scaling storage performance independent of storage capacity. - See more at: http://pernixdata.com/partners/pernixpro\n","permalink":"https://davidstamen.com/2015/05/07/honored-to-be-a-pernixpro/","tags":["Pernix Pro"],"title":"Honored to be a PernixPro"},{"categories":["Certification"],"contents":"Here is a bit of my experience with the VCP6-DCV Delta beta exam.\nInitial Thoughts Today I sat and took the VCP6-DCV Delta Exam beta. I have never taken a VMware beta exam so I wasn\u0026rsquo;t quite sure what to expect, from what I have been told, I expected lots of questions with bad grammar and horrible spelling. However today I got something a bit different. Ill explain it best without violating any NDA.\nI sat down and as usual started the exam. After the initial \u0026ldquo;Welcome to the Exam\u0026rdquo; screen which stated i would have 75 questions in 95 minutes. I was expecting some survey questions or introduction to the beta, however I was wrong you are immediately dropped into the test. About 40 minutes later I finished and felt pretty good, the bad news is I have to wait 8-10 weeks after the beta exam concludes for my results and based on my calculation I feel the beta exam will be around for at least another 4 weeks. This means i will need to wait between 12-14 weeks for my results.\nExam Content I feel the content the exam covered was a good mixture. The last DCV exam was about 2 years prior so I felt the new exam covered a good bitÂ of installation, administration, configuration and troubleshooting. This exam snuck up on me so I really didn\u0026rsquo;t get to complete as much studying as I wanted to, I only got up to Section 3.1. I feel if I would have gotten a chance to study the whole blueprint I would be feeling more comfortable with whatever my results may be. I will still continue to finish out my studying and guide just in case I dont get a satisfactory result. However based on the content I did study as always the blueprint lined up very well with the content on the exam.\nFeedback I really wish that there was notes for each question on the exam. There were some questions that would of benefited from user feedback, I know beta exams are there to really test the end user and I feel being able to provide feedback would of generally helped the beta process.\nWould I do it again? Maybe. Like I stated above but not being able to provide feedback, I feel like I was just an experiment with VMware to see how I could score the exam. If the beta exams returned to how they once were (Invite only and feedback allowed). I would definately be interested.\n","permalink":"https://davidstamen.com/2015/04/27/vcp6-dcv-delta-exam-beta-thoughts/","tags":["VCP6-DCV"],"title":"VCP6-DCV Delta Exam (Beta) Thoughts"},{"categories":["VMware"],"contents":"So one thing I have come across with a few VCSA6 installs was the inability to use login with current credentials via the Web client or vSphere client.\nWorking with VMware support we were finally able to get it working with a few tweaks and there is a current pending KB that has not been published yet. (KB2113038) I have been told this affects both an embedded deployment (VCSA and PSC together) and external deployment (VCSA and PSC seperate.)\nIf using an embedded VCSA+PSC make sure the VM is joined to the domain. If using an external VCSA and PSC you can easily join the PSC to the domain using the vSphere Web Client.  Log in to your vSphere Web Client. Navigate to Administration-\u0026gt;System Configuration-\u0026gt;Nodes Select your PSC and select the Active Directory Tab.   From here you can enter in your domain and credentials and join it to the domain, after it is successful you will need to restart the PSC.  If you try to select your VCSA and look for the Active Directory tab you will notice it is missing, to join your VCSA to the domain you need to perform the domain join via the CLI.  SSH to your VCSA Query the device to see if it is joined to the domain   /opt/likewise/bin/domainjoin-cli query   Join the device to the domain using the following syntax, you will need to enter int he domainname, user with rights to join domain   /opt/likewise/bin/domainjoin-cli join domainname adminusername   Once it is successful reboot the system and rerun the query to see if it was successfully joined   /opt/likewise/bin/domainjoin-cli query   At this point if you try to login with the current credentials you will still fail as there is one additional step. This will need to be completed on the VCSA virtual machine.   SSH to the appropriate appliance\n  Navigate to /etc/ and using your favorite text editor modify the nsswitch.conf file. (Examples are using VI)\n  Look for the line \u0026ldquo;password: compat ato\u0026rdquo; this line will need to be modified   Modify the line to read \u0026ldquo;passwd: compat ato lsass\u0026rdquo;   Once you have updated the file and saved it, restart the VCSA or its services\n   service vmware-vpxd restart  Now wait\u0026hellip;.in multiple tests it takes 30 minutes until you are able to logon using the credentials and it will now work for both the web and c# client.   In some cases this file will also need to be modified on the PSC.  ","permalink":"https://davidstamen.com/2015/04/13/vsphere6-unable-to-use-session-credentials/","tags":["vSphere 6.0"],"title":"vSphere6 - Unable to use session credentials"},{"categories":["VMware"],"contents":"So as always things change across multiple Window\u0026rsquo;s operating systems and VMware revisions. I had a need to extend the drives on about 50 VMs today and really didn\u0026rsquo;t want to do all that clicking. I remember awhile back it was easy to do this with a Basic Set-Harddisk and use the -ResizeGuestPartition but alas that has been removed from the current functionality. So I took my search to google and found a couple scripts that worked ok, but nothing that was a seamless experience.\nI will be sharing it with you to save you the time. The script is very simple all you need to do is pass it the VM Name, VMware Hard Disk #, New Hard Disk Size in GB, and the Volume Letter.1param( 2 [string]$VM 3) 4$VM = Get-VM $VM 5$HardDisk = Read-Host \u0026#34;Enter VMware Hard Disk (Ex. 1)\u0026#34; 6$HardDisk = \u0026#34;Hard Disk \u0026#34; + $HardDisk 7$HardDiskSize = Read-Host \u0026#34;Enter the new Hard Disk size in GB (Ex. 50)\u0026#34; 8$VolumeLetter = Read-Host \u0026#34;Enter the volume letter (Ex. c,d,e,f)\u0026#34; 9Get-HardDisk -vm $VM | where {$_.Name -eq $HardDisk} | Set-HardDisk -CapacityGB $HardDiskSize -Confirm:$false 10Invoke-VMScript -vm $VM -ScriptText \u0026#34;echo select vol $VolumeLetter \u0026gt; c:\\diskpart.txt \u0026amp;\u0026amp; echo extend \u0026gt;\u0026gt; c:\\diskpart.txt \u0026amp;\u0026amp; diskpart.exe /s c:\\diskpart.txt\u0026#34; -ScriptType BAT Once done, you can execute the script by running .\\ScriptName.ps1 VMname as seen in the below screenshot.\n","permalink":"https://davidstamen.com/2015/04/02/powercli-extend-vmdk-and-guest-os/","tags":["PowerCLI","Storage"],"title":"PowerCLI - Extend VMDK and Guest OS"},{"categories":["Certification"],"contents":"VMware has announced https://mylearn.vmware.com/mgrReg/plan.cfm?plan=64178\u0026amp;ui=www_cert the availability of the VCP6-DCV beta exams. The beta exam includes 3 seperate exams. If you are currently an active VCP you can either take the VCP6-DCV or VCP6-DCV Delta exam, and if you are currently not certified you are required to take the vSphere 6 Foundations and VCP6-DCV to obtain the certification.\nvSphere 6 Foundations : Exam code: 2V0-620\nVCP6-DCV : Exam Code: 2V0-621\nVCP6-DCV Delta : Exam Code: 2V0-621D\nThe good news is that the beta exams cost $50, definately better than the $225 price the exams will increase to once they go GA. One thing to note about Beta exams is you will not immediately recieve a score. Full details about the beta exams can be found here https://mylearn.vmware.com/mgrReg/plan.cfm?plan=63957\u0026amp;ui=www_cert .\nIf you look at the VCP6-DCV certification page, you will notice one thing missing. There is no longer a blueprint posted, but a web based version of it. I have taken the time and broken it out into PDF form which you can find attached to this blogpost, as I move through studying, I will be updating it with more content so please stay tuned for an updated version with study content.\nVCP6-DCV Foundations Study Guide\nVCP6-DCV Delta Study Guide\nVCP6-DCV Study Guide\n","permalink":"https://davidstamen.com/2015/04/01/vcp6-dcv-beta-exam/","tags":["VCP6-DCV"],"title":"VCP6-DCV Beta Exam"},{"categories":["VMware"],"contents":"I was trying to remove SRM 5.1 from our environment and kept getting an error that UAC must be disabled. Even though UAC was set to \u0026ldquo;Never Notify\u0026rdquo; SRM didnt like this.\nTo fully disable UAC run the following command from an elevated command prompt and then reboot the system.\n1REG ADD â€œHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Systemâ€ /v EnableLUA /t REG_DWORD /d 0 /f Note: You can also avoid this by doing the uninstall as the builtin local administrator account\n","permalink":"https://davidstamen.com/2015/02/18/srm-unable-to-uninstall-due-to-uac/","tags":["Site Recovery Manager"],"title":"SRM - Unable to uninstall due to UAC"},{"categories":["VMware"],"contents":"I was in the process of getting vRealize for Horizon configured, and as I was going through the broker agent configuration for the life of me I couldn\u0026rsquo;t get the eventdb portion to work. Everytime i entered in the user name and password, I would receive the following error. FAILED (Format of the initialization string does not conform to specification starting at index 88.)\nI knew it wasn\u0026rsquo;t a password issue as I was able to logon to SQL Manager with no issue, and the Horizon View EventsDB was working fine, so I went on a google search to try to hunt through logs. SQL Server was reporting i was entering the wrong password which made me think. In past issues some applications haven\u0026rsquo;t like certain characters in passwords.\nI came across this blog http://stackoverflow.com/questions/2030610/password-limitations-in-sql-server-and-mysql\nSo in the configuration page i entered in my password as \u0026ldquo;password\u0026rdquo;Â and voila it worked!\n","permalink":"https://davidstamen.com/2015/02/06/unable-to-configure-event-database-in-vrealize-operations-view-broker-agent/","tags":["Horizon View","vROPS"],"title":"Unable to Configure Event Database in vRealize Operations View Broker Agent"},{"categories":["VMware"],"contents":"I use a customized version of http://www.virtu-al.net/vcheck-pluginsheaders/vcheck/ by Alan Renouf to connect to multiple servers. However a coworker of mine was trying to run it, and the script would only return data from the 2nd vCenter we were connecting to.\nDoing some troubleshooting we noticed their DefaultVIServerMode was set to single. This means that only a single servers connection will occur at once. Changing this setting is very easy, there are 3 scopes, but only one really needs to be set. You can review the 3 scope options https://www.vmware.com/support/developer/PowerCLI/PowerCLI51/html/Set-PowerCLIConfiguration.html\nSee below for command to run, for Session scope which is valid for the current vSphere PowerCLI session only and overrides any User and All Users settings.\n1Set-PowerCLIConfiguration -DefaultVIServerMode multiple -Scope Session -Confirm:$false ","permalink":"https://davidstamen.com/2015/01/29/powercli-troubleshooting-multiple-default-servers/","tags":["PowerCLI"],"title":"PowerCLI - Troubleshooting Multiple Default Servers"},{"categories":["VMware"],"contents":"I had a need to enable CPU and Memory hotadd to many virtual machines prior to a template being updated, doing some research there is no easy way, however there are some functions out there to do it. You can copy and paste each function into a powershell window and then run the associated command.\n1Enable-MemHotAdd $ServerName 2Disable-MemHotAdd $ServerName 3Enable-vCPUHotAdd $ServerName 4Disable-vCPUHotAdd $ServerName Enable Memory HotAdd 1Function Enable-MemHotAdd($vm){ 2$vmview = Get-vm $vm | Get-View 3$vmConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec 4$extra = New-Object VMware.Vim.optionvalue 5$extra.Key=\u0026#34;mem.hotadd\u0026#34; 6$extra.Value=\u0026#34;true\u0026#34; 7$vmConfigSpec.extraconfig += $extra 8$vmview.ReconfigVM($vmConfigSpec) 9} Disable Memory HotAdd 1Function Disable-MemHotAdd($vm){ 2$vmview = Get-VM $vm | Get-View 3$vmConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec 4$extra = New-Object VMware.Vim.optionvalue 5$extra.Key=\u0026#34;mem.hotadd\u0026#34; 6$extra.Value=\u0026#34;false\u0026#34; 7$vmConfigSpec.extraconfig += $extra 8$vmview.ReconfigVM($vmConfigSpec) 9} Enable CPU HotAdd 1Function Enable-vCpuHotAdd($vm){ 2$vmview = Get-vm $vm | Get-View 3$vmConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec 4$extra = New-Object VMware.Vim.optionvalue 5$extra.Key=\u0026#34;vcpu.hotadd\u0026#34; 6$extra.Value=\u0026#34;true\u0026#34; 7$vmConfigSpec.extraconfig += $extra 8$vmview.ReconfigVM($vmConfigSpec) 9} 10 Disable CPU HotAdd 1Function Disable-vCpuHotAdd($vm){ 2$vmview = Get-vm $vm | Get-View 3$vmConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec 4$extra = New-Object VMware.Vim.optionvalue 5$extra.Key=\u0026#34;vcpu.hotadd\u0026#34; 6$extra.Value=\u0026#34;false\u0026#34; 7$vmConfigSpec.extraconfig += $extra 8$vmview.ReconfigVM($vmConfigSpec) 9} Notes: Enabling CPU Hotadd disables vNUMA. So enable enable this if its really neccessary in your environment. KB2040375\n","permalink":"https://davidstamen.com/2015/01/14/powercli-enable-cpu-and-memory-hotadd/","tags":["PowerCLI"],"title":"PowerCLI - Enable CPU and Memory HotAdd"},{"categories":["Security"],"contents":"So going though v7, v8 and v9 of the certificate guides I continued to have some issues getting the certificate to work and the steps never included ways to add subject alternative names. Upon further research I have identified a good step by step to replace the trend micro DSM certificate and include subject alternative names using a Microsoft certificate authority.\n Stop the â€œTrend Micro Deep Security Managerâ€ service If not already created, create a folder on the root of C:\\ called â€œcertsâ€ Go to C:\\Program Files\\Trend Micro\\Deep Security Manager and create a new folder called â€œBackupkeystoreâ€ Copy .keystore and configuration.properties to Backupkeystore folder Open administrative command line \u0026amp; change directory to â€œC:\\Program Files \\Trend Mirco\\Deep Security Manager\\jre\\bin\\â€ Run this command â€œkeytool -genkey -alias tomcat -keyalg RSA -dname cn=(FQDN of Server)â€. This will create a â€œ.keystoreâ€ file under the C:\\Users\\ directory When prompted for password enter a password for the keystore. Run this command â€œkeytool -certreq -keyalg RSA -alias tomcat -file certrequest.txtâ€ When prompted for password use same password as entered in step 6. Open the certrequest.txt located in C:\\Program Files \\Trend Micro\\Deep Security Manager\\jre\\bin\\ and copy the contents of the file. Access the CA server site https://certsrv and click â€œRequest a certificateâ€. Select â€œadvanced certificate requestâ€ Select â€œSubmit a certificate request by using a base-64-encoded CMC or PKCS #10 file, or submit a renewal request by using a base-64-encoded PKCS #7 fileâ€ Paste copied text from certrequest.txt in â€œBase-64-encoded certificate requestâ€ field, select â€œWeb Serverâ€ under Certificate Template and enter Subject Alternative Names under Additional Attributes using the following format: â€œsan:dns=\u0026amp;dns=â€ and click â€œSubmit.â€ Click â€œDownload certificate chainâ€ and save as â€œtrend.p7bâ€ in the certs folder on the C: drive From administrative command prompt run this command â€œkeytool -import -trustcacerts -alias tomcat -file C:\\certs\\trend.p7b -keystore C:\\Users\\.keystoreâ€ When prompted for password use same password as entered in step 6. When prompted to â€œInstall reply anywayâ€, type â€œyesâ€ Copy .keystore from C:\\Users%username%\\ and paste it into C:\\Program Files \\Trend Micro\\Deep Security Manager From administrative command prompt change directories to C:\\Program Files \\Trend Micro\\Deep Security Manager and run this command â€œ.\\configuration.propertiesâ€. This will open the configuration.properties in notepad. Look for the line keystorePass= and delete the entry after the = symbol, enter the password used in step 6 after the = and save and close the file. Restart the â€œTrend Micro Deep Security Managerâ€ service  ","permalink":"https://davidstamen.com/2014/12/19/updating-trend-micro-deep-security-manager-certificate/","tags":["Trend Micro"],"title":"Updating Trend Micro Deep Security Manager Certificate"},{"categories":["Awards"],"contents":"I am honored to have been accepted as a Cisco Champion for 2015! I guess this means I will continue and post to expand contentÂ on Cisco UCS and Cisco IronPort.\n","permalink":"https://davidstamen.com/2014/11/26/cisco-champion-2015/","tags":["Cisco Champion"],"title":"Cisco Champion 2015"},{"categories":["Microsoft"],"contents":"So after recently implementing directory sync i wanted to make sure any new groups were properly set up in active directory.\nUnfortunately i was unable to find any commands so thanks to MS Support I was able to find a way to identify these. You would think it would be under Get-DistributionGroup but it is actually under Get-MSolGroup. After connecting via remote powershell you can run the below command to see all that are not synced.\n1Get-MsolGroup -All | Select DisplayName, LastDirSyncTime | Where-Object {$_.LastDirSyncTime -eq $null} ","permalink":"https://davidstamen.com/2014/11/19/identity-dirsync-distribution-groups-in-office365/","tags":["Exchange"],"title":"Identify DirSync Distribution Groups in Office365"},{"categories":["Microsoft"],"contents":"So I have been working in a few situations where i have wanted to use Horizon 6 published (RDS) applications but having to either launch the Horizon View client within a VDI or have users be forced to logon again has been a deal breaker.\nUpon further research i finally found the right combination of settings to allow users to launch the RDS Hosted Applications via a Shortcut and automatically login to the view client making this process seamless.\nFor some reason when the Horizon View 3.0/3.1 client is installed within a VDI you are not given the option to \u0026ldquo;Logon As Current User\u0026rdquo; this is essentially the trick for this, so all credentials are automatically passed through. To work around this we need to use the vdm_Client.adm template to apply this settings at a group policy level.\n The first thing we need to do is download the Horizon 6 Group Policy Templates. They can be downloaded at the following link.   https://my.vmware.com/group/vmware/details?downloadGroup=VIEW-601-GA\u0026amp;productId=420\u0026amp;rPId=6889  Once we have the admin templates downloaded we need to create a new group policy using the vdm_Client.adm template. Load up Group Policy Management and create a new GPO Import the vdm_client.adm template by navigating to Computer Configuration/Policies/Administrative Templates, Right Click and Select Add template. Select vdm_client.adm and select ok. Once the client is loaded we can expand Classic Administrative Templates and now we see a new set of policies \u0026ldquo;VMware View Client Configuration\u0026rdquo; If we navigate to the \u0026ldquo;Scripting Definitions\u0026rdquo; subfolder we can configure the Server URL, and if needed any specific logon username, password and application launch settings. Next we will navigate to the \u0026ldquo;Security Settings\u0026rdquo; subfolder and we can configure \u0026ldquo;Default value of the \u0026lsquo;Log in as current user\u0026rsquo; checkbox, by default this is disabled, so we will want to set this to be enabled. We can now close the group policy editor and review the settingsviewclient Upon launching the Horizon View client, it will now automatically login to the URL specified with the currently logged on user. Right Click the Published Application and you have two choices. Create Shortcut, or Add to Start Menu. Now when a user launches a shortcut the Horizon View client will seamlessly launch.  ","permalink":"https://davidstamen.com/2014/10/29/horizon-view-6-single-sign-on-with-published-applications/","tags":["Horizon View"],"title":"Horizon View 6 - Single Sign On with Published Applications"},{"categories":["Microsoft"],"contents":"Chrome depreciated one of the features that allowed these popups to work, here is a temporary workaround to get it working.\nDownload the Chrome Policy Plugin here\n Open the zip file you just downloaded and locate the .ADM file that best matches your system: Extract the .ADM file to any folder on your hard drive Go to Start \u0026gt; Run, and run gpedit.msc Right-click Local Computer Policy \u0026gt; Computer Configuration \u0026gt; Administrative Templates, and select Add/Remove Templates: Add the adm template that you saved to disk earlier:   You should now see the template underneath a Google \u0026gt; Google Chrome section within Administrative Templates  Depending on which operating system you have, it might be under a Classic Administrative Templates (ADM) folder:    Click on Google Chrome in the left-hand pane and then double-click on the item called Enable deprecated web platform features in the list within the right-hand pane:   NOTE: It helps to sort the table in the right-hand pane by the Setting column in order to find the Enable deprecated web platform features item more easily.  In the new screen that appears, click the Enabled radio button: In the Options section of the same screen, click the Showâ€¦ button On the new screen that appears, type ShowModalDialog_EffectiveUntil20150430 into the first cell of the table thatâ€™s displayed and hit ENTER: -IMPORTANT NOTE: Make sure there are no spaces either before or after the ShowModalDialog_EffectiveUntil20150430 Otherwise, Chrome will reject the setting (see the Troubleshooting section for more information). Click OK To verify that this policy has taken effect, navigate to the following URL in Chrome: chrome://policy If everything is set up correctly, you should see a screen like the following  ","permalink":"https://davidstamen.com/2014/10/16/office-365exchange-eac-pop-ups-not-working-with-chrome-37/","tags":["Exchange","Chrome"],"title":"Office 365/Exchange EAC Pop Ups not working with Chrome 37"},{"categories":["VMware"],"contents":"As I was upgrading my VDP-A environment from 5.5 to 5.8 the upgrade failed due to the following error.\n\u0026ldquo;Please make sure you have at least 20GB for repo, 10GB for var, and 1GB for root partition.\u0026rdquo;\nUpon further research there seems to be an issue from 5.5.1 and 5.5.5 appliances with the /space partition filling up due to PostGres events. The issue can be resolving by installing the following VDP patch (vdp_patch-5.5.5.190.)\nKB2067635\nThe installation is pretty straightforward.  Download the patch   VDP VDP-Advanced  Copy the patch file to the VDP appliance and place it in the /root directory using filezilla/winscp Using an SSH session or the console of the VDP appliance, log in as root and run these commands:   chmod +x vdp_patch-5.5.5.190.run sh vdp_patch-5.5.5.190.run  After the installation is complete, verify all the services are running and you are good to go.\n","permalink":"https://davidstamen.com/2014/09/22/vmware-data-protection-insuffient-disk-space-for-upgrade/","tags":["VDP"],"title":"vSphere Data Protection - Insufficient Disk Space for Upgrade"},{"categories":["Microsoft"],"contents":"So upon trying to install .Net 3.5 on a new server today it would not allow me to, it kept telling me the source files were unavailable even after pointing to source directly to multiple ISO\u0026rsquo;s and copied the files locally.\nUpon further research I stumbled across this microsoft KB article and used it to ultimately find my fix. KB2734782\nHere are the full steps I followed to get .NET installed.   Open gpedit.msc to modify your local group policy.\n  Navigate to Computer Configuration/Administrative Tools/Systemand there should be an option for \u0026quot;Specify Settings for optional component installation.\u0026ldquo;Enable this option and select \u0026ldquo;Contact Windows Update directly to download repair content.\u0026rdquo;   Now open up an elevated cmd/powershell prompt and run a gpupdate /force to enforce the new policy\n  Run the following command to install .NET\n   DISM /Online /Enable-Feature /FeatureName:NetFx3 /All  ","permalink":"https://davidstamen.com/2014/09/11/unable-to-install-net-3-5-on-server-2012r2/","tags":["Windows"],"title":"Unable to Install .NET 3.5 on Server 2012R2"},{"categories":["VMware"],"contents":"We had a strange issue that any time a VM was snapshotted it then forced a reboot and sysprep. Reviewing the customization logs(C:\\windows\\temp\\vmware-imc\\guestcust.log) I noticed the following error..Unable to set customization status in vmx.\nUpon further research it seems this is a known issue and is resolved in ESXi 5.1 Express Patch 5 KB2077640 as referenced in this article KB2078352.\nHowever the hotfix only fixes future occurences, you still need to fix all the VMs affected. See below for the powercli script I created to connect to all my vcenters, get VM\u0026rsquo;s that are affected and then fix them. Please note as this is not referenced in the KB that the VM will need to be POWERED OFF and then POWERED ON for the change to go into affect. A restart will not fix it.\n1Connect-VIServer vcenter.lab.local 2$VMs = Get-VM | Get-AdvancedSetting -Name tools.deployPkg.fileName | Where-Object {$_.Value -ne \u0026#34;\u0026#34;} 3$VMs | Select Entity, Value 4$VMs | ForEach {Get-VM $_.Entity | Get-AdvancedSetting -Name tools.deployPkg.fileName | Set-AdvancedSetting -Value \u0026#39;\u0026#39; -Confirm:$false} ","permalink":"https://davidstamen.com/2014/07/08/sysprep-runs-repeatedly-on-virtual-machines-deployed-to-esxi-5-1-build-1743533/","tags":["PowerCLI","Sysprep","vSphere 5.1"],"title":"Sysprep runs repeatedly on virtual machines deployed to ESXi 5.1 build 1743533"},{"categories":["VMware"],"contents":"Thank you to everyone who listened to me on the EMEA vBrownbag. Here are copies of documentation and scripts on how to configure ESXi to use the remote dump collector.\nCheck the ESXi Dump Collector Configuration Example: 1Foreach ($vmhost in (get-vmhost)){ 2$esxcli = Get-EsxCli -vmhost $vmhost 3$esxcli.system.coredump.network.get()} Setting the ESXi Dump Collector Example: 1Foreach ($vmhost in (get-vmhost)) { 2$esxcli = Get-EsxCli -vmhost $vmhost 3$esxcli.system.coredump.network.set($null, â€œvmk0â€³, â€œIPtoDumpCollectorâ€³, â€œ6500â€³) 4$esxcli.system.coredump.network.set($true)} Test Host by Causing PSOD Run the following command via SSH or Direct Shell. We can see that the server is now doing a network coredump.\n1vsish -e set /reliability/crashMe/Panic 1 #Post-Installation Changes If you wish to change the default port or maxsize of the dump, these can be changed by modifying the vmconfig-netdump.xml file. See below link with instructions on how to make the changes and restart the Dump Collector Service. KB2002954\n#PowerCLI Scripts courtesy of Mike Laverick http://www.mikelaverick.com/2013/12/back-to-basics-installing-other-optional-vcenter-5-5-services/\n","permalink":"https://davidstamen.com/2014/06/10/configuring-esxi-5-5-dump-collector/","tags":["PowerCLI","Dump Collector"],"title":"Configuring ESXi 5.5 Dump Collector"},{"categories":["VMware"],"contents":"Thank you to everyone who listened to me on the EMEA vBrownbag. Here are copies of documentation and scripts on how to configure ESXi to use the Syslog collector.\nCheck the ESXi Syslog Collector Configuration Example: 1Foreach ($vmhost in (get-vmhost)){ 2$esxcli = Get-EsxCli -vmhost $vmhost 3$esxcli.system.syslog.config.get()} Setting the ESXi Syslog Collector Example: 1Foreach ($vmhost in (get-vmhost)){ 2$esxcli = Get-EsxCli -vmhost $vmhost 3$esxcli.system.syslog.config.set($null, $null, $null, $null,\u0026#34;udp://IPtoSyslogServer:514â€³) 4$esxcli.system.syslog.reload()} Post-Installation Changes If you wish to change the default port or maxsize of the syslog rotation, these can be changed by modifying the vmconfig-syslog.xml file. See below link with instructions on how to make the changes and restart the Syslog Collector Service. 2021652\nPowerCLI Scripts courtesy of Mike Laverick http://www.mikelaverick.com/2013/12/back-to-basics-installing-other-optional-vcenter-5-5-services/\n","permalink":"https://davidstamen.com/2014/06/10/configuring-esxi-5-5-syslog-collector/","tags":["PowerCLI","Syslog"],"title":"Configuring ESXi 5.5 Syslog Collector"},{"categories":["VMware"],"contents":"In Part 1 we showed you how to deploy vCloud Connector 2.6, and in Part 2 we showed you how to configure it.\nHere in Part 3 we will show you how to migrate a workload from your private cloud to your public cloud.\nLets go back to our vCenter and select our vCloud Connector Plugin\nExpand your vCenter and select the folder that contains the VM you wish to copy to vCHS. (The source VM must be powered off)\nSelect your VM and select the Copy Icon\nHere we will select our vCHS Cloud Node. Enter in a name for our VM and select which catalog in vCHS we wish to assign it to.\nSelect your vDC you wish you deploy the VM to.\nFrom here we have two options. If we already have a vApp in vCHS we we to use we will leave all the boxes unchecked.\nHowever if you do not have an existing vApp we will need to Deploy a vApp after copy. Here we will select the network mode (direct or fenced) and which network we wish to use. Make sure to UNCHECK guest customization as you will not want your VM to be re-sysprepped. You can then automatically choose to power on your vApp and remove the temporary one if needed.\nNext we will review our copy settings and choose validate.\nYou may receive an error about the staging space. This means you need to increase the disk space on the vCloud Connector Node to be equal to the size of the VM you are trying to migrate. In my case my VM was thin provisioned so there was no issue with this warning.\nSelect Finish and you will see your VM Copy begin.\nOnce the copy completes we can now navigate to our vCHS console and view our VM.\nLets navigate to https://vchs.vmware.com and logon. Lets select our VDC and select our Virtual Machines and now see our new workload.\nIf we wanted to modify the virtual machine/vAPP under related links we can \u0026ldquo;Manage Catalogs in vCloud Director\u0026rdquo;\nIf we select My Cloud, and then VM\u0026rsquo;s we can see our VM\u0026rsquo;s and shutdown and edit any settings we need and then power back on.\nNow we have migrated a workload from our private cloud to our public cloud! Hope this has helped you with any testing you need!\n","permalink":"https://davidstamen.com/2014/06/04/deploying-vcloud-connector-2-6-and-configuring-for-vchs-part-3/","tags":["vCloud Air"],"title":"Deploying vCloud Connector 2.6 and Configuring For vCHS (Part 3)"},{"categories":["VMware"],"contents":"So luckily i was selected for the June 2014 wave of vCloud Hybrid Service access as a vExpert. I have been looking forwarding to using vCHS since it went GA and am glad to finally have the opportunity to use it hands on.\nOnce I got access I knew I wanted to copy some of my existing workloads to vCHS instead of having to start from scratch. I begin to look for some good guides on implementing vCloud Connector 2.6 but couldn\u0026rsquo;t find anything as it was just released and majorly overhauled.\nSo here is my first howto blog post, I hope it helps you get your POC configured nice and smooth.\nFirst you will need to download the vCloud Connector Server and vCloud Connector Node from https://my.vmware.com. vCloud Connector 2.6 is now free and no longer needs a license.\nOnce you have the two OVF bundles downloaded you will need to deploy them through vCenter.\n Select File, Deploy OVF.  Now browse and select the vCloud Connector Server OVF File  Next you will be prompted with the OVF Information and requirements, select Next.  Accept the EULA.  Leave Default VM Name  Choose the host/cluster you wish to deploy to.  Choose a resource pool (if utilized)  Choose your datastore.  Choose your Disk Format, in most cases you may want to use Thin.  Select your network port group.  Fill in Static IP information, if you want to use DHCP leave all fields blank.  Review your settings and then hit Finish to deploy your vCloud Connector Server.  Repeat all steps above for your vCloud Connector Node. This will be utilized to add your Private Cloud (vCenter) to vCloud Connector to move virtual machines to vCHS.\nDeploying vCloud Connector 2.6 and Configuring For vCHS (Part 2)\n","permalink":"https://davidstamen.com/2014/06/03/deploying-vcloud-connector-2-6-and-configuring-for-vchs-part-1/","tags":["vCloud Air"],"title":"Deploying vCloud Connector 2.6 and Configuring For vCHS (Part 1)"},{"categories":["VMware"],"contents":"Here is Part 2 a continuation of Deploying vCloud Connector 2.6 and Configuring For vCHS (Part 1) (http://davidstamen.com/2014/06/03/deploying-vcloud-connector-2-6-and-configuring-for-vchs-part-1/) where we will configure vCloud connector to your Private(vCenter) and Public(vCHS) clouds.\nLets start with getting the vCloud Connector Server ready. Just in case you forgot what IP you assigned we can open the appliance and view the management information.\nAs we can see here the URL to configure the appliace is https://192.168.0.13:5480 and the default username is admin and default password is vmware.\nOnce logged in it is best to update the timezone. Select your timezone and make sure to Save Settings.\nIt is also best to make sure you change the default passwords, so select the Server tab and enter in your new information.\nThe next thing we want to do is make sure we register the vCloud Connector Server with vCenter so we get the plugin to manage the solution. Select the vSphere Tab underneath server and enter in your vCenter information and make sure to select register.Now that we have vCloud Connector registered with vCenter and the vSphere client we can go away and add in our nodes.\nNavigate to the nodes tab and select Register Node.\nIn order to register vCHS as a node we first need to logon and gather some information. So navigate to https://vchs.vmware.com and select your VDC. On the right hand side expand vCloud Director API URL underneath Related Links. We will need to copy the first aprt of the URL. In our case https://p1v17-vcd.vchs.vmware.com\nHere we will need to enter in the vCHS tenant information. Our Display Name(This will be the cloud name within vCloud Connector) the Node URL(This is the link to your vCHS Instance, append 8443 as vCHS uses a different port), If it is a public cloud(vCHS), Cloud Type will be vCloud Director, vCD-Org Name will be your vCD name within vCHS and then username and password will be your vCHS Information.\nOnce you are done select register and you will see your vCHS instance successfully registered. You will also note it appended the full url to the organization.\nNow we need to go ahead and configure our vCloud Connector Node to be able to add our vCenter(Private Cloud). Navigate to the management IP port 5480 and use the default username admin and password vmware as we did with the server. Make sure to update the timezone and password appropriately as we did above.\nNow we will navigate to the node tab and select Cloud Registration. This is where we will enter in our vCenter server. Enter in your vCenter IP and make sure to select Ignore SSL Cert if you are using the default certificate or future steps will fail. Select Update configuration and we are all done configuring the node.\nWe will now go back to the vCloud Connector Server to register our additional node. Enter in the Display Name in which it will show up in the management console, the node URL, will be the IP of the vCloud Connector Node, Cloud Type will be vSphere and the credentials will be an account with administrator rights into vCenter.\nSelect Register and you should now see your private and public clouds registered.\nNow that the vCloud Connector Server is all ready we can now add the Clouds we registered as nodes. Lets navigate to our vSphere client and look at a new plugin that has been added.\nOnce selected we can now add objects to our cloud, select Clouds and select the green + sign to add our private and public clouds to manage.\nLets add our Public Cloud (vCHS) First. From the Drop down for name select the display name you set above. All we need to enter here is your vCHS username and password and select Add.\nNow we can add our vCenter (Private Cloud)\nSelect the + sign again and choose your vCenter node you registered previously. Enter in the same username and password you used to register the node.\nNow if we go back to our Clouds tab we can now see both our public and private clouds registered.\nYou can now migrate your private cloud workloads to the public cloud!\nDeploying vCloud Connector 2.6 and Configuring For vCHS (Part 3)\n","permalink":"https://davidstamen.com/2014/06/03/deploying-vcloud-connector-2-6-and-configuring-for-vchs-part-2/","tags":["vCloud Air"],"title":"Deploying vCloud Connector 2.6 and Configuring For vCHS (Part 2)"},{"categories":["VMware"],"contents":"For upcoming testing there was a need to create 140 datastores on a cluster for testing. Who wants to do that much clicking and typing? Not me! You can use the below PowerCLI commands to get the SCSI ID\u0026rsquo;s, Create the Datastore and then Rescan all hosts in the cluster.\nHow do i get the CanonicalName for allocated disks? 1Get-SCSILun -VMhost 192.168.1.103 -LunType Disk | Select CanonicalName,Capacity How do I create a VMFS datastore for the CanonicalName I identified above? 1New-Datastore -VMHost HostÂ -Name Datastore -Path CanonicalName -VMFS How do i rescan all the hosts in the cluster to see the new datastore? 1Get-Cluster -name Cluster | Get-VMhost | Get-VMHostStorage -RescanAllHBA ","permalink":"https://davidstamen.com/2014/05/22/create-vmfs-datastore-using-powercli/","tags":["PowerCLI","Storage"],"title":"Create VMFS Datastore Using PowerCLI"},{"categories":["VMware"],"contents":"After upgrading vCenter this functionality is no longer enabled by default. Please perform the following steps to enable rename of files upon successful Storage vMotion.\n Log into the vSphere Client as an Administrator ClickÂ AdministrationÂ \u0026gt;Â vCenter Server Settings ClickÂ Advanced Settings Add this advanced parameter key:   provisioning.relocate.enableRename  Set the value to: true ClickÂ Add ClickÂ OK Restart the VMware VirtualCenter Server service for the changes to take effect  ","permalink":"https://davidstamen.com/2014/05/21/vsphere-5-x-storage-vmotion-does-not-rename-virtual-machine-files/","tags":["vMotion","Storage"],"title":"vSphere 5.x Storage vMotion Does Not Rename Virtual Machine Files."},{"categories":["VMware"],"contents":"If you are configuring a cluster with less than 2 datastores, you will receive an HA warning \u0026ldquo;The number of heartbeat datastores for host is 1, which is less than required: 2\u0026rdquo; You can add an option to the HA Advanced Options to supress this warning.\n Log in to vCenter Server Right-click the cluster and clickÂ Edit Settings ClickÂ vSphere HA \u0026gt; Advanced Options Under Option, add an entry for das.ignoreInsufficientHbDatastore Under Value, typeÂ true ClickÂ Cluster Features De-selectÂ Turn on vSphere HAÂ and clickÂ OK Wait for all the hosts in the cluster to re-configure HA, then right-click the cluster and clickÂ Edit Settings ClickÂ Cluster Features ClickÂ Turn on vSphere HA ClickÂ OK  ","permalink":"https://davidstamen.com/2014/05/08/ha-error-datastore-heartbeat-is-less-than-2/","tags":["Storage"],"title":"HA Error: Datastore Heartbeat is less than 2"},{"categories":["VMware"],"contents":"When setting up a cluster for testing you may not have 2 nics to use for management. to bypass the warning you can configure HA to not alert you for this issue.\nTo perform the steps in the c# client.  From the VMware Infrastructure Client, right-click on the cluster and clickÂ Edit Settings. SelectÂ vSphere HAÂ and clickÂ Advanced Options. In the Options column, enterÂ das.ignoreRedundantNetWarning In the Value column, typeÂ true ClickÂ OK. Right-click the host and clickÂ Reconfigure for vSphere HA. This reconfigures HA.  To perform the steps in the webclient.  From the vSphere Web Client, right click on the cluster. Click on theÂ Managetab for the cluster, then under Settings clickÂ vSphere HA. Click on theÂ Editbutton in the top right corner. Expand theÂ Advanced Optionssection, and clickÂ Add. In the Options column, typeÂ das.ignoreRedundantNetWarning. In the Value column, typeÂ true. ClickÂ OK Right-click the host and clickÂ Reconfigure for vSphere HA.  ","permalink":"https://davidstamen.com/2014/05/08/ha-error-network-redundancy/","tags":["Networking","HA"],"title":"HA Error: Network Redundancy"},{"categories":["VMware"],"contents":"This is a great script to keep handy. If you have multiple RDM\u0026rsquo;s on a VM and need to get the NAA_ID for them the below PowerCLI command will get you that information.\n1Get-VM VMNAME| Get-HardDisk -DiskType \u0026#34;RawPhysical\u0026#34;,\u0026#34;RawVirtual\u0026#34; | Select Parent,Name,DiskType,ScsiCanonicalName,DeviceName,CapacityGB | fl If you then need to match the SCSI virtual disk to the Guest OS this is a great article on how to do so.\nKB2051606\n","permalink":"https://davidstamen.com/2014/05/06/get-naa-id-for-virtual-machine-rdms-in-vmware/","tags":["PowerCLI","Storage"],"title":"Get NAA.ID for Virtual Machine RDM's in VMware"},{"categories":["Microsoft"],"contents":"I don\u0026rsquo;t know whats going on in the past few weeks but the sheer amount of zeroday exploits via email have risen. To protect yourselves against this I would recommend setting up a transport rule to drop or reject any email with executable content. This can be done for Exchange 2013 or Office365 (Exchange Online).\n Login to Exchange Admin Center using administrative credentials On the left pane select \u0026ldquo;Mail flow\u0026rdquo; On the top pane select \u0026quot; Rules\u0026rdquo; Click on the \u0026ldquo;+\u0026rdquo; sign and select create a new rule Give a name to the rule and select \u0026ldquo;more options\u0026rdquo; at the bottom of the page. Under \u0026quot;Apply the rule if\u0026quot;Select \u0026quot;Any attachment has executable content\u0026quot; Under \u0026quot;Do the following\u0026quot;Select \u0026ldquo;Reject the message with explanation\u0026rdquo; and input your text. Save the rule.  ","permalink":"https://davidstamen.com/2014/05/01/blocking-attachments-with-executable-content/","tags":["Exchange"],"title":"Blocking Attachments With Executable Content"},{"categories":["VMware"],"contents":"While continuing to build out my lab for VCAP-DCA today I had to deploy the vMA (vSphere Management Assistant). Upon deployment i tried to SSH to it and unfortunately was not able to. By default SSH is turned off, perform the steps below to enable it.\n Logon to vMA via a Console Session Run   \u0026lsquo;sudo vi /etc/hosts.allow\u0026rsquo;  Scroll to the very bottom and type i to insert content into the file. On the last line addÂ    \u0026lsquo;sshd: ALL: ALLOW\u0026rsquo;  Hit \u0026lsquo;ESC\u0026rsquo; then type \u0026lsquo;:wq!\u0026rsquo; to save. Restart SSH services to enable the change.   \u0026lsquo;sudo /etc/initd/sshd restart\u0026rsquo;  You will nowÂ be able to SSH to the vMA.  ","permalink":"https://davidstamen.com/2014/05/01/enable-ssh-on-vma-5-0/","tags":["SSH","vMA"],"title":"Enable SSH on vSphere Management Assistant 5.0"},{"categories":["Cisco"],"contents":"Building out some new servers today I came across an issue where the servers would have no network connectivity even though the vNICs were properly tagged and assign a VLAN ID. Upon further research, I noticed that \u0026ldquo;Native VLAN\u0026rdquo; was not selected. This is a must for any operating system that does not do VLAN Tagging such as ESXi.\nSo remember to set the VLAN to Native if using an operating system that does not support VLAN tagging!\n","permalink":"https://davidstamen.com/2014/04/29/cisco-ucs-and-native-vlan-tagging/","tags":["Cisco UCS"],"title":"Cisco UCS and Native VLAN Tagging"},{"categories":["VMware"],"contents":"I was working today on configuring NFS/Openfiler in my lab and came across an issue that my nested ESXi host\u0026rsquo;s couldn\u0026rsquo;t talk over the VSS (Standard Switch) I created. Upon further research when using nested ESXi you need to enable \u0026ldquo;Promiscuous Mode\u0026rdquo; on the VSS to allow the traffic to pass.\n","permalink":"https://davidstamen.com/2014/04/29/nested-esxi-and-nfs/","tags":["HomeLab","Networking"],"title":"Nested ESXi and NFS"}]